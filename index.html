<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RevisionVault Pro - University Study Materials</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1a2980;
            --secondary: #26d0ce;
            --accent: #ff4081;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --light: #f8fafc;
            --dark: #1e293b;
            --card-bg: #ffffff;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --radius: 16px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 0;
            padding-bottom: 100px;
        }

        /* Fixed Header Container */
        .header-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            padding: 15px 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
        }

        /* Logo Section */
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-shrink: 0;
        }

        .logo-icon {
            background: rgba(255, 255, 255, 0.9);
            width: 45px;
            height: 45px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 22px;
            box-shadow: var(--shadow);
        }

        .logo-text h1 {
            font-size: 22px;
            margin-bottom: 2px;
            font-weight: 800;
            letter-spacing: -0.5px;
            color: white;
        }

        .logo-text p {
            font-size: 12px;
            opacity: 0.9;
            font-weight: 400;
            color: rgba(255, 255, 255, 0.9);
        }

        /* Search Bar */
        .search-container {
            flex: 1;
            max-width: 600px;
            position: relative;
        }

        .search-box {
            width: 100%;
            padding: 14px 20px;
            padding-left: 45px;
            border: none;
            border-radius: 50px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            color: white;
            font-size: 15px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .search-box::placeholder {
            color: rgba(255, 255, 255, 0.8);
        }

        .search-box:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.25);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.2);
        }

        .search-icon {
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.9);
            font-size: 16px;
        }

        /* Search Suggestions */
        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-top: 8px;
            max-height: 300px;
            overflow-y: auto;
            display: none;
            z-index: 1001;
            border: 2px solid #e2e8f0;
        }

        .search-suggestions.active {
            display: block;
        }

        .suggestion-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 1px solid #e2e8f0;
        }

        .suggestion-item:hover {
            background: #f1f5f9;
        }

        .suggestion-code {
            font-weight: 700;
            color: var(--primary);
            font-size: 14px;
        }

        .suggestion-title {
            font-size: 12px;
            color: #64748b;
            margin-top: 4px;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Main Container */
        .main-container {
            margin-top: 100px;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
            background: white;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            min-height: calc(100vh - 180px);
        }

        /* Main Layout */
        .main-layout {
            display: grid;
            grid-template-columns: 280px 1fr 320px;
            min-height: 600px;
        }

        /* Left Sidebar */
        .sidebar-left {
            background: var(--light);
            padding: 25px 20px;
            border-right: 1px solid #e2e8f0;
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 16px;
            font-weight: 700;
        }

        .tools-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 25px;
        }

        .tool-card {
            background: var(--card-bg);
            padding: 18px 12px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tool-card:hover {
            transform: translateY(-3px);
            border-color: var(--primary);
            box-shadow: var(--shadow);
        }

        .tool-icon {
            font-size: 22px;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .tool-name {
            font-size: 12px;
            font-weight: 700;
            color: var(--dark);
        }

        .timetable {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            border: 2px solid #e2e8f0;
        }

        .week-display {
            font-size: 20px;
            font-weight: 800;
            color: var(--primary);
            text-align: center;
            margin-bottom: 5px;
        }

        .date-range {
            color: #64748b;
            text-align: center;
            margin-bottom: 15px;
            font-size: 13px;
        }

        .schedule-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            text-align: center;
        }

        .schedule-item {
            padding: 10px;
            background: #f1f5f9;
            border-radius: 8px;
        }

        .time {
            font-weight: 700;
            color: var(--primary);
            font-size: 12px;
        }

        .subject {
            font-size: 11px;
            color: #64748b;
            margin-top: 4px;
        }

        .ai-chat-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, var(--accent), #f50057);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 800;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 25px;
            transition: all 0.3s;
        }

        /* Main Content */
        .main-content {
            padding: 25px;
            background: white;
            overflow-y: auto;
            height: calc(100vh - 180px);
        }

        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .main-title {
            font-size: 24px;
            color: var(--primary);
            font-weight: 800;
        }

        .filters {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .filter-select {
            padding: 10px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            background: white;
            color: var(--dark);
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 140px;
        }

        .access-status {
            background: linear-gradient(135deg, #ffeaea, #ffc9c9);
            border: 3px solid var(--danger);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
        }

        .access-granted {
            background: linear-gradient(135deg, #d1fae5, #a7f3d0);
            border-color: var(--success);
        }

        /* Quick Unit Codes */
        .quick-units {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .unit-chip {
            background: #e0f2fe;
            color: var(--primary);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        /* Search Results */
        .search-results {
            display: none;
            margin-top: 20px;
        }

        .search-results.active {
            display: block;
        }

        /* Materials Grid */
        .materials-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 35px;
        }

        .material-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            overflow: hidden;
            border: 2px solid #e2e8f0;
            transition: all 0.3s;
        }

        .material-badge {
            position: absolute;
            top: 12px;
            left: 12px;
            background: linear-gradient(135deg, var(--accent), #f50057);
            color: white;
            padding: 6px 14px;
            border-radius: 50px;
            font-size: 10px;
            font-weight: 800;
            letter-spacing: 1px;
        }

        .material-badge.trending {
            background: linear-gradient(135deg, var(--warning), #f97316);
        }

        .material-badge.recent {
            background: linear-gradient(135deg, var(--success), #059669);
        }

        .material-image {
            height: 160px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.2);
            font-size: 60px;
            position: relative;
        }

        .material-content {
            padding: 20px;
        }

        .material-title {
            font-size: 16px;
            font-weight: 800;
            color: var(--dark);
            margin-bottom: 12px;
            line-height: 1.4;
        }

        .material-meta {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .material-code {
            background: #e0f2fe;
            padding: 5px 12px;
            border-radius: 50px;
            color: var(--primary);
            font-weight: 800;
            font-size: 12px;
        }

        .material-year {
            background: #fee2e2;
            padding: 5px 12px;
            border-radius: 50px;
            color: var(--danger);
            font-weight: 800;
            font-size: 12px;
        }

        .material-info {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #64748b;
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 12px;
        }

        .material-description {
            color: #64748b;
            font-size: 13px;
            line-height: 1.5;
            margin-bottom: 18px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .material-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            font-size: 13px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: all 0.3s;
        }

        .view-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .preview-btn {
            background: #f1f5f9;
            color: var(--dark);
            border: 2px solid #e2e8f0;
        }

        /* Right Sidebar */
        .sidebar-right {
            background: var(--light);
            padding: 25px 20px;
            border-left: 1px solid #e2e8f0;
            height: calc(100vh - 180px);
            overflow-y: auto;
        }

        .category-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 16px;
            background: var(--card-bg);
            border-radius: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            border: 2px solid #e2e8f0;
            transition: all 0.3s;
        }

        .category-name {
            font-weight: 700;
            color: var(--dark);
            font-size: 13px;
        }

        .category-count {
            background: #e0f2fe;
            padding: 3px 10px;
            border-radius: 50px;
            font-size: 11px;
            font-weight: 800;
            color: var(--primary);
        }

        .university-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .university-card {
            background: var(--card-bg);
            padding: 15px 10px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.3s;
        }

        .university-logo {
            width: 35px;
            height: 35px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 8px;
            font-weight: 800;
            font-size: 14px;
        }

        .premium-banner {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            padding: 20px;
            border-radius: var(--radius);
            text-align: center;
            margin-top: 25px;
            box-shadow: var(--shadow);
        }

        /* RAISED Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            border-radius: 50px;
            padding: 12px 25px;
            display: flex;
            gap: 10px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.25);
            z-index: 1000;
            border: 2px solid #e2e8f0;
            min-width: 550px;
            justify-content: space-around;
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
        }

        .nav-btn {
            background: none;
            border: none;
            padding: 12px 18px;
            border-radius: 30px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            font-size: 13px;
            color: #64748b;
            transition: all 0.3s;
            min-width: 100px;
            justify-content: center;
        }

        .nav-btn.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 8px 20px rgba(26, 41, 128, 0.3);
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 15px;
            color: #64748b;
            border-top: 1px solid #e2e8f0;
            background: var(--light);
            font-size: 13px;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
        }

        .form-select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            background: white;
            font-size: 14px;
            color: #495057;
        }

        .submit-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        /* Admin Panel Styles */
        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .admin-section {
            display: none;
        }

        .admin-list {
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
        }

        /* FULLSCREEN SIMPLE DOCUMENT VIEWER */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.98);
            z-index: 2000;
            padding: 0;
        }

        .modal.active {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: transparent;
            border-radius: 0;
            width: 100%;
            height: 100vh;
            overflow: hidden;
            box-shadow: none;
        }

        .modal-header {
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 10;
            height: 60px;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-title {
            font-size: 18px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 70%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .close-modal {
            background: rgba(255, 255, 255, 0.15);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .close-modal:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        .modal-body {
            padding: 0;
            margin: 0;
            height: 100vh;
            position: relative;
            padding-top: 60px; /* Space for header */
        }

        /* SIMPLE PDF VIEWER - Fullscreen with touch gestures */
        .pdf-viewer-container {
            width: 100%;
            height: 100%;
            position: relative;
            background: #000;
        }

        .pdf-viewer-frame {
            width: 100%;
            height: 100%;
            border: none;
            display: none;
            background: white;
        }

        .pdf-viewer-frame.active {
            display: block;
        }

        /* PDF Loading State */
        .pdf-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            background: #000;
            color: white;
            text-align: center;
            padding: 40px;
        }

        .pdf-loading i {
            font-size: 60px;
            margin-bottom: 20px;
            opacity: 0.8;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        .pdf-loading h3 {
            font-size: 24px;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .pdf-loading p {
            opacity: 0.8;
            max-width: 400px;
            line-height: 1.6;
        }

        .pdf-error {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            background: #000;
            color: white;
            text-align: center;
            padding: 40px;
        }

        .pdf-error i {
            font-size: 60px;
            margin-bottom: 20px;
        }

        .pdf-error h3 {
            font-size: 24px;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .pdf-error p {
            opacity: 0.9;
            max-width: 400px;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        /* AI Chat */
        #aiChatMessages {
            height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 120px;
            right: 20px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            display: none;
            z-index: 2001;
            max-width: 300px;
            border-left: 5px solid var(--success);
            transform: translateX(400px);
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .notification.show {
            display: block;
            transform: translateX(0);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
            .sidebar-left, .sidebar-right {
                display: none;
            }
            .main-content {
                height: auto;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 10px;
                padding: 10px;
            }
            
            .search-container {
                width: 100%;
                max-width: 100%;
            }
            
            .main-container {
                margin-top: 140px;
            }
            
            /* Mobile Bottom Navigation */
            .bottom-nav {
                bottom: 30px;
                min-width: 90%;
                padding: 10px 15px;
                gap: 5px;
            }
            
            .nav-btn {
                min-width: auto;
                padding: 10px 12px;
                font-size: 11px;
            }
            
            .nav-btn span {
                display: none;
            }
            
            .materials-grid {
                grid-template-columns: 1fr;
            }
            
            .filters {
                flex-direction: column;
                width: 100%;
            }
            
            .filter-select {
                width: 100%;
            }
            
            .main-content {
                height: auto;
                padding: 15px;
            }
            
            .sidebar-right {
                height: auto;
            }
            
            /* Mobile Document Viewer */
            .modal-header {
                padding: 12px 15px;
                height: 55px;
            }
            
            .modal-title {
                font-size: 16px;
                max-width: 65%;
            }
            
            .close-modal {
                width: 36px;
                height: 36px;
                font-size: 16px;
            }
            
            .modal-body {
                padding-top: 55px;
            }
            
            .pdf-loading i,
            .pdf-error i {
                font-size: 50px;
            }
            
            .pdf-loading h3,
            .pdf-error h3 {
                font-size: 20px;
            }
        }

        /* Small Mobile */
        @media (max-width: 480px) {
            .bottom-nav {
                bottom: 25px;
                padding: 8px 10px;
            }
            
            .nav-btn {
                padding: 8px 10px;
            }
            
            .nav-btn i {
                font-size: 14px;
            }
            
            .modal-header {
                padding: 10px 12px;
                height: 50px;
            }
            
            .modal-title {
                font-size: 14px;
                max-width: 60%;
            }
            
            .close-modal {
                width: 32px;
                height: 32px;
                font-size: 14px;
            }
            
            .modal-body {
                padding-top: 50px;
            }
        }

        /* Unlock Code Section Styles */
        .unlock-code-section {
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
            border: 3px solid #4caf50;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            display: none;
        }

        .unlock-code-section.active {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }

        .unlock-code-btn {
            background: linear-gradient(135deg, #ff9800, #f57c00);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
            transition: all 0.3s;
        }

        .unlock-code-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 152, 0, 0.3);
        }
    </style>
</head>
<body>
    <!-- Fixed Header -->
    <div class="header-container">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <div class="logo-text">
                    <h1>RevisionVault Pro</h1>
                    <p>University Study Materials Platform</p>
                </div>
            </div>
            
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-box" placeholder="Search by Unit Code e.g AGRO222" id="searchInput">
                <div class="search-suggestions" id="searchSuggestions"></div>
            </div>
            
            <div class="header-actions">
                <div class="price-tag">
                    <i class="fas fa-crown"></i>
                    <span>Ksh 67 for 5 Months</span>
                </div>
                <div class="contact-number">
                    <i class="fas fa-phone-alt"></i>
                    <span>0765 098 865</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <div class="main-layout">
            <!-- Left Sidebar -->
            <aside class="sidebar-left">
                <div class="section-title">
                    <i class="fas fa-tools"></i>
                    <span>POWERFUL Study Tools</span>
                </div>
                <div class="tools-grid">
                    <div class="tool-card" onclick="showNotification('StudyList', 'StudyList feature coming soon!')">
                        <div class="tool-icon"><i class="fas fa-list"></i></div>
                        <div class="tool-name">STUDYLIST</div>
                    </div>
                    <div class="tool-card" onclick="showNotification('Reminders', 'Reminders feature coming soon!')">
                        <div class="tool-icon"><i class="fas fa-bell"></i></div>
                        <div class="tool-name">REMINDERS</div>
                    </div>
                    <div class="tool-card" onclick="showNotification('Notes', 'Notes feature coming soon!')">
                        <div class="tool-icon"><i class="fas fa-sticky-note"></i></div>
                        <div class="tool-name">NOTES</div>
                    </div>
                    <div class="tool-card" onclick="showNotification('Tests', 'Tests feature coming soon!')">
                        <div class="tool-icon"><i class="fas fa-file-alt"></i></div>
                        <div class="tool-name">TESTS</div>
                    </div>
                    <div class="tool-card" onclick="showNotification('Downloads', 'Downloads feature coming soon!')">
                        <div class="tool-icon"><i class="fas fa-download"></i></div>
                        <div class="tool-name">DOWNLOADS</div>
                    </div>
                    <div class="tool-card" onclick="showNotification('Progress', 'Progress tracking coming soon!')">
                        <div class="tool-icon"><i class="fas fa-chart-line"></i></div>
                        <div class="tool-name">PROGRESS</div>
                    </div>
                </div>

                <div class="timetable">
                    <div class="section-title">
                        <i class="fas fa-calendar-alt"></i>
                        <span>My Timetable</span>
                    </div>
                    <div class="week-display">Week 24</div>
                    <div class="date-range">Mon, June 10 - Fri, June 14</div>
                    <div class="schedule-grid">
                        <div class="schedule-item">
                            <div class="time">9:00 AM</div>
                            <div class="subject">AGRO222</div>
                        </div>
                        <div class="schedule-item">
                            <div class="time">11:00 AM</div>
                            <div class="subject">BOTA241</div>
                        </div>
                        <div class="schedule-item">
                            <div class="time">2:00 PM</div>
                            <div class="subject">ZOOL210</div>
                        </div>
                    </div>
                </div>

                <button class="ai-chat-btn" onclick="openAIChat()">
                    <i class="fas fa-robot"></i>
                    AI CHAT
                    <span>ESSAYS | RESEARCH | ASSIGNMENTS</span>
                </button>
            </aside>

            <!-- Main Content -->
            <main class="main-content">
                <!-- Home Tab -->
                <div id="home" class="tab-content active">
                    <div class="content-header">
                        <h1 class="main-title">Continue Reading</h1>
                        <div class="filters">
                            <select class="filter-select" onchange="filterMaterials()" id="universityFilter">
                                <option value="all">All Universities</option>
                            </select>
                            <select class="filter-select" onchange="filterMaterials()" id="yearFilter">
                                <option value="all">All Years</option>
                                <option value="1">Year 1</option>
                                <option value="2">Year 2</option>
                                <option value="3">Year 3</option>
                                <option value="4">Year 4</option>
                            </select>
                        </div>
                    </div>

                    <div class="quick-units" id="quickUnits"></div>

                    <div id="accessStatus" class="access-status">
                        <div class="access-text">
                            <h3><i class="fas fa-lock"></i> Access Locked</h3>
                            <p>Subscribe to unlock all study materials and features</p>
                        </div>
                        <button class="view-btn" onclick="showTab('register')" style="width: auto; padding: 10px 20px;">
                            <i class="fas fa-crown"></i> Subscribe Now
                        </button>
                    </div>

                    <div class="search-results" id="searchResults">
                        <h2 class="search-results-title" id="searchResultsTitle"></h2>
                        <div class="materials-grid" id="searchResultsGrid"></div>
                    </div>

                    <div id="continueReading">
                        <div class="materials-grid" id="continueReadingGrid"></div>

                        <div class="section-divider" style="margin: 30px 0 25px; display: flex; align-items: center; gap: 15px;">
                            <div class="divider-line" style="flex: 1; height: 2px; background: linear-gradient(90deg, transparent, #e2e8f0, transparent);"></div>
                            <h2 style="font-size: 20px; color: var(--primary); font-weight: 800; white-space: nowrap;">Trending Materials</h2>
                            <div class="divider-line" style="flex: 1; height: 2px; background: linear-gradient(90deg, transparent, #e2e8f0, transparent);"></div>
                        </div>

                        <div class="materials-grid" id="trendingGrid"></div>
                    </div>
                </div>

                <!-- Materials Tab -->
                <div id="materials" class="tab-content">
                    <div class="content-header">
                        <h1 class="main-title">All Study Materials</h1>
                        <div class="filters">
                            <select class="filter-select" onchange="filterAllMaterials()" id="allUniversityFilter">
                                <option value="all">All Universities</option>
                            </select>
                            <select class="filter-select" onchange="filterAllMaterials()" id="allSubjectFilter">
                                <option value="all">All Subjects</option>
                            </select>
                        </div>
                    </div>
                    <div class="materials-grid" id="allMaterialsGrid"></div>
                </div>

                <!-- Register Tab -->
                <div id="register" class="tab-content">
                    <div class="content-header">
                        <h1 class="main-title">Student Registration</h1>
                    </div>
                    
                    <!-- Registration Form -->
                    <div id="registrationForm">
                        <div class="form-group">
                            <label class="form-label">Full Name</label>
                            <input type="text" class="form-input" id="studentName" placeholder="Enter your full name">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Phone Number (WhatsApp)</label>
                            <input type="tel" class="form-input" id="studentPhone" placeholder="07XXXXXXXX">
                            <small style="color: #6c757d; font-size: 12px;">This number will be used for WhatsApp verification</small>
                        </div>

                        <div class="form-group">
                            <label class="form-label">University</label>
                            <select class="form-select" id="studentUniversity">
                                <option value="">Select University</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Course/Program</label>
                            <input type="text" class="form-input" id="studentCourse" placeholder="e.g., BSc Agriculture">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Year of Study</label>
                            <select class="form-select" id="studentYear">
                                <option value="">Select Year</option>
                                <option value="1">Year 1</option>
                                <option value="2">Year 2</option>
                                <option value="3">Year 3</option>
                                <option value="4">Year 4</option>
                            </select>
                        </div>

                        <!-- UPDATED: Payment Instructions with fixed account number -->
                        <div class="payment-instructions" style="background: #e8f5e9; border: 3px solid #4caf50; border-radius: 15px; padding: 20px; margin: 20px 0;">
                            <h3 style="color: #4caf50; margin-bottom: 15px;">ðŸ’³ M-Pesa Payment Instructions</h3>
                            <p style="margin-bottom: 8px;">1. Go to <strong>M-Pesa</strong> on your phone</p>
                            <p style="margin-bottom: 8px;">2. Select <strong>Lipa Na M-Pesa</strong></p>
                            <p style="margin-bottom: 8px;">3. Select <strong>Pay Bill</strong></p>
                            <p style="margin-bottom: 8px;">4. Enter Business Number:</p>
                            <div style="text-align: center; margin: 15px 0;">
                                <div style="font-size: 28px; font-weight: bold; color: var(--primary);">247247</div>
                            </div>
                            <p style="margin-bottom: 8px;">5. Enter Account Number:</p>
                            <div style="text-align: center; margin: 15px 0;">
                                <div style="font-size: 28px; font-weight: bold; color: var(--primary);">0765 098 865</div>
                                <small style="color: #6c757d;">(This is the fixed account number)</small>
                            </div>
                            <p style="margin-bottom: 8px;">6. Enter Amount:</p>
                            <div style="text-align: center; margin: 15px 0;">
                                <div style="font-size: 32px; font-weight: bold; color: #4caf50;">Ksh 67</div>
                            </div>
                            <p style="margin-bottom: 8px;">7. Enter your <strong>M-Pesa PIN</strong></p>
                            <p style="margin-bottom: 8px;">8. Wait for confirmation message</p>
                            <p style="margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 8px; color: #856404;">
                                <i class="fas fa-info-circle"></i> Important: Always use account number <strong>0765098865</strong>
                            </p>
                        </div>

                        <div class="form-group">
                            <label class="form-label">M-Pesa Transaction Code</label>
                            <input type="text" class="form-input" id="paymentCode" placeholder="Enter transaction code (e.g., SDF45G7H)">
                        </div>

                        <div class="whatsapp-notice" style="background: #e3f2fd; border: 2px solid #2196f3; border-radius: 10px; padding: 15px; text-align: center; margin: 20px 0;">
                            <i class="fab fa-whatsapp" style="color: #25d366; font-size: 24px; margin-bottom: 10px;"></i>
                            <p><strong>WhatsApp Verification</strong></p>
                            <p style="font-size: 13px;">After submitting, your phone will send a WhatsApp message to admin automatically</p>
                        </div>

                        <button class="submit-btn" onclick="registerStudent()">
                            <i class="fas fa-paper-plane"></i> SUBMIT REGISTRATION & PAYMENT
                        </button>
                    </div>

                    <!-- Unlock Code Section (Combined with registration) -->
                    <div id="unlockCodeSection" class="unlock-code-section" style="display: none;">
                        <h3 style="color: #4caf50; margin-bottom: 15px;">
                            <i class="fas fa-key"></i> Account Activation Required
                        </h3>
                        <p style="margin-bottom: 15px; color: #6c757d;">
                            Your registration has been submitted successfully! The admin will send you an unlock code via WhatsApp. 
                            Once you receive it, click the button below to activate your account.
                        </p>
                        
                        <div class="form-group">
                            <label class="form-label">Your Phone Number</label>
                            <input type="tel" class="form-input" id="unlockPhone" placeholder="07XXXXXXXX" readonly>
                        </div>

                        <!-- NEW: Replaced unlock code button with a different button -->
                        <button class="unlock-code-btn" onclick="activateAccountWithUnlockCode()">
                            <i class="fas fa-rocket"></i> ACTIVATE MY ACCOUNT NOW
                        </button>

                        <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 10px; border-left: 4px solid #ff9800;">
                            <p style="color: #856404; margin-bottom: 8px; font-size: 14px;">
                                <i class="fas fa-lightbulb"></i> <strong>What happens next?</strong>
                            </p>
                            <ol style="color: #856404; font-size: 13px; padding-left: 20px;">
                                <li>Admin receives your registration</li>
                                <li>Admin approves and sends unlock code via WhatsApp</li>
                                <li>Click "ACTIVATE MY ACCOUNT NOW" button above</li>
                                <li>Enter the unlock code when prompted</li>
                                <li>Your account will be activated immediately!</li>
                            </ol>
                        </div>

                        <div style="text-align: center; margin-top: 20px;">
                            <button class="action-btn" onclick="showTab('login')" style="width: auto; padding: 12px 25px;">
                                <i class="fas fa-sign-in-alt"></i> Already activated? Login here
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Login Tab -->
                <div id="login" class="tab-content">
                    <div class="content-header">
                        <h1 class="main-title">Student Login</h1>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Phone Number</label>
                        <input type="tel" class="form-input" id="loginPhone" placeholder="07XXXXXXXX">
                    </div>

                    <button class="submit-btn" onclick="loginStudent()">
                        <i class="fas fa-sign-in-alt"></i> LOGIN
                    </button>

                    <div style="text-align: center; margin-top: 20px;">
                        <button class="action-btn" onclick="showTab('register')" style="width: auto; padding: 12px 25px;">
                            <i class="fas fa-user-plus"></i> Not registered? Click here
                        </button>
                    </div>

                    <div id="loginMessage" style="margin-top: 20px; padding: 15px; border-radius: 8px; display: none;"></div>
                </div>

                <!-- Admin Tab -->
                <div id="admin" class="tab-content">
                    <div class="content-header">
                        <h1 class="main-title">Admin Control Panel</h1>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Admin Password</label>
                        <input type="password" class="form-input" id="adminPassword" placeholder="Enter admin password">
                    </div>

                    <button class="submit-btn" onclick="adminLogin()">
                        <i class="fas fa-sign-in-alt"></i> LOGIN AS ADMIN
                    </button>

                    <div id="adminPanel" style="display: none; margin-top: 30px;">
                        <div class="admin-tabs">
                            <button class="nav-btn" onclick="showAdminSection('pending')" style="flex: none; padding: 12px 20px;">Pending Approvals</button>
                            <button class="nav-btn" onclick="showAdminSection('students')" style="flex: none; padding: 12px 20px;">All Students</button>
                            <button class="nav-btn" onclick="showAdminSection('materials')" style="flex: none; padding: 12px 20px;">Manage Materials</button>
                        </div>

                        <div id="pendingSection" class="admin-section" style="display: none;">
                            <h3 style="color: var(--primary); margin-bottom: 15px;">ðŸ“‹ Pending Subscriptions</h3>
                            <div class="admin-list" id="pendingList"></div>
                        </div>

                        <div id="studentsSection" class="admin-section" style="display: none;">
                            <h3 style="color: var(--primary); margin-bottom: 15px;">ðŸ‘¥ All Registered Students</h3>
                            <div class="admin-list" id="studentList"></div>
                        </div>

                        <div id="materialsSection" class="admin-section" style="display: none;">
                            <h3 style="color: var(--primary); margin-bottom: 15px;">ðŸ“š Manage Study Materials</h3>
                            <div style="margin-bottom: 20px;">
                                <button class="submit-btn" onclick="addNewMaterial()" style="width: auto; padding: 12px 25px;">
                                    <i class="fas fa-plus"></i> Add New Material
                                </button>
                            </div>
                            <div class="admin-list" id="adminMaterialsList"></div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Right Sidebar -->
            <aside class="sidebar-right">
                <div class="sidebar-section">
                    <h2 class="section-title">
                        <i class="fas fa-folder"></i>
                        Categories
                    </h2>
                    <ul class="category-list" id="categoryList"></ul>
                </div>

                <div class="sidebar-section">
                    <h2 class="section-title">
                        <i class="fas fa-university"></i>
                        Universities
                    </h2>
                    <div class="university-grid" id="universityGrid"></div>
                </div>

                <div class="premium-banner">
                    <div class="premium-title">
                        <i class="fas fa-crown"></i>
                        PREMIUM ACCESS
                    </div>
                    <p style="font-size: 13px;">Unlock all study materials for 5 months</p>
                    <div class="premium-price">Ksh 67</div>
                    <p style="font-size: 12px; opacity: 0.9;">One payment, full access to all resources</p>
                    <button class="premium-btn" onclick="showTab('register')">
                        <i class="fas fa-bolt"></i> SUBSCRIBE NOW
                    </button>
                </div>

                <div style="margin-top: 30px; text-align: center; color: #64748b; font-size: 13px; line-height: 1.6;">
                    <p><i class="fas fa-shield-alt"></i> Secure Payment</p>
                    <p><i class="fas fa-headset"></i> 24/7 Support</p>
                    <p><i class="fas fa-check-circle"></i> Money Back Guarantee</p>
                </div>
            </aside>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>&copy; 2025 RevisionVault Pro â€¢ Developed by Walter Zauko</p>
            <p style="margin-top: 3px;">Contact: 0765 098 865 â€¢ All rights reserved</p>
        </footer>
    </div>

    <!-- RAISED Bottom Navigation -->
    <div class="bottom-nav">
        <button class="nav-btn active" onclick="showTab('home')">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </button>
        <button class="nav-btn" onclick="showTab('materials')">
            <i class="fas fa-book"></i>
            <span>Materials</span>
        </button>
        <button class="nav-btn" onclick="showTab('register')">
            <i class="fas fa-user-plus"></i>
            <span>Register</span>
        </button>
        <button class="nav-btn" onclick="showTab('login')">
            <i class="fas fa-key"></i>
            <span>Login</span>
        </button>
        <button class="nav-btn" onclick="showTab('admin')">
            <i class="fas fa-shield-alt"></i>
            <span>Admin</span>
        </button>
    </div>

    <!-- SIMPLE FULLSCREEN DOCUMENT VIEWER MODAL -->
    <div class="modal" id="pdfModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="pdfModalTitle">
                    <i class="fas fa-file-pdf"></i>
                    <span>Document Viewer</span>
                </h2>
                <button class="close-modal" onclick="closeModal('pdfModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="pdf-viewer-container">
                    <!-- Loading State -->
                    <div class="pdf-loading" id="pdfLoading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <h3>Loading Document...</h3>
                        <p>Please wait while we load your document.</p>
                    </div>
                    
                    <!-- Error State -->
                    <div class="pdf-error" id="pdfError" style="display: none;">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>Document Not Available</h3>
                        <p>The requested document could not be loaded. Please try again later or contact support.</p>
                        <button class="action-btn" onclick="closeModal('pdfModal')" style="width: auto; padding: 10px 20px; background: var(--primary); color: white;">
                            <i class="fas fa-times"></i> Close
                        </button>
                    </div>
                    
                    <!-- PDF Viewer - Fast loading with no controls -->
                    <iframe class="pdf-viewer-frame" id="pdfViewer" 
                            frameborder="0" 
                            scrolling="yes"
                            sandbox="allow-scripts allow-same-origin"
                            loading="eager">
                    </iframe>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Chat Modal -->
    <div class="modal" id="aiChatModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title"><i class="fas fa-robot"></i> AI Study Assistant</h2>
                <button class="close-modal" onclick="closeModal('aiChatModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                    <p>AI Chat helps with essays, research, assignments, and study questions. Ask anything!</p>
                </div>
                
                <div id="aiChatMessages" style="height: 300px; overflow-y: auto; margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                    <div style="background: #f1f5f9; padding: 10px; border-radius: 10px; margin-bottom: 10px;">
                        <strong><i class="fas fa-robot"></i> AI Assistant:</strong> Hello! I'm your AI study assistant. How can I help you today?
                    </div>
                </div>
                
                <div class="form-group">
                    <input type="text" class="form-input" id="aiQuestion" placeholder="Ask me anything about your studies...">
                </div>
                
                <button class="submit-btn" onclick="askAI()">
                    <i class="fas fa-paper-plane"></i> Ask AI Assistant
                </button>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <div style="display: flex; justify-content: space-between; align-items: start;">
            <div>
                <strong id="notificationTitle"></strong>
                <p id="notificationMessage" style="margin-top: 5px;"></p>
            </div>
            <button onclick="hideNotification()" style="background: none; border: none; color: #6c757d; cursor: pointer;">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>

    <script>
        // ==================== APP DATA ====================
        const DOCUMENTS_DATA = [
            {
                "Title": "Plant Breeding notes",
                "Unit Code": "AGRO222",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Agronomy",
                "Year": "2",
                "Description": "lecture notes on plant Breeding",
                "URL": "https://drive.google.com/file/d/17CG_rb_ecvnkLfjTzNC31u55pBR_RW70/preview",
                "Trending": true,
                "Recent": true
            },
            {
                "Title": "Scope of production Economics",
                "Unit Code": "AGEC241",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Agricultural Economics",
                "Year": "2",
                "Description": "lecture notes on production Economics",
                "URL": "https://drive.google.com/file/d/1uSBqGCfeWPr-upLjKOu-cCkwQUVW7GOU/preview",
                "Trending": true
            },
            {
                "Title": "Production Economics",
                "Unit Code": "AGEC241",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Agricultural Economics",
                "Year": "2",
                "Description": "lecture notes on production Economics",
                "URL": "https://drive.google.com/file/d/1LZ5P_t9qRlxZq2AyAI8JoG-bZAdS6G_c/preview"
            },
            {
                "Title": "ICT Application in Agricultural Education and Extension",
                "Unit Code": "AGED113",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Agricultural Education and Extension",
                "Year": "2",
                "Description": "Examination paper on ICT Application in Agricultural Education and Extension",
                "URL": "https://drive.google.com/file/d/1MxYZpCMFoxTLI6ZR0w9rBBAWeZ1h_bg_/preview",
                "Recent": true
            },
            {
                "Title": "plant Breeding",
                "Unit Code": "AGRO222",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Agronomy",
                "Year": "2",
                "Description": "lecture notes on plant Breeding",
                "URL": "https://drive.google.com/file/d/1wFm3cb1YRR9yD9f5noK4tg0HeD0K0jtg/preview"
            },
            {
                "Title": "taxonomy of higher plants",
                "Unit Code": "BOTA241",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Botany",
                "Year": "2",
                "Description": "lecture notes on Taxonomy of higher plants",
                "URL": "https://drive.google.com/file/d/102toSTJ9WewkGSiBKx3IxWlbPoeKrGCU/preview"
            },
            {
                "Title": "plant physiology",
                "Unit Code": "BOTA271",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Botany",
                "Year": "2",
                "Description": "lecture notes on plant physiology",
                "URL": "https://drive.google.com/file/d/1vSG6ErlBddO-dXBVu8Ice1ut297SiI5d/preview"
            },
            {
                "Title": "Breeding practices",
                "Unit Code": "AGRO222",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Agronomy",
                "Year": "2",
                "Description": "lecture notes on breeding practices",
                "URL": "https://drive.google.com/file/d/1nZfdRK6TTVLvR05-E70WPLBN51_m6G7C/preview",
                "Recent": true
            },
            {
                "Title": "Cell biology",
                "Unit Code": "ZOOL232",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "zoology",
                "Year": "2",
                "Description": "lecture notes on cell biology",
                "URL": "https://drive.google.com/file/d/1LlFPeHK2DjZBhYh8C0LP9DZMX-etSZd7/preview"
            },
            {
                "Title": "course outline",
                "Unit Code": "AGEC241",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Agricultural Economics",
                "Year": "2",
                "Description": "lecture notes on production Economics",
                "URL": "https://drive.google.com/file/d/15D0aQg6hUX3v1pKwxnQ0Al0vRVIVCfsO/preview"
            },
            {
                "Title": "Epistemology and Education",
                "Unit Code": "EDFO112",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Education Foundation",
                "Year": "2",
                "Description": "lecture notes on Epistemology and Education",
                "URL": "https://drive.google.com/file/d/1Z9vZTucmGM_Vcp-cTvHfWwOxzNNLgPkj/preview"
            },
            {
                "Title": "Environmental Science",
                "Unit Code": "ENSC104",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Environmental Science",
                "Year": "2",
                "Description": "lecture notes on Environmental Education",
                "URL": "https://drive.google.com/file/d/1Rd_mPqrUik3mh9LX6GQEgD5XOjDfw1gB/preview"
            },
            {
                "Title": "Environmental Education",
                "Unit Code": "ENSC104",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Environmental Science",
                "Year": "2",
                "Description": "lecture notes on Environmental Education",
                "URL": "https://drive.google.com/file/d/1px1TN0icV_IlUjRm9DpgVyyPHmSfqBNz/preview"
            },
            {
                "Title": "introduction to entrepreneurship",
                "Unit Code": "AGBM102",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Agro business management",
                "Year": "2",
                "Description": "lecture notes on introduction to Enterpreneurship",
                "URL": "https://drive.google.com/file/d/18KKbBRI1zzReDAAKaQ3lgNmYUHKfc57B/preview"
            },
            {
                "Title": "Ecology",
                "Unit Code": "ZOOL210",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Zoology",
                "Year": "2",
                "Description": "lecture notes on ecology",
                "URL": "https://drive.google.com/file/d/146nlk4PihaeonVHslq3GClWqwu5xsbeX/preview",
                "Trending": true
            },
            {
                "Title": "SENV311",
                "Unit Code": "SENV311",
                "University": "University of Eldoret",
                "Type": "pdf",
                "Subject": "Environmental Science",
                "Year": "2",
                "Description": "groupwork assignment",
                "URL": "https://drive.google.com/file/d/1yPUYlgNepiDrG8RFIraiO5vA3iLLlS6D/preview",
                "Recent": true
            },
            {
                "Title": "Integral Calculus",
                "Unit Code": "MATH212",
                "University": "University of Nairobi",
                "Type": "pdf",
                "Subject": "Mathematics",
                "Year": "2",
                "Description": "2024 Main exam paper on integral calculus",
                "URL": "https://drive.google.com/file/d/1LZ5P_t9qRlxZq2AyAI8JoG-bZAdS6G_c/preview",
                "Trending": true
            },
            {
                "Title": "Analytical Geometry",
                "Unit Code": "MATH132",
                "University": "University of Nairobi",
                "Type": "pdf",
                "Subject": "Mathematics",
                "Year": "1",
                "Description": "Complete notes on analytical geometry",
                "URL": "https://drive.google.com/file/d/1wFm3cb1YRR9yD9f5noK4tg0HeD0K0jtg/preview"
            }
        ];

        // 20+ Kenyan Universities
        const UNIVERSITIES = [
            "University of Nairobi",
            "Kenyatta University",
            "Moi University",
            "Egerton University",
            "Jomo Kenyatta University of Agriculture and Technology",
            "Maseno University",
            "Masinde Muliro University of Science and Technology",
            "Dedan Kimathi University of Technology",
            "Technical University of Kenya",
            "Technical University of Mombasa",
            "Murang'a University of Technology",
            "Meru University of Science and Technology",
            "Kirinyaga University",
            "Laikipia University",
            "University of Eldoret",
            "Chuka University",
            "Karatina University",
            "Rongo University",
            "Kisii University",
            "South Eastern Kenya University",
            "Pwani University",
            "Co-operative University of Kenya",
            "Kabarak University",
            "Strathmore University",
            "Mount Kenya University",
            "Africa Nazarene University",
            "Catholic University of Eastern Africa",
            "Daystar University",
            "United States International University Africa",
            "Zetech University"
        ];

        // ==================== APP STATE ====================
        let appState = {
            currentUser: JSON.parse(localStorage.getItem('currentUser')) || null,
            users: JSON.parse(localStorage.getItem('users')) || [],
            documents: JSON.parse(localStorage.getItem('documents')) || DOCUMENTS_DATA,
            // CHANGED: Reset admin password to walter.zauko23
            adminPassword: localStorage.getItem('adminPassword') || 'walter.zauko23',
            adminWhatsApp: localStorage.getItem('adminWhatsApp') || '254765098865',
            subscriptionPrice: localStorage.getItem('subscriptionPrice') || '67',
            searchTimeout: null,
            allUnitCodes: [],
            recentlyRegisteredPhone: null
        };

        // ==================== SIMPLE FULLSCREEN DOCUMENT VIEWER ====================
        function openDocumentViewer(url, title) {
            if (!appState.currentUser || !appState.currentUser.subscription.active) {
                showTab('register');
                showNotification('Access Denied', 'Please subscribe to view documents', 'warning');
                return;
            }
            
            // Show loading state
            document.getElementById('pdfLoading').style.display = 'flex';
            document.getElementById('pdfError').style.display = 'none';
            document.getElementById('pdfViewer').style.display = 'none';
            document.getElementById('pdfViewer').classList.remove('active');
            
            // Update modal title (show only document title)
            document.getElementById('pdfModalTitle').innerHTML = `<i class="fas fa-file-pdf"></i><span>${title}</span>`;
            
            // Convert URL to proper embed format if needed
            let embedUrl = url;
            if (url.includes('drive.google.com')) {
                // Check if it's already a preview URL
                if (!url.includes('/preview')) {
                    // Convert to preview URL
                    const match = url.match(/\/d\/([^\/]+)/) || url.match(/id=([^&]+)/);
                    if (match && match[1]) {
                        embedUrl = `https://drive.google.com/file/d/${match[1]}/preview`;
                    }
                }
                // Add minimal parameter to remove buttons
                if (embedUrl.includes('preview')) {
                    embedUrl += (embedUrl.includes('?') ? '&' : '?') + 'rm=minimal';
                }
            }
            
            // Set viewer source
            const viewer = document.getElementById('pdfViewer');
            viewer.src = embedUrl;
            
            // Open modal
            openModal('pdfModal');
            
            // Preload document for faster opening
            setTimeout(() => {
                if (viewer.src) {
                    document.getElementById('pdfLoading').style.display = 'none';
                    document.getElementById('pdfViewer').style.display = 'block';
                    document.getElementById('pdfViewer').classList.add('active');
                }
            }, 500);
            
            viewer.onerror = function() {
                document.getElementById('pdfLoading').style.display = 'none';
                document.getElementById('pdfError').style.display = 'flex';
                showNotification('Error', 'Could not load document. Please try again.', 'error');
            };
            
            // Set timeout for loading
            setTimeout(() => {
                if (document.getElementById('pdfLoading').style.display !== 'none') {
                    document.getElementById('pdfLoading').style.display = 'none';
                    document.getElementById('pdfViewer').style.display = 'block';
                    document.getElementById('pdfViewer').classList.add('active');
                }
            }, 2000);
        }

        // ==================== MODAL FUNCTIONS ====================
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            document.body.style.overflow = 'auto';
            
            // Clear PDF viewer
            const viewer = document.getElementById('pdfViewer');
            viewer.src = 'about:blank';
            
            // Reset loading states
            document.getElementById('pdfLoading').style.display = 'none';
            document.getElementById('pdfError').style.display = 'none';
        }

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            loadAppData();
            initializeUniversities();
            initializeCategories();
            initializeUnitCodes();
            renderHomeContent();
            updateAccessStatus();
            
            // Setup search
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', function(e) {
                clearTimeout(appState.searchTimeout);
                
                if (e.target.value.length > 0) {
                    showSearchSuggestions(e.target.value);
                } else {
                    hideSearchSuggestions();
                }
                
                appState.searchTimeout = setTimeout(() => {
                    searchByUnitCode(e.target.value);
                }, 300);
            });
            
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchByUnitCode(this.value);
                }
            });
            
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.search-container')) {
                    hideSearchSuggestions();
                }
            });
            
            document.querySelectorAll('.bottom-nav .nav-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.bottom-nav .nav-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            // Initialize sample data
            initializeSampleData();
            
            // Check if we need to show unlock code section
            if (appState.recentlyRegisteredPhone) {
                showUnlockCodeSection(appState.recentlyRegisteredPhone);
            }
        });

        function loadAppData() {
            if (localStorage.getItem('users')) {
                appState.users = JSON.parse(localStorage.getItem('users'));
            }
            if (localStorage.getItem('documents')) {
                appState.documents = JSON.parse(localStorage.getItem('documents'));
            }
            appState.adminPassword = localStorage.getItem('adminPassword') || 'walter.zauko23';
            appState.adminWhatsApp = localStorage.getItem('adminWhatsApp') || '254765098865';
            appState.subscriptionPrice = localStorage.getItem('subscriptionPrice') || '67';
            appState.recentlyRegisteredPhone = localStorage.getItem('recentlyRegisteredPhone');
        }

        function saveAppData() {
            localStorage.setItem('users', JSON.stringify(appState.users));
            localStorage.setItem('documents', JSON.stringify(appState.documents));
            localStorage.setItem('currentUser', JSON.stringify(appState.currentUser));
            localStorage.setItem('adminPassword', appState.adminPassword);
            localStorage.setItem('adminWhatsApp', appState.adminWhatsApp);
            localStorage.setItem('subscriptionPrice', appState.subscriptionPrice);
            localStorage.setItem('recentlyRegisteredPhone', appState.recentlyRegisteredPhone);
        }

        function initializeUniversities() {
            const universitySelects = [
                document.getElementById('universityFilter'),
                document.getElementById('allUniversityFilter'),
                document.getElementById('studentUniversity')
            ];
            
            universitySelects.forEach(select => {
                if (select) {
                    select.innerHTML = '<option value="all">All Universities</option>' +
                        UNIVERSITIES.map(uni => `<option value="${uni}">${uni}</option>`).join('');
                }
            });
            
            const grid = document.getElementById('universityGrid');
            if (grid) {
                grid.innerHTML = UNIVERSITIES.slice(0, 8).map(uni => `
                    <div class="university-card" onclick="filterByUniversity('${uni}')">
                        <div class="university-logo">${uni.substring(0, 2).toUpperCase()}</div>
                        <div class="university-name">${uni.length > 20 ? uni.substring(0, 18) + '...' : uni}</div>
                    </div>
                `).join('');
            }
        }

        function initializeCategories() {
            const categories = {};
            appState.documents.forEach(doc => {
                if (doc.Subject) {
                    categories[doc.Subject] = (categories[doc.Subject] || 0) + 1;
                }
            });
            
            const categoryList = document.getElementById('categoryList');
            if (categoryList) {
                const sortedCategories = Object.entries(categories)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 8);
                
                categoryList.innerHTML = sortedCategories.map(([category, count]) => `
                    <li class="category-item" onclick="filterByCategory('${category}')">
                        <span class="category-name">${category}</span>
                        <span class="category-count">${count}</span>
                    </li>
                `).join('');
            }
            
            const subjectFilter = document.getElementById('allSubjectFilter');
            if (subjectFilter) {
                subjectFilter.innerHTML = '<option value="all">All Subjects</option>' +
                    Object.keys(categories).map(subject => 
                        `<option value="${subject}">${subject}</option>`
                    ).join('');
            }
        }

        function initializeUnitCodes() {
            const unitCodes = [...new Set(appState.documents.map(doc => doc["Unit Code"]))];
            appState.allUnitCodes = unitCodes;
            
            const quickUnits = document.getElementById('quickUnits');
            if (quickUnits) {
                const popularUnits = unitCodes.slice(0, 8);
                quickUnits.innerHTML = popularUnits.map(code => `
                    <div class="unit-chip" onclick="quickSearch('${code}')">
                        ${code}
                    </div>
                `).join('');
            }
        }

        // ==================== SEARCH FUNCTIONS ====================
        function searchByUnitCode(query) {
            if (!query.trim()) {
                document.getElementById('searchResults').classList.remove('active');
                document.getElementById('continueReading').style.display = 'block';
                hideSearchSuggestions();
                return;
            }
            
            query = query.trim().toUpperCase();
            
            const results = appState.documents.filter(doc => {
                const unitCode = (doc["Unit Code"] || "").toUpperCase();
                const title = (doc.Title || "").toUpperCase();
                const subject = (doc.Subject || "").toUpperCase();
                const description = (doc.Description || "").toUpperCase();
                
                return unitCode.includes(query) || 
                       title.includes(query) ||
                       subject.includes(query) ||
                       description.includes(query);
            });
            
            if (results.length > 0) {
                document.getElementById('continueReading').style.display = 'none';
                document.getElementById('searchResults').classList.add('active');
                document.getElementById('searchResultsTitle').textContent = `Search Results for "${query}" (${results.length} found)`;
                
                const grid = document.getElementById('searchResultsGrid');
                grid.innerHTML = results.map(doc => createMaterialCard(doc)).join('');
                
                setTimeout(() => {
                    document.getElementById('searchResults').scrollIntoView({ behavior: 'smooth' });
                }, 100);
                
                showNotification('Search Results', `Found ${results.length} materials for "${query}"`, 'success');
            } else {
                document.getElementById('continueReading').style.display = 'block';
                document.getElementById('searchResults').classList.remove('active');
                showNotification('No Results', `No materials found for "${query}"`, 'warning');
            }
            
            hideSearchSuggestions();
        }

        function showSearchSuggestions(query) {
            if (!query || query.length < 1) {
                hideSearchSuggestions();
                return;
            }
            
            query = query.trim().toUpperCase();
            
            const unitCodeMatches = appState.allUnitCodes.filter(code => 
                code.toUpperCase().includes(query)
            ).slice(0, 5);
            
            const titleMatches = appState.documents.filter(doc => 
                doc.Title.toUpperCase().includes(query)
            ).slice(0, 3);
            
            if (unitCodeMatches.length === 0 && titleMatches.length === 0) {
                hideSearchSuggestions();
                return;
            }
            
            const suggestionsContainer = document.getElementById('searchSuggestions');
            let suggestionsHTML = '';
            
            if (unitCodeMatches.length > 0) {
                suggestionsHTML += '<div style="padding: 10px 20px; background: #f1f5f9; color: #64748b; font-size: 12px; font-weight: 600;">Unit Codes</div>';
                
                unitCodeMatches.forEach(code => {
                    const doc = appState.documents.find(d => d["Unit Code"] === code);
                    suggestionsHTML += `
                        <div class="suggestion-item" onclick="selectSuggestion('${code}')">
                            <div class="suggestion-code">${code}</div>
                            ${doc ? `<div class="suggestion-title">${doc.Title}</div>` : ''}
                        </div>
                    `;
                });
            }
            
            if (titleMatches.length > 0) {
                suggestionsHTML += '<div style="padding: 10px 20px; background: #f1f5f9; color: #64748b; font-size: 12px; font-weight: 600; border-top: 1px solid #e2e8f0;">Titles</div>';
                
                titleMatches.forEach(doc => {
                    suggestionsHTML += `
                        <div class="suggestion-item" onclick="selectSuggestion('${doc["Unit Code"]}')">
                            <div class="suggestion-code">${doc["Unit Code"]}</div>
                            <div class="suggestion-title">${doc.Title}</div>
                        </div>
                    `;
                });
            }
            
            suggestionsContainer.innerHTML = suggestionsHTML;
            suggestionsContainer.classList.add('active');
        }

        function hideSearchSuggestions() {
            document.getElementById('searchSuggestions').classList.remove('active');
        }

        function selectSuggestion(unitCode) {
            document.getElementById('searchInput').value = unitCode;
            searchByUnitCode(unitCode);
            hideSearchSuggestions();
        }

        function quickSearch(unitCode) {
            document.getElementById('searchInput').value = unitCode;
            searchByUnitCode(unitCode);
        }

        // ==================== UI FUNCTIONS ====================
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            
            document.getElementById(tabName).style.display = 'block';
            
            document.querySelectorAll('.bottom-nav .nav-btn').forEach(btn => btn.classList.remove('active'));
            
            const buttons = {
                'home': 0,
                'materials': 1,
                'register': 2,
                'login': 3,
                'admin': 4
            };
            
            if (buttons[tabName] !== undefined) {
                document.querySelectorAll('.bottom-nav .nav-btn')[buttons[tabName]].classList.add('active');
            }
            
            if (tabName !== 'home') {
                document.getElementById('searchInput').value = '';
                document.getElementById('searchResults').classList.remove('active');
                document.getElementById('continueReading').style.display = 'block';
                hideSearchSuggestions();
            }
            
            switch(tabName) {
                case 'home':
                    renderHomeContent();
                    break;
                case 'materials':
                    renderAllMaterials();
                    break;
                case 'admin':
                    document.getElementById('adminPassword').value = '';
                    break;
            }
        }

        function renderHomeContent() {
            renderContinueReading();
            renderTrendingMaterials();
        }

        function renderContinueReading() {
            const grid = document.getElementById('continueReadingGrid');
            const recentMaterials = appState.documents.filter(doc => doc.Recent).slice(0, 6);
            
            grid.innerHTML = recentMaterials.map(doc => createMaterialCard(doc)).join('');
        }

        function renderAllMaterials() {
            const grid = document.getElementById('allMaterialsGrid');
            grid.innerHTML = appState.documents.map(doc => createMaterialCard(doc)).join('');
        }

        function renderTrendingMaterials() {
            const grid = document.getElementById('trendingGrid');
            const trendingMaterials = appState.documents.filter(doc => doc.Trending).slice(0, 4);
            
            grid.innerHTML = trendingMaterials.map(doc => createMaterialCard(doc)).join('');
        }

        function createMaterialCard(doc) {
            const hasAccess = appState.currentUser && appState.currentUser.subscription && 
                             appState.currentUser.subscription.active;
            
            const badges = [];
            if (doc.Trending) badges.push('<div class="material-badge trending">TRENDING</div>');
            if (doc.Recent) badges.push('<div class="material-badge recent">RECENT</div>');
            
            return `
                <div class="material-card">
                    ${badges.join('')}
                    
                    <div class="material-image">
                        <i class="fas fa-file-pdf"></i>
                    </div>
                    
                    <div class="material-content">
                        <h3 class="material-title">${doc.Title}</h3>
                        
                        <div class="material-meta">
                            <span class="material-code">${doc["Unit Code"]}</span>
                            <span class="material-year">Year ${doc.Year}</span>
                        </div>
                        
                        <div class="material-info">
                            <i class="fas fa-university"></i>
                            <span>${doc.University}</span>
                        </div>
                        
                        <p class="material-description">${doc.Description}</p>
                        
                        <div class="material-actions">
                            ${hasAccess ? 
                                `<button class="action-btn view-btn" onclick="openDocumentViewer('${doc.URL}', '${doc.Title}')">
                                    <i class="fas fa-eye"></i> View Document
                                </button>` :
                                `<button class="action-btn view-btn" onclick="showTab('register')">
                                    <i class="fas fa-lock"></i> Subscribe to View
                                </button>`
                            }
                            <button class="action-btn preview-btn" onclick="previewLink('${doc.URL}')">
                                <i class="fas fa-external-link-alt"></i> Preview
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function previewLink(url) {
            window.open(url, '_blank', 'noopener,noreferrer');
        }

        // ==================== REGISTRATION FUNCTIONS ====================
        function registerStudent() {
            const name = document.getElementById('studentName').value.trim();
            const phone = document.getElementById('studentPhone').value.trim();
            const university = document.getElementById('studentUniversity').value;
            const course = document.getElementById('studentCourse').value.trim();
            const year = document.getElementById('studentYear').value;
            const paymentCode = document.getElementById('paymentCode').value.trim();
            
            // Validation
            if (!name || !phone || !university || !course || !year || !paymentCode) {
                showNotification('Error', 'Please fill in all fields', 'error');
                return;
            }
            
            if (phone.length !== 10 || !phone.startsWith('07')) {
                showNotification('Error', 'Please enter a valid Kenyan phone number (07XXXXXXXX)', 'error');
                return;
            }
            
            // Check if user already exists
            const existingUser = appState.users.find(u => u.phone === phone);
            if (existingUser) {
                showNotification('Error', 'This phone number is already registered', 'error');
                return;
            }
            
            // Create new user with pending status
            const newUser = {
                id: Date.now(),
                name: name,
                phone: phone,
                university: university,
                course: course,
                year: year,
                registrationDate: new Date().toISOString(),
                subscription: {
                    active: false,
                    paymentCode: paymentCode,
                    unlockCode: '', // Will be set by admin
                    status: 'pending',
                    startDate: null,
                    endDate: null
                }
            };
            
            // Add to users array
            appState.users.push(newUser);
            saveAppData();
            
            // Store the phone for unlock code section
            appState.recentlyRegisteredPhone = phone;
            localStorage.setItem('recentlyRegisteredPhone', phone);
            
            // Hide registration form and show unlock code section
            document.getElementById('registrationForm').style.display = 'none';
            showUnlockCodeSection(phone);
            
            // Send WhatsApp notification to admin
            sendWhatsAppNotification(newUser);
            
            showNotification('Registration Submitted', 'Your registration has been submitted! Admin will send you an unlock code via WhatsApp.', 'success');
            
            // Scroll to unlock code section
            document.getElementById('unlockCodeSection').scrollIntoView({ behavior: 'smooth' });
        }

        function showUnlockCodeSection(phone) {
            const unlockCodeSection = document.getElementById('unlockCodeSection');
            const unlockPhoneInput = document.getElementById('unlockPhone');
            
            if (unlockCodeSection && unlockPhoneInput) {
                unlockCodeSection.style.display = 'block';
                unlockCodeSection.classList.add('active');
                unlockPhoneInput.value = phone;
            }
        }

        // NEW: Function for the new "ACTIVATE MY ACCOUNT NOW" button
        function activateAccountWithUnlockCode() {
            const phone = document.getElementById('unlockPhone').value.trim();
            const user = appState.users.find(u => u.phone === phone);
            
            if (!user) {
                showNotification('Error', 'User not found. Please register first.', 'error');
                return;
            }
            
            if (!user.subscription.unlockCode) {
                // Show dialog to enter unlock code
                const unlockCode = prompt(`Please enter the unlock code sent to ${phone}:`, '');
                
                if (!unlockCode) {
                    showNotification('Cancelled', 'Unlock code entry cancelled', 'warning');
                    return;
                }
                
                if (user.subscription.unlockCode !== unlockCode) {
                    showNotification('Error', 'Invalid unlock code. Please check and try again.', 'error');
                    return;
                }
                
                // Activate subscription
                activateUserAccount(user, unlockCode);
            } else {
                // User already has unlock code, just activate
                const unlockCode = prompt(`Please enter the unlock code for ${phone}:`, '');
                
                if (!unlockCode) {
                    showNotification('Cancelled', 'Unlock code entry cancelled', 'warning');
                    return;
                }
                
                if (user.subscription.unlockCode !== unlockCode) {
                    showNotification('Error', 'Invalid unlock code. Please check and try again.', 'error');
                    return;
                }
                
                // Activate subscription
                activateUserAccount(user, unlockCode);
            }
        }

        function activateUserAccount(user, unlockCode) {
            const now = new Date();
            user.subscription.active = true;
            user.subscription.status = 'approved';
            user.subscription.startDate = now.toISOString();
            user.subscription.endDate = new Date(now.getTime() + 5 * 30 * 24 * 60 * 60 * 1000).toISOString(); // 5 months
            
            // Set as current user
            appState.currentUser = user;
            
            // Clear recently registered phone
            appState.recentlyRegisteredPhone = null;
            localStorage.removeItem('recentlyRegisteredPhone');
            
            saveAppData();
            updateAccessStatus();
            
            showNotification('Success', 'Account activated! You now have full access.', 'success');
            setTimeout(() => {
                showTab('home');
            }, 1500);
        }

        function sendWhatsAppNotification(user) {
            const adminNumber = appState.adminWhatsApp.replace(/^0/, '254').replace(/^\+/, '');
            const message = `ðŸ“š NEW REGISTRATION - RevisionVault Pro
            
Name: ${user.name}
Phone: ${user.phone}
University: ${user.university}
Course: ${user.course}
Year: ${user.year}
Payment Code: ${user.subscription.paymentCode}
Date: ${new Date().toLocaleString()}

Please review and approve this registration.`;

            const whatsappUrl = `https://wa.me/${adminNumber}?text=${encodeURIComponent(message)}`;
            
            // Open WhatsApp in new tab
            window.open(whatsappUrl, '_blank');
        }

        function generateUnlockCode() {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
            let code = '';
            for (let i = 0; i < 8; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        // ==================== LOGIN FUNCTIONS ====================
        function loginStudent() {
            const phone = document.getElementById('loginPhone').value.trim();
            const user = appState.users.find(u => u.phone === phone);
            
            if (!user) {
                showLoginMessage('User not found. Please register first.', 'error');
                return;
            }
            
            if (!user.subscription.active) {
                if (user.subscription.status === 'pending') {
                    showLoginMessage('Your account is pending approval. Please wait for admin to send unlock code.', 'warning');
                } else {
                    showLoginMessage('Your subscription is not active. Please contact admin.', 'warning');
                }
                return;
            }
            
            // Check if subscription has expired
            const endDate = new Date(user.subscription.endDate);
            const now = new Date();
            
            if (endDate < now) {
                user.subscription.active = false;
                saveAppData();
                showLoginMessage('Your subscription has expired. Please renew.', 'warning');
                return;
            }
            
            // Login successful
            appState.currentUser = user;
            saveAppData();
            updateAccessStatus();
            
            showLoginMessage('Login successful! Redirecting to home...', 'success');
            
            setTimeout(() => {
                showTab('home');
                showNotification('Welcome Back', `Welcome back, ${user.name}!`, 'success');
            }, 1000);
        }

        function showLoginMessage(message, type) {
            const messageDiv = document.getElementById('loginMessage');
            messageDiv.textContent = message;
            messageDiv.style.display = 'block';
            
            switch(type) {
                case 'success':
                    messageDiv.style.backgroundColor = '#d1fae5';
                    messageDiv.style.color = '#065f46';
                    messageDiv.style.border = '2px solid #10b981';
                    break;
                case 'error':
                    messageDiv.style.backgroundColor = '#fee2e2';
                    messageDiv.style.color = '#991b1b';
                    messageDiv.style.border = '2px solid #ef4444';
                    break;
                case 'warning':
                    messageDiv.style.backgroundColor = '#fef3c7';
                    messageDiv.style.color = '#92400e';
                    messageDiv.style.border = '2px solid #f59e0b';
                    break;
            }
        }

        function updateAccessStatus() {
            const accessStatus = document.getElementById('accessStatus');
            if (!accessStatus) return;
            
            if (appState.currentUser && appState.currentUser.subscription.active) {
                const endDate = new Date(appState.currentUser.subscription.endDate);
                const daysLeft = Math.ceil((endDate - new Date()) / (1000 * 60 * 60 * 24));
                
                accessStatus.innerHTML = `
                    <div class="access-text">
                        <h3><i class="fas fa-unlock"></i> Access Granted</h3>
                        <p>Welcome, ${appState.currentUser.name}! Subscription valid for ${daysLeft} more days</p>
                    </div>
                    <button class="view-btn" onclick="logout()" style="width: auto; padding: 10px 20px;">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                `;
                accessStatus.classList.remove('access-status');
                accessStatus.classList.add('access-status', 'access-granted');
            } else {
                accessStatus.innerHTML = `
                    <div class="access-text">
                        <h3><i class="fas fa-lock"></i> Access Locked</h3>
                        <p>Subscribe to unlock all study materials and features</p>
                    </div>
                    <button class="view-btn" onclick="showTab('register')" style="width: auto; padding: 10px 20px;">
                        <i class="fas fa-crown"></i> Subscribe Now
                    </button>
                `;
                accessStatus.classList.remove('access-granted');
                accessStatus.classList.add('access-status');
            }
        }

        function logout() {
            appState.currentUser = null;
            saveAppData();
            updateAccessStatus();
            showTab('home');
            showNotification('Logged Out', 'You have been logged out successfully', 'success');
        }

        // ==================== ADMIN FUNCTIONS ====================
        function adminLogin() {
            const password = document.getElementById('adminPassword').value;
            
            // CHANGED: Check against walter.zauko23
            if (password === 'walter.zauko23' || password === appState.adminPassword) {
                document.getElementById('adminPanel').style.display = 'block';
                document.getElementById('adminPassword').value = '';
                showNotification('Admin Access', 'Welcome to Admin Panel', 'success');
                
                // Load pending approvals
                loadPendingApprovals();
            } else {
                showNotification('Error', 'Invalid admin password', 'error');
            }
        }

        function showAdminSection(sectionName) {
            document.querySelectorAll('.admin-section').forEach(section => {
                section.style.display = 'none';
            });
            
            document.getElementById(`${sectionName}Section`).style.display = 'block';
            
            // Load data for the section
            switch(sectionName) {
                case 'pending':
                    loadPendingApprovals();
                    break;
                case 'students':
                    loadAllStudents();
                    break;
                case 'materials':
                    loadAdminMaterials();
                    break;
            }
        }

        function loadPendingApprovals() {
            const pendingList = document.getElementById('pendingList');
            const pendingUsers = appState.users.filter(u => u.subscription.status === 'pending');
            
            if (pendingUsers.length === 0) {
                pendingList.innerHTML = '<p>No pending approvals</p>';
                return;
            }
            
            pendingList.innerHTML = pendingUsers.map(user => `
                <div style="border: 2px solid #e2e8f0; padding: 15px; margin-bottom: 10px; border-radius: 8px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>${user.name}</strong>
                            <div style="font-size: 12px; color: #64748b; margin-top: 5px;">
                                ðŸ“ž ${user.phone} | ðŸ« ${user.university} | ðŸ“š ${user.course} (Year ${user.year})
                            </div>
                            <div style="font-size: 12px; color: #f59e0b; margin-top: 5px;">
                                ðŸ’³ Payment Code: ${user.subscription.paymentCode}
                            </div>
                        </div>
                        <button onclick="approveStudent('${user.phone}')" style="background: #10b981; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer;">
                            Approve
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function loadAllStudents() {
            const studentList = document.getElementById('studentList');
            
            if (appState.users.length === 0) {
                studentList.innerHTML = '<p>No registered students</p>';
                return;
            }
            
            studentList.innerHTML = appState.users.map(user => `
                <div style="border: 2px solid #e2e8f0; padding: 15px; margin-bottom: 10px; border-radius: 8px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>${user.name}</strong>
                            <div style="font-size: 12px; color: #64748b; margin-top: 5px;">
                                ðŸ“ž ${user.phone} | ðŸ« ${user.university}
                            </div>
                            <div style="font-size: 12px; margin-top: 5px;">
                                Status: 
                                ${user.subscription.active ? 
                                    '<span style="color: #10b981;">âœ“ Active</span>' : 
                                    user.subscription.status === 'pending' ?
                                        '<span style="color: #f59e0b;">â³ Pending</span>' :
                                        '<span style="color: #ef4444;">âœ— Inactive</span>'
                                }
                                ${user.subscription.unlockCode ? 
                                    ` | ðŸ”‘ Code: ${user.subscription.unlockCode}` : 
                                    ''
                                }
                            </div>
                        </div>
                        <button onclick="deleteStudent('${user.phone}')" style="background: #ef4444; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer;">
                            Delete
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function approveStudent(phone) {
            const user = appState.users.find(u => u.phone === phone);
            if (user) {
                const unlockCode = generateUnlockCode();
                user.subscription.unlockCode = unlockCode;
                user.subscription.status = 'approved';
                saveAppData();
                
                // Send WhatsApp message to user with unlock code
                const whatsappUrl = `https://wa.me/254${phone.substring(1)}?text=${encodeURIComponent(
                    `ðŸ”“ UNLOCK CODE - RevisionVault Pro\n\nYour account has been approved!\n\nðŸ”‘ Unlock Code: ${unlockCode}\n\nUse this code to activate your account.`
                )}`;
                window.open(whatsappUrl, '_blank');
                
                showNotification('Approved', `Unlock code sent to ${phone}`, 'success');
                loadPendingApprovals();
            }
        }

        function deleteStudent(phone) {
            if (confirm('Are you sure you want to delete this student?')) {
                appState.users = appState.users.filter(u => u.phone !== phone);
                saveAppData();
                showNotification('Deleted', 'Student deleted successfully', 'success');
                loadAllStudents();
            }
        }

        // ==================== MATERIALS MANAGEMENT ====================
        function loadAdminMaterials() {
            const materialsList = document.getElementById('adminMaterialsList');
            
            materialsList.innerHTML = appState.documents.map((doc, index) => `
                <div style="border: 2px solid #e2e8f0; padding: 15px; margin-bottom: 10px; border-radius: 8px;">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div style="flex: 1;">
                            <strong>${doc.Title}</strong>
                            <div style="font-size: 12px; color: #64748b; margin-top: 5px;">
                                ðŸ“š ${doc["Unit Code"]} | ðŸ« ${doc.University} | ðŸ“… Year ${doc.Year}
                            </div>
                            <div style="font-size: 12px; margin-top: 5px;">
                                ${doc.Description}
                            </div>
                        </div>
                        <button onclick="deleteMaterial(${index})" style="background: #ef4444; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; margin-left: 10px;">
                            Delete
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function deleteMaterial(index) {
            if (confirm('Are you sure you want to delete this material?')) {
                appState.documents.splice(index, 1);
                saveAppData();
                showNotification('Deleted', 'Material deleted successfully', 'success');
                loadAdminMaterials();
            }
        }

        function addNewMaterial() {
            const title = prompt('Enter material title:');
            if (!title) return;
            
            const unitCode = prompt('Enter unit code:');
            if (!unitCode) return;
            
            const university = prompt('Enter university:');
            if (!university) return;
            
            const year = prompt('Enter year (1-4):');
            if (!year) return;
            
            const subject = prompt('Enter subject:');
            if (!subject) return;
            
            const description = prompt('Enter description:');
            if (!description) return;
            
            const url = prompt('Enter Google Drive URL:');
            if (!url) return;
            
            const newMaterial = {
                "Title": title,
                "Unit Code": unitCode,
                "University": university,
                "Type": "pdf",
                "Subject": subject,
                "Year": year,
                "Description": description,
                "URL": url,
                "Trending": false,
                "Recent": true
            };
            
            appState.documents.push(newMaterial);
            saveAppData();
            showNotification('Added', 'New material added successfully', 'success');
            loadAdminMaterials();
            initializeCategories();
            initializeUnitCodes();
        }

        // ==================== AI CHAT FUNCTIONS ====================
        function openAIChat() {
            if (!appState.currentUser || !appState.currentUser.subscription.active) {
                showTab('register');
                showNotification('Access Denied', 'Please subscribe to use AI Chat', 'warning');
                return;
            }
            openModal('aiChatModal');
        }

        function askAI() {
            const question = document.getElementById('aiQuestion').value.trim();
            if (!question) return;
            
            const messagesDiv = document.getElementById('aiChatMessages');
            
            // Add user message
            messagesDiv.innerHTML += `
                <div style="background: #dbeafe; padding: 10px; border-radius: 10px; margin-bottom: 10px; text-align: right;">
                    <strong>You:</strong> ${question}
                </div>
            `;
            
            // Clear input
            document.getElementById('aiQuestion').value = '';
            
            // Scroll to bottom
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            
            // Simulate AI thinking
            setTimeout(() => {
                const responses = [
                    "Based on my knowledge, that's an excellent question! In academic terms, this relates to...",
                    "I'd recommend studying this topic from multiple angles. Start with the fundamentals and then move to advanced concepts.",
                    "For your assignment, I suggest structuring it with an introduction, three main points, and a conclusion.",
                    "This is a common topic in university studies. The key points to remember are...",
                    "I can help you break this down into manageable sections for better understanding."
                ];
                
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                
                messagesDiv.innerHTML += `
                    <div style="background: #f1f5f9; padding: 10px; border-radius: 10px; margin-bottom: 10px;">
                        <strong><i class="fas fa-robot"></i> AI Assistant:</strong> ${randomResponse}
                        <div style="font-size: 12px; color: #64748b; margin-top: 5px;">
                            <i class="fas fa-lightbulb"></i> Tip: Always cite your sources in academic work.
                        </div>
                    </div>
                `;
                
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            }, 1000);
        }

        // ==================== NOTIFICATION FUNCTIONS ====================
        function showNotification(title, message, type = 'info') {
            const notification = document.getElementById('notification');
            const notificationTitle = document.getElementById('notificationTitle');
            const notificationMessage = document.getElementById('notificationMessage');
            
            // Set colors based on type
            switch(type) {
                case 'success':
                    notification.style.borderLeftColor = '#10b981';
                    break;
                case 'error':
                    notification.style.borderLeftColor = '#ef4444';
                    break;
                case 'warning':
                    notification.style.borderLeftColor = '#f59e0b';
                    break;
                default:
                    notification.style.borderLeftColor = '#3b82f6';
            }
            
            notificationTitle.textContent = title;
            notificationMessage.textContent = message;
            
            notification.classList.add('show');
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                hideNotification();
            }, 5000);
        }

        function hideNotification() {
            const notification = document.getElementById('notification');
            notification.classList.remove('show');
        }

        // ==================== FILTER FUNCTIONS ====================
        function filterMaterials() {
            const university = document.getElementById('universityFilter').value;
            const year = document.getElementById('yearFilter').value;
            
            let filtered = appState.documents;
            
            if (university !== 'all') {
                filtered = filtered.filter(doc => doc.University === university);
            }
            
            if (year !== 'all') {
                filtered = filtered.filter(doc => doc.Year === year);
            }
            
            document.getElementById('continueReadingGrid').innerHTML = 
                filtered.slice(0, 6).map(doc => createMaterialCard(doc)).join('');
        }

        function filterAllMaterials() {
            const university = document.getElementById('allUniversityFilter').value;
            const subject = document.getElementById('allSubjectFilter').value;
            
            let filtered = appState.documents;
            
            if (university !== 'all') {
                filtered = filtered.filter(doc => doc.University === university);
            }
            
            if (subject !== 'all') {
                filtered = filtered.filter(doc => doc.Subject === subject);
            }
            
            document.getElementById('allMaterialsGrid').innerHTML = 
                filtered.map(doc => createMaterialCard(doc)).join('');
        }

        function filterByCategory(category) {
            document.getElementById('allSubjectFilter').value = category;
            showTab('materials');
            filterAllMaterials();
        }

        function filterByUniversity(university) {
            document.getElementById('allUniversityFilter').value = university;
            showTab('materials');
            filterAllMaterials();
        }

        // ==================== SAMPLE DATA INITIALIZATION ====================
        function initializeSampleData() {
            if (appState.users.length === 0) {
                appState.users.push({
                    id: 1,
                    name: "John Doe",
                    phone: "0712345678",
                    university: "Egerton University",
                    course: "BSc Agriculture",
                    year: "2",
                    registrationDate: new Date().toISOString(),
                    subscription: {
                        active: true,
                        paymentCode: "ABC123XYZ",
                        unlockCode: "RVP7X9Y2",
                        status: 'approved',
                        startDate: new Date().toISOString(),
                        endDate: new Date(Date.now() + 5 * 30 * 24 * 60 * 60 * 1000).toISOString()
                    }
                });
                
                saveAppData();
            }
        }
    </script>
</body>
</html>