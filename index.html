<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RevisionVault - University Study Materials</title>
    <link rel="icon" type="image/x-icon" href="https://cdn-icons-png.flaticon.com/512/2237/2237289.png">
    <style>
        /* === MODERN CSS RESET === */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --accent: #f72585;
            --success: #4cc9f0;
            --dark: #2b2d42;
            --light: #f8f9fa;
            --gray: #6c757d;
            --shadow: 0 10px 30px rgba(0,0,0,0.1);
            --gradient: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%);
            --radius: 12px;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: var(--dark);
            line-height: 1.6;
        }
        
        /* === MAIN CONTAINER === */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* === HEADER === */
        .header {
            background: white;
            border-radius: var(--radius);
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            background: var(--gradient);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
        }
        
        .logo-text h1 {
            font-size: 28px;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
        }
        
        .tagline {
            color: var(--gray);
            font-size: 14px;
        }
        
        /* === HERO SECTION === */
        .hero {
            background: var(--gradient);
            color: white;
            border-radius: var(--radius);
            padding: 50px 30px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }
        
        .hero::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 200%;
            background: rgba(255,255,255,0.1);
            transform: rotate(30deg);
        }
        
        .hero h2 {
            font-size: 36px;
            margin-bottom: 15px;
            font-weight: 700;
        }
        
        .hero p {
            font-size: 18px;
            opacity: 0.9;
            margin-bottom: 25px;
        }
        
        .price-badge {
            background: rgba(255,255,255,0.2);
            display: inline-flex;
            align-items: center;
            padding: 15px 30px;
            border-radius: 50px;
            backdrop-filter: blur(10px);
            margin: 20px 0;
        }
        
        .price {
            font-size: 48px;
            font-weight: 800;
            margin-right: 10px;
        }
        
        .period {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .per-day {
            background: rgba(255,255,255,0.3);
            padding: 8px 20px;
            border-radius: 30px;
            font-size: 14px;
            display: inline-block;
        }
        
        /* === STATUS MESSAGES === */
        .status {
            padding: 20px;
            border-radius: var(--radius);
            margin: 20px 0;
            display: none;
        }
        
        .status.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }
        
        .status.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }
        
        .status.warning {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fde68a;
        }
        
        .pending-status {
            display: flex;
            align-items: center;
            gap: 15px;
            background: #fef3c7;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #f59e0b;
        }
        
        .spinner {
            width: 30px;
            height: 30px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #f59e0b;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* === PAYMENT SECTION === */
        .payment-section {
            background: white;
            border-radius: var(--radius);
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }
        
        .section-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 30px;
            color: var(--secondary);
            font-size: 24px;
        }
        
        .payment-box {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 30px;
            border-radius: var(--radius);
            text-align: center;
            margin: 30px 0;
        }
        
        .payment-label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 10px;
        }
        
        .mpesa-number {
            font-size: 32px;
            font-weight: 800;
            letter-spacing: 2px;
            margin: 10px 0;
            font-family: monospace;
        }
        
        .payment-note {
            font-size: 13px;
            opacity: 0.9;
            margin-top: 10px;
        }
        
        /* === FORM === */
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        
        .form-input {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e2e8f0;
            border-radius: var(--radius);
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }
        
        .btn {
            padding: 16px 32px;
            border: none;
            border-radius: var(--radius);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
        }
        
        .btn-primary {
            background: var(--gradient);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(67, 97, 238, 0.3);
        }
        
        .btn-secondary {
            background: #e2e8f0;
            color: var(--dark);
            margin-top: 15px;
        }
        
        /* === DOCUMENTS === */
        .documents-section {
            background: white;
            border-radius: var(--radius);
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }
        
        .documents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }
        
        .document-card {
            background: white;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            transition: all 0.3s;
            border: 1px solid #e2e8f0;
        }
        
        .document-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }
        
        .doc-icon {
            background: var(--gradient);
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 32px;
        }
        
        .doc-content {
            padding: 25px;
        }
        
        .doc-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--dark);
        }
        
        .doc-meta {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .meta-tag {
            background: #e2e8f0;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
        }
        
        .download-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: var(--gradient);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 500;
            margin-top: 15px;
            transition: all 0.3s;
        }
        
        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(67, 97, 238, 0.3);
        }
        
        /* === ADMIN PANEL === */
        .admin-panel {
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            margin: 20px 0;
            box-shadow: var(--shadow);
            border: 2px solid #e2e8f0;
            display: none;
        }
        
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .admin-stats {
            display: flex;
            gap: 15px;
        }
        
        .stat {
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .stat.pending {
            background: #fef3c7;
            color: #92400e;
        }
        
        .stat.approved {
            background: #d1fae5;
            color: #065f46;
        }
        
        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            padding: 12px 20px;
            border: none;
            background: #f1f5f9;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tab-btn.active {
            background: #3b82f6;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .request-card {
            background: #f8fafc;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #f59e0b;
        }
        
        .request-info {
            margin-bottom: 15px;
        }
        
        .request-phone {
            font-size: 18px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 5px;
        }
        
        .request-code {
            color: #64748b;
            font-family: monospace;
            margin-bottom: 5px;
        }
        
        .request-time {
            font-size: 12px;
            color: #94a3b8;
        }
        
        .request-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn-approve, .btn-reject, .btn-whatsapp {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .btn-approve {
            background: #10b981;
            color: white;
        }
        
        .btn-reject {
            background: #ef4444;
            color: white;
        }
        
        .btn-whatsapp {
            background: #25d366;
            color: white;
        }
        
        /* === ADMIN ACCESS BUTTON === */
        .admin-access-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #3b82f6;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
            z-index: 1000;
            border: none;
        }
        
        /* === CONTACT LINKS === */
        .contact-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .contact-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 25px;
            background: white;
            border-radius: 50px;
            text-decoration: none;
            color: var(--dark);
            font-weight: 500;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .contact-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .contact-btn.telegram {
            background: linear-gradient(135deg, #0088cc 0%, #006699 100%);
            color: white;
        }
        
        .contact-btn.whatsapp {
            background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);
            color: white;
        }
        
        /* === FOOTER === */
        .footer {
            background: white;
            border-radius: var(--radius);
            padding: 40px;
            margin-top: 40px;
            box-shadow: var(--shadow);
            text-align: center;
        }
        
        .footer-links {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .footer-link {
            color: var(--gray);
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .footer-link:hover {
            color: var(--primary);
        }
        
        .copyright {
            color: var(--gray);
            font-size: 14px;
            margin-top: 20px;
        }
        
        /* === RESPONSIVE === */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                text-align: center;
                gap: 20px;
            }
            
            .hero h2 {
                font-size: 28px;
            }
            
            .price {
                font-size: 36px;
            }
            
            .mpesa-number {
                font-size: 24px;
            }
            
            .documents-grid {
                grid-template-columns: 1fr;
            }
            
            .contact-links {
                flex-direction: column;
            }
            
            .contact-btn {
                justify-content: center;
            }
            
            .request-actions {
                flex-direction: column;
            }
            
            .admin-tabs {
                flex-direction: column;
            }
        }
        
        /* === LOADING === */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--gray);
        }
        
        /* === ANIMATIONS === */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container fade-in">
        <!-- HEADER -->
        <header class="header">
            <div class="logo-section">
                <div class="logo-icon">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <div class="logo-text">
                    <h1>RevisionVault</h1>
                    <p class="tagline">Premium University Study Materials</p>
                </div>
            </div>
            <div id="userStatus">
                <!-- User status will be shown here -->
            </div>
        </header>

        <!-- HERO SECTION -->
        <section class="hero">
            <h2>Access 1000+ University Revision Papers</h2>
            <p>One subscription. All subjects. Unlimited downloads.</p>
            <div class="price-badge">
                <span class="price">Ksh 50</span>
                <span class="period">/semester</span>
            </div>
            <div class="per-day">Less than <strong>Ksh 0.50/day</strong></div>
        </section>

        <!-- STATUS MESSAGE -->
        <div id="statusMessage" class="status"></div>

        <!-- PENDING STATUS (shown when waiting) -->
        <div id="pendingStatus" class="pending-status" style="display: none;">
            <div class="spinner"></div>
            <div>
                <strong>‚è≥ Waiting for Admin Approval</strong>
                <p>Your payment is being verified. We'll notify you when approved.</p>
            </div>
        </div>

        <!-- PAYMENT & VERIFICATION SECTION -->
        <section class="payment-section">
            <h2 class="section-title"><i class="fas fa-credit-card"></i> How to Subscribe</h2>
            
            <!-- Steps -->
            <div style="margin: 25px 0;">
                <div style="display: flex; align-items: center; margin-bottom: 15px;">
                    <div style="background: var(--primary); color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px;">1</div>
                    <div>Send <strong>Ksh 50</strong> to:</div>
                </div>
                
                <!-- PAYMENT BOX -->
                <div class="payment-box">
                    <div class="payment-label">Send Ksh 50 to:</div>
                    <div class="mpesa-number">0765098865</div>
                    <div class="payment-label">Reference: <strong>REVISION</strong></div>
                    <div class="payment-note">(M-Pesa/Equitel)</div>
                </div>
                
                <div style="display: flex; align-items: center; margin: 20px 0;">
                    <div style="background: var(--primary); color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px;">2</div>
                    <div>Enter your payment details below for verification</div>
                </div>
            </div>

            <!-- VERIFICATION FORM -->
            <h2 class="section-title"><i class="fas fa-check-circle"></i> Verify Your Payment</h2>
            
            <div class="form-group">
                <label class="form-label" for="userPhone">Your Phone Number</label>
                <input type="tel" id="userPhone" class="form-input" placeholder="0765 098 865" maxlength="13">
            </div>
            
            <div class="form-group">
                <label class="form-label" for="txnCode">Transaction Code</label>
                <input type="text" id="txnCode" class="form-input" placeholder="ABC123XYZ" maxlength="10">
            </div>
            
            <button class="btn btn-primary" onclick="submitForApproval()">
                <i class="fas fa-paper-plane"></i> Submit for Verification
            </button>
            
            <button class="btn btn-secondary" onclick="testPayment()">
                <i class="fas fa-bolt"></i> Try Demo (No Payment)
            </button>
            
            <p style="text-align: center; margin-top: 20px; color: var(--gray); font-size: 14px;">
                <i class="fas fa-clock"></i> Activation within 5-10 minutes after approval
            </p>
            
            <!-- CONTACT LINKS -->
            <div class="contact-links">
                <a href="https://t.me/+QlZ_LCrZoB5kZjNk" class="contact-btn telegram" target="_blank">
                    <i class="fab fa-telegram"></i> Join Telegram Channel
                </a>
                <a href="#" id="whatsappLink" class="contact-btn whatsapp">
                    <i class="fab fa-whatsapp"></i> Contact Support
                </a>
            </div>
        </section>

        <!-- DOCUMENTS SECTION -->
        <section class="documents-section">
            <h2 class="section-title"><i class="fas fa-file-pdf"></i> Available Documents</h2>
            
            <div id="documentsList" class="documents-grid">
                <div class="loading">
                    <div class="spinner" style="margin: 0 auto 15px;"></div>
                    <p>Loading documents...</p>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-secondary" onclick="requestNotes()">
                    <i class="fas fa-comment"></i> Request Specific Notes
                </button>
            </div>
        </section>

        <!-- ADMIN PANEL (Hidden by default) -->
        <div id="adminContainer" class="admin-panel">
            <!-- Admin content will be loaded here -->
        </div>

        <!-- FOOTER -->
        <footer class="footer">
            <div style="margin-bottom: 20px;">
                <h3 style="color: var(--dark); margin-bottom: 10px;">RevisionVault</h3>
                <p style="color: var(--gray);">University study materials made affordable</p>
            </div>
            
            <div class="footer-links">
                <a href="https://t.me/+QlZ_LCrZoB5kZjNk" class="footer-link" target="_blank">
                    <i class="fab fa-telegram"></i> Telegram
                </a>
                <a href="#" id="footerWhatsapp" class="footer-link">
                    <i class="fab fa-whatsapp"></i> WhatsApp
                </a>
                <a href="mailto:support@revisionvault.com" class="footer-link">
                    <i class="fas fa-envelope"></i> Email
                </a>
            </div>
            
            <div style="margin: 30px 0; padding: 20px; background: var(--light); border-radius: var(--radius);">
                <h4 style="margin-bottom: 10px; color: var(--dark);">Need Help?</h4>
                <p style="color: var(--gray); margin-bottom: 15px;">Contact us for support or document requests</p>
                <div style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;">
                    <div style="text-align: center;">
                        <div style="font-weight: 600; color: var(--primary);">Payment Number</div>
                        <div style="font-size: 18px; font-weight: 700;">0765098865</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-weight: 600; color: var(--primary);">Response Time</div>
                        <div style="font-size: 18px; font-weight: 700;">5-10 minutes</div>
                    </div>
                </div>
            </div>
            
            <div class="copyright">
                <p>&copy; 2024 RevisionVault. All rights reserved.</p>
                <p style="margin-top: 5px; font-size: 12px;">Made with ‚ù§Ô∏è for Kenyan university students</p>
            </div>
        </footer>
    </div>

    <!-- ADMIN ACCESS BUTTON -->
    <button class="admin-access-btn" onclick="showAdminPanel()">
        <i class="fas fa-user-shield"></i>
    </button>

    <script>
        // ================= CONFIGURATION =================
        const CONFIG = {
            // YOUR DETAILS
            yourPhoneNumber: '254765098865',      // 0765098865 in 254 format
            yourWhatsAppNumber: '254765098865',   // Same for WhatsApp
            yourTelegramLink: 'https://t.me/+QlZ_LCrZoB5kZjNk',
            
            // APP SETTINGS
            subscriptionDays: 180,  // 6 months
            price: 50,
            currency: 'Ksh',
            
            // ADMIN SETTINGS
            adminPassword: 'RV2024',  // CHANGE THIS!
            adminEmail: 'revisionvaultke@gmail.com'
        };

        // ================= DATA STORAGE =================
        let pendingRequests = JSON.parse(localStorage.getItem('pending_requests')) || [];
        let activeSubscriptions = JSON.parse(localStorage.getItem('active_subscriptions')) || [];

        // ================= DOCUMENTS DATA =================
        const DOCUMENTS = [
            {
                id: 1,
                title: "Calculus II - Past Papers 2020-2023",
                course: "Mathematics",
                university: "University of Nairobi",
                year: 2023,
                size: "2.4 MB",
                pages: 45,
                downloadUrl: "https://t.me/+QlZ_LCrZoB5kZjNk/1",
                tags: ["mathematics", "calculus", "past-papers"]
            },
            {
                id: 2,
                title: "Data Structures & Algorithms",
                course: "Computer Science",
                university: "Kenyatta University",
                year: 2022,
                size: "3.1 MB",
                pages: 68,
                downloadUrl: "https://t.me/+QlZ_LCrZoB5kZjNk/2",
                tags: ["cs", "algorithms", "notes"]
            },
            {
                id: 3,
                title: "Microeconomics - Theory & Practice",
                course: "Economics",
                university: "Moi University",
                year: 2021,
                size: "1.8 MB",
                pages: 32,
                downloadUrl: "https://t.me/+QlZ_LCrZoB5kZjNk/3",
                tags: ["economics", "business", "theory"]
            }
        ];

        // ================= INITIALIZE APP =================
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
        });

        function initApp() {
            console.log('üöÄ RevisionVault Initializing...');
            
            // Setup WhatsApp links
            document.getElementById('whatsappLink').href = `https://wa.me/${CONFIG.yourWhatsAppNumber}`;
            document.getElementById('footerWhatsapp').href = `https://wa.me/${CONFIG.yourWhatsAppNumber}`;
            
            // Setup phone input formatting
            const phoneInput = document.getElementById('userPhone');
            phoneInput.addEventListener('input', formatPhoneInput);
            
            // Auto-uppercase transaction code
            const txnInput = document.getElementById('txnCode');
            txnInput.addEventListener('input', function(e) {
                e.target.value = e.target.value.toUpperCase();
            });
            
            // Load documents
            loadDocuments();
            
            // Check existing subscription
            checkExistingSubscription();
            
            // Check for pending approval
            checkPendingApproval();
            
            // Check URL for admin access
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('admin') === CONFIG.adminPassword) {
                showAdminPanel();
            }
            
            console.log('‚úÖ App Ready!');
        }

        // ================= FORMATTING FUNCTIONS =================
        function formatPhoneForDisplay(phone) {
            if (phone.startsWith('254')) {
                return '0' + phone.substring(3, 6) + ' ' + phone.substring(6, 9) + ' ' + phone.substring(9);
            }
            return phone;
        }

        function formatPhoneForAPI(phone) {
            let cleaned = phone.replace(/\s+/g, '');
            if (cleaned.startsWith('0')) {
                return '254' + cleaned.substring(1);
            }
            return cleaned;
        }

        function formatPhoneInput(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 0) {
                if (value.length <= 3) {
                    value = value;
                } else if (value.length <= 6) {
                    value = value.substring(0, 3) + ' ' + value.substring(3);
                } else {
                    value = value.substring(0, 3) + ' ' + value.substring(3, 6) + ' ' + value.substring(6, 9);
                }
            }
            e.target.value = value;
        }

        // ================= PAYMENT SUBMISSION =================
        function submitForApproval() {
            const phone = document.getElementById('userPhone').value.trim();
            const txnCode = document.getElementById('txnCode').value.trim().toUpperCase();

            if (!phone || phone.replace(/\s/g, '').length < 9) {
                showStatus('Please enter a valid Kenyan phone number', 'error');
                return;
            }

            if (!txnCode || txnCode.length < 8) {
                showStatus('Please enter a valid transaction code (8-10 characters)', 'error');
                return;
            }

            // Create request
            const request = {
                id: Date.now(),
                phone: formatPhoneForAPI(phone),
                displayPhone: phone,
                txnCode: txnCode,
                amount: 50,
                status: "pending",
                submitted: new Date().toISOString(),
                ip: "user-" + Math.random().toString(36).substr(2, 9)
            };

            // Add to pending requests
            pendingRequests.push(request);
            localStorage.setItem('pending_requests', JSON.stringify(pendingRequests));

            // Save user phone for checking
            localStorage.setItem('last_submitted_phone', request.phone);

            // Show pending status
            document.getElementById('pendingStatus').style.display = 'flex';
            showStatus('‚úÖ Payment submitted for admin approval! You will be notified when approved.', 'success');

            // Send WhatsApp notification to admin
            sendAdminNotification(request);

            // Start checking for approval
            startApprovalCheck(request.id);

            // Clear form
            document.getElementById('userPhone').value = '';
            document.getElementById('txnCode').value = '';
        }

        function sendAdminNotification(request) {
            const adminMessage = 
                `üîÑ NEW PAYMENT REQUEST\n\n` +
                `üì± Phone: ${request.displayPhone}\n` +
                `üí≥ Amount: Ksh ${request.amount}\n` +
                `üìü Code: ${request.txnCode}\n` +
                `‚è∞ Time: ${new Date(request.submitted).toLocaleTimeString()}\n\n` +
                `To approve: ${window.location.origin}${window.location.pathname}?admin=${CONFIG.adminPassword}`;

            const whatsappURL = `https://wa.me/${CONFIG.yourWhatsAppNumber}?text=${encodeURIComponent(adminMessage)}`;
            
            // Open WhatsApp for admin
            window.open(whatsappURL, '_blank');
        }

        // ================= APPROVAL CHECKING =================
        function startApprovalCheck(requestId) {
            let checkCount = 0;
            const maxChecks = 120; // Check for 60 minutes (30 seconds √ó 120 = 60 mins)

            const checkInterval = setInterval(() => {
                checkCount++;

                const request = pendingRequests.find(r => r.id == requestId);

                if (!request) {
                    clearInterval(checkInterval);
                    return;
                }

                if (request.status === 'approved') {
                    clearInterval(checkInterval);
                    document.getElementById('pendingStatus').style.display = 'none';
                    showStatus('üéâ Payment approved! All documents now unlocked.', 'success');
                    
                    // Activate user access
                    activateUserAccess(request);
                    
                    // Refresh documents
                    setTimeout(() => {
                        loadDocuments();
                    }, 1000);
                    
                } else if (request.status === 'rejected') {
                    clearInterval(checkInterval);
                    document.getElementById('pendingStatus').style.display = 'none';
                    showStatus(`‚ùå Payment rejected. ${request.rejectionReason || 'Please contact support.'}`, 'error');
                    
                } else if (checkCount >= maxChecks) {
                    clearInterval(checkInterval);
                    document.getElementById('pendingStatus').style.display = 'none';
                    showStatus('‚è∞ Approval taking longer than expected. We will notify you via WhatsApp.', 'warning');
                }
            }, 30000); // Check every 30 seconds
        }

        function checkPendingApproval() {
            const lastPhone = localStorage.getItem('last_submitted_phone');
            if (!lastPhone) return;

            const pendingRequest = pendingRequests.find(r => 
                r.phone === lastPhone && r.status === 'pending'
            );

            if (pendingRequest) {
                document.getElementById('pendingStatus').style.display = 'flex';
                startApprovalCheck(pendingRequest.id);
            }
        }

        // ================= ADMIN PANEL =================
        function showAdminPanel() {
            const password = prompt('Enter admin password:');
            if (password !== CONFIG.adminPassword) {
                alert('Access denied');
                return;
            }

            const pendingCount = pendingRequests.filter(r => r.status === 'pending').length;
            const approvedCount = activeSubscriptions.length;

            const adminHTML = `
                <div class="admin-header">
                    <h3><i class="fas fa-user-shield"></i> Admin Panel</h3>
                    <div class="admin-stats">
                        <span class="stat pending">‚è≥ ${pendingCount} Pending</span>
                        <span class="stat approved">‚úÖ ${approvedCount} Active</span>
                    </div>
                </div>
                
                <div class="admin-tabs">
                    <button class="tab-btn active" onclick="showAdminTab('pending')">
                        <i class="fas fa-clock"></i> Pending (${pendingCount})
                    </button>
                    <button class="tab-btn" onclick="showAdminTab('approved')">
                        <i class="fas fa-check-circle"></i> Approved (${approvedCount})
                    </button>
                    <button class="tab-btn" onclick="showAdminTab('manual')">
                        <i class="fas fa-user-plus"></i> Manual Add
                    </button>
                </div>
                
                <div id="pendingTab" class="tab-content active">
                    <h4>Pending Approval Requests</h4>
                    ${renderPendingRequests()}
                </div>
                
                <div id="approvedTab" class="tab-content">
                    <h4>Active Subscriptions</h4>
                    ${renderApprovedUsers()}
                </div>
                
                <div id="manualTab" class="tab-content">
                    <h4>Manual User Activation</h4>
                    <div style="margin: 20px 0;">
                        <input type="text" id="manualPhone" placeholder="Phone (0712 345 678)" class="form-input" style="margin-bottom: 10px;">
                        <input type="text" id="manualCode" placeholder="Transaction Code" class="form-input" style="margin-bottom: 10px;">
                        <button class="btn btn-primary" onclick="manualApproveUser()">
                            <i class="fas fa-check"></i> Activate User
                        </button>
                    </div>
                </div>
            `;

            document.getElementById('adminContainer').innerHTML = adminHTML;
            document.getElementById('adminContainer').style.display = 'block';
        }

        function showAdminTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName + 'Tab').classList.add('active');
            event.target.classList.add('active');
        }

        function renderPendingRequests() {
            const pending = pendingRequests.filter(r => r.status === 'pending');
            
            if (pending.length === 0) {
                return '<p style="text-align: center; color: var(--gray); padding: 20px;">No pending requests</p>';
            }
            
            return pending.map(request => `
                <div class="request-card">
                    <div class="request-info">
                        <div class="request-phone">üì± ${request.displayPhone}</div>
                        <div class="request-code">üí≥ ${request.txnCode}</div>
                        <div class="request-time">‚è∞ ${new Date(request.submitted).toLocaleTimeString()}</div>
                    </div>
                    <div class="request-actions">
                        <button class="btn-approve" onclick="approveRequest(${request.id})">
                            <i class="fas fa-check"></i> Approve
                        </button>
                        <button class="btn-reject" onclick="rejectRequest(${request.id})">
                            <i class="fas fa-times"></i> Reject
                        </button>
                        <button class="btn-whatsapp" onclick="messageUser('${request.displayPhone}')">
                            <i class="fab fa-whatsapp"></i> Message
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function renderApprovedUsers() {
            if (activeSubscriptions.length === 0) {
                return '<p style="text-align: center; color: var(--gray); padding: 20px;">No active subscriptions</p>';
            }
            
            return activeSubscriptions.map(user => `
                <div class="request-card" style="border-left-color: #10b981;">
                    <div class="request-info">
                        <div class="request-phone">üì± ${formatPhoneForDisplay(user.phone)}</div>
                        <div class="request-code">üìÖ Expires: ${new Date(user.expires).toLocaleDateString()}</div>
                        <div class="request-time">‚è∞ Activated: ${new Date(user.activated).toLocaleDateString()}</div>
                    </div>
                </div>
            `).join('');
        }

        // ================= ADMIN ACTIONS =================
        function approveRequest(requestId) {
            const request = pendingRequests.find(r => r.id == requestId);
            if (!request) return;

            // Update request status
            request.status = 'approved';
            request.approvedAt = new Date().toISOString();
            localStorage.setItem('pending_requests', JSON.stringify(pendingRequests));

            // Activate user
            activateUserAccess(request);

            // Refresh admin panel
            showAdminPanel();

            // Notify user
            sendUserNotification(request, 'approved');

            showStatus(`‚úÖ User ${request.displayPhone} approved!`, 'success');
        }

        function rejectRequest(requestId) {
            const reason = prompt('Rejection reason:');
            if (reason === null) return;

            const request = pendingRequests.find(r => r.id == requestId);
            if (!request) return;

            request.status = 'rejected';
            request.rejectionReason = reason;
            request.rejectedAt = new Date().toISOString();
            localStorage.setItem('pending_requests', JSON.stringify(pendingRequests));

            // Refresh admin panel
            showAdminPanel();

            // Notify user
            sendUserNotification(request, 'rejected');

            showStatus(`‚ùå Request rejected. User notified.`, 'error');
        }

        function manualApproveUser() {
            const phone = document.getElementById('manualPhone').value.trim();
            const txnCode = document.getElementById('manualCode').value.trim() || 'MANUAL-' + Date.now();

            if (!phone) {
                alert('Please enter phone number');
                return;
            }

            const request = {
                id: Date.now(),
                phone: formatPhoneForAPI(phone),
                displayPhone: phone,
                txnCode: txnCode,
                amount: 50,
                status: "approved",
                submitted: new Date().toISOString(),
                approvedAt: new Date().toISOString()
            };

            // Add to pending for consistency
            pendingRequests.push(request);
            localStorage.setItem('pending_requests', JSON.stringify(pendingRequests));

            // Activate user
            activateUserAccess(request);

            // Clear form
            document.getElementById('manualPhone').value = '';
            document.getElementById('manualCode').value = '';

            // Refresh admin panel
            showAdminPanel();

            // Notify user
            sendUserNotification(request, 'approved');

            showStatus(`‚úÖ User ${phone} manually activated!`, 'success');
        }

        function activateUserAccess(request) {
            // Calculate expiry
            const expiryDate = new Date();
            expiryDate.setDate(expiryDate.getDate() + CONFIG.subscriptionDays);

            const userData = {
                phone: request.phone,
                displayPhone: request.displayPhone,
                status: 'Active',
                expires: expiryDate.toISOString(),
                activated: request.approvedAt || new Date().toISOString(),
                txnCode: request.txnCode,
                plan: 'Semester'
            };

            // Add to active subscriptions
            const existingIndex = activeSubscriptions.findIndex(u => u.phone === request.phone);
            if (existingIndex !== -1) {
                activeSubscriptions[existingIndex] = userData;
            } else {
                activeSubscriptions.push(userData);
            }

            localStorage.setItem('active_subscriptions', JSON.stringify(activeSubscriptions));

            // Also save as current user subscription
            localStorage.setItem('revisionvault_subscription', JSON.stringify(userData));

            // Update UI
            updateUserStatus(userData);
        }

        function sendUserNotification(request, status) {
            let message = '';
            
            if (status === 'approved') {
                message = 
                    `‚úÖ *PAYMENT APPROVED!*\n\n` +
                    `Your RevisionVault subscription is now ACTIVE!\n\n` +
                    `üì± Login with: ${request.displayPhone}\n` +
                    `üìÖ Expires: 6 months from now\n` +
                    `üîó App: ${window.location.href}\n\n` +
                    `All documents are now unlocked!`;
            } else {
                message = 
                    `‚ùå *PAYMENT REJECTED*\n\n` +
                    `Your payment verification failed.\n` +
                    `Reason: ${request.rejectionReason || 'Could not verify payment'}\n\n` +
                    `Please contact support if you believe this is an error.`;
            }

            const whatsappURL = `https://wa.me/${request.phone}?text=${encodeURIComponent(message)}`;
            window.open(whatsappURL, '_blank');
        }

        function messageUser(phone) {
            const message = prompt('Message to user:');
            if (!message) return;

            const whatsappURL = `https://wa.me/${formatPhoneForAPI(phone)}?text=${encodeURIComponent(message)}`;
            window.open(whatsappURL, '_blank');
        }

        // ================= USER MANAGEMENT =================
        function checkExistingSubscription() {
            const subscription = localStorage.getItem('revisionvault_subscription');
            
            if (subscription) {
                const data = JSON.parse(subscription);
                const expiry = new Date(data.expires);
                const today = new Date();
                
                if (expiry > today) {
                    updateUserStatus(data);
                    return true;
                } else {
                    localStorage.removeItem('revisionvault_subscription');
                }
            }
            return false;
        }

        function updateUserStatus(userData) {
            const expiry = new Date(userData.expires);
            const daysLeft = Math.ceil((expiry - new Date()) / (1000 * 60 * 60 * 24));
            
            document.getElementById('userStatus').innerHTML = `
                <div style="background: #d1fae5; color: #065f46; padding: 10px 20px; border-radius: 50px; font-weight: 600;">
                    <i class="fas fa-crown"></i> Active (${daysLeft} days)
                </div>
            `;
        }

        // ================= DOCUMENTS =================
        function loadDocuments() {
            const container = document.getElementById('documentsList');
            const hasAccess = checkExistingSubscription();
            
            let html = '';
            
            DOCUMENTS.forEach(doc => {
                html += `
                    <div class="document-card">
                        <div class="doc-icon">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <div class="doc-content">
                            <h3 class="doc-title">${doc.title}</h3>
                            <div class="doc-meta">
                                <span class="meta-tag">${doc.course}</span>
                                <span class="meta-tag">${doc.university}</span>
                                <span class="meta-tag">${doc.year}</span>
                            </div>
                            <p style="color: var(--gray); margin: 10px 0;">
                                <i class="fas fa-file"></i> ${doc.pages} pages ‚Ä¢ 
                                <i class="fas fa-database"></i> ${doc.size}
                            </p>
                            
                            ${hasAccess ? 
                                `<a href="${doc.downloadUrl}" class="download-btn" target="_blank">
                                    <i class="fas fa-download"></i> Download PDF
                                </a>` :
                                `<div style="background: #fee2e2; color: #991b1b; padding: 10px; border-radius: 8px; text-align: center;">
                                    <i class="fas fa-lock"></i> Subscribe to unlock (Ksh 50)
                                </div>`
                            }
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // ================= UTILITY FUNCTIONS =================
        function testPayment() {
            const testPhone = '2547' + Math.floor(Math.random() * 100000000).toString().padStart(8, '0');
            const testTxn = 'TEST' + Math.floor(Math.random() * 10000).toString().padStart(4, '0');
            
            document.getElementById('userPhone').value = formatPhoneForDisplay(testPhone);
            document.getElementById('txnCode').value = testTxn;
            
            showStatus('üß™ Demo mode activated. Click "Submit for Verification" to test the flow.', 'warning');
        }

        function requestNotes() {
            const course = prompt('Which course notes do you need?');
            if (!course) return;

            const message = 
                `üìö *NOTE REQUEST*\n\n` +
                `Course: ${course}\n` +
                `Date: ${new Date().toLocaleDateString()}\n\n` +
                `Please upload notes for this course.`;

            const whatsappURL = `https://wa.me/${CONFIG.yourWhatsAppNumber}?text=${encodeURIComponent(message)}`;
            window.open(whatsappURL, '_blank');
            
            showStatus('üìù Opening WhatsApp for your request...', 'success');
        }

        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
            statusDiv.style.display = 'block';
            
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }

        // ================= INITIAL LOG =================
        console.log(`
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë           REVISIONVAULT - READY TO LAUNCH        ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë ‚úÖ M-Pesa: 0765098865                            ‚ïë
‚ïë ‚úÖ WhatsApp: 0765098865                          ‚ïë
‚ïë ‚úÖ Telegram: t.me/+QlZ_LCrZoB5kZjNk              ‚ïë
‚ïë ‚úÖ Admin Password: RV2024                        ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë üöÄ Auto-Approval System Active                   ‚ïë
‚ïë üëë Admin Panel: ?admin=RV2024                    ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
        `);
    </script>
</body>
</html>