<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RevisionVault - Study Materials</title>
    
    <!-- Add PDF.js library for PDF rendering -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        /* ===== RESET & BASE ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 0;
            color: #333;
            overflow-x: hidden;
        }
        
        /* Screenshot Protection */
        .screenshot-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent;
            z-index: 999999;
            pointer-events: none;
            display: none;
        }
        
        /* ===== MAIN CONTAINER ===== */
        .container {
            max-width: 100%;
            min-height: 100vh;
            background: white;
            position: relative;
        }
        
        /* ===== HEADER ===== */
        .header {
            background: linear-gradient(90deg, #1a2980 0%, #26d0ce 100%);
            color: white;
            padding: 15px 20px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .header-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo i {
            font-size: 2rem;
        }
        
        .logo-text h1 {
            font-size: 1.6rem;
            font-weight: 700;
            line-height: 1.2;
        }
        
        .logo-text .tagline {
            opacity: 0.9;
            font-size: 0.8rem;
            margin-top: 3px;
        }
        
        .header-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Admin Button */
        .admin-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 50px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            font-size: 0.9rem;
            text-decoration: none;
        }
        
        .admin-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        
        /* User Menu */
        .user-menu {
            position: relative;
        }
        
        .user-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 50px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            font-size: 0.9rem;
        }
        
        .user-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            min-width: 180px;
            display: none;
            z-index: 1000;
            margin-top: 10px;
        }
        
        .dropdown-menu.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        .dropdown-item {
            padding: 12px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #333;
            text-decoration: none;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .dropdown-item:last-child {
            border-bottom: none;
        }
        
        .dropdown-item:hover {
            background: #f8f9fa;
            color: #1a2980;
        }
        
        /* Approval Status Indicator */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-left: 10px;
        }
        
        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status-active {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status-expired {
            background: #fee2e2;
            color: #991b1b;
        }
        
        /* ===== CONTENT SECTIONS ===== */
        .content-section {
            display: none;
            min-height: calc(100vh - 120px);
            padding: 0;
        }
        
        .content-section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* ===== SUBSCRIPTION SECTION (First Screen) ===== */
        .subscription-section {
            padding: 20px;
            background: linear-gradient(135deg, #f8f9ff 0%, #eef2ff 100%);
            min-height: calc(100vh - 80px);
        }
        
        .hero-box {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
            border: 3px solid #1a2980;
        }
        
        .hero-title {
            color: #1a2980;
            margin-bottom: 10px;
            font-size: 1.6rem;
        }
        
        .hero-subtitle {
            color: #666;
            margin-bottom: 20px;
            font-size: 0.95rem;
        }
        
        .price-box {
            background: linear-gradient(135deg, #1a2980 0%, #26d0ce 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
        }
        
        .price-amount {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .price-period {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .features-list {
            text-align: left;
            margin: 20px 0;
        }
        
        .feature-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
            color: #555;
            font-size: 0.9rem;
        }
        
        .feature-item i {
            color: #10b981;
            font-size: 1.1rem;
        }
        
        .steps-box {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #e2e8f0;
        }
        
        .step {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .step-number {
            background: #1a2980;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 12px;
            flex-shrink: 0;
            font-size: 0.9rem;
        }
        
        .mpesa-details {
            background: #10b981;
            color: white;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            margin: 20px 0;
        }
        
        .mpesa-number {
            font-size: 1.8rem;
            font-weight: bold;
            letter-spacing: 1px;
            margin: 10px 0;
            direction: ltr;
            word-break: break-all;
        }
        
        /* ===== FORMS ===== */
        .form-container {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            border: 2px solid #e2e8f0;
        }
        
        .form-title {
            color: #1a2980;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 2px solid #f0f0f0;
            font-size: 1.2rem;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #333;
            font-size: 0.9rem;
        }
        
        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 0.95rem;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #1a2980;
        }
        
        .new-university-input {
            display: none;
            margin-top: 10px;
            animation: fadeIn 0.3s ease;
        }
        
        /* ===== BUTTONS ===== */
        .btn {
            padding: 12px 20px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(90deg, #1a2980 0%, #26d0ce 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(26, 41, 128, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(90deg, #10b981 0%, #34d399 100%);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(90deg, #ef4444 0%, #f87171 100%);
            color: white;
        }
        
        .btn-secondary {
            background: #64748b;
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(90deg, #f59e0b 0%, #fbbf24 100%);
            color: white;
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid #1a2980;
            color: #1a2980;
        }
        
        .btn-small {
            padding: 8px 15px;
            font-size: 0.85rem;
        }
        
        .btn-block {
            width: 100%;
        }
        
        /* ===== DOCUMENTS SECTION ===== */
        .documents-section {
            padding: 15px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .section-title {
            color: #1a2980;
            font-size: 1.4rem;
        }
        
        .university-badge {
            background: #1a2980;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 500;
            font-size: 0.85rem;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .filter-bar {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding-bottom: 8px;
            scrollbar-width: none;
        }
        
        .filter-bar::-webkit-scrollbar {
            display: none;
        }
        
        .filter-chip {
            padding: 8px 15px;
            background: #f1f5f9;
            border-radius: 20px;
            cursor: pointer;
            white-space: nowrap;
            border: 2px solid transparent;
            font-size: 0.85rem;
        }
        
        .filter-chip.active {
            background: #1a2980;
            color: white;
            border-color: #1a2980;
        }
        
        .documents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .document-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 2px solid #e2e8f0;
            transition: all 0.3s;
        }
        
        .document-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
            border-color: #1a2980;
        }
        
        .document-header {
            background: #f8f9ff;
            padding: 15px;
            border-bottom: 2px solid #eef2ff;
        }
        
        .document-title {
            font-weight: bold;
            color: #1a2980;
            margin-bottom: 8px;
            font-size: 1rem;
        }
        
        .document-meta {
            display: flex;
            gap: 12px;
            font-size: 0.8rem;
            color: #666;
            flex-wrap: wrap;
        }
        
        .document-body {
            padding: 15px;
        }
        
        .document-description {
            color: #555;
            margin-bottom: 12px;
            line-height: 1.4;
            font-size: 0.9rem;
        }
        
        .document-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 12px;
        }
        
        .tag {
            background: #e0f2fe;
            color: #0369a1;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
        }
        
        .document-actions {
            display: flex;
            gap: 8px;
        }
        
        /* ===== PDF VIEWER ===== */
        .pdf-viewer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.97);
            z-index: 9999;
            display: none;
            flex-direction: column;
        }
        
        .pdf-viewer.active {
            display: flex;
        }
        
        .pdf-viewer-header {
            background: #111;
            padding: 12px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #333;
            flex-shrink: 0;
        }
        
        .pdf-viewer-title {
            color: white;
            font-size: 1rem;
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .pdf-viewer-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .pdf-viewer-body {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }
        
        .pdf-controls-bar {
            background: #222;
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #333;
            flex-shrink: 0;
        }
        
        .pdf-nav-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .pdf-page-info {
            color: white;
            font-size: 0.9rem;
            margin: 0 15px;
        }
        
        .pdf-zoom-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .pdf-canvas-container {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            background: #525659;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            position: relative;
        }
        
        .pdf-page-canvas {
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            max-width: 100%;
            position: relative;
        }
        
        .pdf-watermark {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 3rem;
            color: rgba(255,0,0,0.08);
            pointer-events: none;
            user-select: none;
            white-space: nowrap;
            z-index: 1;
            font-weight: bold;
        }
        
        .pdf-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 1.2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        
        .pdf-progress-bar {
            width: 200px;
            height: 4px;
            background: #333;
            border-radius: 2px;
            overflow: hidden;
        }
        
        .pdf-progress-fill {
            height: 100%;
            background: #1a2980;
            width: 0%;
            transition: width 0.3s;
        }
        
        /* ===== ADMIN SECTION ===== */
        .admin-section {
            padding: 15px;
            background: #f8f9ff;
            min-height: calc(100vh - 80px);
        }
        
        .admin-login-box {
            max-width: 400px;
            margin: 40px auto;
            background: white;
            padding: 30px 25px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .admin-panel {
            display: none;
        }
        
        .admin-panel.active {
            display: block;
        }
        
        .admin-grid {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 15px;
            min-height: 500px;
        }
        
        .admin-sidebar {
            background: white;
            border-radius: 12px;
            padding: 15px;
            border: 2px solid #e2e8f0;
        }
        
        .admin-menu {
            list-style: none;
        }
        
        .admin-menu li {
            margin-bottom: 5px;
        }
        
        .admin-menu a {
            display: block;
            padding: 10px 12px;
            color: #333;
            text-decoration: none;
            border-radius: 6px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }
        
        .admin-menu a.active,
        .admin-menu a:hover {
            background: #1a2980;
            color: white;
        }
        
        .admin-content {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #e2e8f0;
            overflow-x: auto;
        }
        
        /* Admin Dashboard */
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .stat-card {
            background: #f8f9ff;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #e2e8f0;
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #1a2980;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.85rem;
        }
        
        .admin-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.9rem;
        }
        
        .admin-table th {
            background: #f8f9ff;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #1a2980;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .admin-table td {
            padding: 12px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .admin-table tr:hover {
            background: #f8f9ff;
        }
        
        /* Pending Approvals Section */
        .pending-approvals {
            background: #fffbeb;
            border: 2px solid #fbbf24;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .pending-list {
            margin-top: 15px;
        }
        
        .pending-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .pending-info {
            flex: 1;
        }
        
        .pending-info h4 {
            color: #1a2980;
            margin-bottom: 5px;
        }
        
        .pending-actions {
            display: flex;
            gap: 10px;
        }
        
        /* Search and Filter */
        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .search-input {
            flex: 1;
            padding: 10px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 0.9rem;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #1a2980;
        }
        
        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .action-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            border: 2px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .action-card:hover {
            border-color: #1a2980;
            transform: translateY(-3px);
        }
        
        .action-card i {
            font-size: 1.5rem;
            color: #1a2980;
            margin-bottom: 8px;
        }
        
        .action-card h4 {
            font-size: 0.9rem;
            color: #333;
        }
        
        .badge {
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
            display: inline-block;
        }
        
        .badge-success {
            background: #d1fae5;
            color: #065f46;
        }
        
        .badge-warning {
            background: #fef3c7;
            color: #92400e;
        }
        
        .badge-danger {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .badge-info {
            background: #dbeafe;
            color: #1e40af;
        }
        
        /* ===== STATUS MESSAGES ===== */
        .status-message {
            padding: 12px 15px;
            border-radius: 8px;
            margin: 12px 0;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideIn 0.3s ease;
            font-size: 0.9rem;
        }
        
        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .status-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }
        
        .status-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }
        
        .status-warning {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fde68a;
        }
        
        .status-info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #bfdbfe;
        }
        
        /* ===== FOOTER ===== */
        .footer {
            text-align: center;
            padding: 15px;
            color: #666;
            border-top: 1px solid #e5e7eb;
            background: #f8f9ff;
            margin-top: auto;
            font-size: 0.85rem;
        }
        
        .developer-name {
            color: #1a2980;
            font-weight: 600;
        }
        
        /* ===== LOADING ===== */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 99999;
        }
        
        .loading-overlay.active {
            display: flex;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #1a2980;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            .documents-grid {
                grid-template-columns: 1fr;
            }
            
            .admin-grid {
                grid-template-columns: 1fr;
            }
            
            .admin-sidebar {
                order: 2;
            }
            
            .admin-content {
                order: 1;
            }
            
            .mpesa-number {
                font-size: 1.4rem;
            }
            
            .price-amount {
                font-size: 2.2rem;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .header-controls {
                flex-wrap: wrap;
                justify-content: flex-end;
            }
            
            .admin-stats {
                grid-template-columns: 1fr;
            }
            
            .quick-actions {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .pending-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .pending-actions {
                width: 100%;
                justify-content: flex-end;
            }
            
            .pdf-controls-bar {
                flex-wrap: wrap;
                gap: 10px;
            }
            
            .pdf-nav-controls, .pdf-zoom-controls {
                flex-wrap: wrap;
            }
        }
        
        @media (max-width: 480px) {
            .document-actions {
                flex-direction: column;
            }
            
            .btn-small {
                width: 100%;
            }
            
            .form-container {
                padding: 15px;
            }
            
            .hero-box {
                padding: 20px;
            }
            
            .admin-login-box {
                margin: 20px auto;
                padding: 20px 15px;
            }
            
            .quick-actions {
                grid-template-columns: 1fr;
            }
            
            .search-box {
                flex-direction: column;
            }
            
            .pdf-controls-bar {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }
            
            .pdf-nav-controls, .pdf-zoom-controls {
                justify-content: center;
            }
        }
    </style>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Screenshot Protection Overlay -->
    <div class="screenshot-overlay" id="screenshotOverlay"></div>
    
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>
    
    <!-- Main Container -->
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-top">
                <div class="logo">
                    <i class="fas fa-graduation-cap"></i>
                    <div class="logo-text">
                        <h1>RevisionVault</h1>
                        <p class="tagline">University Study Materials</p>
                    </div>
                </div>
                
                <div class="header-controls">
                    <!-- Admin Button - Always Visible -->
                    <a href="#" class="admin-btn" id="adminBtn" onclick="showSection('admin'); return false;">
                        <i class="fas fa-lock"></i> Admin
                    </a>
                    
                    <!-- User Menu (Shown when logged in) -->
                    <div class="user-menu" id="userMenu" style="display: none;">
                        <button class="user-btn" id="userMenuBtn">
                            <i class="fas fa-user-circle"></i>
                            <span id="userName">User</span>
                            <span class="status-indicator" id="userStatusIndicator"></span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="dropdown-menu" id="userDropdown">
                            <div class="dropdown-item" onclick="showSection('profile')">
                                <i class="fas fa-user"></i> My Profile
                            </div>
                            <div class="dropdown-item" onclick="showSection('documents')">
                                <i class="fas fa-file-alt"></i> Study Materials
                            </div>
                            <div class="dropdown-item" onclick="logout()">
                                <i class="fas fa-sign-out-alt"></i> Logout
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Content Sections -->
        <div class="content-sections">
            <!-- Subscription Section (First Screen) -->
            <div class="content-section active" id="subscriptionSection">
                <div class="subscription-section">
                    <!-- Hero Box -->
                    <div class="hero-box">
                        <h2 class="hero-title">Unlock All Study Materials</h2>
                        <p class="hero-subtitle">
                            Get complete access to thousands of revision papers, notes, and past papers from your university.
                        </p>
                        
                        <div class="price-box">
                            <div class="price-amount">Ksh 50</div>
                            <div class="price-period">5 Months Full Access</div>
                            <p style="margin-top: 8px; opacity: 0.9; font-size: 0.9rem;">Less than Ksh 0.33 per day!</p>
                        </div>
                        
                        <div class="features-list">
                            <div class="feature-item">
                                <i class="fas fa-check-circle"></i>
                                <span>All documents from your university</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Secure viewer (No screenshots)</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-check-circle"></i>
                                <span>New materials added daily</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Auto-sync from Telegram</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-check-circle"></i>
                                <span>24/7 access on any device</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Steps Box -->
                    <div class="steps-box">
                        <h3 style="color: #1a2980; margin-bottom: 15px; font-size: 1.1rem;">How to Subscribe:</h3>
                        
                        <div class="step">
                            <div class="step-number">1</div>
                            <div>
                                <strong>Open M-Pesa</strong> on your phone
                            </div>
                        </div>
                        
                        <div class="step">
                            <div class="step-number">2</div>
                            <div>
                                Select <strong>"Send Money"</strong>
                            </div>
                        </div>
                        
                        <div class="step">
                            <div class="step-number">3</div>
                            <div>
                                Send <strong>Ksh 50</strong> to:
                            </div>
                        </div>
                        
                        <div class="mpesa-details">
                            <div class="mpesa-number">0765 098 865</div>
                            <p>Reference: <strong>REVISION</strong></p>
                            <p style="font-size: 0.85rem; margin-top: 8px;">
                                <i class="fas fa-info-circle"></i> Equitel number (works with M-Pesa)
                            </p>
                        </div>
                        
                        <div class="step">
                            <div class="step-number">4</div>
                            <div>
                                Enter your <strong>M-Pesa PIN</strong> and send
                            </div>
                        </div>
                        
                        <div class="step">
                            <div class="step-number">5</div>
                            <div>
                                Copy the <strong>Transaction Code</strong> from SMS
                            </div>
                        </div>
                    </div>
                    
                    <!-- Subscription Form -->
                    <div class="form-container">
                        <h3 class="form-title">Complete Your Subscription</h3>
                        
                        <div class="form-group">
                            <label class="form-label">Your Phone Number (10 digits)</label>
                            <input type="tel" class="form-input" id="userPhone" placeholder="0712345678" maxlength="10" pattern="[0-9]{10}">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">M-Pesa Transaction Code</label>
                            <input type="text" class="form-input" id="transactionCode" placeholder="ABC123XYZ" maxlength="10">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Select Your University</label>
                            <select class="form-input" id="userUniversity" onchange="toggleNewUniversityInput('userUniversity', 'newUserUniversity')">
                                <option value="">-- Choose University --</option>
                                <option value="University of Nairobi">University of Nairobi</option>
                                <option value="Kenyatta University">Kenyatta University</option>
                                <option value="Moi University">Moi University</option>
                                <option value="JKUAT">JKUAT</option>
                                <option value="Strathmore University">Strathmore University</option>
                                <option value="Mount Kenya University">Mount Kenya University</option>
                                <option value="Egerton University">Egerton University</option>
                                <option value="Maseno University">Maseno University</option>
                                <option value="Technical University of Kenya">Technical University of Kenya</option>
                                <option value="Kabarak University">Kabarak University</option>
                                <option value="Daystar University">Daystar University</option>
                                <option value="United States International University">USIU Africa</option>
                                <option value="Catholic University of Eastern Africa">CUEA</option>
                                <option value="Add New University">Add New University</option>
                            </select>
                            <input type="text" class="form-input new-university-input" id="newUserUniversity" placeholder="Enter New University Name">
                        </div>
                        
                        <div id="subscriptionStatus"></div>
                        
                        <button class="btn btn-primary btn-block" onclick="verifySubscription()">
                            <i class="fas fa-paper-plane"></i> Submit for Verification
                        </button>
                        
                        <p style="text-align: center; margin-top: 12px; color: #666; font-size: 0.85rem;">
                            <i class="fas fa-shield-alt"></i> Your information is secure and encrypted
                        </p>
                    </div>
                    
                    <!-- Contact Info -->
                    <div style="text-align: center; margin-top: 15px; color: #666; font-size: 0.85rem;">
                        <p>Need help? Contact support:</p>
                        <div style="display: flex; justify-content: center; gap: 15px; margin-top: 8px; flex-wrap: wrap;">
                            <a href="https://wa.me/254765098865" target="_blank" style="color: #25D366; text-decoration: none; font-size: 0.85rem;">
                                <i class="fab fa-whatsapp"></i> WhatsApp
                            </a>
                            <a href="https://t.me/Walterzauko23" target="_blank" style="color: #0088cc; text-decoration: none; font-size: 0.85rem;">
                                <i class="fab fa-telegram"></i> Telegram
                            </a>
                            <a href="https://t.me/RevisionVaultDocuments" target="_blank" style="color: #1a2980; text-decoration: none; font-size: 0.85rem;">
                                <i class="fab fa-telegram"></i> Materials Channel
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Documents Section -->
            <div class="content-section" id="documentsSection">
                <div class="documents-section">
                    <!-- Header -->
                    <div class="section-header">
                        <div>
                            <h2 class="section-title">Study Materials</h2>
                            <div class="university-badge" id="userUniBadge">
                                <i class="fas fa-university"></i> <span id="currentUniversity">Loading...</span>
                            </div>
                        </div>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <button class="btn btn-outline btn-small" onclick="refreshDocuments()">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                            <button class="btn btn-secondary btn-small" onclick="requestDocument()">
                                <i class="fas fa-plus"></i> Request Notes
                            </button>
                        </div>
                    </div>
                    
                    <!-- Access Control Message -->
                    <div id="accessControlMessage" style="display: none;"></div>
                    
                    <!-- Filters -->
                    <div class="filter-bar" id="filterBar" style="display: none;">
                        <div class="filter-chip active" onclick="filterDocuments('all')">All Documents</div>
                        <div class="filter-chip" onclick="filterDocuments('pdf')">PDF Files</div>
                        <div class="filter-chip" onclick="filterDocuments('notes')">Lecture Notes</div>
                        <div class="filter-chip" onclick="filterDocuments('past')">Past Papers</div>
                        <div class="filter-chip" onclick="filterDocuments('books')">Textbooks</div>
                    </div>
                    
                    <!-- Documents Grid -->
                    <div id="documentsContainer">
                        <!-- Documents will be loaded here -->
                    </div>
                    
                    <!-- No Documents Message -->
                    <div id="noDocuments" style="text-align: center; padding: 40px; display: none;">
                        <i class="fas fa-file-alt" style="font-size: 3rem; color: #ccc; margin-bottom: 15px;"></i>
                        <h3 style="color: #666; margin-bottom: 10px;">No Documents Available</h3>
                        <p style="color: #888; margin-bottom: 20px;">Documents for your university will appear here once uploaded.</p>
                        <button class="btn btn-primary" onclick="requestDocument()" style="max-width: 250px; margin: 0 auto;">
                            <i class="fas fa-comment"></i> Request Specific Notes
                        </button>
                    </div>
                    
                    <!-- Subscription Required Message -->
                    <div id="subscriptionRequired" style="text-align: center; padding: 60px 20px; display: none;">
                        <i class="fas fa-lock" style="font-size: 4rem; color: #1a2980; margin-bottom: 20px;"></i>
                        <h3 style="color: #1a2980; margin-bottom: 15px;">Access Restricted</h3>
                        <p style="color: #666; margin-bottom: 25px; max-width: 500px; margin-left: auto; margin-right: auto;">
                            You need an active subscription to access study materials. Subscribe now to unlock thousands of documents from your university.
                        </p>
                        <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                            <button class="btn btn-primary" onclick="showSection('subscription')">
                                <i class="fas fa-credit-card"></i> Subscribe Now
                            </button>
                            <button class="btn btn-outline" onclick="checkApprovalStatus()">
                                <i class="fas fa-sync-alt"></i> Check Approval Status
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Admin Section -->
            <div class="content-section" id="adminSection">
                <div class="admin-section">
                    <!-- Admin Login -->
                    <div class="admin-login-box" id="adminLoginBox">
                        <i class="fas fa-lock fa-3x" style="color: #1a2980; margin-bottom: 15px;"></i>
                        <h2 style="color: #1a2980; margin-bottom: 10px; font-size: 1.4rem;">Admin Access</h2>
                        <p style="color: #666; margin-bottom: 25px; font-size: 0.9rem;">Enter admin password to access control panel</p>
                        
                        <div class="form-group">
                            <input type="password" class="form-input" id="adminPassword" placeholder="Enter admin password" autocomplete="off">
                        </div>
                        
                        <div id="adminLoginStatus"></div>
                        
                        <button class="btn btn-primary btn-block" onclick="adminLogin()">
                            <i class="fas fa-sign-in-alt"></i> Login to Admin Panel
                        </button>
                        
                        <button class="btn btn-outline btn-block" onclick="showSection('subscription')" style="margin-top: 15px;">
                            <i class="fas fa-arrow-left"></i> Back to Home
                        </button>
                        
                        <div style="margin-top: 20px; color: #666; font-size: 0.85rem;">
                            <i class="fas fa-info-circle"></i> Contact <span class="developer-name">Walter Zauko</span> if you forgot password
                        </div>
                    </div>
                    
                    <!-- Admin Panel -->
                    <div class="admin-panel" id="adminPanel">
                        <div class="admin-grid">
                            <!-- Sidebar -->
                            <div class="admin-sidebar">
                                <div style="text-align: center; margin-bottom: 20px;">
                                    <i class="fas fa-user-shield fa-2x" style="color: #1a2980; margin-bottom: 10px;"></i>
                                    <h3 style="color: #1a2980; font-size: 1.2rem;">Admin Panel</h3>
                                    <p style="color: #666; font-size: 0.8rem; margin-top: 5px;">Welcome, Admin</p>
                                </div>
                                <ul class="admin-menu">
                                    <li><a href="#" class="active" onclick="showAdminTab('dashboard')">
                                        <i class="fas fa-tachometer-alt"></i> Dashboard
                                    </a></li>
                                    <li><a href="#" onclick="showAdminTab('pending')">
                                        <i class="fas fa-clock"></i> Pending Approvals
                                        <span class="badge badge-warning" id="pendingCount" style="margin-left: auto;">0</span>
                                    </a></li>
                                    <li><a href="#" onclick="showAdminTab('users')">
                                        <i class="fas fa-users"></i> Manage Users
                                    </a></li>
                                    <li><a href="#" onclick="showAdminTab('payments')">
                                        <i class="fas fa-credit-card"></i> Payment Records
                                    </a></li>
                                    <li><a href="#" onclick="showAdminTab('documents')">
                                        <i class="fas fa-file-alt"></i> Manage Documents
                                    </a></li>
                                    <li><a href="#" onclick="showAdminTab('upload')">
                                        <i class="fas fa-upload"></i> Upload Documents
                                    </a></li>
                                    <li><a href="#" onclick="showAdminTab('settings')">
                                        <i class="fas fa-cog"></i> Settings
                                    </a></li>
                                    <li><a href="#" onclick="adminLogout()">
                                        <i class="fas fa-sign-out-alt"></i> Logout
                                    </a></li>
                                </ul>
                            </div>
                            
                            <!-- Content -->
                            <div class="admin-content">
                                <!-- Dashboard Tab -->
                                <div class="admin-tab active" id="adminDashboard">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                        <h3 style="color: #1a2980; font-size: 1.2rem;">Admin Dashboard</h3>
                                        <div style="display: flex; gap: 10px;">
                                            <button class="btn btn-primary btn-small" onclick="exportData()">
                                                <i class="fas fa-download"></i> Export Data
                                            </button>
                                            <button class="btn btn-secondary btn-small" onclick="refreshAdminData()">
                                                <i class="fas fa-sync-alt"></i> Refresh
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div class="admin-stats">
                                        <div class="stat-card">
                                            <div class="stat-number" id="totalUsers">0</div>
                                            <div class="stat-label">Total Users</div>
                                        </div>
                                        <div class="stat-card">
                                            <div class="stat-number" id="activeUsers">0</div>
                                            <div class="stat-label">Active Users</div>
                                        </div>
                                        <div class="stat-card">
                                            <div class="stat-number" id="pendingApprovals">0</div>
                                            <div class="stat-label">Pending Approvals</div>
                                        </div>
                                        <div class="stat-card">
                                            <div class="stat-number" id="totalEarnings">0</div>
                                            <div class="stat-label">Total Earnings (Ksh)</div>
                                        </div>
                                    </div>
                                    
                                    <div class="quick-actions">
                                        <div class="action-card" onclick="showAdminTab('pending')">
                                            <i class="fas fa-check-circle"></i>
                                            <h4>Approve Users</h4>
                                        </div>
                                        <div class="action-card" onclick="showAdminTab('upload')">
                                            <i class="fas fa-file-upload"></i>
                                            <h4>Upload Documents</h4>
                                        </div>
                                        <div class="action-card" onclick="showAdminTab('users')">
                                            <i class="fas fa-user-edit"></i>
                                            <h4>Manage Users</h4>
                                        </div>
                                        <div class="action-card" onclick="showAdminTab('settings')">
                                            <i class="fas fa-cogs"></i>
                                            <h4>Settings</h4>
                                        </div>
                                    </div>
                                    
                                    <div style="margin-top: 25px;">
                                        <h4 style="color: #1a2980; margin-bottom: 12px; font-size: 1rem;">Recent Activities</h4>
                                        <div id="recentActivities">
                                            <!-- Recent activities will be loaded here -->
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Pending Approvals Tab -->
                                <div class="admin-tab" id="adminPending">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                        <h3 style="color: #1a2980; font-size: 1.2rem;">Pending Approvals</h3>
                                        <button class="btn btn-success btn-small" onclick="approveAllPending()">
                                            <i class="fas fa-check-double"></i> Approve All
                                        </button>
                                    </div>
                                    
                                    <div class="search-box">
                                        <input type="text" class="search-input" id="pendingSearch" placeholder="Search by phone or university..." onkeyup="searchPending()">
                                        <button class="btn btn-primary" onclick="searchPending()">
                                            <i class="fas fa-search"></i> Search
                                        </button>
                                    </div>
                                    
                                    <div class="pending-approvals">
                                        <div id="pendingApprovalsList">
                                            <!-- Pending approvals will be loaded here -->
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Users Tab -->
                                <div class="admin-tab" id="adminUsers">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                        <h3 style="color: #1a2980; font-size: 1.2rem;">Manage Users</h3>
                                        <div style="display: flex; gap: 8px;">
                                            <button class="btn btn-primary btn-small" onclick="exportUsers()">
                                                <i class="fas fa-download"></i> Export
                                            </button>
                                            <button class="btn btn-secondary btn-small" onclick="refreshUsers()">
                                                <i class="fas fa-sync-alt"></i>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div class="search-box">
                                        <input type="text" class="search-input" id="userSearch" placeholder="Search users by phone, university..." onkeyup="searchUsers()">
                                        <select class="form-input" id="userFilter" style="width: 150px;" onchange="searchUsers()">
                                            <option value="all">All Users</option>
                                            <option value="active">Active Only</option>
                                            <option value="pending">Pending Only</option>
                                            <option value="expired">Expired Only</option>
                                        </select>
                                    </div>
                                    
                                    <table class="admin-table">
                                        <thead>
                                            <tr>
                                                <th>Phone</th>
                                                <th>University</th>
                                                <th>Status</th>
                                                <th>Expires</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="usersTable">
                                            <!-- Users will be loaded here -->
                                        </tbody>
                                    </table>
                                </div>
                                
                                <!-- Payments Tab -->
                                <div class="admin-tab" id="adminPayments">
                                    <h3 style="color: #1a2980; margin-bottom: 15px; font-size: 1.2rem;">Payment Records</h3>
                                    
                                    <div class="search-box">
                                        <input type="text" class="search-input" id="paymentSearch" placeholder="Search by phone, transaction code..." onkeyup="searchPayments()">
                                        <input type="date" class="form-input" id="paymentDate" style="width: 150px;" onchange="searchPayments()">
                                    </div>
                                    
                                    <table class="admin-table">
                                        <thead>
                                            <tr>
                                                <th>Date</th>
                                                <th>Phone</th>
                                                <th>University</th>
                                                <th>M-Pesa Code</th>
                                                <th>Amount</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="paymentsTable">
                                            <!-- Payments will be loaded here -->
                                        </tbody>
                                    </table>
                                </div>
                                
                                <!-- Documents Tab -->
                                <div class="admin-tab" id="adminDocuments">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                        <h3 style="color: #1a2980; font-size: 1.2rem;">Manage Documents</h3>
                                        <button class="btn btn-primary" onclick="showAdminTab('upload')">
                                            <i class="fas fa-plus"></i> Add New
                                        </button>
                                    </div>
                                    
                                    <div class="search-box">
                                        <input type="text" class="search-input" id="docSearch" placeholder="Search documents by title, course..." onkeyup="searchDocuments()">
                                        <select class="form-input" id="docUniversityFilter" style="width: 150px;" onchange="searchDocuments()">
                                            <option value="all">All Universities</option>
                                            <option value="All">All Universities (Shared)</option>
                                            <!-- University options will be loaded dynamically -->
                                        </select>
                                    </div>
                                    
                                    <div id="adminDocumentsList">
                                        <!-- Admin documents list will be loaded here -->
                                    </div>
                                </div>
                                
                                <!-- Upload Tab -->
                                <div class="admin-tab" id="adminUpload">
                                    <h3 style="color: #1a2980; margin-bottom: 15px; font-size: 1.2rem;">Upload Documents</h3>
                                    <div class="form-container">
                                        <div class="form-group">
                                            <label class="form-label">Document Title *</label>
                                            <input type="text" class="form-input" id="docTitle" placeholder="Enter document title" required>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label class="form-label">Select University *</label>
                                            <select class="form-input" id="docUniversity" required onchange="toggleNewUniversityInput('docUniversity', 'newDocUniversity')">
                                                <option value="All">All Universities (Shared)</option>
                                                <option value="University of Nairobi">University of Nairobi</option>
                                                <option value="Kenyatta University">Kenyatta University</option>
                                                <option value="Moi University">Moi University</option>
                                                <option value="JKUAT">JKUAT</option>
                                                <option value="Strathmore University">Strathmore University</option>
                                                <option value="Mount Kenya University">Mount Kenya University</option>
                                                <option value="Egerton University">Egerton University</option>
                                                <option value="Maseno University">Maseno University</option>
                                                <option value="Technical University of Kenya">Technical University of Kenya</option>
                                                <option value="Kabarak University">Kabarak University</option>
                                                <option value="Daystar University">Daystar University</option>
                                                <option value="United States International University">USIU Africa</option>
                                                <option value="Catholic University of Eastern Africa">CUEA</option>
                                                <option value="Add New University">Add New University</option>
                                            </select>
                                            <input type="text" class="form-input new-university-input" id="newDocUniversity" placeholder="Enter New University Name">
                                        </div>
                                        
                                        <div class="form-group">
                                            <label class="form-label">Course/Subject *</label>
                                            <input type="text" class="form-input" id="docCourse" placeholder="e.g., Calculus, Physics" required>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label class="form-label">Document URL (From Telegram) *</label>
                                            <input type="text" class="form-input" id="docUrl" placeholder="https://t.me/..." required>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label class="form-label">Description</label>
                                            <textarea class="form-input" id="docDescription" rows="3" placeholder="Enter document description"></textarea>
                                        </div>
                                        
                                        <div id="uploadStatus"></div>
                                        
                                        <button class="btn btn-success btn-block" onclick="uploadDocument()">
                                            <i class="fas fa-upload"></i> Upload Document
                                        </button>
                                        
                                        <button class="btn btn-outline btn-block" onclick="showAdminTab('documents')" style="margin-top: 10px;">
                                            <i class="fas fa-arrow-left"></i> Back to Documents
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Settings Tab -->
                                <div class="admin-tab" id="adminSettings">
                                    <h3 style="color: #1a2980; margin-bottom: 15px; font-size: 1.2rem;">Admin Settings</h3>
                                    <div class="form-container">
                                        <div class="form-group">
                                            <label class="form-label">Change Admin Password</label>
                                            <input type="password" class="form-input" id="newPassword" placeholder="Enter new password">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Confirm New Password</label>
                                            <input type="password" class="form-input" id="confirmPassword" placeholder="Confirm new password">
                                        </div>
                                        <button class="btn btn-primary" onclick="updateAdminPassword()">
                                            <i class="fas fa-save"></i> Update Password
                                        </button>
                                        
                                        <hr style="margin: 20px 0;">
                                        
                                        <div class="form-group">
                                            <label class="form-label">System Information</label>
                                            <div style="background: #f8f9ff; padding: 15px; border-radius: 8px; margin-top: 10px;">
                                                <p><strong>App Version:</strong> 2.0</p>
                                                <p><strong>Developer:</strong> <span class="developer-name">Walter Zauko</span></p>
                                                <p><strong>Support Contact:</strong> 0765 098 865</p>
                                                <p><strong>Subscription Price:</strong> Ksh 50 (5 months)</p>
                                            </div>
                                        </div>
                                        
                                        <hr style="margin: 20px 0;">
                                        
                                        <button class="btn btn-danger btn-block" onclick="clearAllData()">
                                            <i class="fas fa-trash"></i> Clear All Data (Danger Zone)
                                        </button>
                                        <p style="color: #666; font-size: 0.8rem; margin-top: 10px; text-align: center;">
                                            <i class="fas fa-exclamation-triangle"></i> This will delete all users, payments, and documents
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Profile Section -->
            <div class="content-section" id="profileSection">
                <div class="subscription-section">
                    <div class="form-container">
                        <h3 class="form-title">My Profile</h3>
                        <div id="profileContent">
                            <!-- Profile info will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="footer">
            <p><strong>RevisionVault &copy; 2025</strong></p>
            <p>Developed by <span class="developer-name">Walter Zauko</span> - Secure University Study Materials Platform</p>
            <p style="margin-top: 8px; color: #888; font-size: 0.85rem;">
                <i class="fas fa-shield-alt"></i> Documents are protected from screenshots and unauthorized sharing
            </p>
        </div>
    </div>
    
    <!-- PDF Viewer -->
    <div class="pdf-viewer" id="pdfViewer">
        <div class="pdf-viewer-header">
            <div class="pdf-viewer-title" id="pdfTitle">Loading PDF...</div>
            <div class="pdf-viewer-controls">
                <button class="btn btn-small" onclick="closePDFViewer()">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>
        </div>
        
        <div class="pdf-controls-bar">
            <div class="pdf-nav-controls">
                <button class="btn btn-small" onclick="prevPDFPage()">
                    <i class="fas fa-chevron-left"></i> Prev
                </button>
                <span class="pdf-page-info" id="pdfPageInfo">Page 1 of 1</span>
                <button class="btn btn-small" onclick="nextPDFPage()">
                    Next <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            
            <div class="pdf-zoom-controls">
                <button class="btn btn-small" onclick="zoomOutPDF()">
                    <i class="fas fa-search-minus"></i>
                </button>
                <span style="color: white; margin: 0 10px; font-size: 0.9rem;" id="pdfZoomLevel">100%</span>
                <button class="btn btn-small" onclick="zoomInPDF()">
                    <i class="fas fa-search-plus"></i>
                </button>
                <button class="btn btn-small" onclick="fitPDFToWidth()">
                    <i class="fas fa-expand-alt"></i> Fit Width
                </button>
            </div>
        </div>
        
        <div class="pdf-viewer-body">
            <div class="pdf-watermark" id="pdfWatermark">REVISIONVAULT - DO NOT COPY</div>
            <div class="pdf-canvas-container" id="pdfCanvasContainer">
                <div class="pdf-loading" id="pdfLoading">
                    <div class="loading-spinner"></div>
                    <div>Loading PDF Document...</div>
                    <div class="pdf-progress-bar">
                        <div class="pdf-progress-fill" id="pdfProgressFill"></div>
                    </div>
                </div>
                <!-- PDF pages will be rendered here -->
            </div>
        </div>
    </div>

    <script>
        // ===== APP CONFIGURATION =====
        const APP_CONFIG = {
            appName: "RevisionVault",
            version: "2.0",
            adminPassword: "walter.zauko23",
            
            // Subscription settings
            subscriptionPrice: 50,
            subscriptionDays: 150, // 5 months
            
            // M-Pesa details
            mpesaNumber: "0765 098 865",
            whatsappNumber: "254765098865",
            telegramChannel: "https://t.me/RevisionVaultDocuments",
            
            // Storage keys
            storageKeys: {
                users: "revisionvault_users",
                documents: "revisionvault_documents",
                payments: "revisionvault_payments",
                universities: "revisionvault_universities",
                currentUser: "revisionvault_current_user",
                adminSession: "revisionvault_admin_session"
            }
        };

        // ===== GLOBAL STATE =====
        let currentUser = null;
        let isAdmin = false;
        let allDocuments = [];
        let allUsers = [];
        let allPayments = [];
        let allUniversities = [];
        let currentFilter = 'all';
        let approvalCheckInterval = null;
        
        // ===== PDF VIEWER STATE =====
        let currentPDF = null;
        let pdfDocument = null;
        let currentPage = 1;
        let totalPages = 1;
        let pdfScale = 1.0;
        let pdfRenderQueue = [];
        let isRendering = false;

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', function() {
            console.log(`${APP_CONFIG.appName} v${APP_CONFIG.version} initialized`);
            
            // Initialize storage
            initializeStorage();
            
            // Check user status
            checkUserStatus();
            
            // Setup event listeners
            setupEventListeners();
            
            // Auto-check approval status every 30 seconds for pending users
            setInterval(() => {
                if (currentUser && currentUser.subscription === 'pending') {
                    checkApprovalStatus();
                }
            }, 30000);
        });

        // ===== STORAGE FUNCTIONS =====
        function initializeStorage() {
            // Initialize users storage
            if (!localStorage.getItem(APP_CONFIG.storageKeys.users)) {
                localStorage.setItem(APP_CONFIG.storageKeys.users, JSON.stringify([]));
            }
            
            // Initialize universities storage
            if (!localStorage.getItem(APP_CONFIG.storageKeys.universities)) {
                // Default universities list
                const defaultUniversities = [
                    "University of Nairobi",
                    "Kenyatta University",
                    "Moi University",
                    "JKUAT",
                    "Strathmore University",
                    "Mount Kenya University",
                    "Egerton University",
                    "Maseno University",
                    "Technical University of Kenya",
                    "Kabarak University",
                    "Daystar University",
                    "United States International University",
                    "Catholic University of Eastern Africa"
                ];
                localStorage.setItem(APP_CONFIG.storageKeys.universities, JSON.stringify(defaultUniversities));
            }
            
            // Initialize documents storage
            if (!localStorage.getItem(APP_CONFIG.storageKeys.documents)) {
                // Add some sample documents
                const sampleDocuments = [
                    {
                        id: 1,
                        title: "Introduction to Calculus",
                        university: "All",
                        course: "Mathematics",
                        type: "pdf",
                        url: "https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf",
                        description: "Basic calculus concepts and formulas for first year students",
                        date: new Date().toISOString(),
                        tags: ["mathematics", "calculus", "year1"],
                        views: 150
                    },
                    {
                        id: 2,
                        title: "Data Structures Notes",
                        university: "University of Nairobi",
                        course: "Computer Science",
                        type: "pdf",
                        url: "https://www.africau.edu/images/default/sample.pdf",
                        description: "Complete notes on data structures and algorithms",
                        date: new Date().toISOString(),
                        tags: ["computerscience", "datastructures", "year2"],
                        views: 89
                    },
                    {
                        id: 3,
                        title: "Organic Chemistry Notes",
                        university: "Kenyatta University",
                        course: "Chemistry",
                        type: "pdf",
                        url: "https://www.orimi.com/pdf-test.pdf",
                        description: "Comprehensive organic chemistry notes with diagrams",
                        date: new Date().toISOString(),
                        tags: ["chemistry", "organic", "year1"],
                        views: 120
                    }
                ];
                localStorage.setItem(APP_CONFIG.storageKeys.documents, JSON.stringify(sampleDocuments));
            }
            
            // Initialize payments storage
            if (!localStorage.getItem(APP_CONFIG.storageKeys.payments)) {
                localStorage.setItem(APP_CONFIG.storageKeys.payments, JSON.stringify([]));
            }
            
            // Load all data
            allUsers = JSON.parse(localStorage.getItem(APP_CONFIG.storageKeys.users) || '[]');
            allPayments = JSON.parse(localStorage.getItem(APP_CONFIG.storageKeys.payments) || '[]');
            allUniversities = JSON.parse(localStorage.getItem(APP_CONFIG.storageKeys.universities) || '[]');
        }

        // ===== USER STATUS CHECK =====
        function checkUserStatus() {
            // Check for admin session first
            const adminSession = localStorage.getItem(APP_CONFIG.storageKeys.adminSession);
            if (adminSession) {
                try {
                    const session = JSON.parse(adminSession);
                    if (session.expires > Date.now()) {
                        isAdmin = true;
                        showAdminPanel();
                        return;
                    } else {
                        localStorage.removeItem(APP_CONFIG.storageKeys.adminSession);
                    }
                } catch (e) {
                    console.error("Admin session error:", e);
                }
            }
            
            // Check for regular user
            const userData = localStorage.getItem(APP_CONFIG.storageKeys.currentUser);
            if (userData) {
                try {
                    const user = JSON.parse(userData);
                    const subscriptionExpiry = new Date(user.subscriptionExpiry);
                    const now = new Date();
                    
                    if (user.subscription === 'active' && subscriptionExpiry > now) {
                        // User has active subscription
                        currentUser = user;
                        updateUserUI();
                        showSection('documents');
                        loadDocuments();
                    } else if (user.subscription === 'pending') {
                        // Subscription pending approval
                        currentUser = user;
                        updateUserUI();
                        showSection('subscription');
                        showStatus("Your subscription is pending approval. Admin will verify within minutes.", "warning");
                        
                        // Start checking approval status
                        startApprovalCheck();
                    } else if (user.subscription === 'expired' || subscriptionExpiry < now) {
                        // Subscription expired
                        currentUser = user;
                        updateUserUI();
                        showSection('subscription');
                        showStatus("Your subscription has expired. Please renew to continue accessing materials.", "warning");
                    } else {
                        // Unknown status
                        showSection('subscription');
                    }
                } catch (e) {
                    console.error("User data error:", e);
                    showSection('subscription');
                }
            } else {
                // No user found, show subscription page
                showSection('subscription');
            }
        }

        function updateUserUI() {
            if (currentUser) {
                // Show user menu
                document.getElementById('userMenu').style.display = 'block';
                document.getElementById('userName').textContent = currentUser.phone || "User";
                
                // Update status indicator
                const statusIndicator = document.getElementById('userStatusIndicator');
                if (currentUser.subscription === 'active') {
                    statusIndicator.className = 'status-indicator status-active';
                    statusIndicator.innerHTML = '<i class="fas fa-check-circle"></i> Active';
                } else if (currentUser.subscription === 'pending') {
                    statusIndicator.className = 'status-indicator status-pending';
                    statusIndicator.innerHTML = '<i class="fas fa-clock"></i> Pending';
                } else if (currentUser.subscription === 'expired') {
                    statusIndicator.className = 'status-indicator status-expired';
                    statusIndicator.innerHTML = '<i class="fas fa-exclamation-circle"></i> Expired';
                }
                
                // Update university badge if available
                if (currentUser.university) {
                    document.getElementById('currentUniversity').textContent = currentUser.university;
                    document.getElementById('userUniBadge').style.display = 'inline-flex';
                }
            } else {
                // Hide user menu
                document.getElementById('userMenu').style.display = 'none';
            }
        }

        // ===== SUBSCRIPTION FUNCTIONS =====
        function verifySubscription() {
            const phone = document.getElementById('userPhone').value.trim();
            const transactionCode = document.getElementById('transactionCode').value.trim().toUpperCase();
            const universitySelect = document.getElementById('userUniversity');
            const newUniversityInput = document.getElementById('newUserUniversity');
            
            // Validation
            if (!phone || phone.length !== 10) {
                showStatus("Please enter a valid 10-digit phone number", "error", "subscriptionStatus");
                return;
            }
            
            // Validate phone number format (Kenyan numbers start with 07, 01, or 011)
            if (!/^(07|01|011)\d{7,8}$/.test(phone)) {
                showStatus("Please enter a valid Kenyan phone number (10 digits)", "error", "subscriptionStatus");
                return;
            }
            
            if (!transactionCode || transactionCode.length < 8) {
                showStatus("Please enter a valid transaction code (8-10 characters)", "error", "subscriptionStatus");
                return;
            }
            
            let university = universitySelect.value;
            
            // Handle new university
            if (university === "Add New University") {
                university = newUniversityInput.value.trim();
                if (!university) {
                    showStatus("Please enter the new university name", "error", "subscriptionStatus");
                    return;
                }
                // Save new university
                university = saveUniversity(university);
            }
            
            if (!university) {
                showStatus("Please select your university", "error", "subscriptionStatus");
                return;
            }
            
            showLoading();
            
            // Create user record
            const user = {
                id: generateUserId(),
                phone: formatPhone(phone),
                university: university,
                transactionCode: transactionCode,
                subscription: 'pending',
                subscriptionDate: new Date().toISOString(),
                subscriptionExpiry: getSubscriptionExpiryDate(),
                registeredDate: new Date().toISOString(),
                status: 'pending_approval'
            };
            
            // Create payment record
            const payment = {
                id: generateId(),
                phone: formatPhone(phone),
                transactionCode: transactionCode,
                university: university,
                amount: APP_CONFIG.subscriptionPrice,
                date: new Date().toISOString(),
                status: 'pending_verification',
                approved: false
            };
            
            // Save data
            saveUser(user);
            savePayment(payment);
            
            // Set as current user (pending approval)
            currentUser = user;
            localStorage.setItem(APP_CONFIG.storageKeys.currentUser, JSON.stringify(user));
            
            // Show success message
            setTimeout(() => {
                hideLoading();
                
                // Create WhatsApp message for admin approval
                const whatsappMessage = `
 *NEW SUBSCRIPTION REQUEST*
                    
 Phone: *${phone}*
 Transaction: *${transactionCode}*
 Amount: *Ksh ${APP_CONFIG.subscriptionPrice}*
 University: *${university}*
 Date: *${new Date().toLocaleDateString('en-GB')}*
                    
Please approve this subscription.
                `.trim();
                
                const whatsappUrl = `https://wa.me/${APP_CONFIG.whatsappNumber}?text=${encodeURIComponent(whatsappMessage)}`;
                
                showStatus("Subscription submitted successfully! Admin will verify within minutes.", "success", "subscriptionStatus");
                
                // Open WhatsApp for admin notification
                setTimeout(() => {
                    window.open(whatsappUrl, '_blank');
                }, 1000);
                
                // Update UI
                updateUserUI();
                
                // Clear form
                document.getElementById('userPhone').value = '';
                document.getElementById('transactionCode').value = '';
                document.getElementById('userUniversity').value = '';
                if (newUniversityInput) newUniversityInput.value = '';
                newUniversityInput.style.display = 'none';
                
                // Start checking approval status
                startApprovalCheck();
                
                // Refresh admin data if admin is logged in
                if (isAdmin) {
                    refreshAdminData();
                }
                
            }, 1500);
        }

        function checkApprovalStatus() {
            if (!currentUser) return;
            
            showLoading();
            
            setTimeout(() => {
                hideLoading();
                
                // Check if user has been approved in localStorage
                const users = JSON.parse(localStorage.getItem(APP_CONFIG.storageKeys.users) || '[]');
                const user = users.find(u => u.phone === currentUser.phone);
                
                if (user) {
                    if (user.subscription === 'active') {
                        // User has been approved!
                        currentUser = user;
                        localStorage.setItem(APP_CONFIG.storageKeys.currentUser, JSON.stringify(user));
                        updateUserUI();
                        
                        // Show success message and redirect to documents
                        showStatus("Your subscription has been approved! Redirecting to materials...", "success");
                        
                        setTimeout(() => {
                            showSection('documents');
                            loadDocuments();
                        }, 2000);
                        
                        // Stop checking approval
                        stopApprovalCheck();
                    } else {
                        // Still pending
                        showStatus("Your subscription is still pending approval. Please wait.", "info");
                    }
                } else {
                    // User not found
                    showStatus("User not found. Please contact admin.", "error");
                }
            }, 1000);
        }

        function startApprovalCheck() {
            // Clear any existing interval
            if (approvalCheckInterval) {
                clearInterval(approvalCheckInterval);
            }
            
            // Check every 15 seconds
            approvalCheckInterval = setInterval(() => {
                if (currentUser && currentUser.subscription === 'pending') {
                    checkApprovalStatus();
                } else {
                    stopApprovalCheck();
                }
            }, 15000);
        }

        function stopApprovalCheck() {
            if (approvalCheckInterval) {
                clearInterval(approvalCheckInterval);
                approvalCheckInterval = null;
            }
        }

        function formatPhone(phone) {
            // Convert 10-digit Kenyan number to 254 format
            let cleaned = phone.replace(/\D/g, '');
            
            if (cleaned.length === 10) {
                if (cleaned.startsWith('0')) {
                    return '254' + cleaned.substring(1);
                } else if (cleaned.startsWith('1')) {
                    return '254' + cleaned;
                }
            }
            
            return cleaned;
        }

        function getSubscriptionExpiryDate() {
            const date = new Date();
            date.setDate(date.getDate() + APP_CONFIG.subscriptionDays);
            return date.toISOString();
        }

        // ===== DOCUMENT FUNCTIONS =====
        function loadDocuments() {
            if (!currentUser) {
                showSection('subscription');
                return;
            }
            
            // Check if user has active subscription
            if (currentUser.subscription !== 'active') {
                // Show access restricted message
                document.getElementById('filterBar').style.display = 'none';
                document.getElementById('documentsContainer').innerHTML = '';
                document.getElementById('noDocuments').style.display = 'none';
                document.getElementById('subscriptionRequired').style.display = 'block';
                
                // Show appropriate message based on status
                const messageDiv = document.getElementById('accessControlMessage');
                messageDiv.innerHTML = '';
                
                if (currentUser.subscription === 'pending') {
                    messageDiv.innerHTML = `
                        <div class="status-message status-warning">
                            <i class="fas fa-clock"></i>
                            <span>Your subscription is pending approval. Please wait for admin verification.</span>
                            <button class="btn btn-small btn-outline" onclick="checkApprovalStatus()" style="margin-left: auto;">
                                Check Status
                            </button>
                        </div>
                    `;
                    messageDiv.style.display = 'block';
                } else if (currentUser.subscription === 'expired') {
                    messageDiv.innerHTML = `
                        <div class="status-message status-error">
                            <i class="fas fa-exclamation-circle"></i>
                            <span>Your subscription has expired. Please renew to access materials.</span>
                            <button class="btn btn-small btn-primary" onclick="showSection('subscription')" style="margin-left: auto;">
                                Renew Now
                            </button>
                        </div>
                    `;
                    messageDiv.style.display = 'block';
                }
                
                return;
            }
            
            // User has active subscription - show documents
            showLoading();
            
            try {
                const docs = JSON.parse(localStorage.getItem(APP_CONFIG.storageKeys.documents) || '[]');
                allDocuments = docs;
                
                // Filter documents for user's university
                const filteredDocs = docs.filter(doc => 
                    doc.university === 'All' || 
                    doc.university === currentUser.university
                );
                
                displayDocuments(filteredDocs);
                
                // Show filters
                document.getElementById('filterBar').style.display = 'flex';
                document.getElementById('subscriptionRequired').style.display = 'none';
                document.getElementById('accessControlMessage').style.display = 'none';
                
            } catch (e) {
                console.error("Error loading documents:", e);
                showStatus("Error loading documents", "error");
            } finally {
                hideLoading();
            }
        }

        function displayDocuments(documents) {
            const container = document.getElementById('documentsContainer');
            const noDocsDiv = document.getElementById('noDocuments');
            
            if (!documents || documents.length === 0) {
                container.innerHTML = '';
                noDocsDiv.style.display = 'block';
                return;
            }
            
            noDocsDiv.style.display = 'none';
            
            // Apply filter
            let filteredDocs = documents;
            if (currentFilter !== 'all') {
                filteredDocs = documents.filter(doc => {
                    if (currentFilter === 'pdf') return doc.type === 'pdf';
                    if (currentFilter === 'notes') return doc.description?.toLowerCase().includes('note') || doc.title?.toLowerCase().includes('note');
                    if (currentFilter === 'past') return doc.description?.toLowerCase().includes('past paper') || doc.title?.toLowerCase().includes('past');
                    if (currentFilter === 'books') return doc.description?.toLowerCase().includes('textbook') || doc.title?.toLowerCase().includes('book');
                    return true;
                });
            }
            
            if (filteredDocs.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <i class="fas fa-search" style="font-size: 2.5rem; margin-bottom: 15px;"></i>
                        <h3 style="margin-bottom: 10px;">No documents found</h3>
                        <p>Try selecting a different filter or check back later.</p>
                    </div>
                `;
                return;
            }
            
            let html = '<div class="documents-grid">';
            
            filteredDocs.forEach(doc => {
                const fileIcon = getFileIcon(doc.type);
                const formattedDate = formatDate(doc.date);
                
                html += `
                    <div class="document-card">
                        <div class="document-header">
                            <div class="document-title">${doc.title}</div>
                            <div class="document-meta">
                                <span><i class="fas ${fileIcon}"></i> ${doc.type.toUpperCase()}</span>
                                ${doc.university !== 'All' ? `<span><i class="fas fa-university"></i> ${doc.university}</span>` : ''}
                                <span><i class="fas fa-calendar"></i> ${formattedDate}</span>
                            </div>
                        </div>
                        <div class="document-body">
                            <div class="document-description">${doc.description || 'No description available'}</div>
                            <div class="document-tags">
                                <span class="tag">${doc.course}</span>
                                ${doc.tags ? doc.tags.map(tag => `<span class="tag">${tag}</span>`).join('') : ''}
                            </div>
                            <div class="document-actions">
                                <button class="btn btn-success btn-small" onclick="openDocument(${doc.id})">
                                    <i class="fas fa-eye"></i> View Document
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        function filterDocuments(filter) {
            currentFilter = filter;
            
            // Update active filter chip
            document.querySelectorAll('.filter-chip').forEach(chip => {
                chip.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Reload documents with filter
            loadDocuments();
        }

        // ===== PDF VIEWER FUNCTIONS =====
        function openDocument(docId) {
            const doc = allDocuments.find(d => d.id === docId);
            if (!doc) return;
            
            // Enable screenshot protection
            document.getElementById('screenshotOverlay').style.display = 'block';
            
            // Set current PDF
            currentPDF = doc;
            
            // Update viewer title
            document.getElementById('pdfTitle').textContent = doc.title;
            document.getElementById('pdfWatermark').textContent = `${currentUser?.phone || 'USER'} - REVISIONVAULT - DO NOT COPY`;
            
            // Reset PDF viewer state
            currentPage = 1;
            pdfScale = 1.0;
            pdfRenderQueue = [];
            isRendering = false;
            
            // Show loading
            document.getElementById('pdfLoading').style.display = 'flex';
            document.getElementById('pdfProgressFill').style.width = '0%';
            
            // Clear canvas container
            const container = document.getElementById('pdfCanvasContainer');
            container.innerHTML = '<div class="pdf-loading" id="pdfLoading" style="display: flex;"><div class="loading-spinner"></div><div>Loading PDF Document...</div><div class="pdf-progress-bar"><div class="pdf-progress-fill" id="pdfProgressFill"></div></div></div>';
            
            // Show PDF viewer
            document.getElementById('pdfViewer').classList.add('active');
            document.body.style.overflow = 'hidden';
            
            // Load PDF
            loadPDF(doc.url);
            
            // Increment view count
            incrementViewCount(docId);
        }

        function loadPDF(url) {
            // Configure PDF.js
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
            
            // Load the PDF
            const loadingTask = pdfjsLib.getDocument({
                url: url,
                cMapUrl: 'https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/cmaps/',
                cMapPacked: true
            });
            
            loadingTask.promise.then(
                function(pdf) {
                    pdfDocument = pdf;
                    totalPages = pdf.numPages;
                    
                    // Update page info
                    document.getElementById('pdfPageInfo').textContent = `Page ${currentPage} of ${totalPages}`;
                    
                    // Update loading progress
                    document.getElementById('pdfProgressFill').style.width = '50%';
                    
                    // Render first few pages
                    renderPDFPages();
                },
                function(error) {
                    console.error("Error loading PDF:", error);
                    document.getElementById('pdfLoading').innerHTML = `
                        <div style="text-align: center;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: #ef4444; margin-bottom: 15px;"></i>
                            <div>Error loading PDF document</div>
                            <div style="font-size: 0.9rem; color: #ccc; margin-top: 10px;">${error.message}</div>
                            <button class="btn btn-primary" onclick="closePDFViewer()" style="margin-top: 20px;">
                                <i class="fas fa-times"></i> Close Viewer
                            </button>
                        </div>
                    `;
                }
            );
            
            // Track loading progress
            loadingTask.onProgress = function(progressData) {
                const progress = (progressData.loaded / progressData.total) * 100;
                document.getElementById('pdfProgressFill').style.width = progress + '%';
            };
        }

        function renderPDFPages() {
            if (!pdfDocument || isRendering) return;
            
            isRendering = true;
            const container = document.getElementById('pdfCanvasContainer');
            
            // Hide loading when done
            document.getElementById('pdfLoading').style.display = 'none';
            
            // Clear container except watermark
            container.innerHTML = '';
            
            // Render pages (we'll render a few pages at a time for performance)
            const pagesToRender = Math.min(totalPages, 10); // Render first 10 pages initially
            
            for (let i = 1; i <= pagesToRender; i++) {
                renderPage(i);
            }
            
            // Add scroll listener to render more pages as user scrolls
            container.addEventListener('scroll', handlePDFScroll);
        }

        function renderPage(pageNum) {
            if (pageNum > totalPages || pageNum < 1) return;
            
            // Check if page is already rendered
            if (document.getElementById(`pdf-page-${pageNum}`)) return;
            
            // Add to render queue
            pdfRenderQueue.push(pageNum);
            
            // Process render queue
            processRenderQueue();
        }

        function processRenderQueue() {
            if (pdfRenderQueue.length === 0) return;
            
            const pageNum = pdfRenderQueue.shift();
            
            pdfDocument.getPage(pageNum).then(function(page) {
                const viewport = page.getViewport({ scale: pdfScale });
                
                // Create canvas for page
                const canvas = document.createElement('canvas');
                canvas.id = `pdf-page-${pageNum}`;
                canvas.className = 'pdf-page-canvas';
                canvas.width = viewport.width;
                canvas.height = viewport.height;
                
                // Add canvas to container
                const container = document.getElementById('pdfCanvasContainer');
                container.appendChild(canvas);
                
                // Render page on canvas
                const context = canvas.getContext('2d');
                const renderContext = {
                    canvasContext: context,
                    viewport: viewport
                };
                
                page.render(renderContext).promise.then(function() {
                    // Update zoom level display
                    document.getElementById('pdfZoomLevel').textContent = Math.round(pdfScale * 100) + '%';
                    
                    // Process next in queue
                    setTimeout(processRenderQueue, 100);
                });
            });
        }

        function handlePDFScroll() {
            const container = document.getElementById('pdfCanvasContainer');
            const scrollTop = container.scrollTop;
            const scrollHeight = container.scrollHeight;
            const clientHeight = container.clientHeight;
            
            // If user is near bottom, render more pages
            if (scrollTop + clientHeight >= scrollHeight - 500) {
                // Find which pages are visible and render next ones
                const renderedPages = Array.from(container.querySelectorAll('.pdf-page-canvas')).length;
                if (renderedPages < totalPages) {
                    for (let i = renderedPages + 1; i <= Math.min(renderedPages + 5, totalPages); i++) {
                        renderPage(i);
                    }
                }
            }
            
            // Update current page based on scroll position
            updateCurrentPageFromScroll();
        }

        function updateCurrentPageFromScroll() {
            const container = document.getElementById('pdfCanvasContainer');
            const canvases = Array.from(container.querySelectorAll('.pdf-page-canvas'));
            
            if (canvases.length === 0) return;
            
            const scrollTop = container.scrollTop;
            let newPage = currentPage;
            
            for (let i = 0; i < canvases.length; i++) {
                const canvas = canvases[i];
                const rect = canvas.getBoundingClientRect();
                const containerRect = container.getBoundingClientRect();
                
                if (rect.top <= containerRect.top + 100 && rect.bottom >= containerRect.top + 100) {
                    newPage = i + 1;
                    break;
                }
            }
            
            if (newPage !== currentPage) {
                currentPage = newPage;
                document.getElementById('pdfPageInfo').textContent = `Page ${currentPage} of ${totalPages}`;
            }
        }

        function prevPDFPage() {
            if (currentPage > 1) {
                currentPage--;
                scrollToPage(currentPage);
                document.getElementById('pdfPageInfo').textContent = `Page ${currentPage} of ${totalPages}`;
            }
        }

        function nextPDFPage() {
            if (currentPage < totalPages) {
                currentPage++;
                scrollToPage(currentPage);
                document.getElementById('pdfPageInfo').textContent = `Page ${currentPage} of ${totalPages}`;
            }
        }

        function scrollToPage(pageNum) {
            const container = document.getElementById('pdfCanvasContainer');
            const canvas = document.getElementById(`pdf-page-${pageNum}`);
            
            if (canvas) {
                canvas.scrollIntoView({ behavior: 'smooth', block: 'start' });
            } else {
                // If page not rendered yet, render it first
                renderPage(pageNum);
                setTimeout(() => {
                    const canvas = document.getElementById(`pdf-page-${pageNum}`);
                    if (canvas) {
                        canvas.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                }, 500);
            }
        }

        function zoomInPDF() {
            if (pdfScale < 3.0) {
                pdfScale += 0.1;
                rerenderAllPages();
            }
        }

        function zoomOutPDF() {
            if (pdfScale > 0.5) {
                pdfScale -= 0.1;
                rerenderAllPages();
            }
        }

        function fitPDFToWidth() {
            const container = document.getElementById('pdfCanvasContainer');
            const firstCanvas = container.querySelector('.pdf-page-canvas');
            
            if (firstCanvas) {
                const containerWidth = container.clientWidth - 40; // Account for padding
                pdfScale = containerWidth / firstCanvas.width;
                rerenderAllPages();
            }
        }

        function rerenderAllPages() {
            // Clear all canvases
            const container = document.getElementById('pdfCanvasContainer');
            container.innerHTML = '';
            
            // Reset render queue
            pdfRenderQueue = [];
            
            // Re-render pages
            const pagesToRender = Math.min(totalPages, 10);
            for (let i = 1; i <= pagesToRender; i++) {
                renderPage(i);
            }
            
            // Update zoom display
            document.getElementById('pdfZoomLevel').textContent = Math.round(pdfScale * 100) + '%';
        }

        function closePDFViewer() {
            document.getElementById('pdfViewer').classList.remove('active');
            document.getElementById('screenshotOverlay').style.display = 'none';
            document.body.style.overflow = 'auto';
            
            // Clean up
            currentPDF = null;
            pdfDocument = null;
            currentPage = 1;
            pdfScale = 1.0;
            pdfRenderQueue = [];
            isRendering = false;
            
            // Remove scroll listener
            const container = document.getElementById('pdfCanvasContainer');
            container.removeEventListener('scroll', handlePDFScroll);
        }

        function incrementViewCount(docId) {
            const docs = JSON.parse(localStorage.getItem(APP_CONFIG.storageKeys.documents) || '[]');
            const docIndex = docs.findIndex(d => d.id === docId);
            if (docIndex !== -1) {
                docs[docIndex].views = (docs[docIndex].views || 0) + 1;
                localStorage.setItem(APP_CONFIG.storageKeys.documents, JSON.stringify(docs));
            }
        }

        // ===== ADMIN FUNCTIONS =====
        function adminLogin() {
            const password = document.getElementById('adminPassword').value.trim();
            
            if (password === APP_CONFIG.adminPassword) {
                // Create admin session
                const session = {
                    username: 'admin',
                    expires: Date.now() + (8 * 60 * 60 * 1000) // 8 hours
                };
                localStorage.setItem(APP_CONFIG.storageKeys.adminSession, JSON.stringify(session));
                
                isAdmin = true;
                showAdminPanel();
                showStatus("Admin login successful", "success", "adminLoginStatus");
            } else {
                showStatus("Incorrect password", "error", "adminLoginStatus");
            }
        }

        function showAdminPanel() {
            document.getElementById('adminLoginBox').style.display = 'none';
            document.getElementById('adminPanel').classList.add('active');
            loadAdminData();
        }

        function loadAdminData() {
            loadAdminDashboard();
            loadPendingApprovals();
            loadAdminUsers();
            loadAdminPayments();
            loadAdminDocuments();
            updateAdminStats();
        }

        function loadPendingApprovals() {
            const users = JSON.parse(localStorage.getItem(APP_CONFIG.storageKeys.users) || '[]');
            const pendingUsers = users.filter(user => 
                user.subscription === 'pending' || user.status === 'pending_approval'
            );
            
            const container = document.getElementById('pendingApprovalsList');
            
            if (pendingUsers.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <i class="fas fa-check-circle" style="font-size: 3rem; color: #10b981; margin-bottom: 15px;"></i>
                        <h3 style="margin-bottom: 10px;">No Pending Approvals</h3>
                        <p>All users have been approved.</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            pendingUsers.forEach(user => {
                const phoneDisplay = formatPhoneForDisplay(user.phone);
                const date = formatDate(user.registeredDate);
                
                html += `
                    <div class="pending-item">
                        <div class="pending-info">
                            <h4>${phoneDisplay}</h4>
                            <p><strong>University:</strong> ${user.university}</p>
                            <p><strong>Transaction Code:</strong> ${user.transactionCode || 'N/A'}</p>
                            <p><strong>Registered:</strong> ${date}</p>
                        </div>
                        <div class="pending-actions">
                            <button class="btn btn-success btn-small" onclick="approveUser('${user.id}')">
                                <i class="fas fa-check"></i> Approve
                            </button>
                            <button class="btn btn-danger btn-small" onclick="rejectUser('${user.id}')">
                                <i class="fas fa-times"></i> Reject
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            
            // Update pending count
            document.getElementById('pendingCount').textContent = pendingUsers.length;
        }

        function approveUser(userId) {
            const users = JSON.parse(localStorage.getItem(APP_CONFIG.storageKeys.users) || '[]');
            const userIndex = users.findIndex(u => u.id === userId);
            
            if (userIndex !== -1) {
                users[userIndex].subscription = 'active';
                users[userIndex].status = 'approved';
                users[userIndex].subscriptionExpiry = getSubscriptionExpiryDate();
                users[userIndex].approvedDate = new Date().toISOString();
                localStorage.setItem(APP_CONFIG.storageKeys.users, JSON.stringify(users));
                
                // Update payments status
                const payments = JSON.parse(localStorage.getItem(APP_CONFIG.storageKeys.payments) || '[]');
                const paymentIndex = payments.findIndex(p => p.phone === users[userIndex].phone);
                if (paymentIndex !== -1) {
                    payments[paymentIndex].status = 'approved';
                    payments[paymentIndex].approved = true;
                    payments[paymentIndex].approvedDate = new Date().toISOString();
                    localStorage.setItem(APP_CONFIG.storageKeys.payments, JSON.stringify(payments));
                }
                
                showStatus("User approved successfully", "success");
                loadAdminDashboard();
                loadPendingApprovals();
                loadAdminUsers();
                loadAdminPayments();
                
                // If the approved user is the current user, update their status
                if (currentUser && currentUser.phone === users[userIndex].phone) {
                    currentUser = users[userIndex];
                    localStorage.setItem(APP_CONFIG.storageKeys.currentUser, JSON.stringify(users[userIndex]));
                    updateUserUI();
                    
                    // Show notification that user has been approved
                    if (document.querySelector('.content-section.active').id === 'subscriptionSection') {
                        showStatus("Your subscription has been approved! You can now access materials.", "success");
                        setTimeout(() => {
                            showSection('documents');
                            loadDocuments();
                        }, 2000);
                    }
                }
            }
        }

        function rejectUser(userId) {
            if (confirm("Are you sure you want to reject this user? This cannot be undone.")) {
                const users = JSON.parse(localStorage.getItem(APP_CONFIG.storageKeys.users) || '[]');
                const userIndex = users.findIndex(u => u.id === userId);
                
                if (userIndex !== -1) {
                    // Also remove the corresponding payment
                    const payments = JSON.parse(localStorage.getItem(APP_CONFIG.storageKeys.payments) || '[]');
                    const filteredPayments = payments.filter(p => p.phone !== users[userIndex].phone);
                    localStorage.setItem(APP_CONFIG.storageKeys.payments, JSON.stringify(filteredPayments));
                    
                    // Remove the user
                    users.splice(userIndex, 1);
                    localStorage.setItem(APP_CONFIG.storageKeys.users, JSON.stringify(users));
                    
                    showStatus("User rejected and removed", "success");
                    loadAdminDashboard();
                    loadPendingApprovals();
                    loadAdminUsers();
                    loadAdminPayments();
                }
            }
        }

        function approveAllPending() {
            if (confirm("Are you sure you want to approve ALL pending users?")) {
                const users = JSON.parse(localStorage.getItem(APP_CONFIG.storageKeys.users) || '[]');
                const payments = JSON.parse(localStorage.getItem(APP_CONFIG.storageKeys.payments) || '[]');
                
                users.forEach(user => {
                    if (user.subscription === 'pending' || user.status === 'pending_approval') {
                        user.subscription = 'active';
                        user.status = 'approved';
                        user.subscriptionExpiry = getSubscriptionExpiryDate();
                        user.approvedDate = new Date().toISOString();
                        
                        // Update corresponding payment
                        const paymentIndex = payments.findIndex(p => p.phone === user.phone);
                        if (paymentIndex !== -1) {
                            payments[paymentIndex].status = 'approved';
                            payments[paymentIndex].approved = true;
                            payments[paymentIndex].approvedDate = new Date().toISOString();
                        }
                    }
                });
                
                localStorage.setItem(APP_CONFIG.storageKeys.users, JSON.stringify(users));
                localStorage.setItem(APP_CONFIG.storageKeys.payments, JSON.stringify(payments));
                
                showStatus("All pending users approved", "success");
                loadAdminData();
            }
        }

        // ===== UTILITY FUNCTIONS =====
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Hide dropdown
            document.getElementById('userDropdown').classList.remove('show');
            
            // Show selected section
            document.getElementById(`${sectionId}Section`).classList.add('active');
            
            // Load data for section
            if (sectionId === 'documents') {
                loadDocuments();
            } else if (sectionId === 'profile') {
                loadProfile();
            } else if (sectionId === 'admin') {
                // Reset admin login form
                document.getElementById('adminLoginBox').style.display = 'block';
                document.getElementById('adminPanel').classList.remove('active');
                document.getElementById('adminPassword').value = '';
                document.getElementById('adminLoginStatus').innerHTML = '';
            }
        }

        function loadProfile() {
            if (!currentUser) {
                showSection('subscription');
                return;
            }
            
            const expiry = new Date(currentUser.subscriptionExpiry);
            const now = new Date();
            const daysLeft = Math.ceil((expiry - now) / (1000 * 60 * 60 * 24));
            const phoneDisplay = formatPhoneForDisplay(currentUser.phone);
            
            const html = `
                <div style="margin-bottom: 20px;">
                    <h4 style="color: #1a2980; margin-bottom: 10px;">Account Information</h4>
                    <p><strong>Phone:</strong> ${phoneDisplay}</p>
                    <p><strong>University:</strong> ${currentUser.university}</p>
                    <p><strong>Subscription Status:</strong> 
                        <span class="badge ${currentUser.subscription === 'active' ? 'badge-success' : currentUser.subscription === 'pending' ? 'badge-warning' : 'badge-danger'}">
                            ${currentUser.subscription === 'active' ? 'Active' : currentUser.subscription === 'pending' ? 'Pending Approval' : 'Expired'}
                        </span>
                    </p>
                    <p><strong>Subscription Date:</strong> ${formatDate(currentUser.subscriptionDate)}</p>
                    <p><strong>Expiry Date:</strong> ${formatDate(currentUser.subscriptionExpiry)}</p>
                    <p><strong>Days Left:</strong> ${daysLeft > 0 ? daysLeft + ' days' : 'Expired'}</p>
                    <p><strong>Transaction Code:</strong> ${currentUser.transactionCode || 'N/A'}</p>
                    ${currentUser.approvedDate ? `<p><strong>Approved Date:</strong> ${formatDate(currentUser.approvedDate)}</p>` : ''}
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn btn-primary" onclick="showSection('subscription')">
                        <i class="fas fa-redo"></i> Renew Subscription
                    </button>
                    <button class="btn btn-outline" onclick="checkApprovalStatus()">
                        <i class="fas fa-sync-alt"></i> Check Status
                    </button>
                </div>
            `;
            
            document.getElementById('profileContent').innerHTML = html;
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem(APP_CONFIG.storageKeys.currentUser);
            localStorage.removeItem(APP_CONFIG.storageKeys.adminSession);
            showSection('subscription');
            document.getElementById('userMenu').style.display = 'none';
            stopApprovalCheck();
            showStatus("Logged out successfully", "success");
        }

        function showStatus(message, type, containerId = null) {
            const status = document.createElement('div');
            status.className = `status-message status-${type}`;
            status.innerHTML = `
                <i class="fas ${getStatusIcon(type)}"></i>
                <span>${message}</span>
            `;
            
            if (containerId) {
                const container = document.getElementById(containerId);
                container.innerHTML = '';
                container.appendChild(status);
            } else {
                // Show in current section
                const activeSection = document.querySelector('.content-section.active');
                if (activeSection) {
                    activeSection.insertBefore(status, activeSection.firstChild);
                }
            }
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (status.parentNode) {
                    status.remove();
                }
            }, 5000);
        }

        function getStatusIcon(type) {
            const icons = {
                'success': 'fa-check-circle',
                'error': 'fa-exclamation-circle',
                'warning': 'fa-exclamation-triangle',
                'info': 'fa-info-circle'
            };
            return icons[type] || 'fa-info-circle';
        }

        function showLoading() {
            document.getElementById('loadingOverlay').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }

        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function generateUserId() {
            return 'user_' + Date.now().toString(36);
        }

        function saveUser(user) {
            const users = JSON.parse(localStorage.getItem(APP_CONFIG.storageKeys.users) || '[]');
            const existingIndex = users.findIndex(u => u.phone === user.phone);
            
            if (existingIndex >= 0) {
                users[existingIndex] = user;
            } else {
                users.push(user);
            }
            
            localStorage.setItem(APP_CONFIG.storageKeys.users, JSON.stringify(users));
            allUsers = users;
        }

        function savePayment(payment) {
            const payments = JSON.parse(localStorage.getItem(APP_CONFIG.storageKeys.payments) || '[]');
            payments.push(payment);
            localStorage.setItem(APP_CONFIG.storageKeys.payments, JSON.stringify(payments));
            allPayments = payments;
        }

        function saveUniversity(universityName) {
            if (!universityName || universityName.trim() === '') return;
            
            const universities = JSON.parse(localStorage.getItem(APP_CONFIG.storageKeys.universities) || '[]');
            const university = universityName.trim();
            
            // Check if university already exists
            if (!universities.includes(university)) {
                universities.push(university);
                localStorage.setItem(APP_CONFIG.storageKeys.universities, JSON.stringify(universities));
                allUniversities = universities;
            }
            
            return university;
        }

        function toggleNewUniversityInput(selectId, inputId) {
            const select = document.getElementById(selectId);
            const input = document.getElementById(inputId);
            
            if (select && input) {
                if (select.value === "Add New University") {
                    input.style.display = 'block';
                    input.required = true;
                } else {
                    input.style.display = 'none';
                    input.required = false;
                    input.value = '';
                }
            }
        }

        function formatPhoneForDisplay(phone) {
            // Convert 254 format to 0xxx xxx xxx
            if (phone.startsWith('254')) {
                return '0' + phone.substring(3);
            }
            return phone;
        }

        function getFileIcon(type) {
            const icons = {
                'pdf': 'fa-file-pdf',
                'doc': 'fa-file-word',
                'docx': 'fa-file-word',
                'ppt': 'fa-file-powerpoint',
                'txt': 'fa-file-alt',
                'zip': 'fa-file-archive',
                'rar': 'fa-file-archive'
            };
            return icons[type] || 'fa-file';
        }

        function formatDate(dateString) {
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('en-GB', {
                    day: '2-digit',
                    month: 'short',
                    year: 'numeric'
                });
            } catch (e) {
                return "Recent";
            }
        }

        function setupEventListeners() {
            // User menu toggle
            document.getElementById('userMenuBtn').addEventListener('click', function(e) {
                e.stopPropagation();
                document.getElementById('userDropdown').classList.toggle('show');
            });
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function() {
                document.getElementById('userDropdown').classList.remove('show');
            });
            
            // Phone number formatting (10 digits only)
            const phoneInput = document.getElementById('userPhone');
            if (phoneInput) {
                phoneInput.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\D/g, '');
                    if (value.length > 10) {
                        value = value.substring(0, 10);
                    }
                    e.target.value = value;
                });
            }
            
            // Transaction code formatting
            const txnInput = document.getElementById('transactionCode');
            if (txnInput) {
                txnInput.addEventListener('input', function(e) {
                    e.target.value = e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
                });
            }
            
            // Keyboard shortcuts for PDF viewer
            document.addEventListener('keydown', function(e) {
                // Escape to close PDF viewer
                if (e.key === 'Escape' && document.getElementById('pdfViewer').classList.contains('active')) {
                    closePDFViewer();
                }
                
                // Arrow keys for navigation in PDF viewer
                if (document.getElementById('pdfViewer').classList.contains('active')) {
                    if (e.key === 'ArrowLeft' || e.key === 'PageUp') {
                        prevPDFPage();
                        e.preventDefault();
                    } else if (e.key === 'ArrowRight' || e.key === 'PageDown') {
                        nextPDFPage();
                        e.preventDefault();
                    } else if (e.key === '+' || e.key === '=') {
                        zoomInPDF();
                        e.preventDefault();
                    } else if (e.key === '-') {
                        zoomOutPDF();
                        e.preventDefault();
                    }
                }
                
                // Ctrl+Shift+A to focus admin password
                if (e.ctrlKey && e.shiftKey && e.key === 'A') {
                    showSection('admin');
                    document.getElementById('adminPassword').focus();
                    e.preventDefault();
                }
            });
            
            // Admin button click
            document.getElementById('adminBtn').addEventListener('click', function(e) {
                e.preventDefault();
                showSection('admin');
            });
        }

        // Initial log
        console.log(`

      REVISIONVAULT v${APP_CONFIG.version}                    

 Developer: Walter Zauko                           
 Copyright: 2025                                   
 Subscription: Ksh 50 for 5 months                 
 Admin Password: ${APP_CONFIG.adminPassword}                
 M-Pesa: ${APP_CONFIG.mpesaNumber}                        
 Phone Format: 10 digits (07XXXXXXXX)              

        `);
    </script>
</body>
</html>