<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RevisionVault Pro - Premium University Materials</title>
    <style>
        :root {
            --primary: #1a2980;
            --secondary: #26d0ce;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --dark: #1f2937;
            --light: #f8fafc;
            --gray: #6b7280;
            --border: #e5e7eb;
            --radius: 12px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--dark);
            line-height: 1.6;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 24px;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, #26d0ce 100%);
            color: white;
            padding: 25px 30px;
            text-align: center;
        }

        .logo-container {
            width: 60px;
            height: 60px;
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
        }

        .header h1 {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 5px;
        }

        .header-subtitle {
            font-size: 14px;
            opacity: 0.9;
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        /* Tabs */
        .tabs-container {
            background: #f8fafc;
            border-bottom: 2px solid var(--border);
            overflow-x: auto;
            white-space: nowrap;
            padding: 0 10px;
        }

        .tabs {
            display: flex;
            min-width: max-content;
        }

        .tab {
            padding: 20px 30px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            color: var(--gray);
            transition: var(--transition);
            border-bottom: 3px solid transparent;
            min-width: 200px;
        }

        .tab:hover {
            background: #f1f5f9;
            color: var(--primary);
        }

        .tab.active {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            background: white;
        }

        .tab i {
            margin-right: 10px;
        }

        /* Tab Content */
        .tab-content {
            display: none;
            padding: 30px;
            min-height: 600px;
        }

        .tab-content.active {
            display: block;
        }

        /* Form Styles */
        .form-section {
            background: white;
            border-radius: var(--radius);
            padding: 30px;
            border: 2px solid var(--border);
            margin-bottom: 25px;
            box-shadow: var(--shadow);
        }

        .form-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .form-title-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 16px;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(26, 41, 128, 0.1);
        }

        /* Button Styles */
        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(26, 41, 128, 0.2);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, #34d399 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #f87171 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning) 0%, #fbbf24 100%);
            color: white;
        }

        .btn-secondary {
            background: #e5e7eb;
            color: var(--dark);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 14px;
        }

        /* Grid Layout */
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
        }

        .grid-4 {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        /* Cards */
        .card {
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            border: 2px solid var(--border);
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .card-header {
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        /* Badges */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 6px 12px;
            border-radius: 50px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-warning {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-danger {
            background: #fee2e2;
            color: #991b1b;
        }

        .badge-info {
            background: #dbeafe;
            color: #1e40af;
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
            border-radius: var(--radius);
            border: 2px solid var(--border);
            margin-top: 20px;
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1000px;
        }

        .admin-table th,
        .admin-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .admin-table th {
            background: #f8fafc;
            font-weight: 600;
            color: var(--dark);
            position: sticky;
            top: 0;
        }

        .admin-table tr:hover {
            background: #f9fafb;
        }

        /* Document Card */
        .document-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid var(--border);
            transition: var(--transition);
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .document-card:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
        }

        .doc-icon {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%);
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 15px;
        }

        /* Search Bar */
        .search-container {
            position: relative;
            margin-bottom: 30px;
        }

        .search-input {
            width: 100%;
            padding: 16px 20px 16px 50px;
            border: 2px solid var(--border);
            border-radius: 50px;
            font-size: 16px;
            transition: var(--transition);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(26, 41, 128, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }

        /* University Filter */
        .university-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            align-items: center;
            padding: 10px;
            background: #f8fafc;
            border-radius: var(--radius);
        }

        .university-badge {
            padding: 10px 20px;
            border-radius: 50px;
            background: #f3f4f6;
            color: var(--gray);
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
            white-space: nowrap;
        }

        .university-badge:hover {
            background: #e5e7eb;
        }

        .university-badge.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border-color: var(--primary);
        }

        /* Admin Tabs */
        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            background: #f8fafc;
            padding: 10px;
            border-radius: var(--radius);
        }

        .admin-tab-btn {
            padding: 12px 24px;
            border-radius: 8px;
            background: #f3f4f6;
            color: var(--gray);
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
            white-space: nowrap;
        }

        .admin-tab-btn:hover {
            background: #e5e7eb;
        }

        .admin-tab-btn.active {
            background: var(--primary);
            color: white;
        }

        .admin-tab-content {
            display: none;
        }

        .admin-tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            flex-direction: column;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 5px solid #f3f4f6;
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 20px 25px;
            border-radius: 12px;
            background: white;
            box-shadow: var(--shadow-lg);
            border-left: 5px solid var(--primary);
            z-index: 9999;
            animation: slideIn 0.3s ease;
            max-width: 400px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .notification.success {
            border-left-color: var(--success);
        }

        .notification.error {
            border-left-color: var(--danger);
        }

        .notification.warning {
            border-left-color: var(--warning);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Document Viewer */
        .document-viewer {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .viewer-content {
            background: white;
            border-radius: 16px;
            width: 90%;
            height: 90%;
            display: flex;
            flex-direction: column;
        }

        .viewer-header {
            padding: 20px;
            border-bottom: 2px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .viewer-body {
            flex: 1;
            padding: 20px;
            overflow: auto;
        }

        /* Upload Area */
        .upload-area {
            border: 3px dashed var(--border);
            border-radius: var(--radius);
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 20px;
        }

        .upload-area:hover {
            border-color: var(--primary);
            background: #f8fafc;
        }

        .upload-area.dragover {
            border-color: var(--success);
            background: #d1fae5;
        }

        /* Statistics Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            border: 2px solid var(--border);
            text-align: center;
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .stat-icon.users { background: #dbeafe; color: var(--info); }
        .stat-icon.payments { background: #fef3c7; color: var(--warning); }
        .stat-icon.documents { background: #d1fae5; color: var(--success); }
        .stat-icon.revenue { background: #fce7f3; color: #db2777; }

        .stat-value {
            font-size: 32px;
            font-weight: 800;
            margin: 10px 0;
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .action-btn {
            background: white;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .action-btn:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                min-width: 180px;
                padding: 15px 20px;
            }
        }

        @media (max-width: 768px) {
            .tabs-container {
                padding: 0;
            }
            
            .tabs {
                flex-direction: column;
                min-width: 100%;
            }
            
            .tab {
                min-width: 100%;
                padding: 15px;
                text-align: left;
            }
            
            .grid-3 {
                grid-template-columns: 1fr;
            }
            
            .university-filter {
                flex-direction: column;
                align-items: stretch;
            }
            
            .university-badge {
                text-align: center;
            }
        }

        /* Copyright */
        .copyright-footer {
            text-align: center;
            padding: 25px;
            color: var(--gray);
            font-size: 14px;
            border-top: 1px solid var(--border);
            background: #f8f9fa;
            margin-top: 40px;
        }

        .copyright-footer strong {
            color: var(--primary);
        }

        /* Progress Bar */
        .progress-bar {
            height: 6px;
            background: #e5e7eb;
            border-radius: 3px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress {
            height: 100%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            transition: width 0.3s ease;
        }

        /* Tooltip */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: var(--dark);
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 14px;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <h3 style="color: var(--primary); margin-bottom: 10px;">Loading RevisionVault Pro</h3>
        <p style="color: var(--gray);">Please wait while we initialize the system...</p>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer"></div>

    <!-- Document Viewer -->
    <div class="document-viewer" id="documentViewer" style="display: none;">
        <div class="viewer-content">
            <div class="viewer-header">
                <h3 id="viewerTitle">Document Preview</h3>
                <button class="btn btn-danger" onclick="closeViewer()">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>
            <div class="viewer-body" id="viewerBody">
                <!-- Document content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Admin Secret Button -->
    <button onclick="showAdminSecretAccess()" class="btn btn-primary" style="position: fixed; top: 20px; right: 20px; z-index: 9998;">
        <i class="fas fa-shield-alt"></i> Admin
    </button>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <div style="display: flex; align-items: center; justify-content: center; gap: 20px; margin-bottom: 15px; flex-wrap: wrap;">
                <div class="logo-container">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <div>
                    <h1>RevisionVault Pro</h1>
                    <p>Premium University Study Materials Platform</p>
                </div>
            </div>
            <p class="header-subtitle">
                <i class="fas fa-shield-alt"></i> Ksh 67 for 5 Months â€¢ 
                <i class="fas fa-user-check"></i> Admin Approval Required â€¢ 
                <i class="fas fa-unlock"></i> Full Document Access
            </p>
        </div>

        <!-- Tabs Navigation -->
        <div class="tabs-container">
            <div class="tabs">
                <div class="tab active" onclick="switchTab('student')">
                    <i class="fas fa-user-graduate"></i>
                    <span>Student Portal</span>
                </div>
                <div class="tab" onclick="switchTab('documents')" id="documentsTab">
                    <i class="fas fa-file-alt"></i>
                    <span>Study Materials</span>
                </div>
                <div class="tab" onclick="switchTab('favorites')" id="favoritesTab">
                    <i class="fas fa-heart"></i>
                    <span>My Favorites</span>
                </div>
                <div class="tab" onclick="switchTab('admin')" id="adminTab">
                    <i class="fas fa-user-shield"></i>
                    <span>Admin Panel</span>
                </div>
            </div>
        </div>

        <!-- ==================== STUDENT PORTAL ==================== -->
        <div id="student" class="tab-content active">
            <div class="registration-flow">
                <!-- Step 1: Registration -->
                <div id="step1" class="form-section">
                    <div class="form-title">
                        <div class="form-title-icon">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <span>Student Registration</span>
                    </div>
                    
                    <div class="grid-2">
                        <div class="form-group">
                            <label>Full Name *</label>
                            <input type="text" id="regFullName" class="form-control" placeholder="Enter your full name" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Email Address *</label>
                            <input type="email" id="regEmail" class="form-control" placeholder="Enter your email" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Phone Number *</label>
                            <input type="tel" id="regPhone" class="form-control" placeholder="07XXXXXXXX" maxlength="10" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Select University *</label>
                            <select id="regUniversity" class="form-control" required>
                                <option value="">Choose your university</option>
                                <!-- 25 Kenyan Universities -->
                                <option value="University of Nairobi">University of Nairobi</option>
                                <option value="Kenyatta University">Kenyatta University</option>
                                <option value="Egerton University">Egerton University</option>
                                <option value="JKUAT">Jomo Kenyatta University of Agriculture and Technology</option>
                                <option value="Moi University">Moi University</option>
                                <option value="Maseno University">Maseno University</option>
                                <option value="Technical University of Kenya">Technical University of Kenya</option>
                                <option value="Technical University of Mombasa">Technical University of Mombasa</option>
                                <option value="Dedan Kimathi University">Dedan Kimathi University of Technology</option>
                                <option value="Murang'a University">Murang'a University of Technology</option>
                                <option value="Karatina University">Karatina University</option>
                                <option value="Kisii University">Kisii University</option>
                                <option value="Laikipia University">Laikipia University</option>
                                <option value="Machakos University">Machakos University</option>
                                <option value="Meru University">Meru University of Science and Technology</option>
                                <option value="Pwani University">Pwani University</option>
                                <option value="Rongo University">Rongo University</option>
                                <option value="South Eastern Kenya University">South Eastern Kenya University</option>
                                <option value="Taita Taveta University">Taita Taveta University</option>
                                <option value="University of Eldoret">University of Eldoret</option>
                                <option value="Chuka University">Chuka University</option>
                                <option value="Kirinyaga University">Kirinyaga University</option>
                                <option value="Cooperative University">Cooperative University of Kenya</option>
                                <option value="Garissa University">Garissa University</option>
                                <option value="Kabarak University">Kabarak University</option>
                                <option value="Strathmore University">Strathmore University</option>
                                <option value="United States International University Africa">USIU Africa</option>
                                <option value="Daystar University">Daystar University</option>
                                <option value="Other">Other University</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Course/Program *</label>
                            <input type="text" id="regCourse" class="form-control" placeholder="e.g., Bachelor of Computer Science" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Year of Study *</label>
                            <select id="regYear" class="form-control" required>
                                <option value="">Select year</option>
                                <option value="1">Year 1</option>
                                <option value="2">Year 2</option>
                                <option value="3">Year 3</option>
                                <option value="4">Year 4</option>
                                <option value="5">Year 5</option>
                                <option value="6">Year 6</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Create Password *</label>
                            <input type="password" id="regPassword" class="form-control" placeholder="Create a secure password" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Confirm Password *</label>
                            <input type="password" id="regConfirmPassword" class="form-control" placeholder="Confirm your password" required>
                        </div>
                    </div>
                    
                    <div class="progress-bar">
                        <div class="progress" style="width: 25%;"></div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="registerStudent()" style="width: 100%; padding: 16px; margin-top: 10px;">
                        <i class="fas fa-user-plus"></i> Register Account
                    </button>
                </div>

                <!-- Step 2: Account Dashboard -->
                <div id="step2" class="form-section" style="display: none;">
                    <div class="form-title">
                        <div class="form-title-icon">
                            <i class="fas fa-user-check"></i>
                        </div>
                        <span>Your Account Dashboard</span>
                    </div>
                    
                    <div class="grid-2">
                        <div class="card">
                            <div class="card-header">
                                <span>Personal Information</span>
                                <span class="badge" id="accountStatusBadge">Pending</span>
                            </div>
                            <div class="form-group">
                                <label>Full Name</label>
                                <div class="form-control" style="background: #f8fafc;" id="accountName"></div>
                            </div>
                            <div class="form-group">
                                <label>Email</label>
                                <div class="form-control" style="background: #f8fafc;" id="accountEmail"></div>
                            </div>
                            <div class="form-group">
                                <label>Phone</label>
                                <div class="form-control" style="background: #f8fafc;" id="accountPhone"></div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <span>Academic Information</span>
                            </div>
                            <div class="form-group">
                                <label>University</label>
                                <div class="form-control" style="background: #f8fafc;" id="accountUniversity"></div>
                            </div>
                            <div class="form-group">
                                <label>Course</label>
                                <div class="form-control" style="background: #f8fafc;" id="accountCourse"></div>
                            </div>
                            <div class="form-group">
                                <label>Year of Study</label>
                                <div class="form-control" style="background: #f8fafc;" id="accountYear"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card" style="margin-top: 20px; text-align: center;">
                        <h4 style="color: var(--primary); margin-bottom: 15px;">Subscription Status</h4>
                        <div id="subscriptionStatus">
                            <div class="badge badge-danger" style="font-size: 14px; padding: 10px 20px;">
                                <i class="fas fa-lock"></i> Not Subscribed
                            </div>
                            <p style="color: var(--gray); margin-top: 10px;">
                                Subscribe to unlock access to all study materials
                            </p>
                        </div>
                    </div>
                    
                    <div class="progress-bar">
                        <div class="progress" style="width: 50%;"></div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <button class="btn btn-primary" onclick="goToPayment()" id="paymentBtn" style="padding: 16px 40px;">
                            <i class="fas fa-credit-card"></i> Subscribe Now (Ksh 67)
                        </button>
                        <button class="btn btn-secondary" onclick="logout()" style="margin-left: 15px; padding: 16px 30px;">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>

                <!-- Step 3: Payment -->
                <div id="step3" class="form-section" style="display: none;">
                    <div class="form-title">
                        <div class="form-title-icon">
                            <i class="fas fa-credit-card"></i>
                        </div>
                        <span>Subscribe & Pay</span>
                    </div>
                    
                    <div class="card" style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); border: 3px solid var(--success);">
                        <h3 style="color: var(--success); margin-bottom: 15px;">
                            <i class="fas fa-money-bill-wave"></i> Payment Instructions
                        </h3>
                        <p>Send <strong>Ksh 67</strong> to:</p>
                        <div style="font-size: 24px; font-weight: bold; color: var(--primary); margin: 15px 0;">0765 098 865</div>
                        <p>via <strong>M-Pesa</strong> then submit your transaction details below.</p>
                        <div style="background: white; padding: 15px; border-radius: 8px; margin-top: 15px;">
                            <p style="color: var(--gray); margin: 0;">
                                <i class="fas fa-info-circle"></i> Keep your transaction code ready
                            </p>
                        </div>
                    </div>
                    
                    <div class="grid-2" style="margin-top: 20px;">
                        <div class="form-group">
                            <label>M-Pesa Transaction Code *</label>
                            <input type="text" id="paymentCode" class="form-control" placeholder="Enter transaction code" required>
                            <small style="color: var(--gray);">e.g., RCG8H9W2X</small>
                        </div>
                        
                        <div class="form-group">
                            <label>Payment Date *</label>
                            <input type="date" id="paymentDate" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Payment Screenshot (Optional)</label>
                            <div class="upload-area" onclick="document.getElementById('paymentScreenshot').click()" style="padding: 20px;">
                                <i class="fas fa-cloud-upload-alt" style="font-size: 32px; color: var(--primary);"></i>
                                <p style="margin-top: 10px;">Click to upload payment screenshot</p>
                            </div>
                            <input type="file" id="paymentScreenshot" style="display: none;" accept="image/*">
                        </div>
                        
                        <div class="form-group">
                            <label>Payment Amount</label>
                            <input type="number" id="paymentAmount" class="form-control" value="67" readonly>
                        </div>
                    </div>
                    
                    <div class="progress-bar">
                        <div class="progress" style="width: 75%;"></div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 20px;">
                        <button class="btn btn-success" onclick="submitPayment()" style="flex: 1; padding: 16px;">
                            <i class="fas fa-paper-plane"></i> Submit Payment for Approval
                        </button>
                        <button class="btn btn-secondary" onclick="goToAccount()" style="padding: 16px;">
                            <i class="fas fa-arrow-left"></i> Back to Account
                        </button>
                    </div>
                </div>

                <!-- Step 4: Unlock Code -->
                <div id="step4" class="form-section" style="display: none;">
                    <div class="form-title">
                        <div class="form-title-icon">
                            <i class="fas fa-unlock-alt"></i>
                        </div>
                        <span>Unlock Your Account</span>
                    </div>
                    
                    <div id="pendingApproval" class="card" style="text-align: center; padding: 40px;">
                        <div style="width: 80px; height: 80px; margin: 0 auto 20px; border-radius: 50%; background: linear-gradient(135deg, var(--warning) 0%, #fbbf24 100%); color: white; display: flex; align-items: center; justify-content: center; font-size: 36px;">
                            <i class="fas fa-clock"></i>
                        </div>
                        <h3 style="color: var(--warning); margin-bottom: 15px;">Waiting for Admin Approval</h3>
                        <p style="color: var(--gray); margin-bottom: 20px;">
                            Your payment is being reviewed by the admin. You'll receive an unlock code via WhatsApp once approved.
                            This usually takes 1-24 hours.
                        </p>
                        <div style="background: #25D366; color: white; padding: 15px; border-radius: 8px; display: inline-flex; align-items: center; gap: 10px;">
                            <i class="fab fa-whatsapp" style="font-size: 24px;"></i>
                            <span>Admin will contact you via WhatsApp for confirmation</span>
                        </div>
                    </div>
                    
                    <div id="readyForUnlock" style="display: none;">
                        <div class="card" style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); border: 3px solid var(--success); text-align: center; padding: 30px;">
                            <div style="width: 60px; height: 60px; margin: 0 auto 15px; border-radius: 50%; background: var(--success); color: white; display: flex; align-items: center; justify-content: center; font-size: 24px;">
                                <i class="fas fa-check"></i>
                            </div>
                            <h3 style="color: var(--success); margin-bottom: 15px;">Payment Approved!</h3>
                            <p style="color: var(--gray); margin-bottom: 20px;">
                                Your payment has been verified. Enter your unlock code below to access all study materials:
                            </p>
                            
                            <div style="max-width: 400px; margin: 20px auto;">
                                <input type="text" id="unlockCodeInput" class="form-control" placeholder="Enter unlock code from admin" style="text-align: center; font-size: 18px; letter-spacing: 2px; padding: 15px;">
                            </div>
                            
                            <div style="display: flex; gap: 15px; justify-content: center; margin-top: 20px;">
                                <button class="btn btn-success" onclick="verifyUnlockCode()" style="padding: 15px 30px;">
                                    <i class="fas fa-unlock"></i> Unlock Account
                                </button>
                                <button class="btn btn-secondary" onclick="requestNewCode()" style="padding: 15px 25px;">
                                    <i class="fas fa-sync"></i> Resend Code
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="accessGranted" style="display: none; text-align: center; padding: 40px;">
                        <div style="width: 80px; height: 80px; margin: 0 auto 20px; border-radius: 50%; background: linear-gradient(135deg, var(--success) 0%, #34d399 100%); color: white; display: flex; align-items: center; justify-content: center; font-size: 36px;">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <h3 style="color: var(--success); margin-bottom: 15px;">Access Granted!</h3>
                        <p style="color: var(--gray); margin-bottom: 20px; font-size: 18px;">
                            ðŸŽ‰ Congratulations! You now have full access to all study materials for 5 months.
                        </p>
                        <div class="quick-actions" style="max-width: 600px; margin: 30px auto;">
                            <button class="action-btn" onclick="switchTab('documents')">
                                <i class="fas fa-book" style="font-size: 32px; color: var(--primary); margin-bottom: 10px;"></i>
                                <div>Access Study Materials</div>
                            </button>
                            <button class="action-btn" onclick="switchTab('favorites')">
                                <i class="fas fa-heart" style="font-size: 32px; color: var(--danger); margin-bottom: 10px;"></i>
                                <div>View Favorites</div>
                            </button>
                        </div>
                    </div>
                    
                    <div class="progress-bar">
                        <div class="progress" style="width: 100%;"></div>
                    </div>
                </div>
            </div>

            <!-- Login Section -->
            <div id="loginSection" class="form-section" style="margin-top: 30px; background: #f8fafc; border: 2px solid #e5e7eb;">
                <h3 style="color: var(--primary); margin-bottom: 20px; text-align: center;">Already have an account?</h3>
                <div style="display: flex; gap: 15px; flex-wrap: wrap; justify-content: center; align-items: center;">
                    <input type="text" id="loginPhone" placeholder="Phone Number" class="form-control" style="max-width: 200px;">
                    <input type="password" id="loginPassword" placeholder="Password" class="form-control" style="max-width: 200px;">
                    <button class="btn btn-primary" onclick="loginStudent()" style="padding: 12px 30px;">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                    <button class="btn btn-secondary" onclick="forgotPassword()" style="padding: 12px 20px;">
                        <i class="fas fa-key"></i> Forgot Password?
                    </button>
                </div>
            </div>
        </div>

        <!-- ==================== DOCUMENTS SECTION ==================== -->
        <div id="documents" class="tab-content">
            <div class="form-section">
                <div class="form-title">
                    <div class="form-title-icon">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <span>University Study Materials</span>
                </div>
                
                <!-- Access Status -->
                <div id="accessStatusBar" class="card" style="margin-bottom: 30px; text-align: center;">
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
                        <div style="text-align: left;">
                            <h4 id="accessStatusText" style="color: var(--danger); margin-bottom: 5px;">
                                <i class="fas fa-lock"></i> Access Locked
                            </h4>
                            <p style="color: var(--gray); font-size: 14px;">Subscribe to unlock all materials</p>
                        </div>
                        <button class="btn btn-primary" onclick="switchTab('student')" id="subscribeBtnDocs">
                            <i class="fas fa-crown"></i> Subscribe Now
                        </button>
                    </div>
                </div>

                <!-- Search and Filter -->
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="searchInput" class="search-input" placeholder="Search by unit code (e.g., BOTA241), title, or subject...">
                </div>

                <!-- University Filter -->
                <div class="university-filter">
                    <span style="font-weight: 600; color: var(--primary);">Filter by University:</span>
                    <div class="university-badge active" onclick="filterByUniversity('all')">All Universities</div>
                    <div class="university-badge" onclick="filterByUniversity('University of Nairobi')">UoN</div>
                    <div class="university-badge" onclick="filterByUniversity('Kenyatta University')">KU</div>
                    <div class="university-badge" onclick="filterByUniversity('JKUAT')">JKUAT</div>
                    <div class="university-badge" onclick="filterByUniversity('Moi University')">Moi</div>
                    <div class="university-badge" onclick="filterByUniversity('Egerton University')">Egerton</div>
                    <div class="university-badge" onclick="filterByUniversity('Maseno University')">Maseno</div>
                    <div class="university-badge" onclick="filterByUniversity('Technical University of Kenya')">TUK</div>
                    <div class="university-badge" onclick="filterByUniversity('Strathmore University')">Strathmore</div>
                    <button class="btn btn-secondary btn-sm" onclick="showMoreUniversities()" style="white-space: nowrap;">
                        <i class="fas fa-ellipsis-h"></i> More
                    </button>
                </div>

                <!-- Documents Grid -->
                <div class="grid-3" id="documentsGrid">
                    <!-- Documents will be loaded here -->
                    <div class="card" style="text-align: center; padding: 40px; grid-column: 1 / -1;">
                        <div class="doc-icon">
                            <i class="fas fa-lock"></i>
                        </div>
                        <h4 style="color: var(--primary); margin-bottom: 15px;">Access Locked</h4>
                        <p style="color: var(--gray); margin-bottom: 20px;">Subscribe to access premium university study materials</p>
                        <button class="btn btn-primary" onclick="switchTab('student')">
                            <i class="fas fa-crown"></i> Subscribe to Unlock
                        </button>
                    </div>
                </div>
                
                <!-- Pagination -->
                <div id="pagination" style="display: none; text-align: center; margin-top: 40px;">
                    <div style="display: flex; justify-content: center; gap: 10px; align-items: center;">
                        <button class="btn btn-secondary" onclick="changePage(-1)">
                            <i class="fas fa-chevron-left"></i> Previous
                        </button>
                        <span style="padding: 10px 20px; background: #f8fafc; border-radius: 8px;">
                            Page <span id="currentPage">1</span> of <span id="totalPages">1</span>
                        </span>
                        <button class="btn btn-secondary" onclick="changePage(1)">
                            Next <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== FAVORITES SECTION ==================== -->
        <div id="favorites" class="tab-content">
            <div class="form-section">
                <div class="form-title">
                    <div class="form-title-icon">
                        <i class="fas fa-heart"></i>
                    </div>
                    <span>My Favorite Documents</span>
                </div>
                
                <div id="favoritesGrid" class="grid-3">
                    <div class="card" style="text-align: center; padding: 40px;">
                        <div class="doc-icon">
                            <i class="fas fa-heart"></i>
                        </div>
                        <h4 style="color: var(--primary); margin-bottom: 15px;">No Favorites Yet</h4>
                        <p style="color: var(--gray);">Add documents to favorites to see them here</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== ADMIN PANEL ==================== -->
        <div id="admin" class="tab-content">
            <!-- Admin Login -->
            <div id="adminLogin" class="form-section" style="max-width: 500px; margin: 0 auto;">
                <div class="form-title">
                    <div class="form-title-icon">
                        <i class="fas fa-user-shield"></i>
                    </div>
                    <span>Admin Authentication</span>
                </div>
                
                <div style="text-align: center; margin-bottom: 30px;">
                    <div class="logo-container" style="margin: 0 auto 20px;">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <p style="color: var(--gray);">Enter admin password to access the dashboard</p>
                </div>
                
                <div class="form-group">
                    <label>Admin Password</label>
                    <input type="password" id="adminPassword" class="form-control" placeholder="Enter admin password" required>
                    <small style="color: var(--gray);">Default password: walter.zauko23</small>
                </div>
                
                <button class="btn btn-primary" onclick="adminLogin()" style="width: 100%; padding: 16px; margin-top: 10px;">
                    <i class="fas fa-sign-in-alt"></i> Login as Admin
                </button>
                
                <div style="margin-top: 20px; padding: 15px; background: #f8fafc; border-radius: 8px; text-align: center;">
                    <p style="color: var(--gray); font-size: 14px;">
                        <i class="fas fa-info-circle"></i> For security, please log out after use
                    </p>
                </div>
            </div>

            <!-- Admin Dashboard -->
            <div id="adminDashboard" style="display: none;">
                <!-- Statistics -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon users">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-value" id="totalUsers">0</div>
                        <div>Total Users</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon payments">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-value" id="pendingApprovals">0</div>
                        <div>Pending Approvals</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon documents">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="stat-value" id="totalDocuments">0</div>
                        <div>Total Documents</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon revenue">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="stat-value" id="totalRevenue">Ksh 0</div>
                        <div>Total Revenue</div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="quick-actions">
                    <div class="action-btn" onclick="switchAdminTab('approvals')">
                        <i class="fas fa-user-check" style="font-size: 32px; color: var(--warning); margin-bottom: 10px;"></i>
                        <div>Pending Approvals</div>
                        <small style="color: var(--gray);">Review payments</small>
                    </div>
                    <div class="action-btn" onclick="switchAdminTab('upload')">
                        <i class="fas fa-upload" style="font-size: 32px; color: var(--success); margin-bottom: 10px;"></i>
                        <div>Upload Documents</div>
                        <small style="color: var(--gray);">Add new materials</small>
                    </div>
                    <div class="action-btn" onclick="switchAdminTab('users')">
                        <i class="fas fa-users" style="font-size: 32px; color: var(--info); margin-bottom: 10px;"></i>
                        <div>Manage Users</div>
                        <small style="color: var(--gray);">View all users</small>
                    </div>
                    <div class="action-btn" onclick="switchAdminTab('documents')">
                        <i class="fas fa-file-alt" style="font-size: 32px; color: var(--primary); margin-bottom: 10px;"></i>
                        <div>Manage Documents</div>
                        <small style="color: var(--gray);">Edit or delete</small>
                    </div>
                </div>

                <!-- Admin Tabs -->
                <div class="admin-tabs">
                    <div class="admin-tab-btn active" onclick="switchAdminTab('dashboard')">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </div>
                    <div class="admin-tab-btn" onclick="switchAdminTab('approvals')">
                        <i class="fas fa-user-check"></i> Pending Approvals
                        <span class="badge badge-warning" id="pendingBadge" style="margin-left: 5px;">0</span>
                    </div>
                    <div class="admin-tab-btn" onclick="switchAdminTab('users')">
                        <i class="fas fa-users"></i> All Users
                    </div>
                    <div class="admin-tab-btn" onclick="switchAdminTab('upload')">
                        <i class="fas fa-upload"></i> Upload Documents
                    </div>
                    <div class="admin-tab-btn" onclick="switchAdminTab('documents')">
                        <i class="fas fa-file-alt"></i> Manage Documents
                    </div>
                    <div class="admin-tab-btn" onclick="switchAdminTab('settings')">
                        <i class="fas fa-cog"></i> Settings
                    </div>
                    <div class="admin-tab-btn" onclick="adminLogout()" style="background: var(--danger); color: white;">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </div>
                </div>

                <!-- Dashboard Tab -->
                <div id="adminDashboardTab" class="admin-tab-content active">
                    <div class="card">
                        <div class="card-header">
                            <span>Recent Activities</span>
                        </div>
                        <div id="recentActivities">
                            <p style="color: var(--gray); text-align: center; padding: 20px;">No recent activities</p>
                        </div>
                    </div>
                    
                    <div class="grid-2" style="margin-top: 20px;">
                        <div class="card">
                            <div class="card-header">
                                <span>Top Universities</span>
                            </div>
                            <div id="topUniversities">
                                <p style="color: var(--gray); text-align: center; padding: 20px;">Loading...</p>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <span>System Status</span>
                            </div>
                            <div id="systemStatus">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span>Storage Usage:</span>
                                    <span id="storageUsage">0 KB</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span>Last Backup:</span>
                                    <span id="lastBackup">Never</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>System Version:</span>
                                    <span>2.0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Pending Approvals Tab -->
                <div id="adminApprovalsTab" class="admin-tab-content">
                    <div class="search-container" style="margin-bottom: 20px;">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" id="searchPayments" class="search-input" placeholder="Search payments...">
                    </div>
                    
                    <div class="table-container">
                        <table class="admin-table" id="pendingPaymentsTable">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Student</th>
                                    <th>Phone</th>
                                    <th>University</th>
                                    <th>Transaction Code</th>
                                    <th>Amount</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Payments will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- All Users Tab -->
                <div id="adminUsersTab" class="admin-tab-content">
                    <div class="search-container" style="margin-bottom: 20px;">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" id="searchUsers" class="search-input" placeholder="Search users by name, phone, or university...">
                    </div>
                    
                    <div class="table-container">
                        <table class="admin-table" id="allUsersTable">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>University</th>
                                    <th>Course</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Users will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Upload Documents Tab -->
                <div id="adminUploadTab" class="admin-tab-content">
                    <div class="form-section">
                        <div class="form-title">
                            <div class="form-title-icon">
                                <i class="fas fa-upload"></i>
                            </div>
                            <span>Upload New Document</span>
                        </div>
                        
                        <div class="grid-2">
                            <div class="form-group">
                                <label>Document Title *</label>
                                <input type="text" id="docTitle" class="form-control" placeholder="Enter document title" required>
                            </div>
                            
                            <div class="form-group">
                                <label>Unit Code *</label>
                                <input type="text" id="docUnitCode" class="form-control" placeholder="e.g., BOTA241" required>
                            </div>
                            
                            <div class="form-group">
                                <label>University *</label>
                                <select id="docUniversity" class="form-control" required>
                                    <option value="">Select university</option>
                                    <!-- 25 Universities -->
                                    <option value="University of Nairobi">University of Nairobi</option>
                                    <option value="Kenyatta University">Kenyatta University</option>
                                    <option value="Egerton University">Egerton University</option>
                                    <option value="JKUAT">Jomo Kenyatta University of Agriculture and Technology</option>
                                    <option value="Moi University">Moi University</option>
                                    <option value="Maseno University">Maseno University</option>
                                    <option value="Technical University of Kenya">Technical University of Kenya</option>
                                    <option value="Technical University of Mombasa">Technical University of Mombasa</option>
                                    <option value="Dedan Kimathi University">Dedan Kimathi University of Technology</option>
                                    <option value="Murang'a University">Murang'a University of Technology</option>
                                    <option value="Karatina University">Karatina University</option>
                                    <option value="Kisii University">Kisii University</option>
                                    <option value="Laikipia University">Laikipia University</option>
                                    <option value="Machakos University">Machakos University</option>
                                    <option value="Meru University">Meru University of Science and Technology</option>
                                    <option value="Pwani University">Pwani University</option>
                                    <option value="Rongo University">Rongo University</option>
                                    <option value="South Eastern Kenya University">South Eastern Kenya University</option>
                                    <option value="Taita Taveta University">Taita Taveta University</option>
                                    <option value="University of Eldoret">University of Eldoret</option>
                                    <option value="Chuka University">Chuka University</option>
                                    <option value="Kirinyaga University">Kirinyaga University</option>
                                    <option value="Cooperative University">Cooperative University of Kenya</option>
                                    <option value="Garissa University">Garissa University</option>
                                    <option value="Kabarak University">Kabarak University</option>
                                    <option value="Strathmore University">Strathmore University</option>
                                    <option value="United States International University Africa">USIU Africa</option>
                                    <option value="Daystar University">Daystar University</option>
                                    <option value="All">All Universities</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>Subject/Course</label>
                                <input type="text" id="docSubject" class="form-control" placeholder="e.g., Botany, Computer Science">
                            </div>
                            
                            <div class="form-group">
                                <label>Year</label>
                                <select id="docYear" class="form-control">
                                    <option value="">Select year</option>
                                    <option value="1">Year 1</option>
                                    <option value="2">Year 2</option>
                                    <option value="3">Year 3</option>
                                    <option value="4">Year 4</option>
                                    <option value="5">Year 5</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>Document Type</label>
                                <select id="docType" class="form-control">
                                    <option value="pdf">PDF</option>
                                    <option value="doc">Word Document</option>
                                    <option value="ppt">Presentation</option>
                                    <option value="image">Image</option>
                                    <option value="video">Video</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="docDescription" class="form-control" rows="3" placeholder="Document description..."></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>Upload Document *</label>
                            <div class="upload-area" id="uploadArea" onclick="document.getElementById('docFile').click()">
                                <i class="fas fa-cloud-upload-alt" style="font-size: 48px; color: var(--primary); margin-bottom: 15px;"></i>
                                <p>Click to upload or drag and drop</p>
                                <p style="font-size: 14px; color: var(--gray); margin-top: 5px;">PDF, DOC, PPT, Images, Videos (Max 25MB)</p>
                            </div>
                            <input type="file" id="docFile" style="display: none;" accept=".pdf,.doc,.docx,.ppt,.pptx,.jpg,.jpeg,.png,.mp4,.avi">
                            <div id="fileInfo" style="margin-top: 10px;"></div>
                        </div>
                        
                        <div style="display: flex; gap: 15px; margin-top: 20px;">
                            <button class="btn btn-success" onclick="uploadDocument()" style="flex: 1; padding: 16px;">
                                <i class="fas fa-upload"></i> Upload Document
                            </button>
                            <button class="btn btn-secondary" onclick="clearUploadForm()" style="padding: 16px;">
                                <i class="fas fa-redo"></i> Clear Form
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Manage Documents Tab -->
                <div id="adminDocumentsTab" class="admin-tab-content">
                    <div class="search-container" style="margin-bottom: 20px;">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" id="searchAdminDocs" class="search-input" placeholder="Search documents by title, unit code, or university...">
                    </div>
                    
                    <div class="table-container">
                        <table class="admin-table" id="adminDocumentsTable">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Unit Code</th>
                                    <th>University</th>
                                    <th>Subject</th>
                                    <th>Upload Date</th>
                                    <th>Views</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Documents will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div id="adminSettingsTab" class="admin-tab-content">
                    <div class="form-section">
                        <div class="form-title">
                            <div class="form-title-icon">
                                <i class="fas fa-cog"></i>
                            </div>
                            <span>Admin Settings</span>
                        </div>
                        
                        <div class="grid-2">
                            <div class="form-group">
                                <label>Change Admin Password</label>
                                <input type="password" id="newAdminPassword" class="form-control" placeholder="New password">
                            </div>
                            
                            <div class="form-group">
                                <label>Confirm New Password</label>
                                <input type="password" id="confirmAdminPassword" class="form-control" placeholder="Confirm new password">
                            </div>
                            
                            <div class="form-group">
                                <label>Subscription Price (Ksh)</label>
                                <input type="number" id="subscriptionPrice" class="form-control" value="67" min="50" max="1000">
                            </div>
                            
                            <div class="form-group">
                                <label>Subscription Duration (Months)</label>
                                <input type="number" id="subscriptionDuration" class="form-control" value="5" min="1" max="12">
                            </div>
                            
                            <div class="form-group">
                                <label>M-Pesa Number</label>
                                <input type="text" id="mpesaNumber" class="form-control" value="0765 098 865" placeholder="M-Pesa number for payments">
                            </div>
                            
                            <div class="form-group">
                                <label>WhatsApp Contact</label>
                                <input type="text" id="whatsappContact" class="form-control" value="+254765098865" placeholder="WhatsApp contact for support">
                            </div>
                        </div>
                        
                        <div class="card" style="margin-top: 20px; background: #f8fafc;">
                            <div class="card-header">
                                <span>System Maintenance</span>
                            </div>
                            <div style="display: flex; gap: 15px; margin-top: 15px;">
                                <button class="btn btn-primary" onclick="backupSystem()">
                                    <i class="fas fa-download"></i> Backup Data
                                </button>
                                <button class="btn btn-secondary" onclick="restoreBackup()">
                                    <i class="fas fa-upload"></i> Restore Backup
                                </button>
                                <button class="btn btn-danger" onclick="resetSystem()">
                                    <i class="fas fa-trash"></i> Reset System
                                </button>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 15px; margin-top: 30px;">
                            <button class="btn btn-primary" onclick="saveAdminSettings()" style="flex: 1; padding: 16px;">
                                <i class="fas fa-save"></i> Save All Settings
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== COPYRIGHT FOOTER ==================== -->
        <div class="copyright-footer">
            <p>&copy; <strong>2025</strong> RevisionVault Pro. All rights reserved.</p>
            <p>Developed by <strong>Walter Zauko</strong> â€¢ Contact: 0765 098 865</p>
            <p style="font-size: 12px; margin-top: 10px; color: var(--gray);">
                <i class="fas fa-shield-alt"></i> Secure Platform | 
                <i class="fas fa-graduation-cap"></i> Premium Materials |
                <i class="fas fa-user-check"></i> Admin Verified |
                <i class="fas fa-mobile-alt"></i> Mobile Optimized
            </p>
        </div>
    </div>

    <script>
        // ==================== INITIALIZATION ====================
        const APP_VERSION = "2.1.0";
        let currentStudent = null;
        let students = JSON.parse(localStorage.getItem('revisionvault_students')) || [];
        let payments = JSON.parse(localStorage.getItem('revisionvault_payments')) || [];
        let documents = JSON.parse(localStorage.getItem('revisionvault_documents')) || [];
        let settings = JSON.parse(localStorage.getItem('revisionvault_settings')) || {
            adminPassword: 'walter.zauko23',
            subscriptionPrice: 67,
            subscriptionDuration: 5,
            mpesaNumber: '0765 098 865',
            whatsappContact: '+254765098865',
            lastBackup: null
        };
        
        let currentPage = 1;
        const docsPerPage = 12;
        let currentUniversityFilter = 'all';

        // List of 25 Kenyan Universities
        const universities = [
            "University of Nairobi",
            "Kenyatta University",
            "Egerton University",
            "Jomo Kenyatta University of Agriculture and Technology",
            "Moi University",
            "Maseno University",
            "Technical University of Kenya",
            "Technical University of Mombasa",
            "Dedan Kimathi University of Technology",
            "Murang'a University of Technology",
            "Karatina University",
            "Kisii University",
            "Laikipia University",
            "Machakos University",
            "Meru University of Science and Technology",
            "Pwani University",
            "Rongo University",
            "South Eastern Kenya University",
            "Taita Taveta University",
            "University of Eldoret",
            "Chuka University",
            "Kirinyaga University",
            "Cooperative University of Kenya",
            "Garissa University",
            "Kabarak University",
            "Strathmore University",
            "United States International University Africa",
            "Daystar University"
        ];

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            console.log(`ðŸš€ RevisionVault Pro v${APP_VERSION} - Initializing...`);
            
            // Show loading for 1.5 seconds
            setTimeout(() => {
                document.getElementById('loadingOverlay').style.display = 'none';
                checkStudentSession();
                loadDocuments();
                updateAccessStatus();
                
                // Set today's date in payment form
                const today = new Date().toISOString().split('T')[0];
                if (document.getElementById('paymentDate')) {
                    document.getElementById('paymentDate').value = today;
                    document.getElementById('paymentDate').max = today;
                }
                
                // Load sample documents if empty
                if (documents.length === 0) {
                    loadSampleDocuments();
                }
                
                showNotification('Welcome to RevisionVault Pro!', 'success');
            }, 1500);
            
            // Setup event listeners
            setupEventListeners();
        });

        function setupEventListeners() {
            // Search functionality
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', debounce(loadDocuments, 300));
            }
            
            // File upload drag and drop
            const uploadArea = document.getElementById('uploadArea');
            if (uploadArea) {
                uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadArea.classList.add('dragover');
                });
                
                uploadArea.addEventListener('dragleave', () => {
                    uploadArea.classList.remove('dragover');
                });
                
                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.classList.remove('dragover');
                    const fileInput = document.getElementById('docFile');
                    fileInput.files = e.dataTransfer.files;
                    updateFileInfo();
                });
            }
            
            // File input change
            const docFile = document.getElementById('docFile');
            if (docFile) {
                docFile.addEventListener('change', updateFileInfo);
            }
            
            // Search payments
            const searchPayments = document.getElementById('searchPayments');
            if (searchPayments) {
                searchPayments.addEventListener('input', debounce(loadPendingPayments, 300));
            }
            
            // Search users
            const searchUsers = document.getElementById('searchUsers');
            if (searchUsers) {
                searchUsers.addEventListener('input', debounce(loadAllUsers, 300));
            }
            
            // Search admin docs
            const searchAdminDocs = document.getElementById('searchAdminDocs');
            if (searchAdminDocs) {
                searchAdminDocs.addEventListener('input', debounce(loadAdminDocuments, 300));
            }
            
            // Enter key for login
            document.getElementById('loginPassword')?.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') loginStudent();
            });
            
            document.getElementById('adminPassword')?.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') adminLogin();
            });
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // ==================== STUDENT FUNCTIONS ====================
        function registerStudent() {
            const fullName = document.getElementById('regFullName').value.trim();
            const email = document.getElementById('regEmail').value.trim();
            const phone = document.getElementById('regPhone').value.trim();
            const university = document.getElementById('regUniversity').value;
            const course = document.getElementById('regCourse').value.trim();
            const year = document.getElementById('regYear').value;
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regConfirmPassword').value;

            // Validation
            if (!fullName || !email || !phone || !university || !course || !year || !password) {
                showNotification('Please fill all required fields', 'error');
                return;
            }

            if (password !== confirmPassword) {
                showNotification('Passwords do not match', 'error');
                return;
            }

            if (phone.length !== 10 || !phone.startsWith('07')) {
                showNotification('Please enter a valid 10-digit Kenyan phone number starting with 07', 'error');
                return;
            }

            // Validate email
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showNotification('Please enter a valid email address', 'error');
                return;
            }

            // Check if student already exists
            if (students.some(s => s.email === email || s.phone === phone)) {
                showNotification('Student with this email or phone already exists. Please login instead.', 'error');
                return;
            }

            // Create student object
            const student = {
                id: 'STU_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                fullName,
                email,
                phone,
                university,
                course,
                year,
                password, // Note: In production, this should be hashed
                status: 'registered',
                registrationDate: new Date().toISOString(),
                lastLogin: new Date().toISOString(),
                subscription: {
                    active: false,
                    startDate: null,
                    endDate: null,
                    plan: null
                },
                paymentStatus: 'none',
                unlockCode: null,
                documentsAccessed: [],
                favorites: [],
                isActive: true
            };

            // Add to students array
            students.push(student);
            currentStudent = student;
            saveToStorage('revisionvault_students', students);
            saveToStorage('revisionvault_current_student', student);

            // Update UI
            updateStudentDisplay(student);
            showStep(2);
            showNotification(`Registration successful! Welcome ${fullName.split(' ')[0]}!`, 'success');
            
            // Log activity
            logActivity(`${fullName} registered`, 'user');
        }

        function updateStudentDisplay(student) {
            document.getElementById('accountName').textContent = student.fullName;
            document.getElementById('accountEmail').textContent = student.email;
            document.getElementById('accountPhone').textContent = student.phone;
            document.getElementById('accountUniversity').textContent = student.university;
            document.getElementById('accountCourse').textContent = student.course;
            document.getElementById('accountYear').textContent = 'Year ' + student.year;
            
            // Update status badge
            const badge = document.getElementById('accountStatusBadge');
            if (student.subscription.active) {
                badge.textContent = 'Active';
                badge.className = 'badge badge-success';
                document.getElementById('subscriptionStatus').innerHTML = `
                    <div class="badge badge-success" style="font-size: 14px; padding: 10px 20px;">
                        <i class="fas fa-unlock"></i> Subscription Active
                    </div>
                    <p style="color: var(--gray); margin-top: 10px;">
                        Valid until ${new Date(student.subscription.endDate).toLocaleDateString()}
                    </p>
                `;
            } else if (student.paymentStatus === 'pending') {
                badge.textContent = 'Payment Pending';
                badge.className = 'badge badge-warning';
                document.getElementById('subscriptionStatus').innerHTML = `
                    <div class="badge badge-warning" style="font-size: 14px; padding: 10px 20px;">
                        <i class="fas fa-clock"></i> Payment Under Review
                    </div>
                `;
            } else {
                badge.textContent = 'Not Subscribed';
                badge.className = 'badge badge-danger';
                document.getElementById('subscriptionStatus').innerHTML = `
                    <div class="badge badge-danger" style="font-size: 14px; padding: 10px 20px;">
                        <i class="fas fa-lock"></i> Not Subscribed
                    </div>
                `;
            }
        }

        function loginStudent() {
            const phone = document.getElementById('loginPhone').value.trim();
            const password = document.getElementById('loginPassword').value.trim();

            if (!phone || !password) {
                showNotification('Please enter phone number and password', 'error');
                return;
            }

            const student = students.find(s => s.phone === phone && s.password === password && s.isActive !== false);
            
            if (!student) {
                showNotification('Invalid phone number or password', 'error');
                return;
            }

            // Update last login
            student.lastLogin = new Date().toISOString();
            currentStudent = student;
            saveToStorage('revisionvault_current_student', student);
            updateStudentInStorage(student);
            
            // Update UI
            updateStudentDisplay(student);
            updateAccessStatus();
            
            // Show appropriate step
            if (student.subscription.active) {
                showStep(2);
                showNotification(`Welcome back, ${student.fullName.split(' ')[0]}!`, 'success');
            } else if (student.paymentStatus === 'pending') {
                showStep(4);
                showNotification('Your payment is pending admin approval', 'warning');
            } else if (student.paymentStatus === 'approved') {
                showStep(4);
                document.getElementById('pendingApproval').style.display = 'none';
                document.getElementById('readyForUnlock').style.display = 'block';
                showNotification('Your payment has been approved! Enter unlock code.', 'success');
            } else {
                showStep(2);
                showNotification(`Welcome back, ${student.fullName.split(' ')[0]}!`, 'success');
            }
            
            // Log activity
            logActivity(`${student.fullName} logged in`, 'user');
        }

        function logout() {
            if (currentStudent) {
                logActivity(`${currentStudent.fullName} logged out`, 'user');
            }
            currentStudent = null;
            localStorage.removeItem('revisionvault_current_student');
            showStep(1);
            updateAccessStatus();
            showNotification('Logged out successfully', 'info');
        }

        function checkStudentSession() {
            const savedStudent = localStorage.getItem('revisionvault_current_student');
            if (savedStudent) {
                try {
                    currentStudent = JSON.parse(savedStudent);
                    updateStudentDisplay(currentStudent);
                    updateAccessStatus();
                    
                    if (currentStudent.subscription.active) {
                        showStep(2);
                    } else if (currentStudent.paymentStatus === 'pending') {
                        showStep(4);
                        document.getElementById('pendingApproval').style.display = 'block';
                        document.getElementById('readyForUnlock').style.display = 'none';
                    } else if (currentStudent.paymentStatus === 'approved') {
                        showStep(4);
                        document.getElementById('pendingApproval').style.display = 'none';
                        document.getElementById('readyForUnlock').style.display = 'block';
                    } else {
                        showStep(2);
                    }
                } catch (error) {
                    console.error('Error loading student session:', error);
                }
            }
        }

        function goToPayment() {
            if (currentStudent) {
                showStep(3);
            }
        }

        function goToAccount() {
            if (currentStudent) {
                showStep(2);
            }
        }

        function submitPayment() {
            if (!currentStudent) {
                showNotification('Please register first', 'error');
                return;
            }

            const paymentCode = document.getElementById('paymentCode').value.trim().toUpperCase();
            const paymentDate = document.getElementById('paymentDate').value;

            if (!paymentCode || !paymentDate) {
                showNotification('Please fill all payment details', 'error');
                return;
            }

            if (paymentCode.length < 8) {
                showNotification('Please enter a valid transaction code', 'error');
                return;
            }

            // Check if payment code already exists
            if (payments.some(p => p.transactionCode === paymentCode)) {
                showNotification('This transaction code has already been used', 'error');
                return;
            }

            // Create payment record
            const payment = {
                id: 'PAY_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                studentId: currentStudent.id,
                studentName: currentStudent.fullName,
                studentPhone: currentStudent.phone,
                studentUniversity: currentStudent.university,
                amount: parseInt(document.getElementById('paymentAmount').value),
                transactionCode: paymentCode,
                paymentDate,
                status: 'pending',
                submissionDate: new Date().toISOString(),
                adminApprovalDate: null,
                unlockCode: null,
                adminNotes: ''
            };

            // Update student
            currentStudent.paymentStatus = 'pending';
            updateStudentInStorage(currentStudent);
            
            // Add payment
            payments.push(payment);
            saveToStorage('revisionvault_payments', payments);

            // Move to next step
            showStep(4);
            showNotification('Payment submitted successfully! Admin will review shortly.', 'success');
            
            // Simulate WhatsApp notification
            simulateWhatsAppNotification(payment);
            
            // Log activity
            logActivity(`${currentStudent.fullName} submitted payment`, 'payment');
        }

        function simulateWhatsAppNotification(payment) {
            const message = `ðŸ“± NEW PAYMENT SUBMISSION\n\n` +
                          `Student: ${payment.studentName}\n` +
                          `Phone: ${payment.studentPhone}\n` +
                          `University: ${payment.studentUniversity}\n` +
                          `Amount: Ksh ${payment.amount}\n` +
                          `Transaction Code: ${payment.transactionCode}\n` +
                          `Date: ${new Date(payment.submissionDate).toLocaleString()}\n\n` +
                          `Please approve via admin panel.`;
            
            console.log('WhatsApp Message:', message);
            // In a real app, send via WhatsApp API
        }

        function verifyUnlockCode() {
            if (!currentStudent) return;

            const inputCode = document.getElementById('unlockCodeInput').value.trim().toUpperCase();
            
            if (!inputCode) {
                showNotification('Please enter unlock code', 'error');
                return;
            }

            // Find payment with this unlock code
            const payment = payments.find(p => 
                p.studentId === currentStudent.id && 
                p.unlockCode === inputCode && 
                p.status === 'approved'
            );

            if (payment) {
                // Update student subscription
                currentStudent.subscription = {
                    active: true,
                    startDate: new Date().toISOString(),
                    endDate: new Date(Date.now() + settings.subscriptionDuration * 30 * 24 * 60 * 60 * 1000).toISOString(),
                    plan: `${settings.subscriptionDuration}_months`
                };
                currentStudent.paymentStatus = 'approved';
                updateStudentInStorage(currentStudent);
                
                // Show success
                document.getElementById('pendingApproval').style.display = 'none';
                document.getElementById('readyForUnlock').style.display = 'none';
                document.getElementById('accessGranted').style.display = 'block';
                
                updateAccessStatus();
                showNotification('ðŸŽ‰ Account unlocked! All materials are now available.', 'success');
                
                // Log activity
                logActivity(`${currentStudent.fullName} unlocked account`, 'user');
            } else {
                showNotification('Invalid unlock code. Please check and try again.', 'error');
            }
        }

        function requestNewCode() {
            showNotification('Request sent to admin. New code will be sent via WhatsApp.', 'info');
        }

        function forgotPassword() {
            const phone = prompt('Enter your registered phone number:');
            if (phone) {
                const student = students.find(s => s.phone === phone);
                if (student) {
                    alert(`Password reset instructions sent to ${student.email}`);
                    showNotification('Password reset instructions sent to your email', 'info');
                } else {
                    showNotification('Phone number not found', 'error');
                }
            }
        }

        // ==================== DOCUMENT FUNCTIONS ====================
        function loadDocuments() {
            const grid = document.getElementById('documentsGrid');
            if (!grid) return;

            let filteredDocs = [...documents];
            
            // Check access
            if (!currentStudent || !currentStudent.subscription.active) {
                grid.innerHTML = `
                    <div class="card" style="text-align: center; padding: 40px; grid-column: 1 / -1;">
                        <div class="doc-icon">
                            <i class="fas fa-lock"></i>
                        </div>
                        <h4 style="color: var(--primary); margin-bottom: 15px;">Access Locked</h4>
                        <p style="color: var(--gray); margin-bottom: 20px;">Subscribe to access premium university study materials</p>
                        <button class="btn btn-primary" onclick="switchTab('student')">
                            <i class="fas fa-crown"></i> Subscribe to Unlock
                        </button>
                    </div>
                `;
                document.getElementById('pagination').style.display = 'none';
                return;
            }

            // Apply search filter
            const searchTerm = document.getElementById('searchInput')?.value.toLowerCase() || '';
            if (searchTerm) {
                filteredDocs = filteredDocs.filter(doc => 
                    doc.title.toLowerCase().includes(searchTerm) ||
                    doc.unitCode.toLowerCase().includes(searchTerm) ||
                    doc.subject?.toLowerCase().includes(searchTerm) ||
                    doc.description?.toLowerCase().includes(searchTerm)
                );
            }

            // Apply university filter
            if (currentUniversityFilter !== 'all') {
                filteredDocs = filteredDocs.filter(doc => 
                    doc.university === currentUniversityFilter || doc.university === 'All'
                );
            }

            // Calculate pagination
            const totalPages = Math.ceil(filteredDocs.length / docsPerPage);
            const startIndex = (currentPage - 1) * docsPerPage;
            const endIndex = startIndex + docsPerPage;
            const paginatedDocs = filteredDocs.slice(startIndex, endIndex);

            if (paginatedDocs.length === 0) {
                grid.innerHTML = `
                    <div class="card" style="text-align: center; padding: 40px; grid-column: 1 / -1;">
                        <div class="doc-icon">
                            <i class="fas fa-search"></i>
                        </div>
                        <h4 style="color: var(--primary); margin-bottom: 15px;">No Documents Found</h4>
                        <p style="color: var(--gray);">Try changing your search criteria or university filter</p>
                    </div>
                `;
                document.getElementById('pagination').style.display = 'none';
                return;
            }

            // Display documents
            grid.innerHTML = paginatedDocs.map(doc => `
                <div class="document-card">
                    <div class="doc-icon">
                        <i class="${getDocumentIcon(doc.type)}"></i>
                    </div>
                    <h4 style="color: var(--primary); margin-bottom: 10px; font-size: 16px;">${doc.title}</h4>
                    <p style="color: var(--gray); margin: 10px 0; font-size: 14px;">
                        <strong>${doc.unitCode}</strong> â€¢ ${doc.university}
                    </p>
                    <p style="font-size: 13px; color: var(--gray); margin-bottom: 15px;">
                        ${doc.subject || 'General'} ${doc.year ? 'â€¢ Year ' + doc.year : ''}
                    </p>
                    <div style="display: flex; gap: 10px; margin-top: auto;">
                        <button class="btn btn-primary btn-sm" onclick="viewDocument('${doc.id}')" style="flex: 1;">
                            <i class="fas fa-eye"></i> View
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="toggleFavorite('${doc.id}')" id="favBtn_${doc.id}">
                            <i class="fas fa-heart"></i>
                        </button>
                    </div>
                </div>
            `).join('');

            // Update favorite buttons
            if (currentStudent) {
                paginatedDocs.forEach(doc => {
                    const favBtn = document.getElementById(`favBtn_${doc.id}`);
                    if (favBtn) {
                        if (currentStudent.favorites.includes(doc.id)) {
                            favBtn.innerHTML = '<i class="fas fa-heart" style="color: var(--danger);"></i>';
                            favBtn.classList.add('active');
                        } else {
                            favBtn.innerHTML = '<i class="fas fa-heart"></i>';
                            favBtn.classList.remove('active');
                        }
                    }
                });
            }

            // Update pagination
            if (filteredDocs.length > docsPerPage) {
                document.getElementById('pagination').style.display = 'block';
                document.getElementById('currentPage').textContent = currentPage;
                document.getElementById('totalPages').textContent = totalPages;
            } else {
                document.getElementById('pagination').style.display = 'none';
            }
        }

        function getDocumentIcon(type) {
            switch(type) {
                case 'pdf': return 'fas fa-file-pdf';
                case 'doc': return 'fas fa-file-word';
                case 'ppt': return 'fas fa-file-powerpoint';
                case 'image': return 'fas fa-file-image';
                case 'video': return 'fas fa-file-video';
                default: return 'fas fa-file-alt';
            }
        }

        function viewDocument(docId) {
            const doc = documents.find(d => d.id === docId);
            if (!doc) return;

            // Update view count
            doc.views = (doc.views || 0) + 1;
            doc.lastAccessed = new Date().toISOString();
            saveToStorage('revisionvault_documents', documents);

            // Add to student's accessed documents
            if (currentStudent && !currentStudent.documentsAccessed.includes(docId)) {
                currentStudent.documentsAccessed.push(docId);
                updateStudentInStorage(currentStudent);
            }

            // Show in viewer
            document.getElementById('viewerTitle').textContent = doc.title;
            document.getElementById('viewerBody').innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <div class="doc-icon" style="margin: 0 auto 20px;">
                        <i class="${getDocumentIcon(doc.type)}"></i>
                    </div>
                    <h4 style="color: var(--primary); margin-bottom: 10px;">${doc.title}</h4>
                    <p style="color: var(--gray); margin-bottom: 5px;">
                        <strong>${doc.unitCode}</strong> â€¢ ${doc.university}
                    </p>
                    <p style="color: var(--gray); margin-bottom: 20px;">
                        ${doc.subject || 'General'} ${doc.year ? 'â€¢ Year ' + doc.year : ''}
                    </p>
                    <div style="max-width: 600px; margin: 30px auto; text-align: left; background: #f8fafc; padding: 20px; border-radius: 8px;">
                        <h5 style="color: var(--primary); margin-bottom: 10px;">Document Information:</h5>
                        <p style="color: var(--gray); margin-bottom: 10px;">${doc.description || 'No description available.'}</p>
                        <p style="color: var(--gray); font-size: 14px;">
                            <i class="fas fa-eye"></i> ${doc.views} views â€¢ 
                            <i class="fas fa-calendar"></i> Uploaded: ${new Date(doc.uploadDate).toLocaleDateString()}
                        </p>
                    </div>
                    <div style="margin: 40px 0;">
                        <button onclick="downloadDocument('${docId}')" class="btn btn-primary" style="padding: 15px 30px;">
                            <i class="fas fa-download"></i> Download Document
                        </button>
                    </div>
                    <p style="color: var(--gray); font-size: 14px;">
                        This is a document preview. Use the download button to get the complete file.
                    </p>
                </div>
            `;
            document.getElementById('documentViewer').style.display = 'flex';
            
            // Log activity
            logActivity(`Viewed document: ${doc.title}`, 'document');
        }

        function downloadDocument(docId) {
            const doc = documents.find(d => d.id === docId);
            if (!doc) return;
            
            // Create a temporary download link
            const link = document.createElement('a');
            link.href = doc.url || '#';
            link.download = `${doc.unitCode}_${doc.title.replace(/\s+/g, '_')}.${doc.type}`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Download started!', 'success');
            
            // Log activity
            logActivity(`Downloaded document: ${doc.title}`, 'document');
        }

        function closeViewer() {
            document.getElementById('documentViewer').style.display = 'none';
        }

        function filterByUniversity(university) {
            currentUniversityFilter = university;
            
            // Update active badge
            document.querySelectorAll('.university-badge').forEach(badge => {
                badge.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Reset to page 1
            currentPage = 1;
            loadDocuments();
        }

        function showMoreUniversities() {
            alert('Available Universities:\n\n' + universities.join('\n'));
        }

        function toggleFavorite(docId) {
            if (!currentStudent) return;
            
            const index = currentStudent.favorites.indexOf(docId);
            if (index === -1) {
                currentStudent.favorites.push(docId);
                showNotification('Added to favorites', 'success');
            } else {
                currentStudent.favorites.splice(index, 1);
                showNotification('Removed from favorites', 'info');
            }
            
            updateStudentInStorage(currentStudent);
            loadDocuments();
            loadFavorites();
        }

        function loadFavorites() {
            if (!currentStudent) return;
            
            const grid = document.getElementById('favoritesGrid');
            const favoriteDocs = documents.filter(doc => 
                currentStudent.favorites.includes(doc.id)
            );
            
            if (favoriteDocs.length === 0) {
                grid.innerHTML = `
                    <div class="card" style="text-align: center; padding: 40px;">
                        <div class="doc-icon">
                            <i class="fas fa-heart"></i>
                        </div>
                        <h4 style="color: var(--primary); margin-bottom: 15px;">No Favorites Yet</h4>
                        <p style="color: var(--gray);">Add documents to favorites to see them here</p>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = favoriteDocs.map(doc => `
                <div class="document-card">
                    <div class="doc-icon">
                        <i class="${getDocumentIcon(doc.type)}"></i>
                    </div>
                    <h4 style="color: var(--primary); margin-bottom: 10px; font-size: 16px;">${doc.title}</h4>
                    <p style="color: var(--gray); margin: 10px 0; font-size: 14px;">
                        <strong>${doc.unitCode}</strong> â€¢ ${doc.university}
                    </p>
                    <div style="display: flex; gap: 10px; margin-top: auto;">
                        <button class="btn btn-primary btn-sm" onclick="viewDocument('${doc.id}')" style="flex: 1;">
                            <i class="fas fa-eye"></i> View
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="toggleFavorite('${doc.id}')">
                            <i class="fas fa-heart-broken"></i> Remove
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function changePage(direction) {
            const totalFilteredDocs = getFilteredDocuments().length;
            const totalPages = Math.ceil(totalFilteredDocs / docsPerPage);
            
            currentPage += direction;
            
            if (currentPage < 1) currentPage = 1;
            if (currentPage > totalPages) currentPage = totalPages;
            
            loadDocuments();
        }

        function getFilteredDocuments() {
            let filteredDocs = [...documents];
            const searchTerm = document.getElementById('searchInput')?.value.toLowerCase() || '';
            
            if (searchTerm) {
                filteredDocs = filteredDocs.filter(doc => 
                    doc.title.toLowerCase().includes(searchTerm) ||
                    doc.unitCode.toLowerCase().includes(searchTerm) ||
                    doc.subject?.toLowerCase().includes(searchTerm)
                );
            }
            
            if (currentUniversityFilter !== 'all') {
                filteredDocs = filteredDocs.filter(doc => 
                    doc.university === currentUniversityFilter || doc.university === 'All'
                );
            }
            
            return filteredDocs;
        }

        // ==================== ADMIN FUNCTIONS ====================
        function adminLogin() {
            const password = document.getElementById('adminPassword').value.trim();
            
            if (password === settings.adminPassword) {
                document.getElementById('adminLogin').style.display = 'none';
                document.getElementById('adminDashboard').style.display = 'block';
                
                // Load admin data
                loadAdminDashboard();
                loadPendingPayments();
                loadAllUsers();
                loadAdminDocuments();
                
                showNotification('Admin login successful! Welcome to Dashboard', 'success');
                
                // Log activity
                logActivity('Admin logged in', 'admin');
            } else {
                showNotification('Invalid admin password', 'error');
            }
        }

        function adminLogout() {
            document.getElementById('adminLogin').style.display = 'block';
            document.getElementById('adminDashboard').style.display = 'none';
            document.getElementById('adminPassword').value = '';
            showNotification('Admin logged out successfully', 'info');
            
            // Log activity
            logActivity('Admin logged out', 'admin');
        }

        function loadAdminDashboard() {
            // Update statistics
            document.getElementById('totalUsers').textContent = students.length;
            document.getElementById('pendingApprovals').textContent = 
                payments.filter(p => p.status === 'pending').length;
            document.getElementById('totalDocuments').textContent = documents.length;
            
            // Calculate revenue
            const totalRevenue = payments
                .filter(p => p.status === 'approved')
                .reduce((sum, p) => sum + p.amount, 0);
            document.getElementById('totalRevenue').textContent = `Ksh ${totalRevenue}`;
            
            // Update pending badge
            document.getElementById('pendingBadge').textContent = 
                payments.filter(p => p.status === 'pending').length;
            
            // Load recent activities
            loadRecentActivities();
            
            // Load top universities
            loadTopUniversities();
            
            // Update system status
            updateSystemStatus();
            
            // Update settings form
            document.getElementById('subscriptionPrice').value = settings.subscriptionPrice;
            document.getElementById('subscriptionDuration').value = settings.subscriptionDuration;
            document.getElementById('mpesaNumber').value = settings.mpesaNumber;
            document.getElementById('whatsappContact').value = settings.whatsappContact;
        }

        function loadRecentActivities() {
            const container = document.getElementById('recentActivities');
            const recentPayments = payments
                .sort((a, b) => new Date(b.submissionDate) - new Date(a.submissionDate))
                .slice(0, 5);
            
            if (recentPayments.length === 0) {
                container.innerHTML = '<p style="color: var(--gray); text-align: center; padding: 20px;">No recent activities</p>';
                return;
            }
            
            container.innerHTML = recentPayments.map(payment => `
                <div style="padding: 15px; border-bottom: 1px solid var(--border);">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>${payment.studentName}</strong>
                            <p style="color: var(--gray); font-size: 14px; margin-top: 5px;">
                                ${payment.studentUniversity} â€¢ ${payment.transactionCode}
                            </p>
                        </div>
                        <span class="badge ${payment.status === 'approved' ? 'badge-success' : payment.status === 'pending' ? 'badge-warning' : 'badge-danger'}">
                            ${payment.status}
                        </span>
                    </div>
                </div>
            `).join('');
        }

        function loadTopUniversities() {
            const container = document.getElementById('topUniversities');
            const universityCounts = {};
            
            students.forEach(student => {
                universityCounts[student.university] = (universityCounts[student.university] || 0) + 1;
            });
            
            const topUniversities = Object.entries(universityCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
            
            if (topUniversities.length === 0) {
                container.innerHTML = '<p style="color: var(--gray); text-align: center; padding: 20px;">No data available</p>';
                return;
            }
            
            container.innerHTML = topUniversities.map(([university, count]) => `
                <div style="padding: 15px; border-bottom: 1px solid var(--border);">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-weight: 600;">${university}</span>
                        <span class="badge badge-info">${count} students</span>
                    </div>
                </div>
            `).join('');
        }

        function updateSystemStatus() {
            // Calculate storage usage
            let totalSize = 0;
            try {
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    const value = localStorage.getItem(key);
                    totalSize += key.length + value.length;
                }
            } catch (e) {
                console.error('Error calculating storage:', e);
            }
            
            const sizeInKB = Math.round(totalSize / 1024);
            document.getElementById('storageUsage').textContent = sizeInKB + ' KB';
            
            // Update last backup
            document.getElementById('lastBackup').textContent = 
                settings.lastBackup ? new Date(settings.lastBackup).toLocaleString() : 'Never';
        }

        function loadPendingPayments() {
            const table = document.getElementById('pendingPaymentsTable').querySelector('tbody');
            let pendingPayments = payments.filter(p => p.status === 'pending');
            
            // Apply search filter
            const searchTerm = document.getElementById('searchPayments')?.value.toLowerCase() || '';
            if (searchTerm) {
                pendingPayments = pendingPayments.filter(p => 
                    p.studentName.toLowerCase().includes(searchTerm) ||
                    p.studentPhone.includes(searchTerm) ||
                    p.transactionCode.toLowerCase().includes(searchTerm) ||
                    p.studentUniversity.toLowerCase().includes(searchTerm)
                );
            }
            
            if (pendingPayments.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px; color: var(--gray);">
                            <i class="fas fa-check-circle" style="font-size: 32px; color: var(--success); margin-bottom: 10px; display: block;"></i>
                            No pending payments
                        </td>
                    </tr>
                `;
                return;
            }
            
            table.innerHTML = pendingPayments.map(payment => `
                <tr>
                    <td>${new Date(payment.submissionDate).toLocaleDateString()}</td>
                    <td>
                        <strong>${payment.studentName}</strong><br>
                        <small style="color: var(--gray);">${payment.studentCourse || ''}</small>
                    </td>
                    <td>${payment.studentPhone}</td>
                    <td>${payment.studentUniversity}</td>
                    <td><code>${payment.transactionCode}</code></td>
                    <td><strong>Ksh ${payment.amount}</strong></td>
                    <td>
                        <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                            <button onclick="approvePayment('${payment.id}')" class="btn btn-success btn-sm">
                                <i class="fas fa-check"></i> Approve
                            </button>
                            <button onclick="rejectPayment('${payment.id}')" class="btn btn-danger btn-sm">
                                <i class="fas fa-times"></i> Reject
                            </button>
                            <button onclick="viewPaymentDetails('${payment.id}')" class="btn btn-info btn-sm">
                                <i class="fas fa-eye"></i> View
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function approvePayment(paymentId) {
            const payment = payments.find(p => p.id === paymentId);
            if (!payment) return;

            // Generate unlock code
            const unlockCode = 'RV-' + Math.random().toString(36).substr(2, 6).toUpperCase();
            
            // Update payment
            payment.status = 'approved';
            payment.adminApprovalDate = new Date().toISOString();
            payment.unlockCode = unlockCode;
            payment.adminNotes = 'Approved by admin';
            
            // Update student
            const student = students.find(s => s.id === payment.studentId);
            if (student) {
                student.paymentStatus = 'approved';
                student.unlockCode = unlockCode;
                updateStudentInStorage(student);
                
                // Send WhatsApp notification to student (simulated)
                sendApprovalWhatsApp(student, unlockCode);
            }
            
            // Save
            saveToStorage('revisionvault_payments', payments);
            
            // Reload
            loadPendingPayments();
            loadAllUsers();
            loadAdminDashboard();
            
            showNotification(`Payment approved! Unlock code: ${unlockCode}`, 'success');
            
            // Log activity
            logActivity(`Approved payment for ${payment.studentName}`, 'admin');
        }

        function sendApprovalWhatsApp(student, unlockCode) {
            const message = `âœ… PAYMENT APPROVED - RevisionVault Pro\n\n` +
                          `Hello ${student.fullName},\n\n` +
                          `Your payment has been approved!\n\n` +
                          `ðŸ”‘ Unlock Code: ${unlockCode}\n` +
                          `â° Duration: ${settings.subscriptionDuration} months access\n` +
                          `ðŸ“š Access: All study materials unlocked\n\n` +
                          `Login to your account and enter the unlock code to access materials.\n\n` +
                          `Thank you for choosing RevisionVault Pro!\n` +
                          `Need help? Contact: ${settings.whatsappContact}`;
            
            console.log('WhatsApp to student:', message);
            // In real app, send via WhatsApp API
        }

        function rejectPayment(paymentId) {
            const payment = payments.find(p => p.id === paymentId);
            if (!payment) return;

            const reason = prompt('Enter rejection reason:');
            if (!reason) return;

            payment.status = 'rejected';
            payment.adminNotes = `Rejected: ${reason}`;
            
            // Update student
            const student = students.find(s => s.id === payment.studentId);
            if (student) {
                student.paymentStatus = 'rejected';
                updateStudentInStorage(student);
            }
            
            saveToStorage('revisionvault_payments', payments);
            loadPendingPayments();
            loadAllUsers();
            loadAdminDashboard();
            
            showNotification('Payment rejected', 'warning');
            
            // Log activity
            logActivity(`Rejected payment for ${payment.studentName}`, 'admin');
        }

        function viewPaymentDetails(paymentId) {
            const payment = payments.find(p => p.id === paymentId);
            if (!payment) return;

            const details = `
                Payment Details:
                -----------------
                Student: ${payment.studentName}
                Phone: ${payment.studentPhone}
                University: ${payment.studentUniversity}
                Amount: Ksh ${payment.amount}
                Transaction Code: ${payment.transactionCode}
                Date: ${new Date(payment.submissionDate).toLocaleString()}
                Status: ${payment.status}
                ${payment.adminNotes ? `Notes: ${payment.adminNotes}` : ''}
            `;
            
            alert(details);
        }

        function loadAllUsers() {
            const table = document.getElementById('allUsersTable').querySelector('tbody');
            let filteredStudents = [...students];
            
            // Apply search filter
            const searchTerm = document.getElementById('searchUsers')?.value.toLowerCase() || '';
            if (searchTerm) {
                filteredStudents = filteredStudents.filter(student => 
                    student.fullName.toLowerCase().includes(searchTerm) ||
                    student.email.toLowerCase().includes(searchTerm) ||
                    student.phone.includes(searchTerm) ||
                    student.university.toLowerCase().includes(searchTerm)
                );
            }
            
            if (filteredStudents.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px; color: var(--gray);">
                            No users found
                        </td>
                    </tr>
                `;
                return;
            }
            
            table.innerHTML = filteredStudents.map(student => `
                <tr>
                    <td>
                        <strong>${student.fullName}</strong><br>
                        <small style="color: var(--gray);">ID: ${student.id.substr(0, 8)}</small>
                    </td>
                    <td>${student.email}</td>
                    <td>${student.phone}</td>
                    <td>${student.university}</td>
                    <td>${student.course}</td>
                    <td>
                        ${student.subscription.active ? 
                            '<span class="badge badge-success">Active</span>' : 
                          student.paymentStatus === 'pending' ? 
                            '<span class="badge badge-warning">Pending</span>' :
                          student.paymentStatus === 'approved' ? 
                            '<span class="badge badge-info">Approved</span>' :
                            '<span class="badge badge-danger">Inactive</span>'
                        }
                    </td>
                    <td>
                        <div style="display: flex; gap: 5px;">
                            <button onclick="viewStudentDetails('${student.id}')" class="btn btn-info btn-sm">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button onclick="editStudent('${student.id}')" class="btn btn-warning btn-sm">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteStudent('${student.id}')" class="btn btn-danger btn-sm">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function viewStudentDetails(studentId) {
            const student = students.find(s => s.id === studentId);
            if (!student) return;

            const details = `
                Student Details:
                -----------------
                Name: ${student.fullName}
                Email: ${student.email}
                Phone: ${student.phone}
                University: ${student.university}
                Course: ${student.course}
                Year: ${student.year}
                
                Registration: ${new Date(student.registrationDate).toLocaleString()}
                Last Login: ${student.lastLogin ? new Date(student.lastLogin).toLocaleString() : 'Never'}
                
                Subscription: ${student.subscription.active ? 'Active' : 'Inactive'}
                ${student.subscription.active ? 
                    `Started: ${new Date(student.subscription.startDate).toLocaleDateString()}\n` +
                    `Ends: ${new Date(student.subscription.endDate).toLocaleDateString()}` : ''}
                
                Documents Accessed: ${student.documentsAccessed.length}
                Favorites: ${student.favorites.length}
            `;
            
            alert(details);
        }

        function editStudent(studentId) {
            const student = students.find(s => s.id === studentId);
            if (!student) return;

            const newStatus = prompt(`Change status for ${student.fullName}:\n1. active\n2. suspended\n3. delete`, 
                student.isActive === false ? 'suspended' : 'active');
            
            if (newStatus === 'active') {
                student.isActive = true;
                showNotification('Student activated', 'success');
            } else if (newStatus === 'suspended') {
                student.isActive = false;
                showNotification('Student suspended', 'warning');
            } else if (newStatus === 'delete') {
                deleteStudent(studentId);
                return;
            }
            
            updateStudentInStorage(student);
            loadAllUsers();
        }

        function deleteStudent(studentId) {
            if (!confirm('Are you sure you want to delete this student? This will also delete their payment records.')) return;
            
            // Remove student
            students = students.filter(s => s.id !== studentId);
            
            // Remove student's payments
            payments = payments.filter(p => p.studentId !== studentId);
            
            // Save
            saveToStorage('revisionvault_students', students);
            saveToStorage('revisionvault_payments', payments);
            
            // If current student is deleted, log them out
            if (currentStudent && currentStudent.id === studentId) {
                logout();
            }
            
            loadAllUsers();
            loadAdminDashboard();
            showNotification('Student deleted successfully', 'success');
            
            // Log activity
            logActivity(`Deleted student: ${studentId}`, 'admin');
        }

        function updateFileInfo() {
            const fileInput = document.getElementById('docFile');
            const fileInfo = document.getElementById('fileInfo');
            
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                const fileSize = (file.size / 1024 / 1024).toFixed(2);
                fileInfo.innerHTML = `
                    <div style="background: #d1fae5; padding: 10px; border-radius: 8px; border: 2px solid var(--success);">
                        <i class="fas fa-file" style="color: var(--success); margin-right: 10px;"></i>
                        <strong>${file.name}</strong> (${fileSize} MB)
                    </div>
                `;
            } else {
                fileInfo.innerHTML = '';
            }
        }

        function uploadDocument() {
            const title = document.getElementById('docTitle').value.trim();
            const unitCode = document.getElementById('docUnitCode').value.trim().toUpperCase();
            const university = document.getElementById('docUniversity').value;
            const fileInput = document.getElementById('docFile');
            
            if (!title || !unitCode || !university || !fileInput.files[0]) {
                showNotification('Please fill all required fields and select a file', 'error');
                return;
            }

            const file = fileInput.files[0];
            const fileSizeMB = file.size / 1024 / 1024;
            
            if (fileSizeMB > 25) {
                showNotification('File size must be less than 25MB', 'error');
                return;
            }

            // Create document object
            const documentObj = {
                id: 'DOC_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                title,
                unitCode,
                university,
                subject: document.getElementById('docSubject').value.trim(),
                year: document.getElementById('docYear').value,
                type: document.getElementById('docType').value,
                description: document.getElementById('docDescription').value.trim(),
                fileName: file.name,
                fileSize: fileSizeMB.toFixed(2) + ' MB',
                uploadDate: new Date().toISOString(),
                lastAccessed: null,
                views: 0,
                // In a real app, upload file to server and get URL
                // For demo, create object URL
                url: URL.createObjectURL(file)
            };

            // Add to documents
            documents.push(documentObj);
            saveToStorage('revisionvault_documents', documents);
            
            // Clear form
            clearUploadForm();
            
            // Update UI
            loadAdminDocuments();
            loadAdminDashboard();
            showNotification('Document uploaded successfully!', 'success');
            
            // Log activity
            logActivity(`Uploaded document: ${title}`, 'admin');
        }

        function clearUploadForm() {
            document.getElementById('docTitle').value = '';
            document.getElementById('docUnitCode').value = '';
            document.getElementById('docUniversity').value = '';
            document.getElementById('docSubject').value = '';
            document.getElementById('docYear').value = '';
            document.getElementById('docDescription').value = '';
            document.getElementById('docFile').value = '';
            document.getElementById('fileInfo').innerHTML = '';
        }

        function loadAdminDocuments() {
            const table = document.getElementById('adminDocumentsTable').querySelector('tbody');
            let filteredDocs = [...documents];
            
            // Apply search filter
            const searchTerm = document.getElementById('searchAdminDocs')?.value.toLowerCase() || '';
            if (searchTerm) {
                filteredDocs = filteredDocs.filter(doc => 
                    doc.title.toLowerCase().includes(searchTerm) ||
                    doc.unitCode.toLowerCase().includes(searchTerm) ||
                    doc.university.toLowerCase().includes(searchTerm) ||
                    doc.subject?.toLowerCase().includes(searchTerm)
                );
            }
            
            if (filteredDocs.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px; color: var(--gray);">
                            No documents found
                        </td>
                    </tr>
                `;
                return;
            }
            
            table.innerHTML = filteredDocs.map(doc => `
                <tr>
                    <td>
                        <strong>${doc.title}</strong><br>
                        <small style="color: var(--gray);">${doc.description || 'No description'}</small>
                    </td>
                    <td><code>${doc.unitCode}</code></td>
                    <td>${doc.university}</td>
                    <td>${doc.subject || 'General'}</td>
                    <td>${new Date(doc.uploadDate).toLocaleDateString()}</td>
                    <td>${doc.views}</td>
                    <td>
                        <div style="display: flex; gap: 5px;">
                            <button onclick="previewDocument('${doc.id}')" class="btn btn-info btn-sm">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button onclick="editDocument('${doc.id}')" class="btn btn-warning btn-sm">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteDocument('${doc.id}')" class="btn btn-danger btn-sm">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function previewDocument(docId) {
            const doc = documents.find(d => d.id === docId);
            if (!doc) return;

            alert(`Document Preview:\n\nTitle: ${doc.title}\nUnit Code: ${doc.unitCode}\nUniversity: ${doc.university}\nSubject: ${doc.subject}\nYear: ${doc.year || 'N/A'}\nType: ${doc.type}\nViews: ${doc.views}\nUploaded: ${new Date(doc.uploadDate).toLocaleString()}`);
        }

        function editDocument(docId) {
            const doc = documents.find(d => d.id === docId);
            if (!doc) return;

            const newTitle = prompt('Edit document title:', doc.title);
            if (newTitle) {
                doc.title = newTitle;
                saveToStorage('revisionvault_documents', documents);
                loadAdminDocuments();
                showNotification('Document updated', 'success');
            }
        }

        function deleteDocument(docId) {
            if (!confirm('Are you sure you want to delete this document? This action cannot be undone.')) return;
            
            const doc = documents.find(d => d.id === docId);
            if (!doc) return;

            // Remove document
            documents = documents.filter(d => d.id !== docId);
            
            // Remove from all students' favorites
            students.forEach(student => {
                const index = student.favorites.indexOf(docId);
                if (index !== -1) {
                    student.favorites.splice(index, 1);
                }
            });
            
            // Save
            saveToStorage('revisionvault_documents', documents);
            saveToStorage('revisionvault_students', students);
            
            // Update UI
            loadAdminDocuments();
            loadAdminDashboard();
            loadDocuments();
            loadFavorites();
            
            showNotification('Document deleted successfully', 'success');
            
            // Log activity
            logActivity(`Deleted document: ${doc.title}`, 'admin');
        }

        function saveAdminSettings() {
            const newPassword = document.getElementById('newAdminPassword').value;
            const confirmPassword = document.getElementById('confirmAdminPassword').value;
            
            if (newPassword && newPassword !== confirmPassword) {
                showNotification('Passwords do not match', 'error');
                return;
            }
            
            // Update settings
            settings.subscriptionPrice = parseInt(document.getElementById('subscriptionPrice').value);
            settings.subscriptionDuration = parseInt(document.getElementById('subscriptionDuration').value);
            settings.mpesaNumber = document.getElementById('mpesaNumber').value;
            settings.whatsappContact = document.getElementById('whatsappContact').value;
            
            if (newPassword) {
                settings.adminPassword = newPassword;
            }
            
            saveToStorage('revisionvault_settings', settings);
            
            // Clear password fields
            document.getElementById('newAdminPassword').value = '';
            document.getElementById('confirmAdminPassword').value = '';
            
            showNotification('Settings saved successfully', 'success');
            
            // Log activity
            logActivity('Updated admin settings', 'admin');
        }

        function backupSystem() {
            const backup = {
                students: students,
                payments: payments,
                documents: documents,
                settings: settings,
                timestamp: new Date().toISOString(),
                version: APP_VERSION
            };
            
            const backupStr = JSON.stringify(backup, null, 2);
            const blob = new Blob([backupStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `revisionvault_backup_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            settings.lastBackup = new Date().toISOString();
            saveToStorage('revisionvault_settings', settings);
            
            showNotification('Backup downloaded successfully', 'success');
            
            // Log activity
            logActivity('System backup created', 'admin');
        }

        function restoreBackup() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(event) {
                const file = event.target.files[0];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        const backup = JSON.parse(e.target.result);
                        
                        if (!confirm(`Restore backup from ${new Date(backup.timestamp).toLocaleString()}? This will overwrite current data.`)) {
                            return;
                        }
                        
                        students = backup.students || [];
                        payments = backup.payments || [];
                        documents = backup.documents || [];
                        settings = backup.settings || settings;
                        
                        saveToStorage('revisionvault_students', students);
                        saveToStorage('revisionvault_payments', payments);
                        saveToStorage('revisionvault_documents', documents);
                        saveToStorage('revisionvault_settings', settings);
                        
                        // Reset current student if restored
                        currentStudent = null;
                        localStorage.removeItem('revisionvault_current_student');
                        
                        showNotification('Backup restored successfully! Please refresh the page.', 'success');
                        
                        // Log activity
                        logActivity('System restored from backup', 'admin');
                        
                        // Reload after 2 seconds
                        setTimeout(() => location.reload(), 2000);
                    } catch (error) {
                        showNotification('Invalid backup file', 'error');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        function resetSystem() {
            if (!confirm('âš ï¸ WARNING: This will reset ALL data (students, payments, documents). This action cannot be undone. Are you sure?')) return;
            
            if (!confirm('Are you REALLY sure? This will delete everything!')) return;
            
            localStorage.clear();
            students = [];
            payments = [];
            documents = [];
            currentStudent = null;
            settings = {
                adminPassword: 'walter.zauko23',
                subscriptionPrice: 67,
                subscriptionDuration: 5,
                mpesaNumber: '0765 098 865',
                whatsappContact: '+254765098865',
                lastBackup: null
            };
            
            saveToStorage('revisionvault_settings', settings);
            
            // Reset UI
            showNotification('System reset complete. Reloading...', 'warning');
            setTimeout(() => location.reload(), 2000);
        }

        // ==================== UTILITY FUNCTIONS ====================
        function showStep(stepNumber) {
            for (let i = 1; i <= 4; i++) {
                document.getElementById('step' + i).style.display = 'none';
            }
            document.getElementById('step' + stepNumber).style.display = 'block';
        }

        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.currentTarget.classList.add('active');
            
            // Load content if needed
            if (tabName === 'documents') {
                currentPage = 1;
                loadDocuments();
            } else if (tabName === 'favorites') {
                loadFavorites();
            }
        }

        function switchAdminTab(tabName) {
            // Hide all admin tabs
            document.querySelectorAll('.admin-tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Update tab buttons
            document.querySelectorAll('.admin-tab-btn').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            const tabElement = document.getElementById('admin' + tabName.charAt(0).toUpperCase() + tabName.slice(1) + 'Tab');
            if (tabElement) {
                tabElement.classList.add('active');
                event.currentTarget.classList.add('active');
            }
        }

        function updateAccessStatus() {
            const statusBar = document.getElementById('accessStatusBar');
            const statusText = document.getElementById('accessStatusText');
            const subscribeBtn = document.getElementById('subscribeBtnDocs');
            const documentsTab = document.querySelector('[onclick="switchTab(\'documents\')"] span');
            
            if (currentStudent && currentStudent.subscription.active) {
                statusBar.style.background = 'linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%)';
                statusBar.style.borderColor = 'var(--success)';
                statusText.innerHTML = '<i class="fas fa-unlock"></i> Access Granted';
                statusText.style.color = 'var(--success)';
                subscribeBtn.style.display = 'none';
                
                // Update documents tab text
                if (documentsTab) {
                    documentsTab.innerHTML = '<i class="fas fa-file-alt"></i> Study Materials <span class="badge badge-success" style="margin-left: 5px; font-size: 10px;">Active</span>';
                }
            } else {
                statusBar.style.background = 'linear-gradient(135deg, #fef3c7 0%, #fde68a 100%)';
                statusBar.style.borderColor = 'var(--warning)';
                statusText.innerHTML = '<i class="fas fa-lock"></i> Access Locked';
                statusText.style.color = 'var(--danger)';
                subscribeBtn.style.display = 'inline-flex';
                
                // Update documents tab text
                if (documentsTab) {
                    documentsTab.innerHTML = '<i class="fas fa-file-alt"></i> Study Materials';
                }
            }
        }

        function updateStudentInStorage(student) {
            const index = students.findIndex(s => s.id === student.id);
            if (index !== -1) {
                students[index] = student;
                saveToStorage('revisionvault_students', students);
                saveToStorage('revisionvault_current_student', student);
            }
        }

        function saveToStorage(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
                return true;
            } catch (error) {
                console.error('Error saving to localStorage:', error);
                showNotification('Storage error. Data may not be saved.', 'error');
                return false;
            }
        }

        function showNotification(message, type = 'info') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            let icon = 'fa-info-circle';
            if (type === 'success') icon = 'fa-check-circle';
            if (type === 'error') icon = 'fa-exclamation-circle';
            if (type === 'warning') icon = 'fa-exclamation-triangle';
            
            notification.innerHTML = `
                <i class="fas ${icon}" style="font-size: 20px;"></i>
                <span style="flex: 1;">${message}</span>
                <button onclick="this.parentElement.remove()" style="background: none; border: none; color: var(--gray); cursor: pointer;">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            container.appendChild(notification);
            
            // Remove after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => notification.remove(), 300);
                }
            }, 5000);
        }

        function showAdminSecretAccess() {
            const password = prompt('Enter admin password:');
            if (password === settings.adminPassword) {
                switchTab('admin');
                document.getElementById('adminPassword').value = password;
                adminLogin();
            } else if (password) {
                showNotification('Invalid admin password', 'error');
            }
        }

        function loadSampleDocuments() {
            // Add some sample documents
            const sampleDocs = [
                {
                    id: 'DOC_SAMPLE_1',
                    title: 'Introduction to Botany',
                    unitCode: 'BOTA241',
                    university: 'University of Nairobi',
                    subject: 'Botany',
                    year: '2',
                    type: 'pdf',
                    description: 'Basic concepts and principles of botany. Covers plant anatomy, physiology, and classification.',
                    fileName: 'bota241_intro.pdf',
                    fileSize: '2.5 MB',
                    uploadDate: new Date().toISOString(),
                    views: 45,
                    url: '#'
                },
                {
                    id: 'DOC_SAMPLE_2',
                    title: 'Computer Networks Fundamentals',
                    unitCode: 'CS401',
                    university: 'JKUAT',
                    subject: 'Computer Science',
                    year: '4',
                    type: 'pdf',
                    description: 'Advanced computer networking concepts including TCP/IP, routing, and network security.',
                    fileName: 'cs401_networks.pdf',
                    fileSize: '3.2 MB',
                    uploadDate: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(),
                    views: 32,
                    url: '#'
                },
                {
                    id: 'DOC_SAMPLE_3',
                    title: 'Financial Accounting Principles',
                    unitCode: 'ACC101',
                    university: 'Kenyatta University',
                    subject: 'Accounting',
                    year: '1',
                    type: 'pdf',
                    description: 'Introduction to financial accounting concepts, principles, and practices.',
                    fileName: 'acc101_principles.pdf',
                    fileSize: '1.8 MB',
                    uploadDate: new Date(Date.now() - 14 * 24 * 60 * 60 * 1000).toISOString(),
                    views: 78,
                    url: '#'
                },
                {
                    id: 'DOC_SAMPLE_4',
                    title: 'Engineering Mathematics',
                    unitCode: 'MAT201',
                    university: 'Moi University',
                    subject: 'Mathematics',
                    year: '2',
                    type: 'pdf',
                    description: 'Calculus, differential equations, and linear algebra for engineering students.',
                    fileName: 'mat201_engineering.pdf',
                    fileSize: '4.1 MB',
                    uploadDate: new Date(Date.now() - 21 * 24 * 60 * 60 * 1000).toISOString(),
                    views: 56,
                    url: '#'
                },
                {
                    id: 'DOC_SAMPLE_5',
                    title: 'Business Management',
                    unitCode: 'BUS301',
                    university: 'Strathmore University',
                    subject: 'Business',
                    year: '3',
                    type: 'ppt',
                    description: 'Principles of business management, leadership, and organizational behavior.',
                    fileName: 'bus301_management.ppt',
                    fileSize: '5.3 MB',
                    uploadDate: new Date(Date.now() - 28 * 24 * 60 * 60 * 1000).toISOString(),
                    views: 41,
                    url: '#'
                }
            ];
            
            documents = [...sampleDocs];
            saveToStorage('revisionvault_documents', documents);
        }

        function logActivity(description, type) {
            // Simple activity logging (could be expanded)
            console.log(`[${type.toUpperCase()}] ${description} - ${new Date().toLocaleString()}`);
        }
    </script>
</body>
</html>