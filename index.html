<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RevisionVault Pro - University Study Materials</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1a2980;
            --secondary: #26d0ce;
            --accent: #ff4081;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --light: #f8fafc;
            --dark: #1e293b;
            --card-bg: #ffffff;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --radius: 16px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 0;
            padding-bottom: 100px;
        }

        /* Fixed Header Container */
        .header-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            padding: 15px 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
        }

        /* Logo Section */
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-shrink: 0;
        }

        .logo-icon {
            background: rgba(255, 255, 255, 0.9);
            width: 45px;
            height: 45px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 22px;
            box-shadow: var(--shadow);
        }

        .logo-text h1 {
            font-size: 22px;
            margin-bottom: 2px;
            font-weight: 800;
            letter-spacing: -0.5px;
            color: white;
        }

        .logo-text p {
            font-size: 12px;
            opacity: 0.9;
            font-weight: 400;
            color: rgba(255, 255, 255, 0.9);
        }

        /* Search Bar */
        .search-container {
            flex: 1;
            max-width: 600px;
            position: relative;
        }

        .search-box {
            width: 100%;
            padding: 14px 20px;
            padding-left: 45px;
            border: none;
            border-radius: 50px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            color: white;
            font-size: 15px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .search-box::placeholder {
            color: rgba(255, 255, 255, 0.8);
        }

        .search-box:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.25);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.2);
        }

        .search-icon {
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.9);
            font-size: 16px;
        }

        /* Search Suggestions */
        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-top: 8px;
            max-height: 300px;
            overflow-y: auto;
            display: none;
            z-index: 1001;
            border: 2px solid #e2e8f0;
        }

        .search-suggestions.active {
            display: block;
        }

        .suggestion-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 1px solid #e2e8f0;
        }

        .suggestion-item:hover {
            background: #f1f5f9;
        }

        .suggestion-code {
            font-weight: 700;
            color: var(--primary);
            font-size: 14px;
        }

        .suggestion-title {
            font-size: 12px;
            color: #64748b;
            margin-top: 4px;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Main Container */
        .main-container {
            margin-top: 100px;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
            background: white;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            min-height: calc(100vh - 180px);
        }

        /* Main Layout */
        .main-layout {
            display: grid;
            grid-template-columns: 280px 1fr 320px;
            min-height: 600px;
        }

        /* Left Sidebar */
        .sidebar-left {
            background: var(--light);
            padding: 25px 20px;
            border-right: 1px solid #e2e8f0;
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 16px;
            font-weight: 700;
        }

        .tools-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 25px;
        }

        .tool-card {
            background: var(--card-bg);
            padding: 18px 12px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tool-card:hover {
            transform: translateY(-3px);
            border-color: var(--primary);
            box-shadow: var(--shadow);
        }

        .tool-icon {
            font-size: 22px;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .tool-name {
            font-size: 12px;
            font-weight: 700;
            color: var(--dark);
        }

        .timetable {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            border: 2px solid #e2e8f0;
        }

        .week-display {
            font-size: 20px;
            font-weight: 800;
            color: var(--primary);
            text-align: center;
            margin-bottom: 5px;
        }

        .date-range {
            color: #64748b;
            text-align: center;
            margin-bottom: 15px;
            font-size: 13px;
        }

        .schedule-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            text-align: center;
        }

        .schedule-item {
            padding: 10px;
            background: #f1f5f9;
            border-radius: 8px;
        }

        .time {
            font-weight: 700;
            color: var(--primary);
            font-size: 12px;
        }

        .subject {
            font-size: 11px;
            color: #64748b;
            margin-top: 4px;
        }

        .ai-chat-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, var(--accent), #f50057);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 800;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 25px;
            transition: all 0.3s;
        }

        /* Main Content */
        .main-content {
            padding: 25px;
            background: white;
            overflow-y: auto;
            height: calc(100vh - 180px);
        }

        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .main-title {
            font-size: 24px;
            color: var(--primary);
            font-weight: 800;
        }

        .filters {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .filter-select {
            padding: 10px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            background: white;
            color: var(--dark);
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 140px;
        }

        /* Registration Success Banner */
        .registration-success-banner {
            background: linear-gradient(135deg, #d1fae5, #a7f3d0);
            border: 3px solid var(--success);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            display: none;
            flex-direction: column;
            align-items: center;
            text-align: center;
            animation: fadeIn 0.5s ease-out;
        }

        .registration-success-banner.active {
            display: flex;
        }

        .registration-success-banner h3 {
            color: #065f46;
            margin-bottom: 10px;
            font-size: 20px;
        }

        .registration-success-banner p {
            color: #047857;
            margin-bottom: 20px;
            max-width: 500px;
        }

        /* Access Status */
        .access-status {
            background: linear-gradient(135deg, #ffeaea, #ffc9c9);
            border: 3px solid var(--danger);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
        }

        .access-granted {
            background: linear-gradient(135deg, #d1fae5, #a7f3d0);
            border-color: var(--success);
        }

        /* Quick Unit Codes */
        .quick-units {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .unit-chip {
            background: #e0f2fe;
            color: var(--primary);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        /* Search Results */
        .search-results {
            display: none;
            margin-top: 20px;
        }

        .search-results.active {
            display: block;
        }

        /* Materials Grid */
        .materials-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 35px;
        }

        .material-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            overflow: hidden;
            border: 2px solid #e2e8f0;
            transition: all 0.3s;
            position: relative;
        }

        .material-badge {
            position: absolute;
            top: 12px;
            left: 12px;
            background: linear-gradient(135deg, var(--accent), #f50057);
            color: white;
            padding: 6px 14px;
            border-radius: 50px;
            font-size: 10px;
            font-weight: 800;
            letter-spacing: 1px;
            z-index: 1;
        }

        .material-badge.trending {
            background: linear-gradient(135deg, var(--warning), #f97316);
        }

        .material-badge.recent {
            background: linear-gradient(135deg, var(--success), #059669);
        }

        .material-image {
            height: 160px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.2);
            font-size: 60px;
            position: relative;
        }

        .material-content {
            padding: 20px;
        }

        .material-title {
            font-size: 16px;
            font-weight: 800;
            color: var(--dark);
            margin-bottom: 12px;
            line-height: 1.4;
        }

        .material-meta {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .material-code {
            background: #e0f2fe;
            padding: 5px 12px;
            border-radius: 50px;
            color: var(--primary);
            font-weight: 800;
            font-size: 12px;
        }

        .material-year {
            background: #fee2e2;
            padding: 5px 12px;
            border-radius: 50px;
            color: var(--danger);
            font-weight: 800;
            font-size: 12px;
        }

        .material-info {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #64748b;
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 12px;
        }

        .material-description {
            color: #64748b;
            font-size: 13px;
            line-height: 1.5;
            margin-bottom: 18px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .material-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            font-size: 13px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: all 0.3s;
        }

        .view-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .preview-btn {
            background: #f1f5f9;
            color: var(--dark);
            border: 2px solid #e2e8f0;
        }

        /* Right Sidebar */
        .sidebar-right {
            background: var(--light);
            padding: 25px 20px;
            border-left: 1px solid #e2e8f0;
            height: calc(100vh - 180px);
            overflow-y: auto;
        }

        .category-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 16px;
            background: var(--card-bg);
            border-radius: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            border: 2px solid #e2e8f0;
            transition: all 0.3s;
        }

        .category-name {
            font-weight: 700;
            color: var(--dark);
            font-size: 13px;
        }

        .category-count {
            background: #e0f2fe;
            padding: 3px 10px;
            border-radius: 50px;
            font-size: 11px;
            font-weight: 800;
            color: var(--primary);
        }

        .university-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .university-card {
            background: var(--card-bg);
            padding: 15px 10px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.3s;
        }

        .university-logo {
            width: 35px;
            height: 35px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 8px;
            font-weight: 800;
            font-size: 14px;
        }

        .premium-banner {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            padding: 20px;
            border-radius: var(--radius);
            text-align: center;
            margin-top: 25px;
            box-shadow: var(--shadow);
        }

        /* RAISED Bottom Navigation - MODIFIED: Only 5 buttons */
        .bottom-nav {
            position: fixed;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            border-radius: 50px;
            padding: 12px 25px;
            display: flex;
            gap: 10px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.25);
            z-index: 1000;
            border: 2px solid #e2e8f0;
            min-width: 580px; /* Adjusted for 5 buttons */
            justify-content: space-around;
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
        }

        .nav-btn {
            background: none;
            border: none;
            padding: 12px 18px;
            border-radius: 30px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            font-size: 13px;
            color: #64748b;
            transition: all 0.3s;
            min-width: 90px; /* Adjusted for 5 buttons */
            justify-content: center;
        }

        .nav-btn.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 8px 20px rgba(26, 41, 128, 0.3);
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 15px;
            color: #64748b;
            border-top: 1px solid #e2e8f0;
            background: var(--light);
            font-size: 13px;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
        }

        .form-select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            background: white;
            font-size: 14px;
            color: #495057;
        }

        .submit-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        /* University Button - NEW STYLE */
        .university-browse-btn {
            background: linear-gradient(135deg, #7c3aed, #6d28d9);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
            box-shadow: 0 6px 20px rgba(124, 58, 237, 0.3);
            margin-top: 20px;
        }

        .university-browse-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(124, 58, 237, 0.4);
            background: linear-gradient(135deg, #6d28d9, #5b21b6);
        }

        .university-browse-btn.small {
            padding: 10px 20px;
            font-size: 14px;
        }

        /* Upload Button */
        .upload-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.3);
        }

        .upload-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.4);
            background: linear-gradient(135deg, #059669, #047857);
        }

        /* Admin Panel Styles */
        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .admin-section {
            display: none;
        }

        .admin-list {
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
        }

        /* FIXED PDF VIEWER MODAL - SIMPLIFIED */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.98);
            z-index: 2000;
            padding: 0;
        }

        .modal.active {
            display: block;
            animation: fadeIn 0.2s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: transparent;
            border-radius: 0;
            width: 100%;
            height: 100vh;
            overflow: hidden;
            box-shadow: none;
        }

        .modal-header {
            background: rgba(0, 0, 0, 0.95);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 10;
            height: 60px;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-title {
            font-size: 18px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 70%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .close-modal {
            background: rgba(255, 255, 255, 0.15);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .close-modal:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        .modal-body {
            padding: 0;
            margin: 0;
            height: 100vh;
            position: relative;
            padding-top: 60px;
        }

        /* SIMPLE PDF VIEWER - Fullscreen with touch gestures */
        .pdf-viewer-container {
            width: 100%;
            height: 100%;
            position: relative;
            background: #000;
        }

        .pdf-viewer-frame {
            width: 100%;
            height: 100%;
            border: none;
            display: none;
            background: white;
        }

        .pdf-viewer-frame.active {
            display: block;
        }

        /* PDF Loading State */
        .pdf-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            background: #000;
            color: white;
            text-align: center;
            padding: 40px;
        }

        .pdf-loading i {
            font-size: 60px;
            margin-bottom: 20px;
            opacity: 0.8;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        .pdf-loading h3 {
            font-size: 24px;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .pdf-loading p {
            opacity: 0.8;
            max-width: 400px;
            line-height: 1.6;
        }

        .pdf-error {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            background: #000;
            color: white;
            text-align: center;
            padding: 40px;
        }

        .pdf-error i {
            font-size: 60px;
            margin-bottom: 20px;
        }

        .pdf-error h3 {
            font-size: 24px;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .pdf-error p {
            opacity: 0.9;
            max-width: 400px;
            line-height: 1.6;
        }

        /* University List Modal */
        .university-list-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2002;
            display: none;
            overflow-y: auto;
            padding: 20px;
        }

        .university-list-modal.active {
            display: block;
        }

        .university-list-content {
            background: white;
            border-radius: var(--radius);
            max-width: 800px;
            margin: 50px auto;
            padding: 25px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .university-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .university-list-title {
            font-size: 24px;
            color: var(--primary);
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .university-list-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .university-list-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.3s;
        }

        .university-list-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: var(--shadow);
        }

        .university-list-logo {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 12px;
            font-weight: 800;
            font-size: 18px;
        }

        .university-list-name {
            font-weight: 700;
            color: var(--dark);
            font-size: 14px;
            margin-bottom: 8px;
        }

        .university-list-count {
            background: #e0f2fe;
            padding: 4px 12px;
            border-radius: 50px;
            font-size: 12px;
            font-weight: 800;
            color: var(--primary);
            display: inline-block;
        }

        /* Admin Approval Styles */
        .admin-approval-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .approve-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .approve-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);
        }

        .reject-btn {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .reject-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(239, 68, 68, 0.3);
        }

        .send-whatsapp-btn {
            background: linear-gradient(135deg, #25d366, #128C7E);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            margin-top: 5px;
        }

        .send-whatsapp-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(37, 211, 102, 0.3);
        }

        /* Status Badges */
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            display: inline-block;
            margin-left: 10px;
        }

        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .status-approved {
            background: #d1fae5;
            color: #065f46;
        }

        .status-active {
            background: #dbeafe;
            color: #1e40af;
        }

        .status-expired {
            background: #fee2e2;
            color: #991b1b;
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }

        .quick-action-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            background: white;
            color: var(--dark);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .quick-action-btn:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        /* Progress Steps */
        .progress-steps {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 30px 0;
            position: relative;
        }

        .progress-steps::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 3px;
            background: #e2e8f0;
            z-index: 1;
        }

        .progress-step {
            position: relative;
            z-index: 2;
            text-align: center;
            flex: 1;
        }

        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: 3px solid #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-weight: bold;
            color: #64748b;
        }

        .step-circle.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .step-label {
            font-size: 12px;
            color: #64748b;
            font-weight: 600;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 120px;
            right: 20px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            display: none;
            z-index: 2001;
            max-width: 300px;
            border-left: 5px solid var(--success);
            transform: translateX(400px);
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .notification.show {
            display: block;
            transform: translateX(0);
        }

        /* Upload Instructions */
        .upload-instructions {
            background: #f0f9ff;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .upload-instructions h3 {
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .instruction-step {
            display: flex;
            align-items: start;
            gap: 15px;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e2e8f0;
        }

        .step-number {
            background: var(--primary);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .step-content {
            flex: 1;
        }

        .step-content h4 {
            color: var(--dark);
            margin-bottom: 5px;
        }

        .step-content p {
            color: #64748b;
            font-size: 14px;
            line-height: 1.5;
        }

        .code-block {
            background: #1e293b;
            color: #e2e8f0;
            padding: 10px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 13px;
            margin: 10px 0;
            overflow-x: auto;
        }

        /* Copy Button */
        .copy-btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
        }

        .copy-btn:hover {
            background: #2563eb;
            transform: translateY(-2px);
        }

        .copy-btn.copied {
            background: #10b981;
        }

        /* Account Number Display - MOVED TO REGISTRATION */
        .account-number-display {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border: 3px solid #f59e0b;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .account-number {
            font-size: 24px;
            font-weight: bold;
            color: #92400e;
            letter-spacing: 2px;
            margin: 10px 0;
        }

        /* Backup Button Styles */
        .backup-btn {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
        }

        .backup-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(139, 92, 246, 0.3);
        }

        /* JSON Upload Styles */
        .json-upload-zone {
            border: 3px dashed #7c3aed;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(124, 58, 237, 0.05);
        }

        .json-upload-zone:hover {
            background: rgba(124, 58, 237, 0.1);
            border-color: #6d28d9;
        }

        .json-upload-zone.dragover {
            background: rgba(124, 58, 237, 0.2);
            border-color: #5b21b6;
            transform: scale(1.02);
        }

        .json-document-preview {
            max-height: 200px;
            overflow-y: auto;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
            background: #f8fafc;
        }

        .json-stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .json-stat-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #e2e8f0;
        }

        .json-stat-number {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .json-stat-label {
            font-size: 12px;
            color: #64748b;
        }

        /* Drag and drop animation */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        .json-upload-zone.dragover {
            animation: pulse 1s infinite;
        }

        /* Cloud Sync Styles */
        .cloud-sync-indicator {
            position: fixed;
            bottom: 120px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
            z-index: 999;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .cloud-sync-indicator.offline {
            background: #ef4444;
        }

        .pending-count {
            background: #f59e0b;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            margin-left: 5px;
        }

        /* Screenshot Protection Overlay */
        .screenshot-protection {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 9999;
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
            text-align: center;
            padding: 20px;
        }

        .screenshot-protection.active {
            display: flex;
        }

        .screenshot-protection i {
            font-size: 60px;
            margin-bottom: 20px;
            color: #ff4081;
        }

        .screenshot-protection h2 {
            font-size: 24px;
            margin-bottom: 10px;
            color: white;
        }

        .screenshot-protection p {
            font-size: 16px;
            margin-bottom: 20px;
            opacity: 0.8;
            max-width: 500px;
        }

        /* Advertisements Styles */
        .advertisement-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .advertisement-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none" opacity="0.1"><path d="M0,0 L100,0 L100,100 Z" fill="white"/></svg>');
            background-size: cover;
        }

        .advertisement-content {
            position: relative;
            z-index: 1;
        }

        .advertisement-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .advertisement-description {
            font-size: 16px;
            margin-bottom: 20px;
            opacity: 0.9;
        }

        .advertisement-cta {
            background: white;
            color: #667eea;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .advertisement-cta:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .ad-close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255,255,255,0.2);
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            z-index: 2;
        }

        /* Statistics Dashboard */
        .statistics-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow);
            border: 2px solid #e2e8f0;
        }

        .stat-card h3 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 16px;
        }

        .stat-number {
            font-size: 32px;
            font-weight: bold;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .stat-trend {
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .stat-trend.positive {
            color: #10b981;
        }

        .stat-trend.negative {
            color: #ef4444;
        }

        .university-stats-list {
            max-height: 400px;
            overflow-y: auto;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
        }

        .university-stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid #e2e8f0;
        }

        .university-stat-item:last-child {
            border-bottom: none;
        }

        .university-stat-name {
            font-weight: 600;
            color: var(--dark);
        }

        .university-stat-count {
            background: #e0f2fe;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: bold;
            color: var(--primary);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
            .sidebar-left, .sidebar-right {
                display: none;
            }
            .main-content {
                height: auto;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 10px;
                padding: 10px;
            }
            
            .search-container {
                width: 100%;
                max-width: 100%;
            }
            
            .main-container {
                margin-top: 140px;
            }
            
            /* Mobile Bottom Navigation */
            .bottom-nav {
                bottom: 30px;
                min-width: 95%;
                padding: 10px 15px;
                gap: 5px;
            }
            
            .nav-btn {
                min-width: auto;
                padding: 10px 12px;
                font-size: 11px;
            }
            
            .nav-btn span {
                display: none;
            }
            
            .materials-grid {
                grid-template-columns: 1fr;
            }
            
            .filters {
                flex-direction: column;
                width: 100%;
            }
            
            .filter-select {
                width: 100%;
            }
            
            .main-content {
                height: auto;
                padding: 15px;
            }
            
            .sidebar-right {
                height: auto;
            }
            
            /* Mobile Document Viewer */
            .modal-header {
                padding: 12px 15px;
                height: 55px;
            }
            
            .modal-title {
                font-size: 16px;
                max-width: 65%;
            }
            
            .close-modal {
                width: 36px;
                height: 36px;
                font-size: 16px;
            }
            
            .modal-body {
                padding-top: 55px;
            }
            
            .pdf-loading i,
            .pdf-error i {
                font-size: 50px;
            }
            
            .pdf-loading h3,
            .pdf-error h3 {
                font-size: 20px;
            }
            
            .progress-steps {
                flex-direction: column;
                gap: 20px;
            }
            
            .progress-steps::before {
                display: none;
            }
            
            .progress-step {
                width: 100%;
                text-align: left;
                display: flex;
                align-items: center;
                gap: 15px;
            }
            
            .step-circle {
                margin: 0;
                flex-shrink: 0;
            }
            
            .quick-actions {
                flex-direction: column;
            }
            
            .admin-tabs {
                flex-direction: column;
            }
            
            .statistics-dashboard {
                grid-template-columns: 1fr;
            }
        }

        /* Small Mobile */
        @media (max-width: 480px) {
            .bottom-nav {
                bottom: 25px;
                padding: 8px 10px;
                min-width: 98%;
            }
            
            .nav-btn {
                padding: 8px 10px;
                min-width: 50px;
            }
            
            .nav-btn i {
                font-size: 14px;
            }
            
            .modal-header {
                padding: 10px 12px;
                height: 50px;
            }
            
            .modal-title {
                font-size: 14px;
                max-width: 60%;
            }
            
            .close-modal {
                width: 32px;
                height: 32px;
                font-size: 14px;
            }
            
            .modal-body {
                padding-top: 50px;
            }
            
            .university-list-grid {
                grid-template-columns: 1fr;
            }
            
            .admin-tabs {
                flex-direction: column;
            }
        }

        /* Animation for cards */
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .material-card {
            animation: slideUp 0.3s ease-out;
        }

        /* Loading Spinner */
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Material Type Badge */
        .material-type {
            position: absolute;
            top: 12px;
            right: 12px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Advertisement Tab Styles */
        .advertisements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .advertisement-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid #e2e8f0;
            transition: all 0.3s;
        }

        .advertisement-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
        }

        .advertisement-image {
            height: 150px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 40px;
        }

        .advertisement-details {
            padding: 20px;
        }

        .advertisement-card-title {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .advertisement-card-description {
            color: #64748b;
            font-size: 14px;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .advertisement-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e2e8f0;
        }

        .advertisement-type {
            background: #e0f2fe;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            color: var(--primary);
        }

        .advertisement-cta-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .advertisement-cta-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
    </style>
</head>
<body>
    <!-- Screenshot Protection Overlay -->
    <div class="screenshot-protection" id="screenshotProtection">
        <i class="fas fa-ban"></i>
        <h2>Screenshots Disabled</h2>
        <p>Screenshots are not allowed for document security. Please use the download feature instead.</p>
        <button class="advertisement-cta" onclick="closeScreenshotProtection()">Close</button>
    </div>

    <!-- Fixed Header -->
    <div class="header-container">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <div class="logo-text">
                    <h1>RevisionVault Pro</h1>
                    <p>University Study Materials Platform</p>
                </div>
            </div>
            
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-box" placeholder="Search by Unit Code e.g AGRO 222 or agro222" id="searchInput">
                <div class="search-suggestions" id="searchSuggestions"></div>
            </div>
            
            <div class="header-actions">
                <div class="price-tag">
                    <i class="fas fa-crown"></i>
                    <span>Ksh 67 for 5 Months</span>
                </div>
                <div class="contact-number">
                    <i class="fas fa-phone-alt"></i>
                    <span>0765 098 865</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Cloud Sync Indicator -->
    <div class="cloud-sync-indicator" id="cloudSyncIndicator">
        <i class="fas fa-cloud"></i>
        <span>Cloud Sync Active</span>
        <span class="pending-count" id="pendingCount">0</span>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <div class="main-layout">
            <!-- Left Sidebar -->
            <aside class="sidebar-left">
                <div class="section-title">
                    <i class="fas fa-tools"></i>
                    <span>POWERFUL Study Tools</span>
                </div>
                <div class="tools-grid">
                    <div class="tool-card" onclick="showNotification('StudyList', 'StudyList feature coming soon!')">
                        <div class="tool-icon"><i class="fas fa-list"></i></div>
                        <div class="tool-name">STUDYLIST</div>
                    </div>
                    <div class="tool-card" onclick="showNotification('Reminders', 'Reminders feature coming soon!')">
                        <div class="tool-icon"><i class="fas fa-bell"></i></div>
                        <div class="tool-name">REMINDERS</div>
                    </div>
                    <div class="tool-card" onclick="showNotification('Notes', 'Notes feature coming soon!')">
                        <div class="tool-icon"><i class="fas fa-sticky-note"></i></div>
                        <div class="tool-name">NOTES</div>
                    </div>
                    <div class="tool-card" onclick="showNotification('Tests', 'Tests feature coming soon!')">
                        <div class="tool-icon"><i class="fas fa-file-alt"></i></div>
                        <div class="tool-name">TESTS</div>
                    </div>
                    <div class="tool-card" onclick="showNotification('Downloads', 'Downloads feature coming soon!')">
                        <div class="tool-icon"><i class="fas fa-download"></i></div>
                        <div class="tool-name">DOWNLOADS</div>
                    </div>
                    <div class="tool-card" onclick="showNotification('Progress', 'Progress tracking coming soon!')">
                        <div class="tool-icon"><i class="fas fa-chart-line"></i></div>
                        <div class="tool-name">PROGRESS</div>
                    </div>
                </div>

                <div class="timetable">
                    <div class="section-title">
                        <i class="fas fa-calendar-alt"></i>
                        <span>My Timetable</span>
                    </div>
                    <div class="week-display">Week 24</div>
                    <div class="date-range">Mon, June 10 - Fri, June 14</div>
                    <div class="schedule-grid">
                        <div class="schedule-item">
                            <div class="time">9:00 AM</div>
                            <div class="subject">AGRO 222</div>
                        </div>
                        <div class="schedule-item">
                            <div class="time">11:00 AM</div>
                            <div class="subject">BOTA 241</div>
                        </div>
                        <div class="schedule-item">
                            <div class="time">2:00 PM</div>
                            <div class="subject">ZOOL 210</div>
                        </div>
                    </div>
                </div>

                <button class="ai-chat-btn" onclick="openAIChat()">
                    <i class="fas fa-robot"></i>
                    AI CHAT
                    <span>ESSAYS | RESEARCH | ASSIGNMENTS</span>
                </button>

                <!-- Quick Actions for Universities -->
                <div class="quick-actions" style="margin-top: 20px;">
                    <button class="quick-action-btn" onclick="openUniversityListModal()">
                        <i class="fas fa-university"></i> Browse Universities
                    </button>
                    <button class="quick-action-btn" onclick="showTab('advertisements')">
                        <i class="fas fa-ad"></i> Advertisements
                    </button>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="main-content">
                <!-- Home Tab -->
                <div id="home" class="tab-content active">
                    <div class="content-header">
                        <h1 class="main-title">Continue Reading</h1>
                        <div class="filters">
                            <select class="filter-select" onchange="filterMaterials()" id="universityFilter">
                                <option value="all">All Universities</option>
                            </select>
                            <select class="filter-select" onchange="filterMaterials()" id="yearFilter">
                                <option value="all">All Years</option>
                                <option value="1">Year 1</option>
                                <option value="2">Year 2</option>
                                <option value="3">Year 3</option>
                                <option value="4">Year 4</option>
                            </select>
                        </div>
                    </div>

                    <!-- Advertisement Banner -->
                    <div class="advertisement-container" id="mainAdvertisement">
                        <button class="ad-close-btn" onclick="closeAd('mainAdvertisement')">
                            <i class="fas fa-times"></i>
                        </button>
                        <div class="advertisement-content">
                            <h2 class="advertisement-title"> Need Extra Cash?</h2>
                            <p class="advertisement-description">Earn money by sharing RevisionVault with your classmates! Get 20% commission for every successful referral.</p>
                            <button class="advertisement-cta" onclick="openAdDetails(1)">Learn More</button>
                        </div>
                    </div>

                    <!-- Progress Steps for New Users -->
                    <div class="progress-steps" id="progressSteps" style="display: none;">
                        <div class="progress-step">
                            <div class="step-circle">1</div>
                            <div class="step-label">Register</div>
                        </div>
                        <div class="progress-step">
                            <div class="step-circle">2</div>
                            <div class="step-label">Get Code</div>
                        </div>
                        <div class="progress-step">
                            <div class="step-circle">3</div>
                            <div class="step-label">Activate</div>
                        </div>
                        <div class="progress-step">
                            <div class="step-circle active">4</div>
                            <div class="step-label">Browse</div>
                        </div>
                    </div>

                    <div class="quick-units" id="quickUnits"></div>

                    <div id="accessStatus" class="access-status">
                        <div class="access-text">
                            <h3><i class="fas fa-lock"></i> Access Locked</h3>
                            <p>Subscribe to unlock all study materials and features</p>
                        </div>
                        <button class="view-btn" onclick="showTab('register')" style="width: auto; padding: 10px 20px;">
                            <i class="fas fa-crown"></i> Subscribe Now
                        </button>
                    </div>

                    <!-- Registration Success Banner -->
                    <div id="registrationSuccessBanner" class="registration-success-banner">
                        <div style="text-align: center; width: 100%;">
                            <h3><i class="fas fa-check-circle"></i> Registration Successful!</h3>
                            <p>Your registration has been submitted. Admin will send you an unlock code via WhatsApp and Email.</p>
                            <p style="margin-bottom: 20px; font-weight: 600;">You can browse universities while waiting:</p>
                            
                            <div class="quick-actions">
                                <button class="quick-action-btn" onclick="openUniversityListModal()">
                                    <i class="fas fa-university"></i> Browse Universities
                                </button>
                                <button class="quick-action-btn" onclick="showTab('login')">
                                    <i class="fas fa-sign-in-alt"></i> Go to Login
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="search-results" id="searchResults">
                        <h2 class="search-results-title" id="searchResultsTitle"></h2>
                        <div class="materials-grid" id="searchResultsGrid"></div>
                    </div>

                    <div id="continueReading">
                        <div class="materials-grid" id="continueReadingGrid"></div>

                        <div class="section-divider" style="margin: 30px 0 25px; display: flex; align-items: center; gap: 15px;">
                            <div class="divider-line" style="flex: 1; height: 2px; background: linear-gradient(90deg, transparent, #e2e8f0, transparent);"></div>
                            <h2 style="font-size: 20px; color: var(--primary); font-weight: 800; white-space: nowrap;">Trending Materials</h2>
                            <div class="divider-line" style="flex: 1; height: 2px; background: linear-gradient(90deg, transparent, #e2e8f0, transparent);"></div>
                        </div>

                        <div class="materials-grid" id="trendingGrid"></div>
                    </div>
                </div>

                <!-- Materials Tab -->
                <div id="materials" class="tab-content">
                    <div class="content-header">
                        <h1 class="main-title">All Study Materials</h1>
                        <div class="filters">
                            <select class="filter-select" onchange="filterAllMaterials()" id="allUniversityFilter">
                                <option value="all">All Universities</option>
                            </select>
                            <select class="filter-select" onchange="filterAllMaterials()" id="allSubjectFilter">
                                <option value="all">All Subjects</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- University Browse Button -->
                    <div style="margin-bottom: 25px;">
                        <button class="university-browse-btn" onclick="openUniversityListModal()">
                            <i class="fas fa-university"></i> BROWSE BY UNIVERSITY
                        </button>
                    </div>
                    
                    <div class="materials-grid" id="allMaterialsGrid"></div>
                </div>

                <!-- Advertisements Tab -->
                <div id="advertisements" class="tab-content">
                    <div class="content-header">
                        <h1 class="main-title">Advertisements & Promotions</h1>
                    </div>
                    
                    <div class="advertisement-container">
                        <div class="advertisement-content">
                            <h2 class="advertisement-title"> Special Offer!</h2>
                            <p class="advertisement-description">Get 3 months FREE when you refer 5 friends to RevisionVault Pro. Limited time offer!</p>
                            <button class="advertisement-cta" onclick="openAdDetails(2)">Claim Offer</button>
                        </div>
                    </div>
                    
                    <div class="advertisements-grid" id="advertisementsGrid">
                        <!-- Ads will be loaded here -->
                    </div>
                    
                    <div style="text-align: center; margin-top: 30px; padding: 20px; border: 2px dashed #e2e8f0; border-radius: 10px;">
                        <h3 style="color: var(--primary); margin-bottom: 10px;">
                            <i class="fas fa-bullhorn"></i> Want to Advertise Here?
                        </h3>
                        <p style="color: #64748b; margin-bottom: 15px;">Contact us to place your advertisement and reach thousands of university students.</p>
                        <button class="university-browse-btn small" onclick="contactForAds()">
                            <i class="fas fa-envelope"></i> Contact for Advertising
                        </button>
                    </div>
                </div>

                <!-- Register Tab -->
                <div id="register" class="tab-content">
                    <div class="content-header">
                        <h1 class="main-title">Student Registration</h1>
                    </div>
                    
                    <!-- Progress Steps -->
                    <div class="progress-steps">
                        <div class="progress-step">
                            <div class="step-circle active">1</div>
                            <div class="step-label">Fill Form</div>
                        </div>
                        <div class="progress-step">
                            <div class="step-circle">2</div>
                            <div class="step-label">Make Payment</div>
                        </div>
                        <div class="progress-step">
                            <div class="step-circle">3</div>
                            <div class="step-label">Get Code</div>
                        </div>
                        <div class="progress-step">
                            <div class="step-circle">4</div>
                            <div class="step-label">Browse</div>
                        </div>
                    </div>

                    <!-- Advertisement Banner in Registration -->
                    <div class="advertisement-container" style="margin-bottom: 25px;">
                        <div class="advertisement-content">
                            <h2 class="advertisement-title"> Special Welcome Offer!</h2>
                            <p class="advertisement-description">First 100 registrations get 6 months instead of 5! Limited slots available.</p>
                        </div>
                    </div>

                    <!-- Registration Form -->
                    <div id="registrationForm">
                        <div class="form-group">
                            <label class="form-label">Full Name</label>
                            <input type="text" class="form-input" id="studentName" placeholder="Enter your full name">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Email Address</label>
                            <input type="email" class="form-input" id="studentEmail" placeholder="your.email@gmail.com">
                            <small style="color: #6c757d; font-size: 12px;">Unlock code will be sent to this email</small>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Phone Number (WhatsApp)</label>
                            <input type="tel" class="form-input" id="studentPhone" placeholder="07XXXXXXXX">
                            <small style="color: #6c757d; font-size: 12px;">This number will be used for WhatsApp verification</small>
                        </div>

                        <div class="form-group">
                            <label class="form-label">University</label>
                            <select class="form-select" id="studentUniversity">
                                <option value="">Select University</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Course/Program</label>
                            <input type="text" class="form-input" id="studentCourse" placeholder="e.g., BSc Agriculture">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Year of Study</label>
                            <select class="form-select" id="studentYear">
                                <option value="">Select Year</option>
                                <option value="1">Year 1</option>
                                <option value="2">Year 2</option>
                                <option value="3">Year 3</option>
                                <option value="4">Year 4</option>
                            </select>
                        </div>

                        <!-- Payment Instructions -->
                        <div class="payment-instructions" style="background: #e8f5e9; border: 3px solid #4caf50; border-radius: 15px; padding: 20px; margin: 20px 0;">
                            <h3 style="color: #4caf50; margin-bottom: 15px;"> M-Pesa Payment Instructions</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                <div style="background: white; padding: 15px; border-radius: 10px;">
                                    <div style="font-size: 14px; font-weight: 600; color: var(--primary); margin-bottom: 8px;">Step 1</div>
                                    <p style="font-size: 13px;">Go to <strong>M-Pesa</strong></p>
                                </div>
                                <div style="background: white; padding: 15px; border-radius: 10px;">
                                    <div style="font-size: 14px; font-weight: 600; color: var(--primary); margin-bottom: 8px;">Step 2</div>
                                    <p style="font-size: 13px;">Select <strong>Lipa Na M-Pesa</strong></p>
                                </div>
                                <div style="background: white; padding: 15px; border-radius: 10px;">
                                    <div style="font-size: 14px; font-weight: 600; color: var(--primary); margin-bottom: 8px;">Step 3</div>
                                    <p style="font-size: 13px;">Select <strong>Pay Bill</strong></p>
                                </div>
                                <div style="background: white; padding: 15px; border-radius: 10px;">
                                    <div style="font-size: 14px; font-weight: 600; color: var(--primary); margin-bottom: 8px;">Step 4</div>
                                    <p style="font-size: 13px;">Business No: <strong>247247</strong></p>
                                </div>
                            </div>
                            
                            <!-- FIXED PAYMENT ACCOUNT NUMBER -->
                            <div class="account-number-display" style="margin: 20px 0;">
                                <h3 style="color: #92400e; margin-bottom: 10px;">
                                    <i class="fas fa-copy"></i> Fixed Payment Account Number
                                </h3>
                                <div class="account-number">0330184468200</div>
                                <button class="copy-btn" onclick="copyAccountNumber()" style="margin: 10px auto; display: block;">
                                    <i class="fas fa-copy"></i> Copy Account Number
                                </button>
                                <p style="font-size: 12px; color: #92400e; margin-top: 10px;">
                                    Copy this account number for M-Pesa payment
                                </p>
                            </div>
                            
                            <div style="text-align: center; margin: 20px 0;">
                                <div style="font-size: 14px; color: #6c757d; margin-bottom: 5px;">Amount</div>
                                <div style="font-size: 32px; font-weight: bold; color: #4caf50;">Ksh 67</div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">M-Pesa Transaction Code</label>
                            <input type="text" class="form-input" id="paymentCode" placeholder="Enter transaction code (e.g., SDF45G7H)">
                        </div>

                        <div class="whatsapp-notice" style="background: #e3f2fd; border: 2px solid #2196f3; border-radius: 10px; padding: 15px; text-align: center; margin: 20px 0;">
                            <i class="fab fa-whatsapp" style="color: #25d366; font-size: 24px; margin-bottom: 10px;"></i>
                            <p><strong>WhatsApp & Email Notification</strong></p>
                            <p style="font-size: 13px;">After submitting, admin will be notified via WhatsApp and Email. Unlock code will be sent to both your WhatsApp and Email.</p>
                        </div>

                        <button class="submit-btn" onclick="registerStudent()">
                            <i class="fas fa-paper-plane"></i> SUBMIT REGISTRATION & PAYMENT
                        </button>

                        <!-- UNLOCK CODE BUTTON -->
                        <div style="text-align: center; margin-top: 25px; padding: 20px; border: 2px dashed #e2e8f0; border-radius: 10px;">
                            <h3 style="color: var(--primary); margin-bottom: 10px;">
                                <i class="fas fa-key"></i> Already Have an Unlock Code?
                            </h3>
                            <p style="color: #64748b; margin-bottom: 15px;">If you've already received your unlock code from admin, click below to activate your account</p>
                            <button class="university-browse-btn small" onclick="showTab('login')" style="width: 100%;">
                                <i class="fas fa-unlock"></i> ENTER UNLOCK CODE & ACTIVATE
                            </button>
                        </div>

                        <!-- Quick Browse Option -->
                        <div style="text-align: center; margin-top: 25px;">
                            <p style="color: #64748b; margin-bottom: 15px;">Want to see what's available first?</p>
                            <button class="university-browse-btn small" onclick="openUniversityListModal()">
                                <i class="fas fa-university"></i> BROWSE UNIVERSITIES
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Login Tab -->
                <div id="login" class="tab-content">
                    <div class="content-header">
                        <h1 class="main-title">Student Login</h1>
                    </div>
                    
                    <!-- University Browse Button at Top -->
                    <div style="margin-bottom: 25px;">
                        <button class="university-browse-btn small" onclick="openUniversityListModal()">
                            <i class="fas fa-university"></i> BROWSE UNIVERSITIES
                        </button>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Phone Number or Email</label>
                        <input type="text" class="form-input" id="loginPhone" placeholder="07XXXXXXXX or your.email@gmail.com">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Unlock Code (From Admin)</label>
                        <input type="text" class="form-input" id="unlockCode" placeholder="Enter unlock code from WhatsApp/Email">
                        <small style="color: #6c757d; font-size: 12px;">Required for first-time activation only</small>
                    </div>

                    <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                        <button class="submit-btn" onclick="loginStudent()" style="flex: 2;">
                            <i class="fas fa-sign-in-alt"></i> LOGIN & ACTIVATE
                        </button>
                        <button class="university-browse-btn small" onclick="openUniversityListModal()" style="flex: 1;">
                            <i class="fas fa-university"></i> Browse
                        </button>
                    </div>

                    <!-- Quick Guide -->
                    <div style="background: #f0f9ff; border: 2px solid #e2e8f0; border-radius: 10px; padding: 20px; margin-top: 25px;">
                        <h3 style="color: var(--primary); margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-info-circle"></i> How It Works
                        </h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                            <div style="text-align: center; padding: 15px; background: white; border-radius: 8px;">
                                <div style="font-size: 24px; color: var(--primary); margin-bottom: 8px;">1</div>
                                <div style="font-size: 12px; font-weight: 600; color: var(--dark);">Register & Pay</div>
                            </div>
                            <div style="text-align: center; padding: 15px; background: white; border-radius: 8px;">
                                <div style="font-size: 24px; color: var(--primary); margin-bottom: 8px;">2</div>
                                <div style="font-size: 12px; font-weight: 600; color: var(--dark);">Get Code via WhatsApp & Email</div>
                            </div>
                            <div style="text-align: center; padding: 15px; background: white; border-radius: 8px;">
                                <div style="font-size: 24px; color: var(--primary); margin-bottom: 8px;">3</div>
                                <div style="font-size: 12px; font-weight: 600; color: var(--dark);">Login & Activate</div>
                            </div>
                            <div style="text-align: center; padding: 15px; background: white; border-radius: 8px;">
                                <div style="font-size: 24px; color: var(--primary); margin-bottom: 8px;">4</div>
                                <div style="font-size: 12px; font-weight: 600; color: var(--dark);">Browse Materials</div>
                            </div>
                        </div>
                    </div>

                    <div id="loginMessage" style="margin-top: 20px; padding: 15px; border-radius: 8px; display: none;"></div>
                </div>

                <!-- Upload Tab -->
                <div id="upload" class="tab-content">
                    <div class="content-header">
                        <h1 class="main-title">Upload Study Materials</h1>
                    </div>

                    <!-- Upload Instructions -->
                    <div class="upload-instructions">
                        <h3><i class="fas fa-info-circle"></i> How to Upload Materials</h3>
                        
                        <div class="instruction-step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h4>Prepare Your Document</h4>
                                <p>Make sure your document is in PDF format. Upload it to Google Drive.</p>
                            </div>
                        </div>
                        
                        <div class="instruction-step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h4>Get Shareable Link</h4>
                                <p>Right-click on the file in Google Drive  "Share"  Change to "Anyone with the link"  Copy link</p>
                            </div>
                        </div>
                        
                        <div class="instruction-step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h4>Convert to Direct Link</h4>
                                <p>Change the link format to direct preview link:</p>
                                <div class="code-block">
                                    Original: https://drive.google.com/file/d/FILE_ID/view?usp=sharing<br>
                                    Change to: https://drive.google.com/file/d/FILE_ID/preview
                                </div>
                                <button class="copy-btn" onclick="copyText('https://drive.google.com/file/d/FILE_ID/preview')">
                                    <i class="fas fa-copy"></i> Copy Format
                                </button>
                            </div>
                        </div>
                        
                        <div class="instruction-step" style="border-bottom: none;">
                            <div class="step-number">4</div>
                            <div class="step-content">
                                <h4>Fill Upload Form</h4>
                                <p>Complete the form below with all details. Your upload will be reviewed by admin.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Upload Form -->
                    <div id="uploadForm">
                        <div class="form-group">
                            <label class="form-label">Document Title</label>
                            <input type="text" class="form-input" id="uploadTitle" placeholder="e.g., Plant Breeding Notes">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Unit Code</label>
                            <input type="text" class="form-input" id="uploadUnitCode" placeholder="e.g., AGRO 222">
                            <small style="color: #6c757d; font-size: 12px;">Format: ABC 123 (space will be added automatically)</small>
                        </div>

                        <div class="form-group">
                            <label class="form-label">University</label>
                            <select class="form-select" id="uploadUniversity">
                                <option value="">Select University</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Subject/Category</label>
                            <input type="text" class="form-input" id="uploadSubject" placeholder="e.g., Agronomy">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Year of Study</label>
                            <select class="form-select" id="uploadYear">
                                <option value="">Select Year</option>
                                <option value="1">Year 1</option>
                                <option value="2">Year 2</option>
                                <option value="3">Year 3</option>
                                <option value="4">Year 4</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Description</label>
                            <textarea class="form-input" id="uploadDescription" placeholder="Brief description of the material" rows="3"></textarea>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Google Drive Direct Link</label>
                            <input type="url" class="form-input" id="uploadURL" placeholder="https://drive.google.com/file/d/.../preview">
                            <small style="color: #6c757d; font-size: 12px;">Must end with /preview (not /view)</small>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Your Phone Number (for notification)</label>
                            <input type="tel" class="form-input" id="uploaderPhone" placeholder="07XXXXXXXX">
                        </div>

                        <button class="upload-btn" onclick="uploadMaterial()">
                            <i class="fas fa-upload"></i> SUBMIT FOR REVIEW
                        </button>

                        <div style="text-align: center; margin-top: 20px; padding: 15px; background: #fef3c7; border-radius: 10px;">
                            <p style="color: #92400e;">
                                <i class="fas fa-info-circle"></i> Note: All uploads are reviewed by admin. You'll be notified via WhatsApp when approved.
                            </p>
                        </div>
                    </div>

                    <!-- Upload Success Message -->
                    <div id="uploadSuccess" style="display: none; background: #d1fae5; border: 2px solid #10b981; border-radius: 10px; padding: 25px; text-align: center; margin-top: 20px;">
                        <div style="font-size: 48px; color: #10b981; margin-bottom: 15px;">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <h3 style="color: #065f46; margin-bottom: 10px;">Upload Submitted Successfully!</h3>
                        <p style="color: #047857; margin-bottom: 20px;">Your material has been submitted for admin review. You'll receive a WhatsApp notification once it's approved.</p>
                        <button class="upload-btn" onclick="showTab('materials')">
                            <i class="fas fa-book"></i> Browse Other Materials
                        </button>
                    </div>
                </div>

                <!-- Admin Tab -->
                <div id="admin" class="tab-content">
                    <div class="content-header">
                        <h1 class="main-title">Admin Control Panel</h1>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Admin Password</label>
                        <input type="password" class="form-input" id="adminPassword" placeholder="Enter admin password">
                    </div>

                    <button class="submit-btn" onclick="adminLogin()">
                        <i class="fas fa-sign-in-alt"></i> LOGIN AS ADMIN
                    </button>

                    <div id="adminPanel" style="display: none; margin-top: 30px;">
                        <!-- LOGOUT BUTTON ADDED HERE -->
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h2 style="color: var(--primary);">Welcome, Admin!</h2>
                            <button class="reject-btn" onclick="adminLogout()" style="padding: 10px 20px;">
                                <i class="fas fa-sign-out-alt"></i> Logout Admin
                            </button>
                        </div>

                        <div class="admin-tabs">
                            <button class="nav-btn" onclick="showAdminSection('pending')" style="flex: none; padding: 12px 20px;">Pending Approvals</button>
                            <button class="nav-btn" onclick="showAdminSection('students')" style="flex: none; padding: 12px 20px;">All Students</button>
                            <button class="nav-btn" onclick="showAdminSection('statistics')" style="flex: none; padding: 12px 20px; background: #7c3aed; color: white;">
                                <i class="fas fa-chart-bar"></i> Statistics
                            </button>
                            <button class="nav-btn" onclick="showAdminSection('materials')" style="flex: none; padding: 12px 20px;">Manage Materials</button>
                            <button class="nav-btn" onclick="showAdminSection('uploads')" style="flex: none; padding: 12px 20px;">User Uploads</button>
                            <button class="nav-btn" onclick="showAdminSection('subscribe')" style="flex: none; padding: 12px 20px; background: #10b981; color: white;">
                                <i class="fas fa-user-plus"></i> Subscribe User
                            </button>
                            <button class="nav-btn" onclick="showAdminSection('backup')" style="flex: none; padding: 12px 20px; background: #8b5cf6; color: white;">Backup</button>
                            <button class="nav-btn" onclick="showAdminSection('jsonUpload')" style="flex: none; padding: 12px 20px; background: #7c3aed; color: white;">
                                <i class="fas fa-file-upload"></i> JSON Upload
                            </button>
                            <button class="nav-btn" onclick="showAdminSection('cloudSync')" style="flex: none; padding: 12px 20px; background: #3b82f6; color: white;">
                                <i class="fas fa-cloud"></i> Cloud Sync
                            </button>
                        </div>

                        <div id="pendingSection" class="admin-section" style="display: none;">
                            <h3 style="color: var(--primary); margin-bottom: 15px;"> Pending Subscriptions</h3>
                            <div class="admin-list" id="pendingList"></div>
                        </div>

                        <div id="studentsSection" class="admin-section" style="display: none;">
                            <h3 style="color: var(--primary); margin-bottom: 15px;"> All Registered Students</h3>
                            <div class="admin-list" id="studentList"></div>
                        </div>

                        <!-- NEW STATISTICS SECTION -->
                        <div id="statisticsSection" class="admin-section" style="display: none;">
                            <h3 style="color: var(--primary); margin-bottom: 15px;"> Statistics Dashboard</h3>
                            
                            <div class="statistics-dashboard">
                                <div class="stat-card">
                                    <h3>Total Students</h3>
                                    <div class="stat-number" id="totalStudentsStat">0</div>
                                    <div class="stat-trend positive" id="studentsTrend">
                                        <i class="fas fa-arrow-up"></i> 0% from last month
                                    </div>
                                </div>
                                
                                <div class="stat-card">
                                    <h3>Active Subscriptions</h3>
                                    <div class="stat-number" id="activeSubscriptionsStat">0</div>
                                    <div class="stat-trend positive" id="subscriptionsTrend">
                                        <i class="fas fa-arrow-up"></i> 0% active
                                    </div>
                                </div>
                                
                                <div class="stat-card">
                                    <h3>Total Materials</h3>
                                    <div class="stat-number" id="totalMaterialsStat">0</div>
                                    <div class="stat-trend positive" id="materialsTrend">
                                        <i class="fas fa-arrow-up"></i> 0% growth
                                    </div>
                                </div>
                                
                                <div class="stat-card">
                                    <h3>Total Revenue</h3>
                                    <div class="stat-number">Ksh <span id="totalRevenueStat">0</span></div>
                                    <div class="stat-trend positive" id="revenueTrend">
                                        <i class="fas fa-arrow-up"></i> 0% this month
                                    </div>
                                </div>
                            </div>
                            
                            <h3 style="color: var(--primary); margin: 30px 0 15px;"> Students Per University</h3>
                            <div class="university-stats-list" id="universityStatsList">
                                <!-- University statistics will be loaded here -->
                            </div>
                            
                            <div style="margin-top: 20px; display: flex; gap: 10px;">
                                <button class="backup-btn" onclick="exportStatistics()">
                                    <i class="fas fa-download"></i> Export Statistics
                                </button>
                                <button class="backup-btn" onclick="refreshStatistics()" style="background: #10b981;">
                                    <i class="fas fa-sync"></i> Refresh
                                </button>
                            </div>
                        </div>

                        <div id="materialsSection" class="admin-section" style="display: none;">
                            <h3 style="color: var(--primary); margin-bottom: 15px;"> Manage Study Materials</h3>
                            <div style="margin-bottom: 20px;">
                                <button class="submit-btn" onclick="addNewMaterial()" style="width: auto; padding: 12px 25px;">
                                    <i class="fas fa-plus"></i> Add New Material
                                </button>
                            </div>
                            <div class="admin-list" id="adminMaterialsList"></div>
                        </div>

                        <div id="uploadsSection" class="admin-section" style="display: none;">
                            <h3 style="color: var(--primary); margin-bottom: 15px;"> User Uploads Pending Review</h3>
                            <div class="admin-list" id="userUploadsList"></div>
                        </div>

                        <!-- NEW SUBSCRIBE USER SECTION -->
                        <div id="subscribeSection" class="admin-section" style="display: none;">
                            <h3 style="color: var(--primary); margin-bottom: 15px;"> Subscribe User Manually</h3>
                            
                            <div style="background: #f0f9ff; border: 2px solid #e2e8f0; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                                <h4 style="color: var(--primary); margin-bottom: 10px;"><i class="fas fa-info-circle"></i> Manual Subscription</h4>
                                <p style="color: #64748b; font-size: 14px; line-height: 1.5;">
                                    Add a user manually and generate an unlock code for them. The code will be sent via WhatsApp and Email.
                                </p>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Full Name</label>
                                <input type="text" class="form-input" id="manualUserName" placeholder="Enter user's full name">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Email Address</label>
                                <input type="email" class="form-input" id="manualUserEmail" placeholder="user.email@gmail.com">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Phone Number (WhatsApp)</label>
                                <input type="tel" class="form-input" id="manualUserPhone" placeholder="07XXXXXXXX">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">University</label>
                                <select class="form-select" id="manualUserUniversity">
                                    <option value="">Select University</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Course/Program</label>
                                <input type="text" class="form-input" id="manualUserCourse" placeholder="e.g., BSc Agriculture">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Year of Study</label>
                                <select class="form-select" id="manualUserYear">
                                    <option value="">Select Year</option>
                                    <option value="1">Year 1</option>
                                    <option value="2">Year 2</option>
                                    <option value="3">Year 3</option>
                                    <option value="4">Year 4</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Payment Code (Optional)</label>
                                <input type="text" class="form-input" id="manualPaymentCode" placeholder="Enter M-Pesa code if paid">
                            </div>
                            
                            <div style="display: flex; gap: 10px; margin-top: 20px;">
                                <button class="submit-btn" onclick="subscribeUserManually()" style="flex: 2;">
                                    <i class="fas fa-user-plus"></i> SUBSCRIBE USER & SEND CODE
                                </button>
                                <button class="backup-btn" onclick="generateUnlockCodeOnly()" style="flex: 1; background: #8b5cf6;">
                                    <i class="fas fa-key"></i> Generate Code Only
                                </button>
                            </div>
                            
                            <div id="manualSubscribeResult" style="margin-top: 20px; display: none;"></div>
                        </div>

                        <!-- BACKUP SECTION -->
                        <div id="backupSection" class="admin-section" style="display: none;">
                            <h3 style="color: var(--primary); margin-bottom: 15px;"> Backup Documents Details</h3>
                            
                            <div style="background: #f0f9ff; border: 2px solid #e2e8f0; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                                <h4 style="color: var(--primary); margin-bottom: 10px;"><i class="fas fa-info-circle"></i> Backup Instructions</h4>
                                <p style="color: #64748b; font-size: 14px; line-height: 1.5;">
                                    Click the button below to copy all recently uploaded documents details to clipboard. 
                                    You can then paste them into a text file for backup.
                                </p>
                            </div>
                            
                            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                                <button class="backup-btn" onclick="backupRecentUploads()" style="padding: 12px 20px; font-size: 14px;">
                                    <i class="fas fa-copy"></i> Copy Recent Uploads Details
                                </button>
                                <button class="backup-btn" onclick="backupAllDocuments()" style="padding: 12px 20px; font-size: 14px; background: linear-gradient(135deg, #10b981, #059669);">
                                    <i class="fas fa-database"></i> Copy All Documents
                                </button>
                            </div>
                            
                            <div id="backupStatus" style="display: none; padding: 15px; border-radius: 8px; margin-top: 15px;"></div>
                            
                            <div style="background: #fef3c7; border: 2px solid #f59e0b; border-radius: 10px; padding: 15px; margin-top: 20px;">
                                <h4 style="color: #92400e; margin-bottom: 10px;"><i class="fas fa-lightbulb"></i> Tip</h4>
                                <p style="color: #92400e; font-size: 13px;">
                                    For best backup practice, copy the details and paste into a Google Docs or text file after each upload session.
                                </p>
                            </div>
                        </div>

                        <!-- JSON UPLOAD SECTION -->
                        <div id="jsonUploadSection" class="admin-section" style="display: none;">
                            <h3 style="color: var(--primary); margin-bottom: 15px;"> JSON Bulk Upload</h3>
                            
                            <div style="background: #f0f9ff; border: 2px solid #e2e8f0; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                                <h4 style="color: var(--primary); margin-bottom: 10px;"><i class="fas fa-info-circle"></i> JSON Bulk Upload Instructions</h4>
                                <p style="color: #64748b; font-size: 14px; line-height: 1.5; margin-bottom: 15px;">
                                    Upload a JSON file containing multiple documents to automatically add them to the system. 
                                    All documents will be immediately available to all users.
                                </p>
                                
                                <div class="instruction-step">
                                    <div class="step-number">1</div>
                                    <div class="step-content">
                                        <h4>Prepare JSON File</h4>
                                        <p>Create a JSON file with an array of document objects. Each document should have this format:</p>
                                        <div class="code-block">
{
  "Title": "Plant Breeding notes",
  "Unit Code": "AGRO222",
  "University": "Egerton University",
  "Type": "pdf",
  "Subject": "Agronomy",
  "Year": "2",
  "Description": "lecture notes on plant Breeding",
  "URL": "https://drive.google.com/file/d/.../preview"
}
                                        </div>
                                        <button class="copy-btn" onclick="copyJSONTemplate()">
                                            <i class="fas fa-copy"></i> Copy Template
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="instruction-step">
                                    <div class="step-number">2</div>
                                    <div class="step-content">
                                        <h4>Download Current Documents</h4>
                                        <p>Download current documents as JSON to use as a template or backup:</p>
                                        <button class="backup-btn" onclick="downloadCurrentDocuments()" style="padding: 12px 20px; font-size: 14px; background: linear-gradient(135deg, #10b981, #059669);">
                                            <i class="fas fa-download"></i> Download Current Documents
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="instruction-step" style="border-bottom: none;">
                                    <div class="step-number">3</div>
                                    <div class="step-content">
                                        <h4>Upload JSON File</h4>
                                        <p>Select your JSON file below and upload. The system will automatically add all documents.</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- JSON Upload Zone -->
                            <div class="json-upload-zone" id="jsonUploadZone" onclick="document.getElementById('jsonFileInput').click()">
                                <div style="font-size: 60px; color: #7c3aed; margin-bottom: 15px;">
                                    <i class="fas fa-file-upload"></i>
                                </div>
                                <h3 style="color: #7c3aed; margin-bottom: 10px;">Drop JSON File Here</h3>
                                <p style="color: #64748b; margin-bottom: 20px;">or click to select a JSON file</p>
                                
                                <div style="margin-bottom: 20px;">
                                    <input type="file" id="jsonFileInput" accept=".json" style="display: none;" onchange="handleJSONFileSelect(event)">
                                    <button class="upload-btn" onclick="event.stopPropagation(); document.getElementById('jsonFileInput').click();" style="width: auto; padding: 15px 40px;">
                                        <i class="fas fa-folder-open"></i> SELECT JSON FILE
                                    </button>
                                </div>
                                
                                <div id="jsonFileInfo" style="display: none; background: #e9d5ff; border-radius: 10px; padding: 15px; margin-top: 15px;">
                                    <div style="display: flex; align-items: center; justify-content: space-between;">
                                        <div style="text-align: left;">
                                            <div style="font-weight: bold; color: #7c3aed;" id="fileName"></div>
                                            <div style="font-size: 12px; color: #64748b;" id="fileSize"></div>
                                        </div>
                                        <button class="reject-btn" onclick="clearJSONFile()" style="padding: 5px 10px; font-size: 12px;">
                                            <i class="fas fa-times"></i> Remove
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Upload Button -->
                            <button id="uploadJSONBtn" class="submit-btn" onclick="uploadJSONDocuments()" disabled style="margin-bottom: 20px; background: #7c3aed;">
                                <i class="fas fa-upload"></i> UPLOAD & PROCESS JSON DOCUMENTS
                            </button>
                            
                            <!-- Upload Status -->
                            <div id="jsonUploadStatus" style="margin-top: 20px; display: none;"></div>
                            
                            <!-- Preview Section -->
                            <div id="jsonPreviewSection" style="display: none;">
                                <h4 style="color: var(--primary); margin-bottom: 15px;"> Document Preview</h4>
                                <div id="jsonPreview" style="max-height: 300px; overflow-y: auto; border: 2px solid #e2e8f0; border-radius: 10px; padding: 15px; background: #f8fafc;"></div>
                                <div id="jsonStats" style="margin-top: 15px; padding: 10px; background: #f0f9ff; border-radius: 8px;"></div>
                            </div>
                        </div>

                        <!-- CLOUD SYNC SECTION -->
                        <div id="cloudSyncSection" class="admin-section" style="display: none;">
                            <h3 style="color: var(--primary); margin-bottom: 15px;"> Cloud Sync Status</h3>
                            
                            <div style="background: #f0f9ff; border: 2px solid #e2e8f0; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                    <div>
                                        <h4 style="color: var(--primary); margin-bottom: 5px;">Cloud Sync Status</h4>
                                        <p style="color: #64748b; font-size: 14px;">Sync data across all devices</p>
                                    </div>
                                    <div style="font-size: 24px; color: #10b981;">
                                        <i class="fas fa-cloud"></i>
                                    </div>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 15px;">
                                    <div style="background: white; padding: 10px; border-radius: 8px; text-align: center;">
                                        <div style="font-size: 20px; font-weight: bold; color: var(--primary);" id="cloudPendingCount">0</div>
                                        <div style="font-size: 12px; color: #64748b;">Pending Approvals</div>
                                    </div>
                                    <div style="background: white; padding: 10px; border-radius: 8px; text-align: center;">
                                        <div style="font-size: 20px; font-weight: bold; color: var(--primary);" id="cloudTotalUsers">0</div>
                                        <div style="font-size: 12px; color: #64748b;">Total Users</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                                <button class="backup-btn" onclick="forceSyncFromCloud()" style="padding: 12px 20px; font-size: 14px; background: linear-gradient(135deg, #3b82f6, #2563eb);">
                                    <i class="fas fa-cloud-download-alt"></i> Sync From Cloud
                                </button>
                                <button class="backup-btn" onclick="forceSaveToCloud()" style="padding: 12px 20px; font-size: 14px; background: linear-gradient(135deg, #10b981, #059669);">
                                    <i class="fas fa-cloud-upload-alt"></i> Save To Cloud
                                </button>
                            </div>
                            
                            <div id="cloudSyncStatus" style="display: none; padding: 15px; border-radius: 8px; margin-top: 15px;"></div>
                            
                            <div style="background: #fef3c7; border: 2px solid #f59e0b; border-radius: 10px; padding: 15px; margin-top: 20px;">
                                <h4 style="color: #92400e; margin-bottom: 10px;"><i class="fas fa-info-circle"></i> How Cloud Sync Works</h4>
                                <p style="color: #92400e; font-size: 13px;">
                                    1. When someone registers, data is saved to cloud<br>
                                    2. Admin panel automatically syncs every 30 seconds<br>
                                    3. All pending approvals appear instantly<br>
                                    4. Approvals sync back to cloud immediately
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Right Sidebar -->
            <aside class="sidebar-right">
                <div class="sidebar-section">
                    <h2 class="section-title">
                        <i class="fas fa-folder"></i>
                        Categories
                    </h2>
                    <ul class="category-list" id="categoryList"></ul>
                </div>

                <div class="sidebar-section">
                    <h2 class="section-title">
                        <i class="fas fa-university"></i>
                        Universities
                    </h2>
                    <div class="university-grid" id="universityGrid"></div>
                    <button class="university-browse-btn small" onclick="openUniversityListModal()" style="margin-top: 15px; width: 100%;">
                        <i class="fas fa-search"></i> Browse All Universities
                    </button>
                </div>

                <!-- Advertisement in Sidebar -->
                <div class="advertisement-container" style="margin-top: 25px;">
                    <div class="advertisement-content">
                        <h2 class="advertisement-title"> Study Groups</h2>
                        <p class="advertisement-description">Join study groups for your course and collaborate with classmates!</p>
                        <button class="advertisement-cta-btn" onclick="openAdDetails(3)">Join Now</button>
                    </div>
                </div>

                <!-- Upload Button in Sidebar -->
                <div style="margin-top: 25px;">
                    <button class="upload-btn" onclick="showTab('upload')" style="width: 100%;">
                        <i class="fas fa-upload"></i> UPLOAD MATERIALS
                    </button>
                </div>

                <div class="premium-banner">
                    <div class="premium-title">
                        <i class="fas fa-crown"></i>
                        PREMIUM ACCESS
                    </div>
                    <p style="font-size: 13px;">Unlock all study materials for 5 months</p>
                    <div class="premium-price">Ksh 67</div>
                    <p style="font-size: 12px; opacity: 0.9;">One payment, full access to all resources</p>
                    <button class="premium-btn" onclick="showTab('register')">
                        <i class="fas fa-bolt"></i> SUBSCRIBE NOW
                    </button>
                </div>

                <div style="margin-top: 30px; text-align: center; color: #64748b; font-size: 13px; line-height: 1.6;">
                    <p><i class="fas fa-shield-alt"></i> Secure Payment</p>
                    <p><i class="fas fa-headset"></i> 24/7 Support</p>
                    <p><i class="fas fa-check-circle"></i> Money Back Guarantee</p>
                </div>
            </aside>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>&copy; 2025 RevisionVault Pro  Developed by Walter Zauko</p>
            <p style="margin-top: 3px;">Contact: 0765 098 865  revisionvaultke@gmail.com  All rights reserved</p>
        </footer>
    </div>

    <!-- RAISED Bottom Navigation - MODIFIED: 6 buttons including Advertisements -->
    <div class="bottom-nav">
        <button class="nav-btn active" onclick="showTab('home')">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </button>
        <button class="nav-btn" onclick="showTab('materials')">
            <i class="fas fa-book"></i>
            <span>Materials</span>
        </button>
        <button class="nav-btn" onclick="showTab('advertisements')">
            <i class="fas fa-ad"></i>
            <span>Ads</span>
        </button>
        <button class="nav-btn" onclick="showTab('upload')">
            <i class="fas fa-upload"></i>
            <span>Upload</span>
        </button>
        <button class="nav-btn" onclick="showTab('register')">
            <i class="fas fa-user-plus"></i>
            <span>Register</span>
        </button>
        <button class="nav-btn" onclick="showTab('admin')">
            <i class="fas fa-shield-alt"></i>
            <span>Admin</span>
        </button>
    </div>

    <!-- University List Modal -->
    <div class="university-list-modal" id="universityListModal">
        <div class="university-list-content">
            <div class="university-list-header">
                <h2 class="university-list-title">
                    <i class="fas fa-university"></i>
                    Browse University Materials
                </h2>
                <button class="close-modal" onclick="closeUniversityListModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="university-list-grid" id="universityListGrid">
                <!-- Universities will be populated here -->
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <p style="color: #64748b; font-size: 14px;">
                    Select a university to view materials from that institution
                </p>
            </div>
        </div>
    </div>

    <!-- SIMPLE FULLSCREEN DOCUMENT VIEWER MODAL -->
    <div class="modal" id="pdfModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="pdfModalTitle">
                    <i class="fas fa-file-pdf"></i>
                    <span>Document Viewer</span>
                </h2>
                <button class="close-modal" onclick="closeModal('pdfModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="pdf-viewer-container">
                    <!-- Loading State -->
                    <div class="pdf-loading" id="pdfLoading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <h3>Loading Document...</h3>
                        <p>Please wait while we load your document.</p>
                    </div>
                    
                    <!-- Error State -->
                    <div class="pdf-error" id="pdfError" style="display: none;">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>Document Not Available</h3>
                        <p>The requested document could not be loaded. Please try again later or contact support.</p>
                        <button class="action-btn" onclick="closeModal('pdfModal')" style="width: auto; padding: 10px 20px; background: var(--primary); color: white;">
                            <i class="fas fa-times"></i> Close
                        </button>
                    </div>
                    
                    <!-- PDF Viewer - Fast loading with no controls -->
                    <iframe class="pdf-viewer-frame" id="pdfViewer" 
                            frameborder="0" 
                            scrolling="yes"
                            sandbox="allow-scripts allow-same-origin"
                            loading="eager">
                    </iframe>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Chat Modal -->
    <div class="modal" id="aiChatModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title"><i class="fas fa-robot"></i> AI Study Assistant</h2>
                <button class="close-modal" onclick="closeModal('aiChatModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                    <p>AI Chat helps with essays, research, assignments, and study questions. Ask anything!</p>
                </div>
                
                <div id="aiChatMessages" style="height: 300px; overflow-y: auto; margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                    <div style="background: #f1f5f9; padding: 10px; border-radius: 10px; margin-bottom: 10px;">
                        <strong><i class="fas fa-robot"></i> AI Assistant:</strong> Hello! I'm your AI study assistant. How can I help you today?
                    </div>
                </div>
                
                <div class="form-group">
                    <input type="text" class="form-input" id="aiQuestion" placeholder="Ask me anything about your studies...">
                </div>
                
                <button class="submit-btn" onclick="askAI()">
                    <i class="fas fa-paper-plane"></i> Ask AI Assistant
                </button>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <div style="display: flex; justify-content: space-between; align-items: start;">
            <div>
                <strong id="notificationTitle"></strong>
                <p id="notificationMessage" style="margin-top: 5px;"></p>
            </div>
            <button onclick="hideNotification()" style="background: none; border: none; color: #6c757d; cursor: pointer;">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>

    <script>
        // ==================== CLOUD SYNC CONFIGURATION ====================
        const CLOUD_CONFIG = {
            binId: '69615ca543b1c97be924f428',
            apiKey: '$2a$10$MXdVSjMsSzkF2MxxTZlpFuyKIy9w8YBPpO..kqTlit9uuM4AyEvXy',
            syncEnabled: true,
            lastSyncTime: null
        };

        let cloudData = {
            pendingApprovals: [],
            users: [],
            userUploads: [],
            statistics: {},
            lastSync: null
        };

        // ==================== APP DATA ====================
        const DOCUMENTS_DATA = [
            {
                "Title": "Plant Breeding notes",
                "Unit Code": "AGRO 222",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Agronomy",
                "Year": "2",
                "Description": "lecture notes on plant Breeding",
                "URL": "https://drive.google.com/file/d/17CG_rb_ecvnkLfjTzNC31u55pBR_RW70/preview",
                "Trending": true,
                "Recent": true
            },
            {
                "Title": "Scope of production Economics",
                "Unit Code": "AGEC 241",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Agricultural Economics",
                "Year": "2",
                "Description": "lecture notes on production Economics",
                "URL": "https://drive.google.com/file/d/1uSBqGCfeWPr-upLjKOu-cCkwQUVW7GOU/preview",
                "Trending": true
            },
            {
                "Title": "Production Economics",
                "Unit Code": "AGEC 241",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Agricultural Economics",
                "Year": "2",
                "Description": "lecture notes on production Economics",
                "URL": "https://drive.google.com/file/d/1LZ5P_t9qRlxZq2AyAI8JoG-bZAdS6G_c/preview"
            },
            {
                "Title": "ICT Application in Agricultural Education and Extension",
                "Unit Code": "AGED 113",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Agricultural Education and Extension",
                "Year": "2",
                "Description": "Examination paper on ICT Application in Agricultural Education and Extension",
                "URL": "https://drive.google.com/file/d/1MxYZpCMFoxTLI6ZR0w9rBBAWeZ1h_bg_/preview",
                "Recent": true
            },
            {
                "Title": "plant Breeding",
                "Unit Code": "AGRO 222",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Agronomy",
                "Year": "2",
                "Description": "lecture notes on plant Breeding",
                "URL": "https://drive.google.com/file/d/1wFm3cb1YRR9yD9f5noK4tg0HeD0K0jtg/preview"
            },
            {
                "Title": "taxonomy of higher plants",
                "Unit Code": "BOTA 241",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Botany",
                "Year": "2",
                "Description": "lecture notes on Taxonomy of higher plants",
                "URL": "https://drive.google.com/file/d/102toSTJ9WewkGSiBKx3IxWlbPoeKrGCU/preview"
            },
            {
                "Title": "plant physiology",
                "Unit Code": "BOTA 271",
                "University": "Egerton University",
                Type: "pdf",
                Subject: "Botany",
                Year: "2",
                Description: "lecture notes on plant physiology",
                URL: "https://drive.google.com/file/d/1vSG6ErlBddO-dXBVu8Ice1ut297SiI5d/preview"
            },
            {
                Title: "Breeding practices",
                "Unit Code": "AGRO 222",
                University: "Egerton University",
                Type: "pdf",
                Subject: "Agronomy",
                Year: "2",
                Description: "lecture notes on breeding practices",
                URL: "https://drive.google.com/file/d/1nZfdRK6TTVLvR05-E70WPLBN51_m6G7C/preview",
                Recent: true
            },
            {
                Title: "Cell biology",
                "Unit Code": "ZOOL 232",
                University: "Egerton University",
                Type: "pdf",
                Subject: "zoology",
                Year: "2",
                Description: "lecture notes on cell biology",
                URL: "https://drive.google.com/file/d/1LlFPeHK2DjZBhYh8C0LP9DZMX-etSZd7/preview"
            },
            {
                Title: "course outline",
                "Unit Code": "AGEC 241",
                University: "Egerton University",
                Type: "pdf",
                Subject: "Agricultural Economics",
                Year: "2",
                Description: "lecture notes on production Economics",
                URL: "https://drive.google.com/file/d/15D0aQg6hUX3v1pKwxnQ0Al0vRVIVCfsO/preview"
            },
            {
                Title: "Epistemology and Education",
                "Unit Code": "EDFO 112",
                University: "Egerton University",
                Type: "pdf",
                Subject: "Education Foundation",
                Year: "2",
                Description: "lecture notes on Epistemology and Education",
                URL: "https://drive.google.com/file/d/1Z9vZTucmGM_Vcp-cTvHfWwOxzNNLgPkj/preview"
            },
            {
                Title: "Environmental Science",
                "Unit Code": "ENSC 104",
                University: "Egerton University",
                Type: "pdf",
                Subject: "Environmental Science",
                Year: "2",
                Description: "lecture notes on Environmental Education",
                URL: "https://drive.google.com/file/d/1Rd_mPqrUik3mh9LX6GQEgD5XOjDfw1gB/preview"
            },
            {
                Title: "Environmental Education",
                "Unit Code": "ENSC 104",
                University: "Egerton University",
                Type: "pdf",
                Subject: "Environmental Science",
                Year: "2",
                Description: "lecture notes on Environmental Education",
                URL: "https://drive.google.com/file/d/1px1TN0icV_IlUjRm9DpgVyyPHmSfqBNz/preview"
            },
            {
                Title: "introduction to entrepreneurship",
                "Unit Code": "AGBM 102",
                University: "Egerton University",
                Type: "pdf",
                Subject: "Agro business management",
                Year: "2",
                Description: "lecture notes on introduction to Enterpreneurship",
                URL: "https://drive.google.com/file/d/18KKbBRI1zzReDAAKaQ3lgNmYUHKfc57B/preview"
            },
            {
                Title: "Ecology",
                "Unit Code": "ZOOL 210",
                University: "Egerton University",
                Type: "pdf",
                Subject: "Zoology",
                Year: "2",
                Description: "lecture notes on ecology",
                URL: "https://drive.google.com/file/d/146nlk4PihaeonVHslq3GClWqwu5xsbeX/preview",
                Trending: true
            },
            {
                Title: "SENV 311",
                "Unit Code": "SENV 311",
                University: "University of Eldoret",
                Type: "pdf",
                Subject: "Environmental Science",
                Year: "2",
                Description: "groupwork assignment",
                URL: "https://drive.google.com/file/d/1yPUYlgNepiDrG8RFIraiO5vA3iLLlS6D/preview",
                Recent: true
            },
            {
                Title: "Integral Calculus",
                "Unit Code": "MATH 212",
                University: "University of Nairobi",
                Type: "pdf",
                Subject: "Mathematics",
                Year: "2",
                Description: "2024 Main exam paper on integral calculus",
                URL: "https://drive.google.com/file/d/1LZ5P_t9qRlxZq2AyAI8JoG-bZAdS6G_c/preview",
                Trending: true
            },
            {
                Title: "Analytical Geometry",
                "Unit Code": "MATH 132",
                University: "University of Nairobi",
                Type: "pdf",
                Subject: "Mathematics",
                Year: "1",
                Description: "Complete notes on analytical geometry",
                URL: "https://drive.google.com/file/d/1wFm3cb1YRR9yD9f5noK4tg0HeD0K0jtg/preview"
            }
        ];

        const UNIVERSITIES = [
            "University of Nairobi",
            "Kenyatta University",
            "Moi University",
            "Egerton University",
            "Jomo Kenyatta University of Agriculture and Technology",
            "Maseno University",
            "Masinde Muliro University of Science and Technology",
            "Dedan Kimathi University of Technology",
            "Technical University of Kenya",
            "Technical University of Mombasa",
            "Murang'a University of Technology",
            "Meru University of Science and Technology",
            "Kirinyaga University",
            "Laikipia University",
            "University of Eldoret",
            "Chuka University",
            "Karatina University",
            "Rongo University",
            "Kisii University",
            "South Eastern Kenya University",
            "Pwani University",
            "Co-operative University of Kenya",
            "Kabarak University",
            "Strathmore University",
            "Mount Kenya University",
            "Africa Nazarene University",
            "Catholic University of Eastern Africa",
            "Daystar University",
            "United States International University Africa",
            "Zetech University"
        ];

        // ==================== ADVERTISEMENTS DATA ====================
        const ADVERTISEMENTS = [
            {
                id: 1,
                title: "Referral Program",
                description: "Earn 20% commission for every friend you refer to RevisionVault Pro. Minimum 5 referrals required.",
                type: "Earning",
                cta: "Start Earning",
                link: "#",
                image: "fa-money-bill-wave"
            },
            {
                id: 2,
                title: "Study Groups",
                description: "Join course-specific study groups and collaborate with classmates on assignments and projects.",
                type: "Community",
                cta: "Join Groups",
                link: "#",
                image: "fa-users"
            },
            {
                id: 3,
                title: "Premium Tutoring",
                description: "Get one-on-one tutoring from top students in your course. Starting from Ksh 200/hour.",
                type: "Service",
                cta: "Book Now",
                link: "#",
                image: "fa-chalkboard-teacher"
            },
            {
                id: 4,
                title: "Textbook Exchange",
                description: "Buy, sell, or exchange textbooks with other students. Save up to 70% on book costs.",
                type: "Marketplace",
                cta: "Browse Books",
                link: "#",
                image: "fa-book"
            },
            {
                id: 5,
                title: "Internship Opportunities",
                description: "Exclusive internship listings from partner companies. Apply for positions in your field.",
                type: "Career",
                cta: "View Jobs",
                link: "#",
                image: "fa-briefcase"
            },
            {
                id: 6,
                title: "Exam Prep Sessions",
                description: "Live online exam preparation sessions with experienced tutors. Limited slots available.",
                type: "Education",
                cta: "Register Now",
                link: "#",
                image: "fa-graduation-cap"
            }
        ];

        // ==================== APP STATE ====================
        let appState = {
            currentUser: JSON.parse(localStorage.getItem('currentUser')) || null,
            users: JSON.parse(localStorage.getItem('users')) || [],
            documents: JSON.parse(localStorage.getItem('documents')) || DOCUMENTS_DATA,
            userUploads: JSON.parse(localStorage.getItem('userUploads')) || [],
            advertisements: JSON.parse(localStorage.getItem('advertisements')) || ADVERTISEMENTS,
            adminPassword: "walter.zauko23",
            adminEmail: "revisionvaultke@gmail.com",
            adminWhatsApp: "254765098865",
            subscriptionPrice: "67",
            searchTimeout: null,
            allUnitCodes: [],
            recentlyRegisteredPhone: null,
            statistics: JSON.parse(localStorage.getItem('statistics')) || {
                totalDownloads: 0,
                activeSubscriptions: 0,
                totalMaterials: DOCUMENTS_DATA.length,
                universitiesWithMaterials: 0,
                userUploadsPending: 0,
                totalRevenue: 0,
                lastBackupDate: null,
                universityStats: {}
            }
        };

        // ==================== NEW FEATURE: SCREENSHOT PROTECTION ====================
        function setupScreenshotProtection() {
            // Detect print screen key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'PrintScreen' || (e.ctrlKey && e.key === 'p')) {
                    e.preventDefault();
                    showScreenshotProtection();
                    return false;
                }
            });

            // Detect right-click
            document.addEventListener('contextmenu', function(e) {
                if (document.getElementById('pdfModal').classList.contains('active')) {
                    e.preventDefault();
                    showScreenshotProtection();
                    return false;
                }
            });

            // Detect copy attempts
            document.addEventListener('copy', function(e) {
                if (document.getElementById('pdfModal').classList.contains('active')) {
                    e.preventDefault();
                    showScreenshotProtection();
                    return false;
                }
            });

            // Add screenshot detection for mobile (limited capabilities)
            let touchCount = 0;
            document.addEventListener('touchstart', function(e) {
                if (document.getElementById('pdfModal').classList.contains('active')) {
                    touchCount++;
                    if (touchCount >= 3) { // Three finger swipe detection
                        showScreenshotProtection();
                        touchCount = 0;
                    }
                    setTimeout(() => { touchCount = 0; }, 1000);
                }
            });
        }

        function showScreenshotProtection() {
            const protection = document.getElementById('screenshotProtection');
            protection.classList.add('active');
            
            // Also black out the PDF viewer
            const pdfViewer = document.getElementById('pdfViewer');
            if (pdfViewer) {
                pdfViewer.style.filter = 'brightness(0)';
            }
            
            // Log the attempt
            console.log('Screenshot attempt detected and blocked');
        }

        function closeScreenshotProtection() {
            const protection = document.getElementById('screenshotProtection');
            protection.classList.remove('active');
            
            // Restore PDF viewer
            const pdfViewer = document.getElementById('pdfViewer');
            if (pdfViewer) {
                pdfViewer.style.filter = 'brightness(1)';
            }
        }

        // ==================== NEW FEATURE: FORMAT UNIT CODES ====================
        function formatUnitCode(code) {
            if (!code) return '';
            
            // Remove any existing spaces and convert to uppercase
            code = code.replace(/\s+/g, '').toUpperCase();
            
            // Insert space after letters (e.g., AGRO222 -> AGRO 222)
            const match = code.match(/^([A-Z]+)(\d+.*)$/);
            if (match) {
                return `${match[1]} ${match[2]}`;
            }
            
            return code;
        }

        function normalizeUnitCode(code) {
            // Remove spaces for searching
            return code.replace(/\s+/g, '').toUpperCase();
        }

        // ==================== NEW FEATURE: EMAIL NOTIFICATIONS ====================
        function sendEmailNotification(toEmail, subject, message) {
            // Create mailto link for admin to send email
            const mailtoLink = `mailto:${toEmail}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(message)}`;
            
            // Try to open email client
            window.open(mailtoLink, '_blank');
            
            // Also show notification
            showNotification('Email Ready', 'Email client opened. Send email to complete notification.', 'info');
            
            return true;
        }

        // ==================== NEW FEATURE: UNIVERSITY STATISTICS ====================
        function calculateUniversityStatistics() {
            const stats = {};
            
            // Count students per university
            appState.users.forEach(user => {
                if (user.university) {
                    stats[user.university] = stats[user.university] || {
                        totalStudents: 0,
                        activeSubscriptions: 0,
                        pendingApprovals: 0
                    };
                    stats[user.university].totalStudents++;
                    
                    if (user.subscription?.active) {
                        stats[user.university].activeSubscriptions++;
                    } else if (user.subscription?.status === 'pending') {
                        stats[user.university].pendingApprovals++;
                    }
                }
            });
            
            // Count materials per university
            appState.documents.forEach(doc => {
                if (doc.University) {
                    stats[doc.University] = stats[doc.University] || {
                        totalStudents: 0,
                        activeSubscriptions: 0,
                        pendingApprovals: 0,
                        totalMaterials: 0
                    };
                    stats[doc.University].totalMaterials = (stats[doc.University].totalMaterials || 0) + 1;
                }
            });
            
            appState.statistics.universityStats = stats;
            saveAppData();
            
            return stats;
        }

        function displayUniversityStatistics() {
            const stats = calculateUniversityStatistics();
            const container = document.getElementById('universityStatsList');
            
            if (!container) return;
            
            // Sort universities by total students
            const sortedStats = Object.entries(stats).sort((a, b) => b[1].totalStudents - a[1].totalStudents);
            
            container.innerHTML = sortedStats.map(([university, data]) => `
                <div class="university-stat-item">
                    <div class="university-stat-name">${university}</div>
                    <div style="display: flex; gap: 10px;">
                        <span class="university-stat-count" style="background: #e0f2fe;">${data.totalStudents || 0}</span>
                        <span class="university-stat-count" style="background: #d1fae5;">${data.activeSubscriptions || 0}</span>
                        <span class="university-stat-count" style="background: #fef3c7;">${data.pendingApprovals || 0}</span>
                        <span class="university-stat-count" style="background: #f3e8ff;">${data.totalMaterials || 0}</span>
                    </div>
                </div>
            `).join('');
            
            // Update statistics dashboard
            updateStatisticsDashboard();
        }

        function updateStatisticsDashboard() {
            // Total Students
            document.getElementById('totalStudentsStat').textContent = appState.users.length;
            
            // Active Subscriptions
            const activeSubs = appState.users.filter(u => u.subscription?.active).length;
            document.getElementById('activeSubscriptionsStat').textContent = activeSubs;
            
            // Total Materials
            document.getElementById('totalMaterialsStat').textContent = appState.documents.length;
            
            // Total Revenue (approximate)
            const totalRevenue = appState.users.length * 67;
            document.getElementById('totalRevenueStat').textContent = totalRevenue.toLocaleString();
            
            // Calculate trends (simplified)
            const studentsTrend = document.getElementById('studentsTrend');
            const subscriptionsTrend = document.getElementById('subscriptionsTrend');
            const materialsTrend = document.getElementById('materialsTrend');
            const revenueTrend = document.getElementById('revenueTrend');
            
            // Set some example trends (in real app, would compare with previous data)
            studentsTrend.innerHTML = `<i class="fas fa-arrow-up"></i> ${Math.floor(Math.random() * 20) + 5}% from last month`;
            subscriptionsTrend.innerHTML = `<i class="fas fa-arrow-up"></i> ${Math.floor((activeSubs / appState.users.length) * 100)}% active`;
            materialsTrend.innerHTML = `<i class="fas fa-arrow-up"></i> ${Math.floor(Math.random() * 30) + 10}% growth`;
            revenueTrend.innerHTML = `<i class="fas fa-arrow-up"></i> ${Math.floor(Math.random() * 25) + 8}% this month`;
        }

        // ==================== NEW FEATURE: MANUAL SUBSCRIPTION ====================
        function subscribeUserManually() {
            const name = document.getElementById('manualUserName').value.trim();
            const email = document.getElementById('manualUserEmail').value.trim();
            const phone = document.getElementById('manualUserPhone').value.trim();
            const university = document.getElementById('manualUserUniversity').value;
            const course = document.getElementById('manualUserCourse').value.trim();
            const year = document.getElementById('manualUserYear').value;
            const paymentCode = document.getElementById('manualPaymentCode').value.trim();
            
            if (!name || !email || !phone || !university || !course || !year) {
                showNotification('Error', 'Please fill in all required fields', 'error');
                return;
            }
            
            // Check if user already exists
            const existingUser = appState.users.find(u => u.phone === phone || u.email === email);
            if (existingUser) {
                showNotification('Info', 'User already exists. Generating new unlock code...', 'info');
                generateUnlockCodeForUser(existingUser);
                return;
            }
            
            // Create new user
            const unlockCode = generateUnlockCode();
            const newUser = {
                id: Date.now(),
                name: name,
                email: email,
                phone: phone,
                university: university,
                course: course,
                year: year,
                registrationDate: new Date().toISOString(),
                subscription: {
                    active: true,
                    paymentCode: paymentCode || 'MANUAL-' + Date.now().toString().slice(-6),
                    unlockCode: unlockCode,
                    status: 'approved',
                    startDate: new Date().toISOString(),
                    endDate: new Date(Date.now() + 5 * 30 * 24 * 60 * 60 * 1000).toISOString(),
                    approvedDate: new Date().toISOString()
                },
                activity: {
                    lastLogin: null,
                    materialsViewed: [],
                    universitiesBrowsed: []
                }
            };
            
            appState.users.push(newUser);
            saveAppData();
            
            // Send unlock code via WhatsApp and Email
            sendUnlockCodeToUser(newUser);
            
            // Show success message
            const resultDiv = document.getElementById('manualSubscribeResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <div style="background: #d1fae5; border: 2px solid #10b981; border-radius: 10px; padding: 20px; text-align: center;">
                    <i class="fas fa-check-circle" style="color: #10b981; font-size: 48px; margin-bottom: 15px;"></i>
                    <h3 style="color: #065f46; margin-bottom: 10px;">User Subscribed Successfully!</h3>
                    <p style="color: #047857; margin-bottom: 15px;">
                        <strong>Unlock Code:</strong> ${unlockCode}<br>
                        Sent to WhatsApp: ${phone} and Email: ${email}
                    </p>
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button class="backup-btn" onclick="copyToClipboard('${unlockCode}')">
                            <i class="fas fa-copy"></i> Copy Code
                        </button>
                        <button class="backup-btn" onclick="sendUnlockCodeToUser(${JSON.stringify(newUser).replace(/"/g, '&quot;')})" style="background: #25d366;">
                            <i class="fab fa-whatsapp"></i> Resend WhatsApp
                        </button>
                    </div>
                </div>
            `;
            
            // Clear form
            document.getElementById('manualUserName').value = '';
            document.getElementById('manualUserEmail').value = '';
            document.getElementById('manualUserPhone').value = '';
            document.getElementById('manualUserUniversity').value = '';
            document.getElementById('manualUserCourse').value = '';
            document.getElementById('manualUserYear').value = '';
            document.getElementById('manualPaymentCode').value = '';
            
            // Update statistics
            updateStatistics();
            calculateUniversityStatistics();
            
            showNotification('Success', `User ${name} subscribed successfully!`, 'success');
        }

        function generateUnlockCodeOnly() {
            const name = document.getElementById('manualUserName').value.trim();
            const email = document.getElementById('manualUserEmail').value.trim();
            const phone = document.getElementById('manualUserPhone').value.trim();
            
            if (!name || !email || !phone) {
                showNotification('Error', 'Please enter name, email, and phone first', 'error');
                return;
            }
            
            const unlockCode = generateUnlockCode();
            const resultDiv = document.getElementById('manualSubscribeResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <div style="background: #f0f9ff; border: 2px solid #3b82f6; border-radius: 10px; padding: 20px; text-align: center;">
                    <i class="fas fa-key" style="color: #3b82f6; font-size: 48px; margin-bottom: 15px;"></i>
                    <h3 style="color: #1e40af; margin-bottom: 10px;">Unlock Code Generated</h3>
                    <div style="font-size: 32px; font-weight: bold; color: #7c3aed; margin: 15px 0; letter-spacing: 3px;">
                        ${unlockCode}
                    </div>
                    <p style="color: #4b5563; margin-bottom: 15px;">
                        For: ${name}<br>
                        Phone: ${phone}<br>
                        Email: ${email}
                    </p>
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button class="backup-btn" onclick="copyToClipboard('${unlockCode}')">
                            <i class="fas fa-copy"></i> Copy Code
                        </button>
                        <button class="backup-btn" onclick="sendManualUnlockCode('${name}', '${phone}', '${email}', '${unlockCode}')" style="background: #25d366;">
                            <i class="fab fa-whatsapp"></i> Send via WhatsApp
                        </button>
                        <button class="backup-btn" onclick="sendManualEmail('${name}', '${email}', '${unlockCode}')" style="background: #ea4335;">
                            <i class="fas fa-envelope"></i> Send via Email
                        </button>
                    </div>
                </div>
            `;
        }

        function sendManualUnlockCode(name, phone, email, unlockCode) {
            const message = ` MANUAL SUBSCRIPTION - RevisionVault Pro\n\nHello ${name},\n\nYour manual subscription has been processed!\n\n Unlock Code: ${unlockCode}\n\n Login Steps:\n1. Go to RevisionVault Pro\n2. Click Login tab\n3. Enter your phone: ${phone}\n4. Enter unlock code: ${unlockCode}\n5. Click Login\n\n Welcome to RevisionVault Pro!`;
            
            const whatsappUrl = `https://wa.me/254${phone.substring(1)}?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
            
            showNotification('WhatsApp Sent', `Unlock code sent to ${phone}`, 'success');
        }

        function sendManualEmail(name, email, unlockCode) {
            const subject = `RevisionVault Pro - Your Unlock Code`;
            const body = `Dear ${name},\n\nYour manual subscription to RevisionVault Pro has been processed!\n\nYour Unlock Code: ${unlockCode}\n\nTo activate your account:\n1. Visit RevisionVault Pro\n2. Click on the Login tab\n3. Enter your email or phone number\n4. Enter the unlock code above\n5. Click Login & Activate\n\nThis code provides 5 months of full access to all study materials.\n\nWelcome to RevisionVault Pro!\n\nBest regards,\nRevisionVault Pro Team`;
            
            sendEmailNotification(email, subject, body);
        }

        function generateUnlockCodeForUser(user) {
            const unlockCode = generateUnlockCode();
            user.subscription.unlockCode = unlockCode;
            user.subscription.status = 'approved';
            user.subscription.active = true;
            user.subscription.startDate = new Date().toISOString();
            user.subscription.endDate = new Date(Date.now() + 5 * 30 * 24 * 60 * 60 * 1000).toISOString();
            user.subscription.approvedDate = new Date().toISOString();
            
            saveAppData();
            sendUnlockCodeToUser(user);
            
            showNotification('Code Generated', `New unlock code sent to ${user.name}`, 'success');
        }

        // ==================== ENHANCED: SEND UNLOCK CODE ====================
        function sendUnlockCodeToUser(user) {
            // Send WhatsApp
            const whatsappMessage = ` ACCOUNT APPROVED - RevisionVault Pro\n\nHello ${user.name},\n\nYour account has been approved!\n\n Unlock Code: ${user.subscription.unlockCode}\n\n Login Steps:\n1. Go to RevisionVault Pro\n2. Click Login tab\n3. Enter your phone: ${user.phone}\n4. Enter unlock code: ${user.subscription.unlockCode}\n5. Click Login\n\n Welcome to RevisionVault Pro!`;
            
            const whatsappUrl = `https://wa.me/254${user.phone.substring(1)}?text=${encodeURIComponent(whatsappMessage)}`;
            window.open(whatsappUrl, '_blank');
            
            // Send Email
            if (user.email) {
                const emailSubject = `RevisionVault Pro - Your Unlock Code`;
                const emailBody = `Dear ${user.name},\n\nYour account has been approved!\n\nYour Unlock Code: ${user.subscription.unlockCode}\n\nTo activate your account:\n1. Visit RevisionVault Pro\n2. Click on the Login tab\n3. Enter your email or phone number\n4. Enter the unlock code above\n5. Click Login & Activate\n\nThis code provides 5 months of full access to all study materials.\n\nWelcome to RevisionVault Pro!\n\nBest regards,\nRevisionVault Pro Team`;
                
                sendEmailNotification(user.email, emailSubject, emailBody);
            }
            
            // Also notify admin
            const adminMessage = ` USER SUBSCRIBED - RevisionVault Pro\n\nUser: ${user.name}\nPhone: ${user.phone}\nEmail: ${user.email}\nUniversity: ${user.university}\nUnlock Code: ${user.subscription.unlockCode}\n\nUnlock code sent via WhatsApp and Email.`;
            
            const adminWhatsappUrl = `https://wa.me/${appState.adminWhatsApp}?text=${encodeURIComponent(adminMessage)}`;
            window.open(adminWhatsappUrl, '_blank');
        }

        // ==================== NEW FEATURE: ADVERTISEMENTS ====================
        function loadAdvertisements() {
            const container = document.getElementById('advertisementsGrid');
            if (!container) return;
            
            container.innerHTML = appState.advertisements.map(ad => `
                <div class="advertisement-card">
                    <div class="advertisement-image">
                        <i class="fas ${ad.image}"></i>
                    </div>
                    <div class="advertisement-details">
                        <h3 class="advertisement-card-title">${ad.title}</h3>
                        <p class="advertisement-card-description">${ad.description}</p>
                        <div class="advertisement-meta">
                            <span class="advertisement-type">${ad.type}</span>
                            <button class="advertisement-cta-btn" onclick="openAdDetails(${ad.id})">
                                ${ad.cta}
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function openAdDetails(adId) {
            const ad = appState.advertisements.find(a => a.id === adId);
            if (!ad) return;
            
            showNotification(ad.title, ad.description, 'info');
            
            // In a real app, this would open a detailed view
            // For now, just show notification and maybe redirect
            if (ad.link && ad.link !== '#') {
                window.open(ad.link, '_blank');
            }
        }

        function closeAd(adId) {
            const ad = document.getElementById(adId);
            if (ad) {
                ad.style.display = 'none';
            }
        }

        function contactForAds() {
            const subject = "Advertisement Inquiry - RevisionVault Pro";
            const body = `Dear RevisionVault Pro Team,\n\nI am interested in advertising on your platform. Please send me more information about:\n\n1. Advertisement rates\n2. Available ad spaces\n3. Audience demographics\n4. Booking process\n\nThank you,\n[Your Name]\n[Your Company/Organization]\n[Your Contact Information]`;
            
            sendEmailNotification(appState.adminEmail, subject, body);
        }

        // ==================== ENHANCED: REGISTRATION WITH EMAIL ====================
        function registerStudent() {
            const name = document.getElementById('studentName').value.trim();
            const email = document.getElementById('studentEmail').value.trim();
            const phone = document.getElementById('studentPhone').value.trim();
            const university = document.getElementById('studentUniversity').value;
            const course = document.getElementById('studentCourse').value.trim();
            const year = document.getElementById('studentYear').value;
            const paymentCode = document.getElementById('paymentCode').value.trim();
            
            if (!name || !email || !phone || !university || !course || !year || !paymentCode) {
                showNotification('Error', 'Please fill in all fields', 'error');
                highlightEmptyFields();
                return;
            }
            
            // Validate email
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showNotification('Error', 'Please enter a valid email address', 'error');
                document.getElementById('studentEmail').style.borderColor = 'var(--danger)';
                return;
            }
            
            if (phone.length !== 10 || !phone.startsWith('07')) {
                showNotification('Error', 'Please enter a valid Kenyan phone number (07XXXXXXXX)', 'error');
                document.getElementById('studentPhone').style.borderColor = 'var(--danger)';
                return;
            }
            
            if (paymentCode.length < 8) {
                showNotification('Error', 'Please enter a valid M-Pesa transaction code', 'error');
                document.getElementById('paymentCode').style.borderColor = 'var(--danger)';
                return;
            }
            
            const existingUser = appState.users.find(u => u.phone === phone || u.email === email);
            if (existingUser) {
                showNotification('Info', 'This phone number or email is already registered', 'info');
                document.getElementById('studentPhone').value = phone;
                document.getElementById('studentEmail').value = email;
                showTab('login');
                return;
            }
            
            const newUser = {
                id: Date.now(),
                name: name,
                email: email,
                phone: phone,
                university: university,
                course: course,
                year: year,
                registrationDate: new Date().toISOString(),
                subscription: {
                    active: false,
                    paymentCode: paymentCode,
                    unlockCode: '',
                    status: 'pending',
                    startDate: null,
                    endDate: null,
                    approvedDate: null
                },
                activity: {
                    lastLogin: null,
                    materialsViewed: [],
                    universitiesBrowsed: []
                }
            };
            
            appState.users.push(newUser);
            saveAppData();
            
            appState.recentlyRegisteredPhone = phone;
            localStorage.setItem('recentlyRegisteredPhone', phone);
            
            showRegistrationSuccessBanner();
            showProgressSteps();
            
            // Send notification to admin via WhatsApp AND Email
            sendRegistrationNotificationToAdmin(newUser);
            
            // SAVE TO CLOUD
            saveToCloud();
            
            showNotification('Registration Successful!', 'Admin will send you an unlock code via WhatsApp and Email. Browse universities now!', 'success');
            
            clearRegistrationForm();
            updateStatistics();
            calculateUniversityStatistics();
        }

        function sendRegistrationNotificationToAdmin(user) {
            // WhatsApp notification to admin
            const whatsappMessage = ` NEW REGISTRATION - RevisionVault Pro
            
 Name: ${user.name}
 Email: ${user.email}
 Phone: ${user.phone}
 University: ${user.university}
 Course: ${user.course}
 Year: ${user.year}
 Payment Code: ${user.subscription.paymentCode}
 Date: ${new Date().toLocaleString()}

Please review and approve this registration.`;

            const whatsappUrl = `https://wa.me/${appState.adminWhatsApp}?text=${encodeURIComponent(whatsappMessage)}`;
            window.open(whatsappUrl, '_blank');
            
            // Email notification to admin
            const emailSubject = `New Registration - ${user.name}`;
            const emailBody = `New student registration received:\n\nName: ${user.name}\nEmail: ${user.email}\nPhone: ${user.phone}\nUniversity: ${user.university}\nCourse: ${user.course}\nYear: ${user.year}\nPayment Code: ${user.subscription.paymentCode}\nRegistration Date: ${new Date().toLocaleString()}\n\nPlease login to admin panel to approve and send unlock code.`;
            
            sendEmailNotification(appState.adminEmail, emailSubject, emailBody);
        }

        // ==================== ENHANCED: SEARCH WITH FORMATTED CODES ====================
        function searchByUnitCode(query) {
            if (!query.trim()) {
                document.getElementById('searchResults').classList.remove('active');
                document.getElementById('continueReading').style.display = 'block';
                hideSearchSuggestions();
                return;
            }
            
            const normalizedQuery = normalizeUnitCode(query);
            
            const results = appState.documents.filter(doc => {
                const unitCode = normalizeUnitCode(doc["Unit Code"] || "");
                const title = (doc.Title || "").toUpperCase();
                const subject = (doc.Subject || "").toUpperCase();
                const description = (doc.Description || "").toUpperCase();
                const university = (doc.University || "").toUpperCase();
                
                return unitCode.includes(normalizedQuery) || 
                       title.includes(normalizedQuery) ||
                       subject.includes(normalizedQuery) ||
                       description.includes(normalizedQuery) ||
                       university.includes(normalizedQuery);
            });
            
            if (results.length > 0) {
                document.getElementById('continueReading').style.display = 'none';
                document.getElementById('searchResults').classList.add('active');
                document.getElementById('searchResultsTitle').textContent = `Search Results for "${query}" (${results.length} found)`;
                
                const grid = document.getElementById('searchResultsGrid');
                grid.innerHTML = results.map(doc => createMaterialCard(doc)).join('');
                
                setTimeout(() => {
                    document.getElementById('searchResults').scrollIntoView({ behavior: 'smooth' });
                }, 100);
                
                showNotification('Search Results', `Found ${results.length} materials for "${query}"`, 'success');
            } else {
                document.getElementById('continueReading').style.display = 'block';
                document.getElementById('searchResults').classList.remove('active');
                showNotification('No Results', `No materials found for "${query}"`, 'warning');
            }
            
            hideSearchSuggestions();
        }

        // ==================== ENHANCED: MATERIAL CARD WITH FORMATTED CODE ====================
        function createMaterialCard(doc) {
            const hasAccess = appState.currentUser && appState.currentUser.subscription && 
                             appState.currentUser.subscription.active;
            
            const badges = [];
            if (doc.Trending) badges.push('<div class="material-badge trending">TRENDING</div>');
            if (doc.Recent) badges.push('<div class="material-badge recent">RECENT</div>');
            
            const typeBadge = doc.Type ? 
                `<div class="material-type">${doc.Type.toUpperCase()}</div>` : 
                '<div class="material-type">PDF</div>';
            
            // Format unit code for display
            const displayUnitCode = formatUnitCode(doc["Unit Code"]);
            
            return `
                <div class="material-card">
                    ${badges.join('')}
                    ${typeBadge}
                    
                    <div class="material-image">
                        <i class="fas fa-file-pdf"></i>
                    </div>
                    
                    <div class="material-content">
                        <h3 class="material-title">${doc.Title}</h3>
                        
                        <div class="material-meta">
                            <span class="material-code">${displayUnitCode}</span>
                            <span class="material-year">Year ${doc.Year}</span>
                        </div>
                        
                        <div class="material-info">
                            <i class="fas fa-university"></i>
                            <span>${doc.University}</span>
                            <span style="margin-left: auto; font-size: 11px;">
                                <i class="fas fa-book"></i> ${doc.Subject}
                            </span>
                        </div>
                        
                        <p class="material-description">${doc.Description}</p>
                        
                        <div class="material-actions">
                            ${hasAccess ? 
                                `<button class="action-btn view-btn" onclick="openDocumentViewer('${doc.URL}', '${doc.Title}', '${doc["Unit Code"]}', '${doc.University}', '${doc.Year}', '${doc.Subject}')">
                                    <i class="fas fa-eye"></i> View Document
                                </button>` :
                                `<button class="action-btn view-btn" onclick="showTab('register')">
                                    <i class="fas fa-lock"></i> Subscribe to View
                                </button>`
                            }
                        </div>
                    </div>
                </div>
            `;
        }

        // ==================== ENHANCED: UPLOAD WITH FORMATTED CODE ====================
        function uploadMaterial() {
            const title = document.getElementById('uploadTitle').value.trim();
            let unitCode = document.getElementById('uploadUnitCode').value.trim();
            const university = document.getElementById('uploadUniversity').value;
            const subject = document.getElementById('uploadSubject').value.trim();
            const year = document.getElementById('uploadYear').value;
            const description = document.getElementById('uploadDescription').value.trim();
            const url = document.getElementById('uploadURL').value.trim();
            const phone = document.getElementById('uploaderPhone').value.trim();
            
            if (!title || !unitCode || !university || !subject || !year || !description || !url || !phone) {
                showNotification('Error', 'Please fill in all fields', 'error');
                return;
            }
            
            if (phone.length !== 10 || !phone.startsWith('07')) {
                showNotification('Error', 'Please enter a valid Kenyan phone number (07XXXXXXXX)', 'error');
                return;
            }
            
            if (!url.includes('/preview')) {
                showNotification('Error', 'URL must be a direct preview link ending with /preview', 'error');
                return;
            }
            
            // Format unit code
            unitCode = formatUnitCode(unitCode);
            
            const upload = {
                id: Date.now(),
                title: title,
                unitCode: unitCode,
                university: university,
                subject: subject,
                year: year,
                description: description,
                url: url,
                uploaderPhone: phone,
                uploadDate: new Date().toISOString(),
                status: 'pending',
                reviewedBy: null,
                reviewDate: null
            };
            
            appState.userUploads.push(upload);
            saveAppData();
            updateStatistics();
            
            document.getElementById('uploadForm').style.display = 'none';
            document.getElementById('uploadSuccess').style.display = 'block';
            
            sendUploadNotification(upload);
            
            showNotification('Upload Submitted', 'Your material has been submitted for review', 'success');
            
            clearUploadForm();
        }

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            loadAppData();
            initializeUniversities();
            initializeCategories();
            initializeUnitCodes();
            renderHomeContent();
            updateAccessStatus();
            updateStatistics();
            checkRegistrationSuccess();
            initializeUploadUniversities();
            loadAdvertisements();
            setupScreenshotProtection();
            
            // Setup search
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', function(e) {
                clearTimeout(appState.searchTimeout);
                
                if (e.target.value.length > 0) {
                    showSearchSuggestions(e.target.value);
                } else {
                    hideSearchSuggestions();
                }
                
                appState.searchTimeout = setTimeout(() => {
                    searchByUnitCode(e.target.value);
                }, 300);
            });
            
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchByUnitCode(this.value);
                }
            });
            
            // Initialize bottom navigation
            document.querySelectorAll('.bottom-nav .nav-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.bottom-nav .nav-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            // Initialize sample data
            initializeSampleData();
            
            // Calculate university statistics
            calculateUniversityStatistics();
            
            // Auto-sync every 30 seconds when admin panel is open
            setInterval(() => {
                if (document.getElementById('adminPanel') && document.getElementById('adminPanel').style.display === 'block') {
                    syncWithCloud();
                }
            }, 30000);
            
            // Initial cloud sync
            setTimeout(syncWithCloud, 2000);
            
            // Update cloud sync indicator periodically
            setInterval(updateCloudSyncIndicator, 5000);
        });

        // ==================== EXISTING FUNCTIONS (updated for new features) ====================
        // Note: I'm including only the function signatures here. The full implementations
        // from the previous code should be integrated with the new features above.

        // CLOUD SYNC FUNCTIONS
        async function syncWithCloud() { /* existing implementation */ }
        async function saveToCloud() { /* existing implementation */ }
        function mergeDataWithCloud() { /* existing implementation */ }
        function updateCloudSyncIndicator() { /* existing implementation */ }
        async function forceSyncFromCloud() { /* existing implementation */ }
        async function forceSaveToCloud() { /* existing implementation */ }

        // JSON UPLOAD FUNCTIONS
        function copyJSONTemplate() { /* existing implementation */ }
        function downloadCurrentDocuments() { /* existing implementation */ }
        function handleJSONFileSelect(event) { /* existing implementation */ }
        function validateAndPreviewJSON(data) { /* existing implementation */ }
        function clearJSONFile() { /* existing implementation */ }
        function uploadJSONDocuments() { /* existing implementation */ }
        function completeUpload(added, duplicates, total) { /* existing implementation */ }

        // APP DATA FUNCTIONS
        function loadAppData() { /* existing implementation */ }
        function saveAppData() { /* existing implementation */ }

        // DOCUMENT VIEWER
        function openDocumentViewer(url, title, unitCode, university, year, subject) {
            // Enhanced with screenshot protection
            if (appState.currentUser && appState.currentUser.subscription.active) {
                const endDate = new Date(appState.currentUser.subscription.endDate);
                const now = new Date();
                
                if (endDate < now) {
                    appState.currentUser.subscription.active = false;
                    appState.currentUser.subscription.status = 'expired';
                    saveAppData();
                    updateAccessStatus();
                    
                    showTab('register');
                    showNotification('Subscription Expired', 'Your subscription has expired. Please subscribe again to continue accessing documents.', 'warning');
                    return;
                }
            }
            
            if (!appState.currentUser || !appState.currentUser.subscription.active) {
                showTab('register');
                showNotification('Access Denied', 'Please subscribe to view documents', 'warning');
                return;
            }
            
            // Setup screenshot protection for this document
            setupDocumentProtection();
            
            // Rest of existing implementation...
            document.getElementById('pdfLoading').style.display = 'flex';
            document.getElementById('pdfError').style.display = 'none';
            document.getElementById('pdfViewer').style.display = 'none';
            document.getElementById('pdfViewer').classList.remove('active');
            
            document.getElementById('pdfModalTitle').innerHTML = `<i class="fas fa-file-pdf"></i><span>${title}</span>`;
            
            let embedUrl = url;
            if (url.includes('drive.google.com')) {
                if (!url.includes('/preview')) {
                    const match = url.match(/\/d\/([^\/]+)/) || url.match(/id=([^&]+)/);
                    if (match && match[1]) {
                        embedUrl = `https://drive.google.com/file/d/${match[1]}/preview`;
                    }
                }
                if (embedUrl.includes('preview')) {
                    embedUrl += (embedUrl.includes('?') ? '&' : '?') + 'rm=minimal';
                }
            }
            
            const viewer = document.getElementById('pdfViewer');
            viewer.src = embedUrl;
            
            openModal('pdfModal');
            
            setTimeout(() => {
                if (viewer.src) {
                    document.getElementById('pdfLoading').style.display = 'none';
                    document.getElementById('pdfViewer').style.display = 'block';
                    document.getElementById('pdfViewer').classList.add('active');
                }
            }, 500);
            
            viewer.onerror = function() {
                document.getElementById('pdfLoading').style.display = 'none';
                document.getElementById('pdfError').style.display = 'flex';
                showNotification('Error', 'Could not load document. Please try again.', 'error');
            };
            
            setTimeout(() => {
                if (document.getElementById('pdfLoading').style.display !== 'none') {
                    document.getElementById('pdfLoading').style.display = 'none';
                    document.getElementById('pdfViewer').style.display = 'block';
                    document.getElementById('pdfViewer').classList.add('active');
                }
            }, 2000);
            
            appState.statistics.totalDownloads++;
            saveAppData();
        }

        function setupDocumentProtection() {
            // Additional protection setup for this specific document
            const viewer = document.getElementById('pdfViewer');
            viewer.onload = function() {
                // Try to disable right-click in iframe (limited due to cross-origin restrictions)
                try {
                    viewer.contentDocument.addEventListener('contextmenu', function(e) {
                        e.preventDefault();
                        showScreenshotProtection();
                    });
                } catch (e) {
                    // Cross-origin restrictions may prevent this
                }
            };
        }

        // MODAL FUNCTIONS
        function openModal(modalId) { /* existing implementation */ }
        function closeModal(modalId) { /* existing implementation */ }

        // UTILITY FUNCTIONS
        function copyToClipboard(text) { /* existing implementation */ }
        function updateStatistics() { /* existing implementation */ }
        function checkRegistrationSuccess() { /* existing implementation */ }
        function backupRecentUploads() { /* existing implementation */ }
        function backupAllDocuments() { /* existing implementation */ }
        function showBackupStatus(message, type) { /* existing implementation */ }

        // UNIVERSITY FUNCTIONS
        function initializeUniversities() { /* existing implementation */ }
        function initializeUploadUniversities() { /* existing implementation */ }
        function openUniversityListModal() { /* existing implementation */ }
        function closeUniversityListModal() { /* existing implementation */ }
        function populateUniversityList() { /* existing implementation */ }
        function showUniversityMaterials(university) { /* existing implementation */ }

        // UPLOAD FUNCTIONS
        function sendUploadNotification(upload) { /* existing implementation */ }
        function clearUploadForm() { /* existing implementation */ }

        // LOGIN FUNCTION
        function loginStudent() { /* existing implementation */ }

        // UI FUNCTIONS
        function updateAccessStatus() { /* existing implementation */ }
        function showLoginMessage(message, type) { /* existing implementation */ }

        // ADMIN FUNCTIONS
        function showAdminSection(sectionName) {
            document.querySelectorAll('.admin-section').forEach(section => {
                section.style.display = 'none';
            });
            
            document.getElementById(`${sectionName}Section`).style.display = 'block';
            
            switch(sectionName) {
                case 'pending':
                    loadPendingApprovals();
                    break;
                case 'students':
                    loadAllStudents();
                    break;
                case 'statistics':
                    displayUniversityStatistics();
                    break;
                case 'materials':
                    loadAdminMaterials();
                    break;
                case 'uploads':
                    loadUserUploads();
                    break;
                case 'subscribe':
                    // Initialize university dropdown
                    const manualUniSelect = document.getElementById('manualUserUniversity');
                    if (manualUniSelect) {
                        manualUniSelect.innerHTML = '<option value="">Select University</option>' +
                            UNIVERSITIES.map(uni => `<option value="${uni}">${uni}</option>`).join('');
                    }
                    break;
                case 'backup':
                    if (appState.statistics.lastBackupDate) {
                        const lastBackup = new Date(appState.statistics.lastBackupDate);
                        const backupStatus = document.getElementById('backupStatus');
                        backupStatus.innerHTML = `
                            <div style="color: #065f46;">
                                <i class="fas fa-check-circle"></i> Last backup: ${lastBackup.toLocaleString()}
                            </div>
                        `;
                        backupStatus.style.display = 'block';
                    }
                    break;
                case 'jsonUpload':
                    clearJSONFile();
                    break;
                case 'cloudSync':
                    updateCloudStats();
                    break;
            }
        }

        function adminLogin() { /* existing implementation */ }
        function adminLogout() { /* existing implementation */ }
        function loadPendingApprovals() { /* existing implementation */ }
        function formatTimeAgo(dateString) { /* existing implementation */ }
        function sendApprovalWhatsApp(phone) { /* existing implementation */ }
        function loadUserUploads() { /* existing implementation */ }
        function backupSingleUpload(uploadId) { /* existing implementation */ }
        function approveUpload(uploadId) { /* existing implementation */ }
        function rejectUpload(uploadId) { /* existing implementation */ }
        function notifyUploader(phone, title, status) { /* existing implementation */ }
        function loadAllStudents() { /* existing implementation */ }
        function approveStudent(phone) { /* existing implementation */ }
        function rejectStudent(phone) { /* existing implementation */ }
        function sendUnlockCodeWhatsApp(phone) { /* existing implementation */ }
        function deleteStudent(phone) { /* existing implementation */ }
        function loadAdminMaterials() { /* existing implementation */ }
        function backupSingleDocument(index) { /* existing implementation */ }
        function deleteMaterial(index) { /* existing implementation */ }
        function addNewMaterial() { /* existing implementation */ }

        // UTILITY FUNCTIONS
        function generateUnlockCode() {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
            let code = '';
            for (let i = 0; i < 8; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        function copyAccountNumber() { /* existing implementation */ }
        function copyText(text) { /* existing implementation */ }

        // TAB NAVIGATION
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            
            document.getElementById(tabName).style.display = 'block';
            
            document.querySelectorAll('.bottom-nav .nav-btn').forEach(btn => btn.classList.remove('active'));
            
            const buttons = {
                'home': 0,
                'materials': 1,
                'advertisements': 2,
                'upload': 3,
                'register': 4,
                'admin': 5
            };
            
            if (buttons[tabName] !== undefined) {
                document.querySelectorAll('.bottom-nav .nav-btn')[buttons[tabName]].classList.add('active');
            }
            
            if (tabName === 'login') {
                document.querySelectorAll('.bottom-nav .nav-btn').forEach(btn => btn.classList.remove('active'));
            }
            
            if (tabName !== 'home') {
                document.getElementById('searchInput').value = '';
                document.getElementById('searchResults').classList.remove('active');
                document.getElementById('continueReading').style.display = 'block';
                hideSearchSuggestions();
            }
            
            switch(tabName) {
                case 'home':
                    renderHomeContent();
                    break;
                case 'materials':
                    renderAllMaterials();
                    break;
                case 'advertisements':
                    loadAdvertisements();
                    break;
                case 'upload':
                    document.getElementById('uploadForm').style.display = 'block';
                    document.getElementById('uploadSuccess').style.display = 'none';
                    break;
                case 'admin':
                    document.getElementById('adminPassword').value = '';
                    break;
            }
        }

        // RENDERING FUNCTIONS
        function renderHomeContent() { /* existing implementation */ }
        function renderContinueReading() { /* existing implementation */ }
        function renderAllMaterials() { /* existing implementation */ }
        function renderTrendingMaterials() { /* existing implementation */ }

        // SAMPLE DATA INITIALIZATION
        function initializeSampleData() { /* existing implementation */ }

        // NOTIFICATION SYSTEM
        function showNotification(title, message, type = 'info') { /* existing implementation */ }
        function hideNotification() { /* existing implementation */ }

        // LOGOUT FUNCTION
        function logout() { /* existing implementation */ }

        // REST OF THE FUNCTIONS
        function initializeCategories() { /* existing implementation */ }
        function initializeUnitCodes() {
            const unitCodes = [...new Set(appState.documents.map(doc => formatUnitCode(doc["Unit Code"])))];
            appState.allUnitCodes = unitCodes;
            
            const quickUnits = document.getElementById('quickUnits');
            if (quickUnits) {
                const popularUnits = unitCodes.slice(0, 8);
                quickUnits.innerHTML = popularUnits.map(code => `
                    <div class="unit-chip" onclick="quickSearch('${code}')">
                        ${code}
                    </div>
                `).join('');
            }
        }

        function showSearchSuggestions(query) { /* existing implementation */ }
        function selectUniversitySuggestion(university) { /* existing implementation */ }
        function hideSearchSuggestions() { /* existing implementation */ }
        function selectSuggestion(unitCode) { /* existing implementation */ }
        function quickSearch(unitCode) { /* existing implementation */ }
        function filterMaterials() { /* existing implementation */ }
        function filterAllMaterials() { /* existing implementation */ }
        function filterByCategory(category) { /* existing implementation */ }
        function highlightEmptyFields() { /* existing implementation */ }
        function clearRegistrationForm() { /* existing implementation */ }
        function showRegistrationSuccessBanner() { /* existing implementation */ }
        function showProgressSteps() { /* existing implementation */ }

        // AI CHAT FUNCTIONS
        function openAIChat() { /* existing implementation */ }
        function askAI() { /* existing implementation */ }

        // STATISTICS EXPORT
        function exportStatistics() {
            const stats = calculateUniversityStatistics();
            let exportText = `=== REVISIONVAULT PRO STATISTICS REPORT ===\n`;
            exportText += `Generated: ${new Date().toLocaleString()}\n`;
            exportText += `Total Students: ${appState.users.length}\n`;
            exportText += `Active Subscriptions: ${appState.users.filter(u => u.subscription?.active).length}\n`;
            exportText += `Total Materials: ${appState.documents.length}\n`;
            exportText += `Estimated Revenue: Ksh ${appState.users.length * 67}\n\n`;
            exportText += `=== STUDENTS PER UNIVERSITY ===\n\n`;
            
            Object.entries(stats).sort((a, b) => b[1].totalStudents - a[1].totalStudents).forEach(([uni, data]) => {
                exportText += `${uni}:\n`;
                exportText += `  Total Students: ${data.totalStudents || 0}\n`;
                exportText += `  Active Subscriptions: ${data.activeSubscriptions || 0}\n`;
                exportText += `  Pending Approvals: ${data.pendingApprovals || 0}\n`;
                exportText += `  Total Materials: ${data.totalMaterials || 0}\n\n`;
            });
            
            copyToClipboard(exportText);
            showNotification('Statistics Exported', 'Statistics copied to clipboard', 'success');
        }

        function refreshStatistics() {
            calculateUniversityStatistics();
            displayUniversityStatistics();
            showNotification('Statistics Refreshed', 'University statistics have been updated', 'success');
        }

        // CLOUD SYNC STATS
        function updateCloudStats() {
            const pendingCount = appState.users.filter(u => u.subscription.status === 'pending').length;
            const totalUsers = appState.users.length;
            
            document.getElementById('cloudPendingCount').textContent = pendingCount;
            document.getElementById('cloudTotalUsers').textContent = totalUsers;
        }
    </script>
</body>
</html>