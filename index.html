<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RevisionVault Pro - University Study Materials</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1a2980;
            --secondary: #26d0ce;
            --accent: #ff4081;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --light: #f8fafc;
            --dark: #1e293b;
            --card-bg: #ffffff;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --radius: 16px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 0;
            padding-bottom: 100px;
        }

        /* Fixed Header Container */
        .header-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            padding: 15px 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
        }

        /* Logo Section */
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-shrink: 0;
        }

        .logo-icon {
            background: rgba(255, 255, 255, 0.9);
            width: 45px;
            height: 45px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 22px;
            box-shadow: var(--shadow);
        }

        .logo-text h1 {
            font-size: 22px;
            margin-bottom: 2px;
            font-weight: 800;
            letter-spacing: -0.5px;
            color: white;
        }

        .logo-text p {
            font-size: 12px;
            opacity: 0.9;
            font-weight: 400;
            color: rgba(255, 255, 255, 0.9);
        }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .price-tag, .contact-number {
            background: rgba(255, 255, 255, 0.15);
            padding: 8px 12px;
            border-radius: 8px;
            color: white;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            backdrop-filter: blur(5px);
        }

        /* Search Bar */
        .search-container {
            flex: 1;
            max-width: 600px;
            position: relative;
        }

        .search-box {
            width: 100%;
            padding: 14px 20px;
            padding-left: 45px;
            border: none;
            border-radius: 50px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            color: white;
            font-size: 15px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .search-box::placeholder {
            color: rgba(255, 255, 255, 0.8);
        }

        .search-box:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.25);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.2);
        }

        .search-icon {
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.9);
            font-size: 16px;
        }

        /* Search Suggestions */
        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-top: 8px;
            max-height: 300px;
            overflow-y: auto;
            display: none;
            z-index: 1001;
            border: 2px solid #e2e8f0;
        }

        .search-suggestions.active {
            display: block;
        }

        .suggestion-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 1px solid #e2e8f0;
        }

        .suggestion-item:hover {
            background: #f1f5f9;
        }

        .suggestion-code {
            font-weight: 700;
            color: var(--primary);
            font-size: 14px;
        }

        .suggestion-title {
            font-size: 12px;
            color: #64748b;
            margin-top: 4px;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Main Container */
        .main-container {
            margin-top: 100px;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
            background: white;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            min-height: calc(100vh - 180px);
        }

        /* Main Layout */
        .main-layout {
            display: grid;
            grid-template-columns: 280px 1fr 320px;
            min-height: 600px;
        }

        /* Left Sidebar */
        .sidebar-left {
            background: var(--light);
            padding: 25px 20px;
            border-right: 1px solid #e2e8f0;
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 16px;
            font-weight: 700;
        }

        .tools-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 25px;
        }

        .tool-card {
            background: var(--card-bg);
            padding: 18px 12px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tool-card:hover {
            transform: translateY(-3px);
            border-color: var(--primary);
            box-shadow: var(--shadow);
        }

        .tool-icon {
            font-size: 22px;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .tool-name {
            font-size: 12px;
            font-weight: 700;
            color: var(--dark);
        }

        .timetable {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            border: 2px solid #e2e8f0;
        }

        .week-display {
            font-size: 20px;
            font-weight: 800;
            color: var(--primary);
            text-align: center;
            margin-bottom: 5px;
        }

        .date-range {
            color: #64748b;
            text-align: center;
            margin-bottom: 15px;
            font-size: 13px;
        }

        .schedule-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            text-align: center;
        }

        .schedule-item {
            padding: 10px;
            background: #f1f5f9;
            border-radius: 8px;
        }

        .time {
            font-weight: 700;
            color: var(--primary);
            font-size: 12px;
        }

        .subject {
            font-size: 11px;
            color: #64748b;
            margin-top: 4px;
        }

        .ai-chat-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, var(--accent), #f50057);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 800;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 25px;
            transition: all 0.3s;
        }

        .ai-chat-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(255, 64, 129, 0.3);
        }

        /* Main Content */
        .main-content {
            padding: 25px;
            background: white;
            overflow-y: auto;
            height: calc(100vh - 180px);
        }

        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .main-title {
            font-size: 24px;
            color: var(--primary);
            font-weight: 800;
        }

        .filters {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .filter-select {
            padding: 10px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            background: white;
            color: var(--dark);
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 140px;
        }

        /* Registration Success Banner */
        .registration-success-banner {
            background: linear-gradient(135deg, #d1fae5, #a7f3d0);
            border: 3px solid var(--success);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            display: none;
            flex-direction: column;
            align-items: center;
            text-align: center;
            animation: fadeIn 0.5s ease-out;
        }

        .registration-success-banner.active {
            display: flex;
        }

        /* Access Status */
        .access-status {
            background: linear-gradient(135deg, #ffeaea, #ffc9c9);
            border: 3px solid var(--danger);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
        }

        .access-granted {
            background: linear-gradient(135deg, #d1fae5, #a7f3d0);
            border-color: var(--success);
        }

        /* Quick Unit Codes */
        .quick-units {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .unit-chip {
            background: #e0f2fe;
            color: var(--primary);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .unit-chip:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        /* Search Results */
        .search-results {
            display: none;
            margin-top: 20px;
        }

        .search-results.active {
            display: block;
        }

        /* Materials Grid */
        .materials-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 35px;
        }

        .material-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            overflow: hidden;
            border: 2px solid #e2e8f0;
            transition: all 0.3s;
            position: relative;
        }

        .material-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
            border-color: var(--primary);
        }

        .material-badge {
            position: absolute;
            top: 12px;
            left: 12px;
            background: linear-gradient(135deg, var(--accent), #f50057);
            color: white;
            padding: 6px 14px;
            border-radius: 50px;
            font-size: 10px;
            font-weight: 800;
            letter-spacing: 1px;
            z-index: 1;
        }

        .material-badge.trending {
            background: linear-gradient(135deg, var(--warning), #f97316);
        }

        .material-badge.recent {
            background: linear-gradient(135deg, var(--success), #059669);
        }

        .material-image {
            height: 160px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.2);
            font-size: 60px;
            position: relative;
        }

        .material-content {
            padding: 20px;
        }

        .material-title {
            font-size: 16px;
            font-weight: 800;
            color: var(--dark);
            margin-bottom: 12px;
            line-height: 1.4;
        }

        .material-meta {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .material-code {
            background: #e0f2fe;
            padding: 5px 12px;
            border-radius: 50px;
            color: var(--primary);
            font-weight: 800;
            font-size: 12px;
        }

        .material-year {
            background: #fee2e2;
            padding: 5px 12px;
            border-radius: 50px;
            color: var(--danger);
            font-weight: 800;
            font-size: 12px;
        }

        .material-info {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #64748b;
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 12px;
        }

        .material-description {
            color: #64748b;
            font-size: 13px;
            line-height: 1.5;
            margin-bottom: 18px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .material-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            font-size: 13px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: all 0.3s;
        }

        .action-btn:hover {
            transform: translateY(-2px);
        }

        .view-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .view-btn:hover {
            box-shadow: 0 5px 15px rgba(26, 41, 128, 0.3);
        }

        .preview-btn {
            background: #f1f5f9;
            color: var(--dark);
            border: 2px solid #e2e8f0;
        }

        /* Right Sidebar */
        .sidebar-right {
            background: var(--light);
            padding: 25px 20px;
            border-left: 1px solid #e2e8f0;
            height: calc(100vh - 180px);
            overflow-y: auto;
        }

        .category-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 16px;
            background: var(--card-bg);
            border-radius: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            border: 2px solid #e2e8f0;
            transition: all 0.3s;
        }

        .category-item:hover {
            border-color: var(--primary);
            transform: translateX(5px);
        }

        .category-name {
            font-weight: 700;
            color: var(--dark);
            font-size: 13px;
        }

        .category-count {
            background: #e0f2fe;
            padding: 3px 10px;
            border-radius: 50px;
            font-size: 11px;
            font-weight: 800;
            color: var(--primary);
        }

        .university-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .university-card {
            background: var(--card-bg);
            padding: 15px 10px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.3s;
        }

        .university-card:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
        }

        .university-logo {
            width: 35px;
            height: 35px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 8px;
            font-weight: 800;
            font-size: 14px;
        }

        .premium-banner {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            padding: 20px;
            border-radius: var(--radius);
            text-align: center;
            margin-top: 25px;
            box-shadow: var(--shadow);
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            border-radius: 50px;
            padding: 12px 25px;
            display: flex;
            gap: 10px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.25);
            z-index: 1000;
            border: 2px solid #e2e8f0;
            min-width: 580px;
            justify-content: space-around;
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
        }

        .nav-btn {
            background: none;
            border: none;
            padding: 12px 18px;
            border-radius: 30px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            font-size: 13px;
            color: #64748b;
            transition: all 0.3s;
            min-width: 90px;
            justify-content: center;
        }

        .nav-btn:hover {
            background: #f1f5f9;
        }

        .nav-btn.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 8px 20px rgba(26, 41, 128, 0.3);
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 15px;
            color: #64748b;
            border-top: 1px solid #e2e8f0;
            background: var(--light);
            font-size: 13px;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
            font-size: 14px;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(26, 41, 128, 0.1);
        }

        .submit-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(26, 41, 128, 0.3);
        }

        /* University Button */
        .university-browse-btn {
            background: linear-gradient(135deg, #7c3aed, #6d28d9);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
            box-shadow: 0 6px 20px rgba(124, 58, 237, 0.3);
        }

        .university-browse-btn.small {
            padding: 10px 20px;
            font-size: 14px;
        }

        /* Upload Button */
        .upload-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.3);
        }

        .upload-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.4);
            background: linear-gradient(135deg, #059669, #047857);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            padding: 0;
        }

        .modal.active {
            display: block;
            animation: fadeIn 0.2s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: transparent;
            border-radius: 0;
            width: 100%;
            height: 100vh;
            overflow: hidden;
            box-shadow: none;
        }

        .modal-header {
            background: rgba(0, 0, 0, 0.95);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 10;
            height: 60px;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-title {
            font-size: 18px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 70%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .close-modal {
            background: rgba(255, 255, 255, 0.15);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .close-modal:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        .modal-body {
            padding: 0;
            margin: 0;
            height: 100vh;
            position: relative;
            padding-top: 60px;
        }

        .pdf-viewer-container {
            width: 100%;
            height: 100%;
            position: relative;
            background: #000;
        }

        .pdf-viewer-frame {
            width: 100%;
            height: 100%;
            border: none;
            display: none;
            background: white;
        }

        .pdf-viewer-frame.active {
            display: block;
        }

        /* Advertisements Styles */
        .advertisement-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .advertisement-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none" opacity="0.1"><path d="M0,0 L100,0 L100,100 Z" fill="white"/></svg>');
            background-size: cover;
        }

        .advertisement-content {
            position: relative;
            z-index: 1;
        }

        .advertisement-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .advertisement-description {
            font-size: 16px;
            margin-bottom: 20px;
            opacity: 0.9;
        }

        .advertisement-cta {
            background: white;
            color: #667eea;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .advertisement-cta:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .ad-close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255,255,255,0.2);
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            z-index: 2;
        }

        /* Advertisement Tab Styles */
        .advertisements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .advertisement-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid #e2e8f0;
            transition: all 0.3s;
        }

        .advertisement-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
        }

        .advertisement-image {
            height: 150px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 40px;
        }

        .advertisement-details {
            padding: 20px;
        }

        .advertisement-card-title {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .advertisement-card-description {
            color: #64748b;
            font-size: 14px;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .advertisement-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e2e8f0;
        }

        .advertisement-type {
            background: #e0f2fe;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            color: var(--primary);
        }

        .advertisement-cta-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .advertisement-cta-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        /* Progress Steps */
        .progress-steps {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 30px 0;
            position: relative;
        }

        .progress-steps::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 3px;
            background: #e2e8f0;
            z-index: 1;
        }

        .progress-step {
            position: relative;
            z-index: 2;
            text-align: center;
            flex: 1;
        }

        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: 3px solid #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-weight: bold;
            color: #64748b;
        }

        .step-circle.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .step-label {
            font-size: 12px;
            color: #64748b;
            font-weight: 600;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 120px;
            right: 20px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            display: none;
            z-index: 2001;
            max-width: 300px;
            border-left: 5px solid var(--success);
            transform: translateX(400px);
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .notification.show {
            display: block;
            transform: translateX(0);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
            .sidebar-left, .sidebar-right {
                display: none;
            }
            .main-content {
                height: auto;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 10px;
                padding: 10px;
            }
            
            .search-container {
                width: 100%;
                max-width: 100%;
            }
            
            .main-container {
                margin-top: 140px;
            }
            
            .bottom-nav {
                bottom: 30px;
                min-width: 95%;
                padding: 10px 15px;
                gap: 5px;
            }
            
            .nav-btn {
                min-width: auto;
                padding: 10px 12px;
                font-size: 11px;
            }
            
            .nav-btn span {
                display: none;
            }
            
            .materials-grid {
                grid-template-columns: 1fr;
            }
        }

        /* NEW: University Statistics Styles */
        .university-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .university-stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #e2e8f0;
            box-shadow: var(--shadow);
            transition: all 0.3s;
        }

        .university-stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .university-stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .university-name {
            font-size: 18px;
            font-weight: 800;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .student-count {
            font-size: 32px;
            font-weight: 900;
            color: var(--primary);
            text-align: center;
            margin: 10px 0;
        }

        .count-label {
            font-size: 14px;
            color: #64748b;
            text-align: center;
            margin-bottom: 15px;
        }

        .stat-details {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #64748b;
            border-top: 1px solid #e2e8f0;
            padding-top: 15px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-weight: 800;
            color: var(--primary);
            font-size: 16px;
        }

        .stat-label {
            font-size: 11px;
            margin-top: 3px;
        }

        /* NEW: User Advertisement Form */
        .user-ad-form {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border: 2px solid #e2e8f0;
            box-shadow: var(--shadow);
        }

        .ad-preview {
            border: 2px dashed #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
            display: none;
        }

        .ad-preview.active {
            display: block;
        }

        .ad-preview-image {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        /* NEW: Enhanced Admin Panel Styles */
        .admin-section {
            margin-top: 20px;
        }

        .admin-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .admin-list-item {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stats-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .summary-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 2px solid #e2e8f0;
        }

        .summary-number {
            font-size: 36px;
            font-weight: 900;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .summary-label {
            font-size: 14px;
            color: #64748b;
        }

        .stats-table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        .stats-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .stats-table th {
            background: var(--primary);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .stats-table td {
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
        }

        .stats-table tr:hover {
            background: #f8fafc;
        }

        .university-rank {
            display: inline-block;
            width: 30px;
            height: 30px;
            background: #e0f2fe;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            font-weight: 800;
            color: var(--primary);
            margin-right: 10px;
        }

        /* NEW: User Advertisement Item */
        .user-ad-item {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border: 2px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-ad-info h4 {
            color: var(--primary);
            margin-bottom: 5px;
        }

        .user-ad-meta {
            font-size: 12px;
            color: #64748b;
            display: flex;
            gap: 15px;
        }

        .upload-status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            margin-left: 10px;
        }

        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .status-approved {
            background: #d1fae5;
            color: #065f46;
        }

        .status-rejected {
            background: #fee2e2;
            color: #991b1b;
        }

        /* NEW: Document Security Notice */
        .document-security-notice {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 100;
        }

        .security-text {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* NEW: User Ad Button in Sidebar */
        .user-ad-btn {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
            width: 100%;
            margin-top: 10px;
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.3);
        }

        .user-ad-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(139, 92, 246, 0.4);
        }
    </style>
</head>
<body>
    <!-- Fixed Header -->
    <div class="header-container">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <div class="logo-text">
                    <h1>RevisionVault Pro</h1>
                    <p>University Study Materials Platform</p>
                </div>
            </div>
            
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-box" placeholder="Search by Unit Code e.g AGRO 222 or agro222" id="searchInput">
                <div class="search-suggestions" id="searchSuggestions"></div>
            </div>
            
            <div class="header-actions">
                <div class="price-tag">
                    <i class="fas fa-crown"></i>
                    <span>Ksh 67 for 5 Months</span>
                </div>
                <div class="contact-number">
                    <i class="fas fa-phone-alt"></i>
                    <span>0765 098 865</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <div class="main-layout">
            <!-- Left Sidebar -->
            <aside class="sidebar-left">
                <div class="section-title">
                    <i class="fas fa-tools"></i>
                    <span>POWERFUL Study Tools</span>
                </div>
                <div class="tools-grid">
                    <div class="tool-card" onclick="showNotification('StudyList', 'StudyList feature coming soon!')">
                        <div class="tool-icon"><i class="fas fa-list"></i></div>
                        <div class="tool-name">STUDYLIST</div>
                    </div>
                    <div class="tool-card" onclick="showNotification('Reminders', 'Reminders feature coming soon!')">
                        <div class="tool-icon"><i class="fas fa-bell"></i></div>
                        <div class="tool-name">REMINDERS</div>
                    </div>
                    <div class="tool-card" onclick="showNotification('Notes', 'Notes feature coming soon!')">
                        <div class="tool-icon"><i class="fas fa-sticky-note"></i></div>
                        <div class="tool-name">NOTES</div>
                    </div>
                    <div class="tool-card" onclick="showNotification('Tests', 'Tests feature coming soon!')">
                        <div class="tool-icon"><i class="fas fa-file-alt"></i></div>
                        <div class="tool-name">TESTS</div>
                    </div>
                    <div class="tool-card" onclick="showNotification('Downloads', 'Downloads feature coming soon!')">
                        <div class="tool-icon"><i class="fas fa-download"></i></div>
                        <div class="tool-name">DOWNLOADS</div>
                    </div>
                    <div class="tool-card" onclick="showNotification('Progress', 'Progress tracking coming soon!')">
                        <div class="tool-icon"><i class="fas fa-chart-line"></i></div>
                        <div class="tool-name">PROGRESS</div>
                    </div>
                </div>

                <div class="timetable">
                    <div class="section-title">
                        <i class="fas fa-calendar-alt"></i>
                        <span>My Timetable</span>
                    </div>
                    <div class="week-display">Week 24</div>
                    <div class="date-range">Mon, June 10 - Fri, June 14</div>
                    <div class="schedule-grid">
                        <div class="schedule-item">
                            <div class="time">9:00 AM</div>
                            <div class="subject">AGRO 222</div>
                        </div>
                        <div class="schedule-item">
                            <div class="time">11:00 AM</div>
                            <div class="subject">BOTA 241</div>
                        </div>
                        <div class="schedule-item">
                            <div class="time">2:00 PM</div>
                            <div class="subject">ZOOL 210</div>
                        </div>
                    </div>
                </div>

                <button class="ai-chat-btn" onclick="openAIChat()">
                    <i class="fas fa-robot"></i>
                    AI CHAT
                    <span>ESSAYS | RESEARCH | ASSIGNMENTS</span>
                </button>
            </aside>

            <!-- Main Content -->
            <main class="main-content">
                <!-- Home Tab -->
                <div id="home" class="tab-content active">
                    <div class="content-header">
                        <h1 class="main-title">Continue Reading</h1>
                        <div class="filters">
                            <select class="filter-select" onchange="filterMaterials()" id="universityFilter">
                                <option value="all">All Universities</option>
                            </select>
                            <select class="filter-select" onchange="filterMaterials()" id="yearFilter">
                                <option value="all">All Years</option>
                                <option value="1">Year 1</option>
                                <option value="2">Year 2</option>
                                <option value="3">Year 3</option>
                                <option value="4">Year 4</option>
                            </select>
                        </div>
                    </div>

                    <!-- Advertisement Banner -->
                    <div class="advertisement-container" id="mainAdvertisement">
                        <button class="ad-close-btn" onclick="closeAd('mainAdvertisement')">
                            <i class="fas fa-times"></i>
                        </button>
                        <div class="advertisement-content">
                            <h2 class="advertisement-title">ðŸŽ“ Need Extra Cash?</h2>
                            <p class="advertisement-description">Earn money by sharing RevisionVault with your classmates! Get 20% commission for every successful referral.</p>
                            <button class="advertisement-cta" onclick="openAdDetails(1)">Learn More</button>
                        </div>
                    </div>

                    <div class="quick-units" id="quickUnits"></div>

                    <div id="accessStatus" class="access-status">
                        <div class="access-text">
                            <h3><i class="fas fa-lock"></i> Access Locked</h3>
                            <p>Subscribe to unlock all study materials and features</p>
                        </div>
                        <button class="view-btn" onclick="showTab('register')" style="width: auto; padding: 10px 20px;">
                            <i class="fas fa-crown"></i> Subscribe Now
                        </button>
                    </div>

                    <!-- Registration Success Banner -->
                    <div id="registrationSuccessBanner" class="registration-success-banner">
                        <div style="text-align: center; width: 100%;">
                            <h3><i class="fas fa-check-circle"></i> Registration Successful!</h3>
                            <p>Your registration has been submitted. Admin will send you an unlock code via WhatsApp and Email.</p>
                            <p style="margin-bottom: 20px; font-weight: 600;">You can browse universities while waiting:</p>
                            
                            <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                                <button class="university-browse-btn small" onclick="openUniversityListModal()">
                                    <i class="fas fa-university"></i> Browse Universities
                                </button>
                                <button class="university-browse-btn small" onclick="showTab('login')" style="background: linear-gradient(135deg, #10b981, #059669);">
                                    <i class="fas fa-sign-in-alt"></i> Go to Login
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="search-results" id="searchResults">
                        <h2 class="search-results-title" id="searchResultsTitle"></h2>
                        <div class="materials-grid" id="searchResultsGrid"></div>
                    </div>

                    <div id="continueReading">
                        <div class="materials-grid" id="continueReadingGrid"></div>

                        <div class="section-divider" style="margin: 30px 0 25px; display: flex; align-items: center; gap: 15px;">
                            <div class="divider-line" style="flex: 1; height: 2px; background: linear-gradient(90deg, transparent, #e2e8f0, transparent);"></div>
                            <h2 style="font-size: 20px; color: var(--primary); font-weight: 800; white-space: nowrap;">Trending Materials</h2>
                            <div class="divider-line" style="flex: 1; height: 2px; background: linear-gradient(90deg, transparent, #e2e8f0, transparent);"></div>
                        </div>

                        <div class="materials-grid" id="trendingGrid"></div>
                    </div>
                </div>

                <!-- Materials Tab -->
                <div id="materials" class="tab-content">
                    <div class="content-header">
                        <h1 class="main-title">All Study Materials</h1>
                        <div class="filters">
                            <select class="filter-select" onchange="filterAllMaterials()" id="allUniversityFilter">
                                <option value="all">All Universities</option>
                            </select>
                            <select class="filter-select" onchange="filterAllMaterials()" id="allSubjectFilter">
                                <option value="all">All Subjects</option>
                            </select>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 25px;">
                        <button class="university-browse-btn" onclick="openUniversityListModal()">
                            <i class="fas fa-university"></i> BROWSE BY UNIVERSITY
                        </button>
                    </div>
                    
                    <div class="materials-grid" id="allMaterialsGrid"></div>
                </div>

                <!-- Advertisements Tab -->
                <div id="advertisements" class="tab-content">
                    <div class="content-header">
                        <h1 class="main-title">Advertisements & Promotions</h1>
                    </div>
                    
                    <!-- User Advertisement Upload Button -->
                    <div style="margin-bottom: 25px; text-align: center;">
                        <button class="upload-btn" onclick="openUserAdUpload()" style="width: 100%; background: linear-gradient(135deg, #8b5cf6, #7c3aed);">
                            <i class="fas fa-bullhorn"></i> UPLOAD YOUR ADVERTISEMENT
                        </button>
                        <p style="color: #64748b; font-size: 14px; margin-top: 10px;">
                            Promote your business, service, or event to thousands of university students
                        </p>
                    </div>
                    
                    <div class="advertisement-container">
                        <div class="advertisement-content">
                            <h2 class="advertisement-title">ðŸ“¢ Special Offer!</h2>
                            <p class="advertisement-description">Get 3 months FREE when you refer 5 friends to RevisionVault Pro. Limited time offer!</p>
                            <button class="advertisement-cta" onclick="openAdDetails(2)">Claim Offer</button>
                        </div>
                    </div>
                    
                    <div class="advertisements-grid" id="advertisementsGrid">
                        <!-- Ads will be loaded here -->
                    </div>
                    
                    <div style="text-align: center; margin-top: 30px; padding: 20px; border: 2px dashed #e2e8f0; border-radius: 10px;">
                        <h3 style="color: var(--primary); margin-bottom: 10px;">
                            <i class="fas fa-bullhorn"></i> Want to Advertise Here?
                        </h3>
                        <p style="color: #64748b; margin-bottom: 15px;">Contact us to place your advertisement and reach thousands of university students.</p>
                        <button class="university-browse-btn small" onclick="openUserAdUpload()">
                            <i class="fas fa-upload"></i> Upload Advertisement
                        </button>
                    </div>
                </div>

                <!-- Register Tab -->
                <div id="register" class="tab-content">
                    <div class="content-header">
                        <h1 class="main-title">Student Registration</h1>
                    </div>
                    
                    <!-- Progress Steps -->
                    <div class="progress-steps">
                        <div class="progress-step">
                            <div class="step-circle active">1</div>
                            <div class="step-label">Fill Form</div>
                        </div>
                        <div class="progress-step">
                            <div class="step-circle">2</div>
                            <div class="step-label">Make Payment</div>
                        </div>
                        <div class="progress-step">
                            <div class="step-circle">3</div>
                            <div class="step-label">Get Code</div>
                        </div>
                        <div class="progress-step">
                            <div class="step-circle">4</div>
                            <div class="step-label">Browse</div>
                        </div>
                    </div>

                    <!-- Advertisement Banner in Registration -->
                    <div class="advertisement-container" style="margin-bottom: 25px;">
                        <div class="advertisement-content">
                            <h2 class="advertisement-title">ðŸŽ‰ Special Welcome Offer!</h2>
                            <p class="advertisement-description">First 100 registrations get 6 months instead of 5! Limited slots available.</p>
                        </div>
                    </div>

                    <!-- Registration Form -->
                    <div id="registrationForm">
                        <div class="form-group">
                            <label class="form-label">Full Name</label>
                            <input type="text" class="form-input" id="studentName" placeholder="Enter your full name">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Email Address</label>
                            <input type="email" class="form-input" id="studentEmail" placeholder="your.email@gmail.com">
                            <small style="color: #6c757d; font-size: 12px;">Unlock code will be sent to this email</small>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Phone Number (WhatsApp)</label>
                            <input type="tel" class="form-input" id="studentPhone" placeholder="07XXXXXXXX">
                            <small style="color: #6c757d; font-size: 12px;">This number will be used for WhatsApp verification</small>
                        </div>

                        <div class="form-group">
                            <label class="form-label">University</label>
                            <select class="form-select" id="studentUniversity">
                                <option value="">Select University</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Course/Program</label>
                            <input type="text" class="form-input" id="studentCourse" placeholder="e.g., BSc Agriculture">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Year of Study</label>
                            <select class="form-select" id="studentYear">
                                <option value="">Select Year</option>
                                <option value="1">Year 1</option>
                                <option value="2">Year 2</option>
                                <option value="3">Year 3</option>
                                <option value="4">Year 4</option>
                            </select>
                        </div>

                        <!-- Payment Instructions -->
                        <div class="payment-instructions" style="background: #e8f5e9; border: 3px solid #4caf50; border-radius: 15px; padding: 20px; margin: 20px 0;">
                            <h3 style="color: #4caf50; margin-bottom: 15px;">ðŸ’³ M-Pesa Payment Instructions</h3>
                            
                            <!-- Fixed Payment Account Number -->
                            <div style="background: #fef3c7; border: 3px solid #f59e0b; border-radius: 10px; padding: 20px; margin: 20px 0; text-align: center;">
                                <h3 style="color: #92400e; margin-bottom: 10px;">
                                    <i class="fas fa-copy"></i> Fixed Payment Account Number
                                </h3>
                                <div style="font-size: 24px; font-weight: bold; color: #92400e; letter-spacing: 2px; margin: 10px 0;">
                                    0330184468200
                                </div>
                                <button class="copy-btn" onclick="copyAccountNumber()" style="margin: 10px auto; display: block; padding: 10px 20px; background: #f59e0b; color: white; border: none; border-radius: 6px; cursor: pointer;">
                                    <i class="fas fa-copy"></i> Copy Account Number
                                </button>
                                <p style="font-size: 12px; color: #92400e; margin-top: 10px;">
                                    Copy this account number for M-Pesa payment
                                </p>
                            </div>
                            
                            <div style="text-align: center; margin: 20px 0;">
                                <div style="font-size: 14px; color: #6c757d; margin-bottom: 5px;">Amount</div>
                                <div style="font-size: 32px; font-weight: bold; color: #4caf50;">Ksh 67</div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">M-Pesa Transaction Code</label>
                            <input type="text" class="form-input" id="paymentCode" placeholder="Enter transaction code (e.g., SDF45G7H)">
                        </div>

                        <div class="whatsapp-notice" style="background: #e3f2fd; border: 2px solid #2196f3; border-radius: 10px; padding: 15px; text-align: center; margin: 20px 0;">
                            <i class="fab fa-whatsapp" style="color: #25d366; font-size: 24px; margin-bottom: 10px;"></i>
                            <p><strong>WhatsApp & Email Notification</strong></p>
                            <p style="font-size: 13px;">After submitting, admin will be notified via WhatsApp and Email. Unlock code will be sent to both your WhatsApp and Email.</p>
                        </div>

                        <button class="submit-btn" onclick="registerStudent()">
                            <i class="fas fa-paper-plane"></i> SUBMIT REGISTRATION & PAYMENT
                        </button>

                        <!-- UNLOCK CODE BUTTON -->
                        <div style="text-align: center; margin-top: 25px; padding: 20px; border: 2px dashed #e2e8f0; border-radius: 10px;">
                            <h3 style="color: var(--primary); margin-bottom: 10px;">
                                <i class="fas fa-key"></i> Already Have an Unlock Code?
                            </h3>
                            <p style="color: #64748b; margin-bottom: 15px;">If you've already received your unlock code from admin, click below to activate your account</p>
                            <button class="university-browse-btn small" onclick="showTab('login')" style="width: 100%;">
                                <i class="fas fa-unlock"></i> ENTER UNLOCK CODE & ACTIVATE
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Login Tab -->
                <div id="login" class="tab-content">
                    <div class="content-header">
                        <h1 class="main-title">Student Login</h1>
                    </div>
                    
                    <!-- University Browse Button at Top -->
                    <div style="margin-bottom: 25px;">
                        <button class="university-browse-btn small" onclick="openUniversityListModal()">
                            <i class="fas fa-university"></i> BROWSE UNIVERSITIES
                        </button>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Phone Number or Email</label>
                        <input type="text" class="form-input" id="loginPhone" placeholder="07XXXXXXXX or your.email@gmail.com">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Unlock Code (From Admin)</label>
                        <input type="text" class="form-input" id="unlockCode" placeholder="Enter unlock code from WhatsApp/Email">
                        <small style="color: #6c757d; font-size: 12px;">Required for first-time activation only</small>
                    </div>

                    <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                        <button class="submit-btn" onclick="loginStudent()" style="flex: 2;">
                            <i class="fas fa-sign-in-alt"></i> LOGIN & ACTIVATE
                        </button>
                        <button class="university-browse-btn small" onclick="openUniversityListModal()" style="flex: 1;">
                            <i class="fas fa-university"></i> Browse
                        </button>
                    </div>

                    <div id="loginMessage" style="margin-top: 20px; padding: 15px; border-radius: 8px; display: none;"></div>
                </div>

                <!-- Upload Tab -->
                <div id="upload" class="tab-content">
                    <div class="content-header">
                        <h1 class="main-title">Upload Study Materials</h1>
                    </div>

                    <!-- Upload Instructions -->
                    <div class="upload-instructions" style="background: #f0f9ff; border: 2px solid #e2e8f0; border-radius: 10px; padding: 20px; margin-bottom: 25px;">
                        <h3 style="color: var(--primary); margin-bottom: 15px;"><i class="fas fa-info-circle"></i> How to Upload Materials</h3>
                        
                        <div style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #e2e8f0;">
                            <h4 style="color: var(--dark); margin-bottom: 5px;">For Pictures, Videos, or Any Files:</h4>
                            <p style="color: #64748b; font-size: 14px; line-height: 1.5;">
                                1. Upload your file to Google Drive<br>
                                2. Right-click on the file â†’ "Share" â†’ Change to "Anyone with the link"<br>
                                3. Copy the shareable link<br>
                                4. Convert to direct link format:<br>
                                &nbsp;&nbsp;<code style="background: #e2e8f0; padding: 2px 5px; border-radius: 4px;">https://drive.google.com/file/d/FILE_ID/preview</code>
                            </p>
                        </div>
                    </div>

                    <!-- Upload Form -->
                    <div id="uploadForm">
                        <div class="form-group">
                            <label class="form-label">Document Title</label>
                            <input type="text" class="form-input" id="uploadTitle" placeholder="e.g., Plant Breeding Notes">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Unit Code</label>
                            <input type="text" class="form-input" id="uploadUnitCode" placeholder="e.g., AGRO 222">
                        </div>

                        <div class="form-group">
                            <label class="form-label">University</label>
                            <select class="form-select" id="uploadUniversity">
                                <option value="">Select University</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Subject/Category</label>
                            <input type="text" class="form-input" id="uploadSubject" placeholder="e.g., Agronomy">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Year of Study</label>
                            <select class="form-select" id="uploadYear">
                                <option value="">Select Year</option>
                                <option value="1">Year 1</option>
                                <option value="2">Year 2</option>
                                <option value="3">Year 3</option>
                                <option value="4">Year 4</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Description</label>
                            <textarea class="form-input" id="uploadDescription" placeholder="Brief description of the material" rows="3"></textarea>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Google Drive Direct Link</label>
                            <input type="url" class="form-input" id="uploadURL" placeholder="https://drive.google.com/file/d/.../preview">
                            <small style="color: #6c757d; font-size: 12px;">Must end with /preview (for pictures, videos, PDFs, etc.)</small>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Your Phone Number (for notification)</label>
                            <input type="tel" class="form-input" id="uploaderPhone" placeholder="07XXXXXXXX">
                        </div>

                        <button class="upload-btn" onclick="uploadMaterial()">
                            <i class="fas fa-upload"></i> SUBMIT FOR REVIEW
                        </button>
                    </div>

                    <!-- Upload Success Message -->
                    <div id="uploadSuccess" style="display: none; background: #d1fae5; border: 2px solid #10b981; border-radius: 10px; padding: 25px; text-align: center; margin-top: 20px;">
                        <div style="font-size: 48px; color: #10b981; margin-bottom: 15px;">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <h3 style="color: #065f46; margin-bottom: 10px;">Upload Submitted Successfully!</h3>
                        <p style="color: #047857; margin-bottom: 20px;">Your material has been submitted for admin review. You'll receive a WhatsApp notification once it's approved.</p>
                        <button class="upload-btn" onclick="showTab('materials')">
                            <i class="fas fa-book"></i> Browse Other Materials
                        </button>
                    </div>
                </div>

                <!-- Admin Tab -->
                <div id="admin" class="tab-content">
                    <div class="content-header">
                        <h1 class="main-title">Admin Control Panel</h1>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Admin Password</label>
                        <input type="password" class="form-input" id="adminPassword" placeholder="Enter admin password">
                    </div>

                    <button class="submit-btn" onclick="adminLogin()">
                        <i class="fas fa-sign-in-alt"></i> LOGIN AS ADMIN
                    </button>

                    <div id="adminPanel" style="display: none; margin-top: 30px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h2 style="color: var(--primary);">Welcome, Admin!</h2>
                            <button style="background: #ef4444; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;" onclick="adminLogout()">
                                <i class="fas fa-sign-out-alt"></i> Logout Admin
                            </button>
                        </div>

                        <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                            <button class="nav-btn" onclick="showAdminSection('pending')">Pending Approvals</button>
                            <button class="nav-btn" onclick="showAdminSection('students')">All Students</button>
                            <button class="nav-btn" onclick="showAdminSection('uploads')">User Uploads</button>
                            <button class="nav-btn" onclick="showAdminSection('userAds')">User Ads</button>
                            <button class="nav-btn" onclick="showAdminSection('statistics')">University Stats</button>
                        </div>

                        <div id="pendingSection" class="admin-section" style="display: none;">
                            <h3 style="color: var(--primary); margin-bottom: 15px;">ðŸ“‹ Pending Subscriptions</h3>
                            <div class="admin-list" id="pendingList"></div>
                        </div>

                        <div id="studentsSection" class="admin-section" style="display: none;">
                            <h3 style="color: var(--primary); margin-bottom: 15px;">ðŸ‘¥ All Registered Students</h3>
                            <div class="admin-list" id="studentList"></div>
                        </div>

                        <div id="uploadsSection" class="admin-section" style="display: none;">
                            <h3 style="color: var(--primary); margin-bottom: 15px;">ðŸ“¤ User Uploads Pending Review</h3>
                            <div class="admin-list" id="userUploadsList"></div>
                        </div>

                        <div id="userAdsSection" class="admin-section" style="display: none;">
                            <h3 style="color: var(--primary); margin-bottom: 15px;">ðŸ“¢ User Advertisements Pending Review</h3>
                            <div class="admin-list" id="userAdsList"></div>
                        </div>

                        <!-- NEW: University Statistics Section -->
                        <div id="statisticsSection" class="admin-section" style="display: none;">
                            <h3 style="color: var(--primary); margin-bottom: 15px;">ðŸ“Š University Statistics</h3>
                            
                            <!-- Summary Cards -->
                            <div class="stats-summary">
                                <div class="summary-card">
                                    <div class="summary-number" id="totalStudents">0</div>
                                    <div class="summary-label">Total Approved Students</div>
                                </div>
                                <div class="summary-card">
                                    <div class="summary-number" id="totalUniversities">0</div>
                                    <div class="summary-label">Universities Represented</div>
                                </div>
                                <div class="summary-card">
                                    <div class="summary-number" id="pendingStudents">0</div>
                                    <div class="summary-label">Pending Approvals</div>
                                </div>
                                <div class="summary-card">
                                    <div class="summary-number">Ksh 67</div>
                                    <div class="summary-label">Subscription Fee</div>
                                </div>
                            </div>

                            <!-- Statistics Table -->
                            <div class="stats-table-container">
                                <h4 style="color: var(--dark); margin: 25px 0 15px 0;">ðŸ“ˆ Approved Students per University</h4>
                                <table class="stats-table">
                                    <thead>
                                        <tr>
                                            <th>Rank</th>
                                            <th>University</th>
                                            <th>Approved Students</th>
                                            <th>Pending</th>
                                            <th>Total</th>
                                            <th>% of Total</th>
                                        </tr>
                                    </thead>
                                    <tbody id="universityStatsTable">
                                        <!-- Data will be populated here -->
                                    </tbody>
                                </table>
                            </div>

                            <!-- University Cards View -->
                            <h4 style="color: var(--dark); margin: 30px 0 15px 0;">ðŸ« University Overview</h4>
                            <div class="university-stats-grid" id="universityStatsGrid">
                                <!-- University cards will be populated here -->
                            </div>

                            <div class="stats-actions" style="margin-top: 20px;">
                                <button class="action-btn view-btn" onclick="exportUniversityStats()" style="width: auto; padding: 10px 20px;">
                                    <i class="fas fa-download"></i> Export Statistics
                                </button>
                                <button class="action-btn preview-btn" onclick="refreshUniversityStats()" style="width: auto; padding: 10px 20px;">
                                    <i class="fas fa-sync"></i> Refresh Stats
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- NEW: User Advertisement Upload Tab -->
                <div id="userAdUpload" class="tab-content" style="display: none;">
                    <div class="content-header">
                        <h1 class="main-title">Upload Your Advertisement</h1>
                    </div>

                    <div class="user-ad-form">
                        <div style="text-align: center; margin-bottom: 25px;">
                            <h3 style="color: var(--primary);">Promote Your Business to University Students</h3>
                            <p style="color: #64748b;">Reach thousands of university students with your advertisement</p>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Advertisement Title</label>
                            <input type="text" class="form-input" id="userAdTitle" placeholder="e.g., Student Discount on Laptops">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Description</label>
                            <textarea class="form-input" id="userAdDescription" placeholder="Describe your advertisement in detail..." rows="3"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Advertisement Type</label>
                            <select class="form-select" id="userAdType">
                                <option value="product">Product</option>
                                <option value="service">Service</option>
                                <option value="event">Event</option>
                                <option value="job">Job Opportunity</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Target Universities (Optional)</label>
                            <select class="form-select" id="userAdUniversities" multiple style="height: 100px;">
                                <option value="all">All Universities</option>
                            </select>
                            <small style="color: #6c757d; font-size: 12px;">Hold Ctrl/Cmd to select multiple universities. Leave as "All Universities" for maximum reach.</small>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Google Drive Link (Picture/Video)</label>
                            <input type="url" class="form-input" id="userAdDriveLink" placeholder="https://drive.google.com/file/d/.../preview">
                            <small style="color: #6c757d; font-size: 12px;">Upload image/video to Google Drive and get /preview link</small>
                            <button type="button" onclick="previewUserAd()" style="margin-top: 10px; padding: 8px 15px; background: #e2e8f0; border: none; border-radius: 6px; cursor: pointer;">
                                <i class="fas fa-eye"></i> Preview Advertisement
                            </button>
                        </div>
                        
                        <div class="ad-preview" id="userAdPreview">
                            <h4>Advertisement Preview</h4>
                            <img id="previewAdImage" class="ad-preview-image" src="" alt="Advertisement Preview">
                            <div id="previewAdText">
                                <h5 id="previewAdTitle"></h5>
                                <p id="previewAdDescription"></p>
                            </div>
                        </div>
                        
                        <div style="background: #f0f9ff; border: 2px solid #e2e8f0; border-radius: 10px; padding: 20px; margin: 20px 0;">
                            <h4 style="color: var(--primary); margin-bottom: 10px;">
                                <i class="fas fa-clock"></i> Advertisement Duration & Pricing
                            </h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                                <div style="padding: 15px; border: 2px solid #e2e8f0; border-radius: 8px; text-align: center; cursor: pointer;" onclick="selectAdDuration(7)" id="duration7">
                                    <div style="font-size: 18px; font-weight: 800; color: var(--primary);">Ksh 500</div>
                                    <div style="font-size: 12px; color: #64748b;">7 Days</div>
                                </div>
                                <div style="padding: 15px; border: 2px solid #e2e8f0; border-radius: 8px; text-align: center; cursor: pointer;" onclick="selectAdDuration(14)" id="duration14">
                                    <div style="font-size: 18px; font-weight: 800; color: var(--primary);">Ksh 900</div>
                                    <div style="font-size: 12px; color: #64748b;">14 Days</div>
                                </div>
                                <div style="padding: 15px; border: 2px solid var(--primary); border-radius: 8px; text-align: center; cursor: pointer; background: #f0f9ff;" onclick="selectAdDuration(30)" id="duration30">
                                    <div style="font-size: 18px; font-weight: 800; color: var(--primary);">Ksh 1,500</div>
                                    <div style="font-size: 12px; color: var(--primary);">30 Days (Most Popular)</div>
                                </div>
                                <div style="padding: 15px; border: 2px solid #e2e8f0; border-radius: 8px; text-align: center; cursor: pointer;" onclick="selectAdDuration(60)" id="duration60">
                                    <div style="font-size: 18px; font-weight: 800; color: var(--primary);">Ksh 2,500</div>
                                    <div style="font-size: 12px; color: #64748b;">60 Days</div>
                                </div>
                            </div>
                            <p style="font-size: 12px; color: #64748b; margin-top: 10px;">
                                Your advertisement will be displayed to thousands of university students
                            </p>
                        </div>
                        
                        <div style="background: #fef3c7; border: 2px solid #f59e0b; border-radius: 10px; padding: 20px; margin: 20px 0;">
                            <h4 style="color: #92400e; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-credit-card"></i> Payment Instructions
                            </h4>
                            <p>Send payment via M-Pesa to:</p>
                            <div style="background: white; border: 2px solid #f59e0b; border-radius: 8px; padding: 15px; margin: 15px 0; text-align: center;">
                                <div style="font-weight: bold; color: #92400e;">Business Number:</div>
                                <div style="font-size: 24px; font-weight: 800; color: #92400e; letter-spacing: 1px; margin: 10px 0;">0330184468200</div>
                                <button class="copy-btn" onclick="copyAccountNumber()" style="margin: 10px auto; display: block; padding: 8px 15px; background: #f59e0b; color: white; border: none; border-radius: 6px; cursor: pointer;">
                                    <i class="fas fa-copy"></i> Copy Account Number
                                </button>
                            </div>
                            <p style="font-size: 12px; color: #92400e;">Amount: <span id="selectedAdPrice">Ksh 1,500</span> for <span id="selectedAdDays">30</span> days</p>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">M-Pesa Transaction Code</label>
                            <input type="text" class="form-input" id="userAdPaymentCode" placeholder="Enter transaction code (e.g., SDF45G7H)">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Your Contact Information</label>
                            <input type="text" class="form-input" id="userAdContactName" placeholder="Your Name">
                            <input type="tel" class="form-input" id="userAdContactPhone" placeholder="Your Phone Number" style="margin-top: 10px;">
                            <input type="email" class="form-input" id="userAdContactEmail" placeholder="Your Email" style="margin-top: 10px;">
                        </div>
                        
                        <div style="background: #e3f2fd; border: 2px solid #2196f3; border-radius: 10px; padding: 15px; margin: 20px 0;">
                            <h4><i class="fas fa-info-circle"></i> Important Information</h4>
                            <ul style="font-size: 12px; color: #64748b; padding-left: 20px; margin-top: 10px;">
                                <li>Advertisement will be reviewed by admin within 24 hours</li>
                                <li>You'll receive WhatsApp notification upon approval</li>
                                <li>Advertisement will be displayed in the Advertisements section</li>
                                <li>Targeted to selected universities or all universities</li>
                            </ul>
                        </div>
                        
                        <button class="submit-btn" onclick="submitUserAdvertisement()" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);">
                            <i class="fas fa-paper-plane"></i> SUBMIT ADVERTISEMENT & PAYMENT
                        </button>
                    </div>
                </div>
            </main>

            <!-- Right Sidebar -->
            <aside class="sidebar-right">
                <div class="sidebar-section">
                    <h2 class="section-title">
                        <i class="fas fa-folder"></i>
                        Categories
                    </h2>
                    <ul class="category-list" id="categoryList"></ul>
                </div>

                <div class="sidebar-section">
                    <h2 class="section-title">
                        <i class="fas fa-university"></i>
                        Universities
                    </h2>
                    <div class="university-grid" id="universityGrid"></div>
                    <button class="university-browse-btn small" onclick="openUniversityListModal()" style="margin-top: 15px; width: 100%;">
                        <i class="fas fa-search"></i> Browse All Universities
                    </button>
                </div>

                <!-- Advertisement in Sidebar -->
                <div class="advertisement-container" style="margin-top: 25px;">
                    <div class="advertisement-content">
                        <h2 class="advertisement-title">ðŸ“š Study Groups</h2>
                        <p class="advertisement-description">Join study groups for your course and collaborate with classmates!</p>
                        <button class="advertisement-cta-btn" onclick="openAdDetails(3)">Join Now</button>
                    </div>
                </div>

                <!-- Upload Button in Sidebar -->
                <div style="margin-top: 25px;">
                    <button class="upload-btn" onclick="showTab('upload')" style="width: 100%;">
                        <i class="fas fa-upload"></i> UPLOAD MATERIALS
                    </button>
                    <button class="user-ad-btn" onclick="openUserAdUpload()">
                        <i class="fas fa-bullhorn"></i> UPLOAD ADVERTISEMENT
                    </button>
                </div>

                <div class="premium-banner">
                    <div style="font-size: 14px; font-weight: bold; margin-bottom: 10px; display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <i class="fas fa-crown"></i>
                        PREMIUM ACCESS
                    </div>
                    <p style="font-size: 13px;">Unlock all study materials for 5 months</p>
                    <div style="font-size: 24px; font-weight: bold; margin: 10px 0;">Ksh 67</div>
                    <p style="font-size: 12px; opacity: 0.9;">One payment, full access to all resources</p>
                    <button style="background: white; color: #f59e0b; border: none; padding: 10px 20px; border-radius: 20px; font-weight: bold; cursor: pointer; margin-top: 10px; width: 100%;" onclick="showTab('register')">
                        <i class="fas fa-bolt"></i> SUBSCRIBE NOW
                    </button>
                </div>
            </aside>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>&copy; 2026 RevisionVault Pro â€¢ Developed by Walter Zauko</p>
            <p style="margin-top: 3px;">Contact: 0765 098 865 â€¢ revisionvaultke@gmail.com â€¢ All rights reserved</p>
        </footer>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <button class="nav-btn active" onclick="showTab('home')">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </button>
        <button class="nav-btn" onclick="showTab('materials')">
            <i class="fas fa-book"></i>
            <span>Materials</span>
        </button>
        <button class="nav-btn" onclick="showTab('advertisements')">
            <i class="fas fa-ad"></i>
            <span>Ads</span>
        </button>
        <button class="nav-btn" onclick="showTab('upload')">
            <i class="fas fa-upload"></i>
            <span>Upload</span>
        </button>
        <button class="nav-btn" onclick="showTab('register')">
            <i class="fas fa-user-plus"></i>
            <span>Register</span>
        </button>
        <button class="nav-btn" onclick="showTab('admin')">
            <i class="fas fa-shield-alt"></i>
            <span>Admin</span>
        </button>
    </div>

    <!-- University List Modal -->
    <div class="modal" id="universityListModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-university"></i>
                    Browse University Materials
                </h2>
                <button class="close-modal" onclick="closeModal('universityListModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div style="padding: 20px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px;" id="universityListGrid">
                        <!-- Universities will be populated here -->
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <p style="color: #64748b; font-size: 14px;">
                            Select a university to view materials from that institution
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- PDF Viewer Modal -->
    <div class="modal" id="pdfModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="pdfModalTitle">
                    <i class="fas fa-file-pdf"></i>
                    <span>Document Viewer</span>
                </h2>
                <button class="close-modal" onclick="closeModal('pdfModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- Document Security Notice -->
                <div class="document-security-notice">
                    <div class="security-text">
                        <i class="fas fa-shield-alt"></i>
                        <span>Approved User Access: You can view but not download or share.</span>
                    </div>
                </div>
                
                <div class="pdf-viewer-container">
                    <iframe class="pdf-viewer-frame" id="pdfViewer" 
                            frameborder="0" 
                            scrolling="yes"
                            sandbox="allow-scripts allow-same-origin"
                            loading="eager">
                    </iframe>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Chat Modal -->
    <div class="modal" id="aiChatModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title"><i class="fas fa-robot"></i> AI Study Assistant</h2>
                <button class="close-modal" onclick="closeModal('aiChatModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                    <p>AI Chat helps with essays, research, assignments, and study questions. Ask anything!</p>
                </div>
                
                <div id="aiChatMessages" style="height: 300px; overflow-y: auto; margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                    <div style="background: #f1f5f9; padding: 10px; border-radius: 10px; margin-bottom: 10px;">
                        <strong><i class="fas fa-robot"></i> AI Assistant:</strong> Hello! I'm your AI study assistant. How can I help you today?
                    </div>
                </div>
                
                <div class="form-group">
                    <input type="text" class="form-input" id="aiQuestion" placeholder="Ask me anything about your studies...">
                </div>
                
                <button class="submit-btn" onclick="askAI()">
                    <i class="fas fa-paper-plane"></i> Ask AI Assistant
                </button>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <div style="display: flex; justify-content: space-between; align-items: start;">
            <div>
                <strong id="notificationTitle"></strong>
                <p id="notificationMessage" style="margin-top: 5px;"></p>
            </div>
            <button onclick="hideNotification()" style="background: none; border: none; color: #6c757d; cursor: pointer;">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>

    <script>
        // ==================== APP DATA ====================
        const DOCUMENTS_DATA = [
            {
                "Title": "Plant Breeding notes",
                "Unit Code": "AGRO 222",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Agronomy",
                "Year": "2",
                "Description": "lecture notes on plant Breeding",
                "URL": "https://drive.google.com/file/d/17CG_rb_ecvnkLfjTzNC31u55pBR_RW70/preview",
                "Trending": true,
                "Recent": true
            },
            {
                "Title": "Scope of production Economics",
                "Unit Code": "AGEC 241",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Agricultural Economics",
                "Year": "2",
                "Description": "lecture notes on production Economics",
                "URL": "https://drive.google.com/file/d/1uSBqGCfeWPr-upLjKOu-cCkwQUVW7GOU/preview",
                "Trending": true
            },
            {
                "Title": "Production Economics",
                "Unit Code": "AGEC 241",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Agricultural Economics",
                "Year": "2",
                "Description": "lecture notes on production Economics",
                "URL": "https://drive.google.com/file/d/1LZ5P_t9qRlxZq2AyAI8JoG-bZAdS6G_c/preview"
            },
            {
                "Title": "ICT Application in Agricultural Education and Extension",
                "Unit Code": "AGED 113",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Agricultural Education and Extension",
                "Year": "2",
                "Description": "Examination paper on ICT Application in Agricultural Education and Extension",
                "URL": "https://drive.google.com/file/d/1MxYZpCMFoxTLI6ZR0w9rBBAWeZ1h_bg_/preview",
                "Recent": true
            },
            {
                "Title": "plant Breeding",
                "Unit Code": "AGRO 222",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Agronomy",
                "Year": "2",
                "Description": "lecture notes on plant Breeding",
                "URL": "https://drive.google.com/file/d/1wFm3cb1YRR9yD9f5noK4tg0HeD0K0jtg/preview"
            },
            {
                "Title": "taxonomy of higher plants",
                "Unit Code": "BOTA 241",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Botany",
                "Year": "2",
                "Description": "lecture notes on Taxonomy of higher plants",
                "URL": "https://drive.google.com/file/d/102toSTJ9WewkGSiBKx3IxWlbPoeKrGCU/preview"
            },
            {
                "Title": "plant physiology",
                "Unit Code": "BOTA 271",
                "University": "Egerton University",
                Type: "pdf",
                Subject: "Botany",
                Year: "2",
                Description: "lecture notes on plant physiology",
                URL: "https://drive.google.com/file/d/1vSG6ErlBddO-dXBVu8Ice1ut297SiI5d/preview"
            },
            {
                Title: "Breeding practices",
                "Unit Code": "AGRO 222",
                University: "Egerton University",
                Type: "pdf",
                Subject: "Agronomy",
                Year: "2",
                Description: "lecture notes on breeding practices",
                URL: "https://drive.google.com/file/d/1nZfdRK6TTVLvR05-E70WPLBN51_m6G7C/preview",
                Recent: true
            },
            {
                Title: "Cell biology",
                "Unit Code": "ZOOL 232",
                University: "Egerton University",
                Type: "pdf",
                Subject: "zoology",
                Year: "2",
                Description: "lecture notes on cell biology",
                URL: "https://drive.google.com/file/d/1LlFPeHK2DjZBhYh8C0LP9DZMX-etSZd7/preview"
            },
            {
                Title: "course outline",
                "Unit Code": "AGEC 241",
                University: "Egerton University",
                Type: "pdf",
                Subject: "Agricultural Economics",
                Year: "2",
                Description: "lecture notes on production Economics",
                URL: "https://drive.google.com/file/d/15D0aQg6hUX3v1pKwxnQ0Al0vRVIVCfsO/preview"
            },
            {
                Title: "Epistemology and Education",
                "Unit Code": "EDFO 112",
                University: "Egerton University",
                Type: "pdf",
                Subject: "Education Foundation",
                Year: "2",
                Description: "lecture notes on Epistemology and Education",
                URL: "https://drive.google.com/file/d/1Z9vZTucmGM_Vcp-cTvHfWwOxzNNLgPkj/preview"
            },
            {
                Title: "Environmental Science",
                "Unit Code": "ENSC 104",
                University: "Egerton University",
                Type: "pdf",
                Subject: "Environmental Science",
                Year: "2",
                Description: "lecture notes on Environmental Education",
                URL: "https://drive.google.com/file/d/1Rd_mPqrUik3mh9LX6GQEgD5XOjDfw1gB/preview"
            },
            {
                Title: "Environmental Education",
                "Unit Code": "ENSC 104",
                University: "Egerton University",
                Type: "pdf",
                Subject: "Environmental Science",
                Year: "2",
                Description: "lecture notes on Environmental Education",
                URL: "https://drive.google.com/file/d/1px1TN0icV_IlUjRm9DpgVyyPHmSfqBNz/preview"
            },
            {
                Title: "introduction to entrepreneurship",
                "Unit Code": "AGBM 102",
                University: "Egerton University",
                Type: "pdf",
                Subject: "Agro business management",
                Year: "2",
                Description: "lecture notes on introduction to Enterpreneurship",
                URL: "https://drive.google.com/file/d/18KKbBRI1zzReDAAKaQ3lgNmYUHKfc57B/preview"
            },
            {
                Title: "Ecology",
                "Unit Code": "ZOOL 210",
                University: "Egerton University",
                Type: "pdf",
                Subject: "Zoology",
                Year: "2",
                Description: "lecture notes on ecology",
                URL: "https://drive.google.com/file/d/146nlk4PihaeonVHslq3GClWqwu5xsbeX/preview",
                Trending: true
            },
            {
                Title: "SENV 311",
                "Unit Code": "SENV 311",
                University: "University of Eldoret",
                Type: "pdf",
                Subject: "Environmental Science",
                Year: "2",
                Description: "groupwork assignment",
                URL: "https://drive.google.com/file/d/1yPUYlgNepiDrG8RFIraiO5vA3iLLlS6D/preview",
                Recent: true
            },
            {
                Title: "Integral Calculus",
                "Unit Code": "MATH 212",
                University: "University of Nairobi",
                Type: "pdf",
                Subject: "Mathematics",
                Year: "2",
                Description: "2024 Main exam paper on integral calculus",
                URL: "https://drive.google.com/file/d/1LZ5P_t9qRlxZq2AyAI8JoG-bZAdS6G_c/preview",
                Trending: true
            },
            {
                Title: "Analytical Geometry",
                "Unit Code": "MATH 132",
                University: "University of Nairobi",
                Type: "pdf",
                Subject: "Mathematics",
                Year: "1",
                Description: "Complete notes on analytical geometry",
                URL: "https://drive.google.com/file/d/1wFm3cb1YRR9yD9f5noK4tg0HeD0K0jtg/preview"
            }
        ];

        const UNIVERSITIES = [
            "University of Nairobi",
            "Kenyatta University",
            "Moi University",
            "Egerton University",
            "Jomo Kenyatta University of Agriculture and Technology",
            "Maseno University",
            "Masinde Muliro University of Science and Technology",
            "Dedan Kimathi University of Technology",
            "Technical University of Kenya",
            "Technical University of Mombasa",
            "Murang'a University of Technology",
            "Meru University of Science and Technology",
            "Kirinyaga University",
            "Laikipia University",
            "University of Eldoret",
            "Chuka University",
            "Karatina University",
            "Rongo University",
            "Kisii University",
            "South Eastern Kenya University",
            "Pwani University",
            "Co-operative University of Kenya",
            "Kabarak University",
            "Strathmore University",
            "Mount Kenya University",
            "Africa Nazarene University",
            "Catholic University of Eastern Africa",
            "Daystar University",
            "United States International University Africa",
            "Zetech University"
        ];

        // ==================== ADVERTISEMENTS DATA ====================
        const ADVERTISEMENTS = [
            {
                id: 1,
                title: "Referral Program",
                description: "Earn 20% commission for every friend you refer to RevisionVault Pro. Minimum 5 referrals required.",
                type: "Earning",
                cta: "Start Earning",
                link: "#",
                image: "fa-money-bill-wave",
                driveLink: "https://drive.google.com/file/d/1LZ5P_t9qRlxZq2AyAI8JoG-bZAdS6G_c/preview"
            },
            {
                id: 2,
                title: "Study Groups",
                description: "Join course-specific study groups and collaborate with classmates on assignments and projects.",
                type: "Community",
                cta: "Join Groups",
                link: "#",
                image: "fa-users",
                driveLink: "https://drive.google.com/file/d/1LZ5P_t9qRlxZq2AyAI8JoG-bZAdS6G_c/preview"
            },
            {
                id: 3,
                title: "Premium Tutoring",
                description: "Get one-on-one tutoring from top students in your course. Starting from Ksh 200/hour.",
                type: "Service",
                cta: "Book Now",
                link: "#",
                image: "fa-chalkboard-teacher",
                driveLink: "https://drive.google.com/file/d/1LZ5P_t9qRlxZq2AyAI8JoG-bZAdS6G_c/preview"
            }
        ];

        // ==================== APP STATE ====================
        let appState = {
            currentUser: JSON.parse(localStorage.getItem('currentUser')) || null,
            users: JSON.parse(localStorage.getItem('users')) || [],
            documents: JSON.parse(localStorage.getItem('documents')) || DOCUMENTS_DATA,
            userUploads: JSON.parse(localStorage.getItem('userUploads')) || [],
            userAdvertisements: JSON.parse(localStorage.getItem('userAdvertisements')) || [],
            advertisements: JSON.parse(localStorage.getItem('advertisements')) || ADVERTISEMENTS,
            adminPassword: "walter.zauko23",
            adminEmail: "revisionvaultke@gmail.com",
            adminWhatsApp: "254765098865",
            subscriptionPrice: "67",
            searchTimeout: null,
            allUnitCodes: [],
            recentlyRegisteredPhone: null
        };

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            loadAppData();
            initializeUniversities();
            initializeCategories();
            initializeUnitCodes();
            renderHomeContent();
            updateAccessStatus();
            checkRegistrationSuccess();
            initializeUploadUniversities();
            loadAdvertisements();
            initializeUserAdUniversities();
            
            // Setup search
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', function(e) {
                clearTimeout(appState.searchTimeout);
                
                if (e.target.value.length > 0) {
                    showSearchSuggestions(e.target.value);
                } else {
                    hideSearchSuggestions();
                }
                
                appState.searchTimeout = setTimeout(() => {
                    searchByUnitCode(e.target.value);
                }, 300);
            });
            
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchByUnitCode(this.value);
                }
            });
            
            // Initialize bottom navigation
            document.querySelectorAll('.bottom-nav .nav-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.bottom-nav .nav-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            // Initialize sample data
            initializeSampleData();
        });

        // ==================== APP DATA FUNCTIONS ====================
        function loadAppData() {
            const savedUsers = localStorage.getItem('users');
            const savedDocuments = localStorage.getItem('documents');
            const savedUploads = localStorage.getItem('userUploads');
            const savedAds = localStorage.getItem('advertisements');
            const savedUserAds = localStorage.getItem('userAdvertisements');
            
            if (savedUsers) appState.users = JSON.parse(savedUsers);
            if (savedDocuments) appState.documents = JSON.parse(savedDocuments);
            if (savedUploads) appState.userUploads = JSON.parse(savedUploads);
            if (savedAds) appState.advertisements = JSON.parse(savedAds);
            if (savedUserAds) appState.userAdvertisements = JSON.parse(savedUserAds);
            
            // Load recently registered phone
            const recentPhone = localStorage.getItem('recentlyRegisteredPhone');
            if (recentPhone) appState.recentlyRegisteredPhone = recentPhone;
        }

        function saveAppData() {
            localStorage.setItem('users', JSON.stringify(appState.users));
            localStorage.setItem('documents', JSON.stringify(appState.documents));
            localStorage.setItem('userUploads', JSON.stringify(appState.userUploads));
            localStorage.setItem('advertisements', JSON.stringify(appState.advertisements));
            localStorage.setItem('userAdvertisements', JSON.stringify(appState.userAdvertisements));
            if (appState.currentUser) {
                localStorage.setItem('currentUser', JSON.stringify(appState.currentUser));
            }
        }

        // ==================== NEW FEATURE: DOCUMENT VIEWER FOR APPROVED USERS ONLY ====================
        function openDocumentViewer(url, title, unitCode, university, year, subject) {
            // Check if user is logged in and has APPROVED subscription
            if (!appState.currentUser || !appState.currentUser.subscription || appState.currentUser.subscription.status !== 'approved') {
                showNotification('Access Denied', 'Your subscription must be approved by admin to view documents. Please wait for approval or contact admin.', 'warning');
                showTab('register');
                return;
            }
            
            document.getElementById('pdfModalTitle').innerHTML = `<i class="fas fa-file-pdf"></i><span>${title} - ${unitCode}</span>`;
            
            let embedUrl = url;
            if (url.includes('drive.google.com')) {
                if (!url.includes('/preview')) {
                    const match = url.match(/\/d\/([^\/]+)/) || url.match(/id=([^&]+)/);
                    if (match && match[1]) {
                        embedUrl = `https://drive.google.com/file/d/${match[1]}/preview`;
                    }
                }
                if (embedUrl.includes('preview')) {
                    embedUrl += (embedUrl.includes('?') ? '&' : '?') + 'rm=minimal';
                }
            }
            
            const viewer = document.getElementById('pdfViewer');
            viewer.src = embedUrl;
            
            openModal('pdfModal');
            
            // Track user activity
            if (appState.currentUser) {
                if (!appState.currentUser.activity) appState.currentUser.activity = { materialsViewed: [] };
                appState.currentUser.activity.materialsViewed.push({
                    title: title,
                    unitCode: unitCode,
                    date: new Date().toISOString()
                });
                saveAppData();
            }
        }

        // ==================== NEW FEATURE: USER ADVERTISEMENT UPLOAD ====================
        function openUserAdUpload() {
            // Check if user is logged in
            if (!appState.currentUser) {
                showNotification('Login Required', 'Please login or register to upload advertisements', 'warning');
                showTab('login');
                return;
            }
            
            // Pre-fill user info
            document.getElementById('userAdContactName').value = appState.currentUser.name || '';
            document.getElementById('userAdContactPhone').value = appState.currentUser.phone || '';
            document.getElementById('userAdContactEmail').value = appState.currentUser.email || '';
            
            // Reset form
            document.getElementById('userAdTitle').value = '';
            document.getElementById('userAdDescription').value = '';
            document.getElementById('userAdDriveLink').value = '';
            document.getElementById('userAdPaymentCode').value = '';
            document.getElementById('userAdPreview').classList.remove('active');
            
            // Set default duration
            selectAdDuration(30);
            
            showTab('userAdUpload');
        }

        function initializeUserAdUniversities() {
            const select = document.getElementById('userAdUniversities');
            if (!select) return;
            
            select.innerHTML = '<option value="all">All Universities</option>' + 
                UNIVERSITIES.map(uni => `<option value="${uni}">${uni}</option>`).join('');
        }

        function selectAdDuration(days) {
            // Remove active class from all duration options
            ['duration7', 'duration14', 'duration30', 'duration60'].forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.style.borderColor = '#e2e8f0';
                    el.style.background = 'white';
                }
            });
            
            // Add active class to selected duration
            const selectedEl = document.getElementById('duration' + days);
            if (selectedEl) {
                selectedEl.style.borderColor = 'var(--primary)';
                selectedEl.style.background = '#f0f9ff';
            }
            
            // Update price display
            let price = 1500;
            if (days === 7) price = 500;
            else if (days === 14) price = 900;
            else if (days === 60) price = 2500;
            
            document.getElementById('selectedAdPrice').textContent = `Ksh ${price.toLocaleString()}`;
            document.getElementById('selectedAdDays').textContent = days;
        }

        function previewUserAd() {
            const title = document.getElementById('userAdTitle').value;
            const description = document.getElementById('userAdDescription').value;
            const driveLink = document.getElementById('userAdDriveLink').value;
            
            if (!title || !description || !driveLink) {
                showNotification('Incomplete Form', 'Please fill in title, description, and Google Drive link', 'warning');
                return;
            }
            
            document.getElementById('previewAdTitle').textContent = title;
            document.getElementById('previewAdDescription').textContent = description;
            
            // Set preview image
            const previewImage = document.getElementById('previewAdImage');
            if (driveLink.includes('drive.google.com')) {
                previewImage.src = driveLink;
                previewImage.style.display = 'block';
            } else {
                previewImage.style.display = 'none';
            }
            
            document.getElementById('userAdPreview').classList.add('active');
        }

        function submitUserAdvertisement() {
            const title = document.getElementById('userAdTitle').value.trim();
            const description = document.getElementById('userAdDescription').value.trim();
            const driveLink = document.getElementById('userAdDriveLink').value.trim();
            const paymentCode = document.getElementById('userAdPaymentCode').value.trim();
            const contactName = document.getElementById('userAdContactName').value.trim();
            const contactPhone = document.getElementById('userAdContactPhone').value.trim();
            const contactEmail = document.getElementById('userAdContactEmail').value.trim();
            const adType = document.getElementById('userAdType').value;
            
            // Get selected universities
            const selectedUniversities = Array.from(document.getElementById('userAdUniversities').selectedOptions)
                .map(option => option.value);
            
            // Get selected duration
            let selectedDuration = 30;
            let price = 1500;
            if (document.getElementById('duration7').style.borderColor === 'rgb(26, 41, 128)') {
                selectedDuration = 7;
                price = 500;
            } else if (document.getElementById('duration14').style.borderColor === 'rgb(26, 41, 128)') {
                selectedDuration = 14;
                price = 900;
            } else if (document.getElementById('duration60').style.borderColor === 'rgb(26, 41, 128)') {
                selectedDuration = 60;
                price = 2500;
            }
            
            // Validate
            if (!title || !description || !driveLink || !paymentCode || !contactName || !contactPhone || !contactEmail) {
                showNotification('Incomplete Form', 'Please fill in all required fields', 'error');
                return;
            }
            
            if (contactPhone.length !== 10 || !contactPhone.startsWith('07')) {
                showNotification('Invalid Phone', 'Please enter a valid Kenyan phone number (07XXXXXXXX)', 'error');
                return;
            }
            
            // Create advertisement object
            const userAd = {
                id: Date.now(),
                title: title,
                description: description,
                type: adType,
                cta: "Learn More",
                link: "#",
                image: "fa-bullhorn",
                driveLink: driveLink,
                paymentCode: paymentCode,
                contactName: contactName,
                contactPhone: contactPhone,
                contactEmail: contactEmail,
                duration: selectedDuration,
                price: price,
                targetUniversities: selectedUniversities,
                status: 'pending',
                submittedBy: appState.currentUser ? appState.currentUser.phone : 'anonymous',
                submissionDate: new Date().toISOString(),
                startDate: null,
                endDate: null,
                approvedBy: null,
                approvalDate: null
            };
            
            // Add to userAdvertisements
            appState.userAdvertisements.push(userAd);
            saveAppData();
            
            // Send notification to admin
            sendUserAdNotificationToAdmin(userAd);
            
            // Show success message
            showNotification('Advertisement Submitted', 'Your ad has been submitted for admin review. You will receive a WhatsApp notification once approved.', 'success');
            
            // Clear form and go back to ads tab
            document.getElementById('userAdTitle').value = '';
            document.getElementById('userAdDescription').value = '';
            document.getElementById('userAdDriveLink').value = '';
            document.getElementById('userAdPaymentCode').value = '';
            document.getElementById('userAdPreview').classList.remove('active');
            
            showTab('advertisements');
        }

        function sendUserAdNotificationToAdmin(ad) {
            const message = `ðŸ“¢ NEW USER ADVERTISEMENT - RevisionVault Pro\n\nðŸ“‹ Title: ${ad.title}\nðŸ“ Type: ${ad.type}\nðŸ’° Price: Ksh ${ad.price}\nðŸ“… Duration: ${ad.duration} days\nðŸ‘¤ Contact: ${ad.contactName} (${ad.contactPhone})\nðŸ“§ Email: ${ad.contactEmail}\nðŸ’³ Payment Code: ${ad.paymentCode}\n\nPlease review in admin panel.`;
            
            const whatsappUrl = `https://wa.me/${appState.adminWhatsApp}?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }

        // ==================== NEW FEATURE: UNIVERSITY STATISTICS IN ADMIN ====================
        function calculateUniversityStatistics() {
            const stats = {};
            
            // Initialize all universities
            UNIVERSITIES.forEach(uni => {
                stats[uni] = {
                    approved: 0,
                    pending: 0,
                    total: 0,
                    revenue: 0
                };
            });
            
            // Count students per university
            appState.users.forEach(user => {
                if (stats[user.university]) {
                    stats[user.university].total++;
                    
                    if (user.subscription.status === 'approved') {
                        stats[user.university].approved++;
                        stats[user.university].revenue += 67; // Subscription fee
                    } else if (user.subscription.status === 'pending') {
                        stats[user.university].pending++;
                    }
                }
            });
            
            return stats;
        }

        function displayUniversityStatistics() {
            const stats = calculateUniversityStatistics();
            const tableBody = document.getElementById('universityStatsTable');
            const gridContainer = document.getElementById('universityStatsGrid');
            const totalStudents = document.getElementById('totalStudents');
            const totalUniversities = document.getElementById('totalUniversities');
            const pendingStudents = document.getElementById('pendingStudents');
            
            if (!tableBody || !gridContainer) return;
            
            // Calculate totals
            let totalApproved = 0;
            let totalPending = 0;
            let totalRevenue = 0;
            let universitiesWithStudents = 0;
            
            Object.keys(stats).forEach(uni => {
                totalApproved += stats[uni].approved;
                totalPending += stats[uni].pending;
                totalRevenue += stats[uni].revenue;
                if (stats[uni].total > 0) universitiesWithStudents++;
            });
            
            // Update summary cards
            if (totalStudents) totalStudents.textContent = totalApproved;
            if (totalUniversities) totalUniversities.textContent = universitiesWithStudents;
            if (pendingStudents) pendingStudents.textContent = totalPending;
            
            // Sort universities by approved students (descending)
            const sortedUniversities = Object.entries(stats)
                .filter(([uni, data]) => data.total > 0)
                .sort((a, b) => b[1].approved - a[1].approved);
            
            // Populate table
            tableBody.innerHTML = '';
            sortedUniversities.forEach(([uni, data], index) => {
                const percentage = totalApproved > 0 ? ((data.approved / totalApproved) * 100).toFixed(1) : 0;
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><span class="university-rank">${index + 1}</span></td>
                    <td><strong>${uni}</strong></td>
                    <td><span style="color: var(--success); font-weight: 800;">${data.approved}</span></td>
                    <td><span style="color: var(--warning);">${data.pending}</span></td>
                    <td>${data.total}</td>
                    <td>
                        <div style="background: #e2e8f0; border-radius: 4px; height: 20px; margin: 5px 0;">
                            <div style="background: var(--primary); width: ${percentage}%; height: 100%; border-radius: 4px;"></div>
                        </div>
                        <span style="font-size: 12px; color: #64748b;">${percentage}%</span>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Populate grid view
            gridContainer.innerHTML = '';
            sortedUniversities.slice(0, 12).forEach(([uni, data], index) => {
                const card = document.createElement('div');
                card.className = 'university-stat-card';
                card.innerHTML = `
                    <div class="university-stat-header">
                        <div class="university-name">
                            <i class="fas fa-university"></i>
                            ${uni}
                        </div>
                        <div style="background: #e0f2fe; padding: 5px 10px; border-radius: 20px; font-size: 12px; font-weight: 800; color: var(--primary);">
                            #${index + 1}
                        </div>
                    </div>
                    
                    <div class="student-count">${data.approved}</div>
                    <div class="count-label">Approved Students</div>
                    
                    <div class="stat-details">
                        <div class="stat-item">
                            <div class="stat-number">${data.total}</div>
                            <div class="stat-label">Total</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">${data.pending}</div>
                            <div class="stat-label">Pending</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">Ksh ${data.revenue}</div>
                            <div class="stat-label">Revenue</div>
                        </div>
                    </div>
                `;
                gridContainer.appendChild(card);
            });
            
            // Add "Other Universities" card if there are more
            if (sortedUniversities.length > 12) {
                const otherCard = document.createElement('div');
                otherCard.className = 'university-stat-card';
                otherCard.innerHTML = `
                    <div class="university-stat-header">
                        <div class="university-name">
                            <i class="fas fa-university"></i>
                            Other Universities
                        </div>
                    </div>
                    
                    <div class="student-count">${sortedUniversities.length - 12}</div>
                    <div class="count-label">More Universities</div>
                    
                    <div style="text-align: center; margin-top: 15px;">
                        <div style="font-size: 12px; color: #64748b;">
                            ${sortedUniversities.length - 12} more universities with registered students
                        </div>
                    </div>
                `;
                gridContainer.appendChild(otherCard);
            }
        }

        function refreshUniversityStats() {
            displayUniversityStatistics();
            showNotification('Statistics Updated', 'University statistics have been refreshed', 'success');
        }

        function exportUniversityStats() {
            const stats = calculateUniversityStatistics();
            const csvContent = "University,Approved Students,Pending Students,Total Students,Revenue (Ksh)\n" +
                Object.entries(stats)
                    .filter(([uni, data]) => data.total > 0)
                    .sort((a, b) => b[1].approved - a[1].approved)
                    .map(([uni, data]) => `${uni},${data.approved},${data.pending},${data.total},${data.revenue}`)
                    .join("\n");
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `university_stats_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            
            showNotification('Export Complete', 'University statistics exported as CSV file', 'success');
        }

        // ==================== MODAL FUNCTIONS ====================
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            document.body.style.overflow = 'auto';
            
            // Clear PDF viewer
            if (modalId === 'pdfModal') {
                document.getElementById('pdfViewer').src = '';
            }
        }

        // ==================== UNIVERSITY FUNCTIONS ====================
        function initializeUniversities() {
            const universityFilter = document.getElementById('universityFilter');
            const allUniversityFilter = document.getElementById('allUniversityFilter');
            const studentUniversity = document.getElementById('studentUniversity');
            
            if (universityFilter) {
                universityFilter.innerHTML = '<option value="all">All Universities</option>' + 
                    UNIVERSITIES.map(uni => `<option value="${uni}">${uni}</option>`).join('');
            }
            
            if (allUniversityFilter) {
                allUniversityFilter.innerHTML = '<option value="all">All Universities</option>' + 
                    UNIVERSITIES.map(uni => `<option value="${uni}">${uni}</option>`).join('');
            }
            
            if (studentUniversity) {
                studentUniversity.innerHTML = '<option value="">Select University</option>' + 
                    UNIVERSITIES.map(uni => `<option value="${uni}">${uni}</option>`).join('');
            }
            
            // Populate university grid in sidebar
            const universityGrid = document.getElementById('universityGrid');
            if (universityGrid) {
                const popularUnis = UNIVERSITIES.slice(0, 6);
                universityGrid.innerHTML = popularUnis.map(uni => `
                    <div class="university-card" onclick="showUniversityMaterials('${uni}')">
                        <div class="university-logo">${uni.substring(0, 2)}</div>
                        <div style="font-size: 11px; font-weight: 600; color: var(--dark);">${uni}</div>
                    </div>
                `).join('');
            }
        }

        function initializeUploadUniversities() {
            const uploadUniversity = document.getElementById('uploadUniversity');
            if (uploadUniversity) {
                uploadUniversity.innerHTML = '<option value="">Select University</option>' + 
                    UNIVERSITIES.map(uni => `<option value="${uni}">${uni}</option>`).join('');
            }
        }

        function openUniversityListModal() {
            populateUniversityList();
            openModal('universityListModal');
        }

        function populateUniversityList() {
            const grid = document.getElementById('universityListGrid');
            if (!grid) return;
            
            grid.innerHTML = UNIVERSITIES.map(uni => {
                const materialsCount = appState.documents.filter(doc => doc.University === uni).length;
                return `
                    <div class="university-card" onclick="showUniversityMaterials('${uni}')" style="cursor: pointer;">
                        <div class="university-logo">${uni.substring(0, 2)}</div>
                        <div style="font-size: 12px; font-weight: 600; color: var(--dark); margin-bottom: 5px;">${uni}</div>
                        <div style="font-size: 10px; color: #64748b;">${materialsCount} materials</div>
                    </div>
                `;
            }).join('');
        }

        function showUniversityMaterials(university) {
            closeModal('universityListModal');
            showTab('materials');
            
            document.getElementById('allUniversityFilter').value = university;
            filterAllMaterials();
        }

        // ==================== SEARCH FUNCTIONS ====================
        function initializeUnitCodes() {
            const unitCodes = [...new Set(appState.documents.map(doc => doc["Unit Code"]))];
            appState.allUnitCodes = unitCodes;
            
            const quickUnits = document.getElementById('quickUnits');
            if (quickUnits) {
                const popularUnits = unitCodes.slice(0, 8);
                quickUnits.innerHTML = popularUnits.map(code => `
                    <div class="unit-chip" onclick="quickSearch('${code}')">
                        ${code}
                    </div>
                `).join('');
            }
        }

        function showSearchSuggestions(query) {
            if (!query) {
                hideSearchSuggestions();
                return;
            }
            
            const suggestions = document.getElementById('searchSuggestions');
            const normalizedQuery = query.toUpperCase().replace(/\s+/g, '');
            
            // Filter unit codes and universities
            const unitCodeMatches = appState.allUnitCodes.filter(code => 
                code.replace(/\s+/g, '').includes(normalizedQuery)
            );
            
            const universityMatches = UNIVERSITIES.filter(uni => 
                uni.toUpperCase().includes(query.toUpperCase())
            );
            
            let html = '';
            
            // Add unit code suggestions
            if (unitCodeMatches.length > 0) {
                html += '<div style="padding: 10px 15px; font-size: 11px; color: #64748b; font-weight: 600; background: #f8fafc;">UNIT CODES</div>';
                unitCodeMatches.slice(0, 5).forEach(code => {
                    html += `
                        <div class="suggestion-item" onclick="selectSuggestion('${code}')">
                            <div class="suggestion-code">${code}</div>
                        </div>
                    `;
                });
            }
            
            // Add university suggestions
            if (universityMatches.length > 0) {
                html += '<div style="padding: 10px 15px; font-size: 11px; color: #64748b; font-weight: 600; background: #f8fafc;">UNIVERSITIES</div>';
                universityMatches.slice(0, 5).forEach(uni => {
                    html += `
                        <div class="suggestion-item" onclick="selectUniversitySuggestion('${uni}')">
                            <div class="suggestion-code">${uni}</div>
                        </div>
                    `;
                });
            }
            
            if (html) {
                suggestions.innerHTML = html;
                suggestions.classList.add('active');
            } else {
                hideSearchSuggestions();
            }
        }

        function hideSearchSuggestions() {
            document.getElementById('searchSuggestions').classList.remove('active');
        }

        function selectSuggestion(unitCode) {
            document.getElementById('searchInput').value = unitCode;
            hideSearchSuggestions();
            searchByUnitCode(unitCode);
        }

        function selectUniversitySuggestion(university) {
            document.getElementById('searchInput').value = university;
            hideSearchSuggestions();
            showUniversityMaterials(university);
        }

        function searchByUnitCode(query) {
            if (!query.trim()) {
                document.getElementById('searchResults').classList.remove('active');
                document.getElementById('continueReading').style.display = 'block';
                hideSearchSuggestions();
                return;
            }
            
            const normalizedQuery = query.toUpperCase().replace(/\s+/g, '');
            
            const results = appState.documents.filter(doc => {
                const unitCode = (doc["Unit Code"] || "").toUpperCase().replace(/\s+/g, '');
                const title = (doc.Title || "").toUpperCase();
                const subject = (doc.Subject || "").toUpperCase();
                const description = (doc.Description || "").toUpperCase();
                const university = (doc.University || "").toUpperCase();
                
                return unitCode.includes(normalizedQuery) || 
                       title.includes(normalizedQuery) ||
                       subject.includes(normalizedQuery) ||
                       description.includes(normalizedQuery) ||
                       university.includes(normalizedQuery);
            });
            
            if (results.length > 0) {
                document.getElementById('continueReading').style.display = 'none';
                document.getElementById('searchResults').classList.add('active');
                document.getElementById('searchResultsTitle').textContent = `Search Results for "${query}" (${results.length} found)`;
                
                const grid = document.getElementById('searchResultsGrid');
                grid.innerHTML = results.map(doc => createMaterialCard(doc)).join('');
            } else {
                document.getElementById('continueReading').style.display = 'block';
                document.getElementById('searchResults').classList.remove('active');
                showNotification('No Results', `No materials found for "${query}"`, 'warning');
            }
            
            hideSearchSuggestions();
        }

        function quickSearch(unitCode) {
            document.getElementById('searchInput').value = unitCode;
            searchByUnitCode(unitCode);
        }

        // ==================== MATERIAL CARD CREATION ====================
        function createMaterialCard(doc) {
            const hasAccess = appState.currentUser && appState.currentUser.subscription && 
                             appState.currentUser.subscription.active && appState.currentUser.subscription.status === 'approved';
            
            const badges = [];
            if (doc.Trending) badges.push('<div class="material-badge trending">TRENDING</div>');
            if (doc.Recent) badges.push('<div class="material-badge recent">RECENT</div>');
            
            return `
                <div class="material-card">
                    ${badges.join('')}
                    
                    <div class="material-image">
                        <i class="fas fa-file-pdf"></i>
                    </div>
                    
                    <div class="material-content">
                        <h3 class="material-title">${doc.Title}</h3>
                        
                        <div class="material-meta">
                            <span class="material-code">${doc["Unit Code"]}</span>
                            <span class="material-year">Year ${doc.Year}</span>
                        </div>
                        
                        <div class="material-info">
                            <i class="fas fa-university"></i>
                            <span>${doc.University}</span>
                            <span style="margin-left: auto; font-size: 11px;">
                                <i class="fas fa-book"></i> ${doc.Subject}
                            </span>
                        </div>
                        
                        <p class="material-description">${doc.Description}</p>
                        
                        <div class="material-actions">
                            ${hasAccess ? 
                                `<button class="action-btn view-btn" onclick="openDocumentViewer('${doc.URL}', '${doc.Title}', '${doc["Unit Code"]}', '${doc.University}', '${doc.Year}', '${doc.Subject}')">
                                    <i class="fas fa-eye"></i> View Document
                                </button>` :
                                `<button class="action-btn view-btn" onclick="showTab('register')">
                                    <i class="fas fa-lock"></i> Subscribe to View
                                </button>`
                            }
                        </div>
                    </div>
                </div>
            `;
        }

        // ==================== RENDERING FUNCTIONS ====================
        function renderHomeContent() {
            renderContinueReading();
            renderTrendingMaterials();
        }

        function renderContinueReading() {
            const grid = document.getElementById('continueReadingGrid');
            if (!grid) return;
            
            const recentDocs = appState.documents.filter(doc => doc.Recent).slice(0, 6);
            grid.innerHTML = recentDocs.map(doc => createMaterialCard(doc)).join('');
        }

        function renderTrendingMaterials() {
            const grid = document.getElementById('trendingGrid');
            if (!grid) return;
            
            const trendingDocs = appState.documents.filter(doc => doc.Trending).slice(0, 6);
            grid.innerHTML = trendingDocs.map(doc => createMaterialCard(doc)).join('');
        }

        function renderAllMaterials() {
            const grid = document.getElementById('allMaterialsGrid');
            if (!grid) return;
            
            grid.innerHTML = appState.documents.map(doc => createMaterialCard(doc)).join('');
        }

        // ==================== FILTER FUNCTIONS ====================
        function filterMaterials() {
            const university = document.getElementById('universityFilter').value;
            const year = document.getElementById('yearFilter').value;
            
            let filteredDocs = appState.documents;
            
            if (university !== 'all') {
                filteredDocs = filteredDocs.filter(doc => doc.University === university);
            }
            
            if (year !== 'all') {
                filteredDocs = filteredDocs.filter(doc => doc.Year === year);
            }
            
            document.getElementById('continueReadingGrid').innerHTML = filteredDocs.slice(0, 6).map(doc => createMaterialCard(doc)).join('');
        }

        function filterAllMaterials() {
            const university = document.getElementById('allUniversityFilter').value;
            const subject = document.getElementById('allSubjectFilter').value;
            
            let filteredDocs = appState.documents;
            
            if (university !== 'all') {
                filteredDocs = filteredDocs.filter(doc => doc.University === university);
            }
            
            if (subject !== 'all') {
                filteredDocs = filteredDocs.filter(doc => doc.Subject === subject);
            }
            
            document.getElementById('allMaterialsGrid').innerHTML = filteredDocs.map(doc => createMaterialCard(doc)).join('');
        }

        // ==================== CATEGORY FUNCTIONS ====================
        function initializeCategories() {
            const categories = {};
            appState.documents.forEach(doc => {
                const subject = doc.Subject || 'Other';
                categories[subject] = (categories[subject] || 0) + 1;
            });
            
            const categoryList = document.getElementById('categoryList');
            if (categoryList) {
                categoryList.innerHTML = Object.entries(categories).map(([name, count]) => `
                    <div class="category-item" onclick="filterByCategory('${name}')">
                        <div class="category-name">${name}</div>
                        <div class="category-count">${count}</div>
                    </div>
                `).join('');
            }
            
            // Populate subject filter
            const subjectFilter = document.getElementById('allSubjectFilter');
            if (subjectFilter) {
                subjectFilter.innerHTML = '<option value="all">All Subjects</option>' + 
                    Object.keys(categories).map(subject => `<option value="${subject}">${subject}</option>`).join('');
            }
        }

        function filterByCategory(category) {
            showTab('materials');
            document.getElementById('allSubjectFilter').value = category;
            filterAllMaterials();
        }

        // ==================== REGISTRATION FUNCTIONS ====================
        function registerStudent() {
            const name = document.getElementById('studentName').value.trim();
            const email = document.getElementById('studentEmail').value.trim();
            const phone = document.getElementById('studentPhone').value.trim();
            const university = document.getElementById('studentUniversity').value;
            const course = document.getElementById('studentCourse').value.trim();
            const year = document.getElementById('studentYear').value;
            const paymentCode = document.getElementById('paymentCode').value.trim();
            
            if (!name || !email || !phone || !university || !course || !year || !paymentCode) {
                showNotification('Error', 'Please fill in all fields', 'error');
                highlightEmptyFields();
                return;
            }
            
            if (phone.length !== 10 || !phone.startsWith('07')) {
                showNotification('Error', 'Please enter a valid Kenyan phone number (07XXXXXXXX)', 'error');
                document.getElementById('studentPhone').style.borderColor = 'var(--danger)';
                return;
            }
            
            const existingUser = appState.users.find(u => u.phone === phone || u.email === email);
            if (existingUser) {
                showNotification('Info', 'This phone number or email is already registered', 'info');
                showTab('login');
                return;
            }
            
            const newUser = {
                id: Date.now(),
                name: name,
                email: email,
                phone: phone,
                university: university,
                course: course,
                year: year,
                registrationDate: new Date().toISOString(),
                subscription: {
                    active: false,
                    paymentCode: paymentCode,
                    unlockCode: '',
                    status: 'pending',
                    startDate: null,
                    endDate: null,
                    approvedDate: null
                }
            };
            
            appState.users.push(newUser);
            saveAppData();
            
            appState.recentlyRegisteredPhone = phone;
            localStorage.setItem('recentlyRegisteredPhone', phone);
            
            showRegistrationSuccessBanner();
            
            // Send notification to admin via WhatsApp
            sendRegistrationNotificationToAdmin(newUser);
            
            showNotification('Registration Successful!', 'Admin will send you an unlock code via WhatsApp and Email.', 'success');
            
            clearRegistrationForm();
        }

        function highlightEmptyFields() {
            const fields = ['studentName', 'studentEmail', 'studentPhone', 'studentUniversity', 'studentCourse', 'studentYear', 'paymentCode'];
            fields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    field.style.borderColor = 'var(--danger)';
                    setTimeout(() => field.style.borderColor = '#e2e8f0', 3000);
                }
            });
        }

        function clearRegistrationForm() {
            const fields = ['studentName', 'studentEmail', 'studentPhone', 'studentUniversity', 'studentCourse', 'studentYear', 'paymentCode'];
            fields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field.tagName === 'SELECT') {
                    field.value = '';
                } else {
                    field.value = '';
                }
                field.style.borderColor = '#e2e8f0';
            });
        }

        function showRegistrationSuccessBanner() {
            const banner = document.getElementById('registrationSuccessBanner');
            banner.classList.add('active');
            
            // Hide access status
            document.getElementById('accessStatus').style.display = 'none';
        }

        function checkRegistrationSuccess() {
            if (appState.recentlyRegisteredPhone) {
                const user = appState.users.find(u => u.phone === appState.recentlyRegisteredPhone);
                if (user && !user.subscription.active) {
                    showRegistrationSuccessBanner();
                    document.getElementById('accessStatus').style.display = 'none';
                }
            }
        }

        function sendRegistrationNotificationToAdmin(user) {
            const message = `ðŸ“š NEW REGISTRATION - RevisionVault Pro\n\nðŸ‘¤ Name: ${user.name}\nðŸ“§ Email: ${user.email}\nðŸ“ž Phone: ${user.phone}\nðŸ« University: ${user.university}\nðŸ“š Course: ${user.course}\nðŸ“… Year: ${user.year}\nðŸ’³ Payment Code: ${user.subscription.paymentCode}\n\nPlease review and approve.`;
            
            const whatsappUrl = `https://wa.me/${appState.adminWhatsApp}?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }

        function copyAccountNumber() {
            const accountNumber = '0330184468200';
            navigator.clipboard.writeText(accountNumber).then(() => {
                showNotification('Copied!', 'Account number copied to clipboard', 'success');
            });
        }

        // ==================== LOGIN FUNCTIONS ====================
        function loginStudent() {
            const phoneOrEmail = document.getElementById('loginPhone').value.trim();
            const unlockCode = document.getElementById('unlockCode').value.trim();
            
            if (!phoneOrEmail || !unlockCode) {
                showLoginMessage('Please enter both phone/email and unlock code', 'error');
                return;
            }
            
            const user = appState.users.find(u => 
                u.phone === phoneOrEmail || u.email === phoneOrEmail
            );
            
            if (!user) {
                showLoginMessage('User not found. Please register first.', 'error');
                return;
            }
            
            if (user.subscription.unlockCode !== unlockCode) {
                showLoginMessage('Invalid unlock code. Please check and try again.', 'error');
                return;
            }
            
            if (user.subscription.status !== 'approved') {
                showLoginMessage('Your account is still pending approval.', 'warning');
                return;
            }
            
            // Check if subscription is still valid
            const endDate = new Date(user.subscription.endDate);
            const now = new Date();
            if (endDate < now) {
                user.subscription.active = false;
                user.subscription.status = 'expired';
                saveAppData();
                showLoginMessage('Your subscription has expired. Please renew.', 'error');
                return;
            }
            
            // Login successful
            user.subscription.active = true;
            appState.currentUser = user;
            saveAppData();
            
            updateAccessStatus();
            showTab('home');
            showNotification('Login Successful!', 'Welcome back to RevisionVault Pro!', 'success');
            
            // Clear form
            document.getElementById('loginPhone').value = '';
            document.getElementById('unlockCode').value = '';
            document.getElementById('loginMessage').style.display = 'none';
        }

        function showLoginMessage(message, type) {
            const messageDiv = document.getElementById('loginMessage');
            messageDiv.textContent = message;
            messageDiv.style.display = 'block';
            messageDiv.style.background = type === 'error' ? '#fee2e2' : '#fef3c7';
            messageDiv.style.border = type === 'error' ? '2px solid #ef4444' : '2px solid #f59e0b';
            messageDiv.style.color = type === 'error' ? '#991b1b' : '#92400e';
        }

        // ==================== ACCESS STATUS ====================
        function updateAccessStatus() {
            const accessDiv = document.getElementById('accessStatus');
            if (!accessDiv) return;
            
            if (appState.currentUser && appState.currentUser.subscription.active && appState.currentUser.subscription.status === 'approved') {
                accessDiv.className = 'access-status access-granted';
                accessDiv.innerHTML = `
                    <div class="access-text">
                        <h3><i class="fas fa-unlock"></i> Access Granted</h3>
                        <p>Welcome, ${appState.currentUser.name}! Full access to all materials</p>
                    </div>
                    <button class="view-btn" onclick="logout()" style="width: auto; padding: 10px 20px;">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                `;
            } else {
                accessDiv.className = 'access-status';
                accessDiv.innerHTML = `
                    <div class="access-text">
                        <h3><i class="fas fa-lock"></i> Access Locked</h3>
                        <p>Subscribe to unlock all study materials and features</p>
                    </div>
                    <button class="view-btn" onclick="showTab('register')" style="width: auto; padding: 10px 20px;">
                        <i class="fas fa-crown"></i> Subscribe Now
                    </button>
                `;
            }
        }

        function logout() {
            appState.currentUser = null;
            localStorage.removeItem('currentUser');
            updateAccessStatus();
            showTab('home');
            showNotification('Logged Out', 'You have been logged out successfully', 'info');
        }

        // ==================== UPLOAD FUNCTIONS ====================
        function uploadMaterial() {
            const title = document.getElementById('uploadTitle').value.trim();
            const unitCode = document.getElementById('uploadUnitCode').value.trim();
            const university = document.getElementById('uploadUniversity').value;
            const subject = document.getElementById('uploadSubject').value.trim();
            const year = document.getElementById('uploadYear').value;
            const description = document.getElementById('uploadDescription').value.trim();
            const url = document.getElementById('uploadURL').value.trim();
            const phone = document.getElementById('uploaderPhone').value.trim();
            
            if (!title || !unitCode || !university || !subject || !year || !description || !url || !phone) {
                showNotification('Error', 'Please fill in all fields', 'error');
                return;
            }
            
            if (phone.length !== 10 || !phone.startsWith('07')) {
                showNotification('Error', 'Please enter a valid Kenyan phone number (07XXXXXXXX)', 'error');
                return;
            }
            
            const upload = {
                id: Date.now(),
                title: title,
                unitCode: unitCode,
                university: university,
                subject: subject,
                year: year,
                description: description,
                url: url,
                uploaderPhone: phone,
                uploadDate: new Date().toISOString(),
                status: 'pending',
                reviewedBy: null,
                reviewDate: null
            };
            
            appState.userUploads.push(upload);
            saveAppData();
            
            document.getElementById('uploadForm').style.display = 'none';
            document.getElementById('uploadSuccess').style.display = 'block';
            
            sendUploadNotification(upload);
            
            showNotification('Upload Submitted', 'Your material has been submitted for review', 'success');
            
            clearUploadForm();
        }

        function clearUploadForm() {
            const fields = ['uploadTitle', 'uploadUnitCode', 'uploadUniversity', 'uploadSubject', 'uploadYear', 'uploadDescription', 'uploadURL', 'uploaderPhone'];
            fields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field.tagName === 'SELECT') {
                    field.value = '';
                } else {
                    field.value = '';
                }
            });
        }

        function sendUploadNotification(upload) {
            const message = `ðŸ“¤ NEW UPLOAD - RevisionVault Pro\n\nðŸ“š Title: ${upload.title}\nðŸ“– Unit: ${upload.unitCode}\nðŸ« University: ${upload.university}\nðŸ“… Year: ${upload.year}\nðŸ‘¤ Uploader: ${upload.uploaderPhone}\n\nPlease review in admin panel.`;
            
            const whatsappUrl = `https://wa.me/${appState.adminWhatsApp}?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }

        // ==================== ADVERTISEMENT FUNCTIONS ====================
        function loadAdvertisements() {
            const container = document.getElementById('advertisementsGrid');
            if (!container) return;
            
            container.innerHTML = appState.advertisements.map(ad => `
                <div class="advertisement-card">
                    <div class="advertisement-image">
                        <i class="fas ${ad.image}"></i>
                    </div>
                    <div class="advertisement-details">
                        <h3 class="advertisement-card-title">${ad.title}</h3>
                        <p class="advertisement-card-description">${ad.description}</p>
                        <div class="advertisement-meta">
                            <span class="advertisement-type">${ad.type}</span>
                            <button class="advertisement-cta-btn" onclick="openAdDetails(${ad.id})">
                                ${ad.cta}
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function openAdDetails(adId) {
            const ad = appState.advertisements.find(a => a.id === adId);
            if (!ad) return;
            
            showNotification(ad.title, ad.description, 'info');
            
            if (ad.link && ad.link !== '#') {
                window.open(ad.link, '_blank');
            }
        }

        function closeAd(adId) {
            const ad = document.getElementById(adId);
            if (ad) {
                ad.style.display = 'none';
            }
        }

        // ==================== ADMIN FUNCTIONS ====================
        function adminLogin() {
            const password = document.getElementById('adminPassword').value;
            
            if (password === appState.adminPassword) {
                document.getElementById('adminPanel').style.display = 'block';
                document.getElementById('adminPassword').value = '';
                showNotification('Admin Login', 'Welcome to Admin Panel', 'success');
            } else {
                showNotification('Error', 'Invalid admin password', 'error');
            }
        }

        function adminLogout() {
            document.getElementById('adminPanel').style.display = 'none';
            showNotification('Admin Logout', 'Logged out of admin panel', 'info');
        }

        function showAdminSection(sectionName) {
            document.querySelectorAll('.admin-section').forEach(section => {
                section.style.display = 'none';
            });
            
            document.getElementById(`${sectionName}Section`).style.display = 'block';
            
            switch(sectionName) {
                case 'pending':
                    loadPendingApprovals();
                    break;
                case 'students':
                    loadAllStudents();
                    break;
                case 'uploads':
                    loadUserUploads();
                    break;
                case 'userAds':
                    loadUserAdvertisements();
                    break;
                case 'statistics':
                    displayUniversityStatistics();
                    break;
            }
        }

        function loadPendingApprovals() {
            const container = document.getElementById('pendingList');
            if (!container) return;
            
            const pendingUsers = appState.users.filter(u => u.subscription.status === 'pending');
            
            if (pendingUsers.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 20px; color: #64748b;">No pending approvals</div>';
                return;
            }
            
            container.innerHTML = pendingUsers.map(user => `
                <div class="admin-list-item">
                    <div>
                        <h4 style="margin: 0 0 5px 0; color: var(--dark);">${user.name}</h4>
                        <p style="margin: 0; color: #64748b; font-size: 14px;">${user.university} â€¢ ${user.course} â€¢ Year ${user.year}</p>
                        <p style="margin: 5px 0 0 0; color: #94a3b8; font-size: 12px;">
                            ðŸ“§ ${user.email}<br>
                            ðŸ“ž ${user.phone}<br>
                            ðŸ’³ Payment Code: ${user.subscription.paymentCode}
                        </p>
                    </div>
                    <div style="display: flex; gap: 5px;">
                        <button class="approve-btn" onclick="approveStudent('${user.phone}')" style="background: #10b981; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer;">
                            <i class="fas fa-check"></i> Approve
                        </button>
                        <button class="reject-btn" onclick="rejectStudent('${user.phone}')" style="background: #ef4444; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer;">
                            <i class="fas fa-times"></i> Reject
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function loadAllStudents() {
            const container = document.getElementById('studentList');
            if (!container) return;
            
            if (appState.users.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 20px; color: #64748b;">No registered students</div>';
                return;
            }
            
            container.innerHTML = appState.users.map(user => `
                <div class="admin-list-item">
                    <div>
                        <h4 style="margin: 0 0 5px 0; color: var(--dark);">${user.name}</h4>
                        <p style="margin: 0; color: #64748b; font-size: 14px;">${user.university} â€¢ ${user.course} â€¢ Year ${user.year}</p>
                        <p style="margin: 5px 0 0 0; color: #94a3b8; font-size: 12px;">
                            Status: <span class="upload-status-badge status-${user.subscription.active ? 'approved' : user.subscription.status}">
                                ${user.subscription.active ? 'ACTIVE' : user.subscription.status.toUpperCase()}
                            </span>
                        </p>
                    </div>
                    <div style="display: flex; gap: 5px;">
                        ${!user.subscription.active ? `
                            <button class="approve-btn" onclick="approveStudent('${user.phone}')" style="background: #10b981; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-size: 12px;">
                                <i class="fas fa-check"></i> Approve
                            </button>
                        ` : ''}
                        <button class="reject-btn" onclick="deleteStudent('${user.phone}')" style="background: #ef4444; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-size: 12px;">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function loadUserUploads() {
            const container = document.getElementById('userUploadsList');
            if (!container) return;
            
            const pendingUploads = appState.userUploads.filter(u => u.status === 'pending');
            
            if (pendingUploads.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 20px; color: #64748b;">No pending uploads</div>';
                return;
            }
            
            container.innerHTML = pendingUploads.map(upload => `
                <div class="admin-list-item">
                    <div>
                        <h4 style="margin: 0 0 5px 0; color: var(--dark);">${upload.title}</h4>
                        <p style="margin: 0; color: #64748b; font-size: 14px;">${upload.unitCode} â€¢ ${upload.university} â€¢ Year ${upload.year}</p>
                        <p style="margin: 5px 0 0 0; color: #94a3b8; font-size: 12px;">
                            Subject: ${upload.subject}<br>
                            Uploader: ${upload.uploaderPhone}<br>
                            Date: ${new Date(upload.uploadDate).toLocaleDateString()}
                        </p>
                    </div>
                    <div style="display: flex; gap: 5px;">
                        <button class="approve-btn" onclick="approveUpload(${upload.id})" style="background: #10b981; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer;">
                            <i class="fas fa-check"></i> Approve
                        </button>
                        <button class="reject-btn" onclick="rejectUpload(${upload.id})" style="background: #ef4444; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer;">
                            <i class="fas fa-times"></i> Reject
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // NEW: Load User Advertisements
        function loadUserAdvertisements() {
            const container = document.getElementById('userAdsList');
            if (!container) return;
            
            const pendingAds = appState.userAdvertisements.filter(ad => ad.status === 'pending');
            
            if (pendingAds.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 20px; color: #64748b;">No pending user advertisements</div>';
                return;
            }
            
            container.innerHTML = pendingAds.map(ad => `
                <div class="user-ad-item">
                    <div class="user-ad-info">
                        <h4>${ad.title}</h4>
                        <div class="user-ad-meta">
                            <span><i class="fas fa-${ad.image}"></i> ${ad.type}</span>
                            <span><i class="fas fa-calendar"></i> ${ad.duration} days</span>
                            <span><i class="fas fa-money-bill"></i> Ksh ${ad.price}</span>
                            <span><i class="fas fa-user"></i> ${ad.contactName}</span>
                        </div>
                        <p style="font-size: 12px; color: #64748b; margin-top: 5px;">${ad.description.substring(0, 100)}...</p>
                    </div>
                    <div style="display: flex; gap: 5px;">
                        <button class="approve-btn" onclick="approveUserAd(${ad.id})" style="background: #10b981; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer;">
                            <i class="fas fa-check"></i> Approve
                        </button>
                        <button class="reject-btn" onclick="rejectUserAd(${ad.id})" style="background: #ef4444; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer;">
                            <i class="fas fa-times"></i> Reject
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function approveStudent(phone) {
            const user = appState.users.find(u => u.phone === phone);
            if (!user) return;
            
            const unlockCode = generateUnlockCode();
            user.subscription.status = 'approved';
            user.subscription.active = true;
            user.subscription.unlockCode = unlockCode;
            user.subscription.startDate = new Date().toISOString();
            user.subscription.endDate = new Date(Date.now() + 5 * 30 * 24 * 60 * 60 * 1000).toISOString();
            user.subscription.approvedDate = new Date().toISOString();
            
            saveAppData();
            loadPendingApprovals();
            loadAllStudents();
            
            // Send unlock code via WhatsApp
            sendUnlockCodeToUser(user);
            
            showNotification('Approved', `Unlock code sent to ${user.name}`, 'success');
        }

        function rejectStudent(phone) {
            if (!confirm('Are you sure you want to reject this student?')) return;
            
            appState.users = appState.users.filter(u => u.phone !== phone);
            saveAppData();
            loadPendingApprovals();
            loadAllStudents();
            
            showNotification('Rejected', 'Student registration has been rejected', 'info');
        }

        function deleteStudent(phone) {
            if (!confirm('Are you sure you want to delete this student?')) return;
            
            appState.users = appState.users.filter(u => u.phone !== phone);
            saveAppData();
            loadAllStudents();
            
            showNotification('Deleted', 'Student has been deleted', 'info');
        }

        function approveUpload(uploadId) {
            const upload = appState.userUploads.find(u => u.id === uploadId);
            if (!upload) return;
            
            // Add to documents
            const newDoc = {
                Title: upload.title,
                "Unit Code": upload.unitCode,
                University: upload.university,
                Type: "pdf",
                Subject: upload.subject,
                Year: upload.year,
                Description: upload.description,
                URL: upload.url,
                Recent: true
            };
            
            appState.documents.push(newDoc);
            upload.status = 'approved';
            upload.reviewedBy = 'admin';
            upload.reviewDate = new Date().toISOString();
            
            saveAppData();
            loadUserUploads();
            
            // Notify uploader
            notifyUploader(upload.uploaderPhone, upload.title, 'approved');
            
            showNotification('Upload Approved', 'Material added to library', 'success');
        }

        function rejectUpload(uploadId) {
            if (!confirm('Are you sure you want to reject this upload?')) return;
            
            const upload = appState.userUploads.find(u => u.id === uploadId);
            if (!upload) return;
            
            upload.status = 'rejected';
            upload.reviewedBy = 'admin';
            upload.reviewDate = new Date().toISOString();
            
            saveAppData();
            loadUserUploads();
            
            // Notify uploader
            notifyUploader(upload.uploaderPhone, upload.title, 'rejected');
            
            showNotification('Upload Rejected', 'Material has been rejected', 'info');
        }

        // NEW: Approve User Advertisement
        function approveUserAd(adId) {
            const ad = appState.userAdvertisements.find(a => a.id === adId);
            if (!ad) return;
            
            // Update ad status
            ad.status = 'approved';
            ad.approvedBy = 'admin';
            ad.approvalDate = new Date().toISOString();
            ad.startDate = new Date().toISOString();
            ad.endDate = new Date(Date.now() + ad.duration * 24 * 60 * 60 * 1000).toISOString();
            
            // Add to main advertisements
            const mainAd = {
                id: ad.id,
                title: ad.title,
                description: ad.description,
                type: ad.type.charAt(0).toUpperCase() + ad.type.slice(1),
                cta: ad.cta,
                link: ad.link,
                image: ad.image,
                driveLink: ad.driveLink,
                targetUniversities: ad.targetUniversities,
                approvedDate: ad.approvalDate,
                expires: ad.endDate
            };
            
            appState.advertisements.push(mainAd);
            
            saveAppData();
            loadUserAdvertisements();
            loadAdvertisements();
            
            // Notify user
            notifyUserAdApproval(ad);
            
            showNotification('Advertisement Approved', `Ad from ${ad.contactName} has been approved and published`, 'success');
        }

        // NEW: Reject User Advertisement
        function rejectUserAd(adId) {
            if (!confirm('Are you sure you want to reject this advertisement?')) return;
            
            const ad = appState.userAdvertisements.find(a => a.id === adId);
            if (!ad) return;
            
            ad.status = 'rejected';
            ad.approvedBy = 'admin';
            ad.approvalDate = new Date().toISOString();
            
            saveAppData();
            loadUserAdvertisements();
            
            notifyUserAdRejection(ad);
            
            showNotification('Advertisement Rejected', 'User has been notified of the rejection', 'info');
        }

        function notifyUploader(phone, title, status) {
            const message = `ðŸ“¤ UPLOAD REVIEW - RevisionVault Pro\n\nYour upload "${title}" has been ${status}.\n\nThank you for contributing!`;
            
            const whatsappUrl = `https://wa.me/254${phone.substring(1)}?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }

        // NEW: Notify User Ad Approval
        function notifyUserAdApproval(ad) {
            const message = `âœ… ADVERTISEMENT APPROVED - RevisionVault Pro\n\nYour advertisement "${ad.title}" has been approved!\n\nðŸ“… Duration: ${ad.duration} days\nðŸ’° Amount Paid: Ksh ${ad.price}\nðŸ“Š Status: Active\n\nYour ad is now live and visible to thousands of university students.\n\nThank you for advertising with us!`;
            
            const whatsappUrl = `https://wa.me/254${ad.contactPhone.substring(1)}?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }

        // NEW: Notify User Ad Rejection
        function notifyUserAdRejection(ad) {
            const message = `âŒ ADVERTISEMENT REJECTED - RevisionVault Pro\n\nYour advertisement "${ad.title}" has been rejected.\n\nIf you have questions about the rejection, please contact us at ${appState.adminWhatsApp}.\n\nPayment will be refunded within 24 hours.`;
            
            const whatsappUrl = `https://wa.me/254${ad.contactPhone.substring(1)}?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }

        function generateUnlockCode() {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
            let code = '';
            for (let i = 0; i < 8; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        function sendUnlockCodeToUser(user) {
            const message = `ðŸ”“ ACCOUNT APPROVED - RevisionVault Pro\n\nHello ${user.name},\n\nYour account has been approved!\n\nðŸ”‘ Unlock Code: ${user.subscription.unlockCode}\n\nðŸ“± Login Steps:\n1. Go to RevisionVault Pro\n2. Click Login tab\n3. Enter your phone: ${user.phone}\n4. Enter unlock code: ${user.subscription.unlockCode}\n5. Click Login\n\nðŸŽ‰ Welcome to RevisionVault Pro!`;
            
            const whatsappUrl = `https://wa.me/254${user.phone.substring(1)}?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }

        // ==================== TAB NAVIGATION ====================
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            
            document.getElementById(tabName).style.display = 'block';
            
            // Update bottom nav active state
            document.querySelectorAll('.bottom-nav .nav-btn').forEach(btn => btn.classList.remove('active'));
            
            const buttons = {
                'home': 0,
                'materials': 1,
                'advertisements': 2,
                'upload': 3,
                'register': 4,
                'admin': 5
            };
            
            if (buttons[tabName] !== undefined) {
                document.querySelectorAll('.bottom-nav .nav-btn')[buttons[tabName]].classList.add('active');
            }
            
            if (tabName === 'login' || tabName === 'userAdUpload') {
                document.querySelectorAll('.bottom-nav .nav-btn').forEach(btn => btn.classList.remove('active'));
            }
            
            // Clear search when switching tabs
            if (tabName !== 'home') {
                document.getElementById('searchInput').value = '';
                document.getElementById('searchResults').classList.remove('active');
                document.getElementById('continueReading').style.display = 'block';
                hideSearchSuggestions();
            }
            
            // Special tab handling
            switch(tabName) {
                case 'home':
                    renderHomeContent();
                    break;
                case 'materials':
                    renderAllMaterials();
                    break;
                case 'advertisements':
                    loadAdvertisements();
                    break;
                case 'upload':
                    document.getElementById('uploadForm').style.display = 'block';
                    document.getElementById('uploadSuccess').style.display = 'none';
                    break;
                case 'admin':
                    document.getElementById('adminPassword').value = '';
                    break;
                case 'userAdUpload':
                    // Already handled by openUserAdUpload function
                    break;
            }
        }

        // ==================== SAMPLE DATA INITIALIZATION ====================
        function initializeSampleData() {
            // This function ensures we have sample data for demonstration
            if (appState.documents.length === 0) {
                appState.documents = DOCUMENTS_DATA;
                saveAppData();
            }
            
            if (appState.advertisements.length === 0) {
                appState.advertisements = ADVERTISEMENTS;
                saveAppData();
            }
        }

        // ==================== AI CHAT FUNCTIONS ====================
        function openAIChat() {
            openModal('aiChatModal');
        }

        function askAI() {
            const question = document.getElementById('aiQuestion').value.trim();
            if (!question) return;
            
            const messagesDiv = document.getElementById('aiChatMessages');
            
            // Add user question
            messagesDiv.innerHTML += `
                <div style="background: #dbeafe; padding: 10px; border-radius: 10px; margin-bottom: 10px; text-align: right;">
                    <strong><i class="fas fa-user"></i> You:</strong> ${question}
                </div>
            `;
            
            // Clear input
            document.getElementById('aiQuestion').value = '';
            
            // Simulate AI response
            setTimeout(() => {
                const responses = [
                    "Based on your question, here's a detailed explanation...",
                    "I'd recommend studying the following key concepts...",
                    "This topic is covered in several materials. Check AGRO 222 notes for more details.",
                    "Great question! Here's what you need to know for your exams...",
                    "I suggest focusing on these three main points..."
                ];
                
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                
                messagesDiv.innerHTML += `
                    <div style="background: #f1f5f9; padding: 10px; border-radius: 10px; margin-bottom: 10px;">
                        <strong><i class="fas fa-robot"></i> AI Assistant:</strong> ${randomResponse}
                    </div>
                `;
                
                // Scroll to bottom
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            }, 1000);
        }

        // ==================== NOTIFICATION SYSTEM ====================
        function showNotification(title, message, type = 'info') {
            const notification = document.getElementById('notification');
            const titleEl = document.getElementById('notificationTitle');
            const messageEl = document.getElementById('notificationMessage');
            
            titleEl.textContent = title;
            messageEl.textContent = message;
            
            // Set color based on type
            if (type === 'error') {
                notification.style.borderLeftColor = 'var(--danger)';
            } else if (type === 'warning') {
                notification.style.borderLeftColor = 'var(--warning)';
            } else if (type === 'success') {
                notification.style.borderLeftColor = 'var(--success)';
            } else {
                notification.style.borderLeftColor = 'var(--primary)';
            }
            
            notification.classList.add('show');
            
            // Auto hide after 5 seconds
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }

        function hideNotification() {
            document.getElementById('notification').classList.remove('show');
        }

        // ==================== UTILITY FUNCTIONS ====================
        function copyText(text) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification('Copied!', 'Text copied to clipboard', 'success');
            });
        }
    </script>
</body>
</html>