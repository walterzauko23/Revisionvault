<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RevisionVault Pro - Premium University Materials</title>
    <style>
        :root {
            --primary: #1a2980;
            --secondary: #26d0ce;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --dark: #1f2937;
            --light: #f8fafc;
            --gray: #6b7280;
            --border: #e5e7eb;
            --radius: 12px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--dark);
            line-height: 1.6;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 24px;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
        }

        /* Header Styles */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, #26d0ce 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .logo-container {
            width: 60px;
            height: 60px;
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
        }

        .header h1 {
            font-size: 36px;
            font-weight: 800;
            margin-bottom: 10px;
        }

        .header-subtitle {
            font-size: 14px;
            opacity: 0.9;
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            background: #f8fafc;
            border-bottom: 2px solid var(--border);
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            color: var(--gray);
            transition: var(--transition);
            border-bottom: 3px solid transparent;
        }

        .tab:hover {
            background: #f1f5f9;
            color: var(--primary);
        }

        .tab.active {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            background: white;
        }

        .tab i {
            margin-right: 10px;
        }

        /* Tab Content */
        .tab-content {
            display: none;
            padding: 30px;
            min-height: 500px;
        }

        .tab-content.active {
            display: block;
        }

        /* Form Styles */
        .form-section {
            background: white;
            border-radius: var(--radius);
            padding: 30px;
            border: 2px solid var(--border);
            margin-bottom: 25px;
            box-shadow: var(--shadow);
        }

        .form-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .form-title-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 16px;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(26, 41, 128, 0.1);
        }

        /* Button Styles */
        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(26, 41, 128, 0.2);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, #34d399 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #f87171 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning) 0%, #fbbf24 100%);
            color: white;
        }

        .btn-secondary {
            background: #e5e7eb;
            color: var(--dark);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 14px;
        }

        /* Grid Layout */
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        /* Cards */
        .card {
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            border: 2px solid var(--border);
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .card-header {
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        /* Badges */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 6px 12px;
            border-radius: 50px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-warning {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-danger {
            background: #fee2e2;
            color: #991b1b;
        }

        .badge-info {
            background: #dbeafe;
            color: #1e40af;
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
            border-radius: var(--radius);
            border: 2px solid var(--border);
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
        }

        .admin-table th,
        .admin-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .admin-table th {
            background: #f8fafc;
            font-weight: 600;
            color: var(--dark);
        }

        .admin-table tr:hover {
            background: #f9fafb;
        }

        /* Document Card */
        .document-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid var(--border);
            transition: var(--transition);
        }

        .document-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .doc-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%);
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin-bottom: 15px;
        }

        /* Search Bar */
        .search-container {
            position: relative;
            margin-bottom: 30px;
        }

        .search-input {
            width: 100%;
            padding: 16px 20px 16px 50px;
            border: 2px solid var(--border);
            border-radius: 50px;
            font-size: 16px;
            transition: var(--transition);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(26, 41, 128, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }

        /* University Filter */
        .university-filter {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            align-items: center;
        }

        .university-badge {
            padding: 10px 20px;
            border-radius: 50px;
            background: #f3f4f6;
            color: var(--gray);
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .university-badge:hover {
            background: #e5e7eb;
        }

        .university-badge.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border-color: var(--primary);
        }

        /* Admin Tabs */
        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .admin-tab-btn {
            padding: 12px 24px;
            border-radius: 8px;
            background: #f3f4f6;
            color: var(--gray);
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .admin-tab-btn:hover {
            background: #e5e7eb;
        }

        .admin-tab-btn.active {
            background: var(--primary);
            color: white;
        }

        .admin-tab-content {
            display: none;
        }

        .admin-tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f4f6;
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 20px 25px;
            border-radius: 12px;
            background: white;
            box-shadow: var(--shadow-lg);
            border-left: 5px solid var(--primary);
            z-index: 9999;
            animation: slideIn 0.3s ease;
            max-width: 400px;
        }

        .notification.success {
            border-left-color: var(--success);
        }

        .notification.error {
            border-left-color: var(--danger);
        }

        .notification.warning {
            border-left-color: var(--warning);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Document Viewer */
        .document-viewer {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .viewer-content {
            background: white;
            border-radius: 16px;
            width: 90%;
            height: 90%;
            display: flex;
            flex-direction: column;
        }

        .viewer-header {
            padding: 20px;
            border-bottom: 2px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .viewer-body {
            flex: 1;
            padding: 20px;
            overflow: auto;
        }

        /* Upload Area */
        .upload-area {
            border: 3px dashed var(--border);
            border-radius: var(--radius);
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 20px;
        }

        .upload-area:hover {
            border-color: var(--primary);
            background: #f8fafc;
        }

        .upload-area.dragover {
            border-color: var(--success);
            background: #d1fae5;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                padding: 15px;
            }
            
            .grid-3 {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 28px;
            }
            
            .university-filter {
                flex-direction: column;
                align-items: stretch;
            }
        }

        /* Copyright */
        .copyright-footer {
            text-align: center;
            padding: 25px;
            color: var(--gray);
            font-size: 14px;
            border-top: 1px solid var(--border);
            background: #f8f9fa;
            margin-top: 40px;
        }

        .copyright-footer strong {
            color: var(--primary);
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h3 style="margin-top: 20px; color: var(--primary);">Loading RevisionVault Pro</h3>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer"></div>

    <!-- Document Viewer -->
    <div class="document-viewer" id="documentViewer" style="display: none;">
        <div class="viewer-content">
            <div class="viewer-header">
                <h3 id="viewerTitle"></h3>
                <button class="btn btn-danger" onclick="closeViewer()">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>
            <div class="viewer-body" id="viewerBody">
                <!-- PDF viewer or document content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Admin Secret Button -->
    <div style="position: fixed; top: 20px; right: 20px; z-index: 9998;">
        <button onclick="showAdminSecretAccess()" class="btn btn-primary">
            <i class="fas fa-shield-alt"></i>
        </button>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <div style="display: flex; align-items: center; justify-content: center; gap: 20px; margin-bottom: 15px; flex-wrap: wrap;">
                <div class="logo-container">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <div>
                    <h1>RevisionVault Pro</h1>
                    <p>Premium University Study Materials</p>
                </div>
            </div>
            <p class="header-subtitle">
                <i class="fas fa-shield-alt"></i> Ksh 67 for 5 Months • 
                <i class="fas fa-user-check"></i> Admin Approval Required • 
                <i class="fas fa-unlock"></i> Full Document Access
            </p>
        </div>

        <!-- Tabs Navigation -->
        <div class="tabs">
            <div class="tab active" onclick="switchTab('student')">
                <i class="fas fa-user-graduate"></i>
                <span>Student Portal</span>
            </div>
            <div class="tab" onclick="switchTab('documents')" id="documentsTab">
                <i class="fas fa-file-alt"></i>
                <span>Study Materials</span>
            </div>
            <div class="tab" onclick="switchTab('favorites')" id="favoritesTab">
                <i class="fas fa-heart"></i>
                <span>My Favorites</span>
            </div>
            <div class="tab" onclick="switchTab('admin')" id="adminTab">
                <i class="fas fa-user-shield"></i>
                <span>Admin Panel</span>
            </div>
        </div>

        <!-- ==================== STUDENT PORTAL ==================== -->
        <div id="student" class="tab-content active">
            <div class="registration-flow">
                <!-- Step 1: Registration -->
                <div id="step1" class="form-section">
                    <div class="form-title">
                        <div class="form-title-icon">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <span>Student Registration</span>
                    </div>
                    
                    <div class="grid-2">
                        <div class="form-group">
                            <label>Full Name *</label>
                            <input type="text" id="regFullName" class="form-control" placeholder="Enter your full name" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Email Address *</label>
                            <input type="email" id="regEmail" class="form-control" placeholder="Enter your email" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Phone Number *</label>
                            <input type="tel" id="regPhone" class="form-control" placeholder="07XXXXXXXX" maxlength="10" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Select University *</label>
                            <select id="regUniversity" class="form-control" required>
                                <option value="">Choose your university</option>
                                <option value="University of Nairobi">University of Nairobi</option>
                                <option value="Kenyatta University">Kenyatta University</option>
                                <option value="Egerton University">Egerton University</option>
                                <option value="JKUAT">JKUAT</option>
                                <option value="Moi University">Moi University</option>
                                <option value="Other">Other University</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Course/Program *</label>
                            <input type="text" id="regCourse" class="form-control" placeholder="e.g., Bachelor of Computer Science" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Year of Study</label>
                            <select id="regYear" class="form-control">
                                <option value="">Select year</option>
                                <option value="1">Year 1</option>
                                <option value="2">Year 2</option>
                                <option value="3">Year 3</option>
                                <option value="4">Year 4</option>
                                <option value="5">Year 5</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Create Password *</label>
                            <input type="password" id="regPassword" class="form-control" placeholder="Create a secure password" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Confirm Password *</label>
                            <input type="password" id="regConfirmPassword" class="form-control" placeholder="Confirm your password" required>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="registerStudent()" style="width: 100%; padding: 16px; margin-top: 20px;">
                        <i class="fas fa-user-plus"></i> Register Account
                    </button>
                </div>

                <!-- Step 2: Account Dashboard -->
                <div id="step2" class="form-section" style="display: none;">
                    <div class="form-title">
                        <div class="form-title-icon">
                            <i class="fas fa-user-check"></i>
                        </div>
                        <span>Your Account Dashboard</span>
                    </div>
                    
                    <div class="grid-2">
                        <div class="card">
                            <div class="card-header">
                                <span>Personal Information</span>
                                <span class="badge badge-info" id="accountStatus">Pending</span>
                            </div>
                            <div class="form-group">
                                <label>Full Name</label>
                                <div class="form-control" style="background: #f8fafc;" id="accountName"></div>
                            </div>
                            <div class="form-group">
                                <label>Email</label>
                                <div class="form-control" style="background: #f8fafc;" id="accountEmail"></div>
                            </div>
                            <div class="form-group">
                                <label>Phone</label>
                                <div class="form-control" style="background: #f8fafc;" id="accountPhone"></div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <span>Academic Information</span>
                            </div>
                            <div class="form-group">
                                <label>University</label>
                                <div class="form-control" style="background: #f8fafc;" id="accountUniversity"></div>
                            </div>
                            <div class="form-group">
                                <label>Course</label>
                                <div class="form-control" style="background: #f8fafc;" id="accountCourse"></div>
                            </div>
                            <div class="form-group">
                                <label>Access Status</label>
                                <div class="form-control" style="background: #f8fafc;" id="accessStatus">Locked</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <button class="btn btn-primary" onclick="goToPayment()" id="paymentBtn">
                            <i class="fas fa-credit-card"></i> Subscribe Now (Ksh 67)
                        </button>
                        <button class="btn btn-secondary" onclick="logout()" style="margin-left: 15px;">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>

                <!-- Step 3: Payment -->
                <div id="step3" class="form-section" style="display: none;">
                    <div class="form-title">
                        <div class="form-title-icon">
                            <i class="fas fa-credit-card"></i>
                        </div>
                        <span>Subscribe & Pay</span>
                    </div>
                    
                    <div class="card" style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); border: 3px solid var(--success);">
                        <h3 style="color: var(--success); margin-bottom: 15px;">
                            <i class="fas fa-money-bill-wave"></i> Payment Instructions
                        </h3>
                        <p>Send <strong>Ksh 67</strong> to:</p>
                        <div style="font-size: 24px; font-weight: bold; color: var(--primary); margin: 15px 0;">0765 098 865</div>
                        <p>Then submit your transaction details below.</p>
                    </div>
                    
                    <div class="grid-2" style="margin-top: 20px;">
                        <div class="form-group">
                            <label>M-Pesa Transaction Code *</label>
                            <input type="text" id="paymentCode" class="form-control" placeholder="Enter transaction code" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Payment Date *</label>
                            <input type="date" id="paymentDate" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Payment Screenshot (Optional)</label>
                            <input type="file" id="paymentScreenshot" class="form-control" accept="image/*">
                        </div>
                        
                        <div class="form-group">
                            <label>Payment Amount</label>
                            <input type="number" id="paymentAmount" class="form-control" value="67" readonly>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 20px;">
                        <button class="btn btn-success" onclick="submitPayment()" style="flex: 1;">
                            <i class="fas fa-paper-plane"></i> Submit Payment
                        </button>
                        <button class="btn btn-secondary" onclick="goToAccount()">
                            <i class="fas fa-arrow-left"></i> Back
                        </button>
                    </div>
                </div>

                <!-- Step 4: Unlock Code -->
                <div id="step4" class="form-section" style="display: none;">
                    <div class="form-title">
                        <div class="form-title-icon">
                            <i class="fas fa-unlock-alt"></i>
                        </div>
                        <span>Unlock Your Account</span>
                    </div>
                    
                    <div id="pendingApproval" class="card" style="text-align: center; padding: 40px;">
                        <div style="width: 80px; height: 80px; margin: 0 auto 20px; border-radius: 50%; background: linear-gradient(135deg, var(--warning) 0%, #fbbf24 100%); color: white; display: flex; align-items: center; justify-content: center; font-size: 36px;">
                            <i class="fas fa-clock"></i>
                        </div>
                        <h3 style="color: var(--warning); margin-bottom: 15px;">Waiting for Approval</h3>
                        <p>Your payment is being reviewed. You'll receive an unlock code via WhatsApp once approved.</p>
                    </div>
                    
                    <div id="readyForUnlock" style="display: none;">
                        <div class="card" style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); border: 3px solid var(--success); text-align: center; padding: 30px;">
                            <div style="width: 60px; height: 60px; margin: 0 auto 15px; border-radius: 50%; background: var(--success); color: white; display: flex; align-items: center; justify-content: center; font-size: 24px;">
                                <i class="fas fa-check"></i>
                            </div>
                            <h3 style="color: var(--success); margin-bottom: 15px;">Payment Approved!</h3>
                            <p>Enter your unlock code below:</p>
                            
                            <div style="max-width: 400px; margin: 20px auto;">
                                <input type="text" id="unlockCodeInput" class="form-control" placeholder="Enter unlock code" style="text-align: center; font-size: 18px; letter-spacing: 2px;">
                            </div>
                            
                            <div style="display: flex; gap: 15px; justify-content: center;">
                                <button class="btn btn-success" onclick="verifyUnlockCode()">
                                    <i class="fas fa-unlock"></i> Unlock Account
                                </button>
                                <button class="btn btn-secondary" onclick="requestNewCode()">
                                    <i class="fas fa-sync"></i> Resend Code
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="accessGranted" style="display: none; text-align: center; padding: 40px;">
                        <div style="width: 80px; height: 80px; margin: 0 auto 20px; border-radius: 50%; background: linear-gradient(135deg, var(--success) 0%, #34d399 100%); color: white; display: flex; align-items: center; justify-content: center; font-size: 36px;">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <h3 style="color: var(--success); margin-bottom: 15px;">Access Granted!</h3>
                        <p>You now have full access to all study materials for 5 months.</p>
                        <button class="btn btn-primary" onclick="switchTab('documents')" style="margin-top: 20px;">
                            <i class="fas fa-book"></i> Access Materials
                        </button>
                    </div>
                </div>
            </div>

            <!-- Login Section -->
            <div id="loginSection" class="form-section" style="margin-top: 30px; background: #f8fafc;">
                <h3 style="color: var(--primary); margin-bottom: 20px; text-align: center;">Already have an account?</h3>
                <div style="display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;">
                    <input type="text" id="loginPhone" placeholder="Phone Number" class="form-control" style="max-width: 200px;">
                    <input type="password" id="loginPassword" placeholder="Password" class="form-control" style="max-width: 200px;">
                    <button class="btn btn-primary" onclick="loginStudent()">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                </div>
            </div>
        </div>

        <!-- ==================== DOCUMENTS SECTION ==================== -->
        <div id="documents" class="tab-content">
            <div class="form-section">
                <div class="form-title">
                    <div class="form-title-icon">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <span>University Study Materials</span>
                </div>
                
                <!-- Access Status -->
                <div id="accessStatusBar" class="card" style="margin-bottom: 30px; text-align: center;">
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
                        <div>
                            <h4 id="accessStatusText" style="color: var(--danger);">
                                <i class="fas fa-lock"></i> Access Locked
                            </h4>
                            <p>Subscribe to unlock all materials</p>
                        </div>
                        <button class="btn btn-primary" onclick="switchTab('student')" id="subscribeBtnDocs">
                            <i class="fas fa-crown"></i> Subscribe Now
                        </button>
                    </div>
                </div>

                <!-- Search and Filter -->
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="searchInput" class="search-input" placeholder="Search by unit code (e.g., BOTA241) or document title...">
                </div>

                <!-- University Filter -->
                <div class="university-filter">
                    <span>Filter by University:</span>
                    <div class="university-badge active" onclick="filterByUniversity('all')">All Universities</div>
                    <div class="university-badge" onclick="filterByUniversity('University of Nairobi')">UoN</div>
                    <div class="university-badge" onclick="filterByUniversity('Kenyatta University')">KU</div>
                    <div class="university-badge" onclick="filterByUniversity('Egerton University')">Egerton</div>
                    <div class="university-badge" onclick="filterByUniversity('JKUAT')">JKUAT</div>
                    <div class="university-badge" onclick="filterByUniversity('Moi University')">Moi</div>
                </div>

                <!-- Documents Grid -->
                <div class="grid-3" id="documentsGrid">
                    <!-- Documents will be loaded here -->
                    <div class="card" style="text-align: center; padding: 40px;">
                        <div class="doc-icon">
                            <i class="fas fa-lock"></i>
                        </div>
                        <h4>Access Locked</h4>
                        <p>Subscribe to view documents</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== FAVORITES SECTION ==================== -->
        <div id="favorites" class="tab-content">
            <div class="form-section">
                <div class="form-title">
                    <div class="form-title-icon">
                        <i class="fas fa-heart"></i>
                    </div>
                    <span>My Favorite Documents</span>
                </div>
                
                <div id="favoritesGrid" class="grid-3">
                    <div class="card" style="text-align: center; padding: 40px;">
                        <div class="doc-icon">
                            <i class="fas fa-heart"></i>
                        </div>
                        <h4>No Favorites Yet</h4>
                        <p>Add documents to favorites to see them here</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== ADMIN PANEL ==================== -->
        <div id="admin" class="tab-content">
            <!-- Admin Login -->
            <div id="adminLogin" class="form-section">
                <div class="form-title">
                    <div class="form-title-icon">
                        <i class="fas fa-user-shield"></i>
                    </div>
                    <span>Admin Authentication</span>
                </div>
                
                <div style="max-width: 400px; margin: 0 auto;">
                    <div class="form-group">
                        <label>Admin Password</label>
                        <input type="password" id="adminPassword" class="form-control" placeholder="Enter admin password" required>
                        <small style="color: var(--gray);">Default: walter.zauko23</small>
                    </div>
                    
                    <button class="btn btn-primary" onclick="adminLogin()" style="width: 100%; padding: 16px;">
                        <i class="fas fa-sign-in-alt"></i> Login as Admin
                    </button>
                </div>
            </div>

            <!-- Admin Dashboard -->
            <div id="adminDashboard" style="display: none;">
                <!-- Admin Tabs -->
                <div class="admin-tabs">
                    <div class="admin-tab-btn active" onclick="switchAdminTab('dashboard')">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </div>
                    <div class="admin-tab-btn" onclick="switchAdminTab('approvals')">
                        <i class="fas fa-user-check"></i> Pending Approvals
                    </div>
                    <div class="admin-tab-btn" onclick="switchAdminTab('users')">
                        <i class="fas fa-users"></i> All Users
                    </div>
                    <div class="admin-tab-btn" onclick="switchAdminTab('upload')">
                        <i class="fas fa-upload"></i> Upload Documents
                    </div>
                    <div class="admin-tab-btn" onclick="switchAdminTab('documents')">
                        <i class="fas fa-file-alt"></i> Manage Documents
                    </div>
                    <div class="admin-tab-btn" onclick="switchAdminTab('settings')">
                        <i class="fas fa-cog"></i> Settings
                    </div>
                </div>

                <!-- Dashboard Tab -->
                <div id="adminDashboardTab" class="admin-tab-content active">
                    <div class="grid-3">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-users"></i> Total Users
                            </div>
                            <h2 style="font-size: 36px; color: var(--primary);" id="totalUsers">0</h2>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-clock"></i> Pending Approvals
                            </div>
                            <h2 style="font-size: 36px; color: var(--warning);" id="pendingApprovalsCount">0</h2>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-file-alt"></i> Total Documents
                            </div>
                            <h2 style="font-size: 36px; color: var(--success);" id="totalDocuments">0</h2>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-unlock"></i> Active Subscriptions
                            </div>
                            <h2 style="font-size: 36px; color: var(--info);" id="activeSubscriptions">0</h2>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-money-bill-wave"></i> Total Revenue
                            </div>
                            <h2 style="font-size: 36px; color: var(--success);" id="totalRevenue">Ksh 0</h2>
                        </div>
                    </div>
                </div>

                <!-- Pending Approvals Tab -->
                <div id="adminApprovalsTab" class="admin-tab-content">
                    <div class="table-container">
                        <table class="admin-table" id="pendingPaymentsTable">
                            <thead>
                                <tr>
                                    <th>Student</th>
                                    <th>Phone</th>
                                    <th>University</th>
                                    <th>Transaction Code</th>
                                    <th>Amount</th>
                                    <th>Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Payments will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- All Users Tab -->
                <div id="adminUsersTab" class="admin-tab-content">
                    <div class="search-container" style="margin-bottom: 20px;">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" id="searchUsers" class="search-input" placeholder="Search users...">
                    </div>
                    
                    <div class="table-container">
                        <table class="admin-table" id="allUsersTable">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>University</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Users will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Upload Documents Tab -->
                <div id="adminUploadTab" class="admin-tab-content">
                    <div class="form-section">
                        <div class="form-title">
                            <div class="form-title-icon">
                                <i class="fas fa-upload"></i>
                            </div>
                            <span>Upload New Document</span>
                        </div>
                        
                        <div class="grid-2">
                            <div class="form-group">
                                <label>Document Title *</label>
                                <input type="text" id="docTitle" class="form-control" placeholder="Enter document title" required>
                            </div>
                            
                            <div class="form-group">
                                <label>Unit Code *</label>
                                <input type="text" id="docUnitCode" class="form-control" placeholder="e.g., BOTA241" required>
                            </div>
                            
                            <div class="form-group">
                                <label>University *</label>
                                <select id="docUniversity" class="form-control" required>
                                    <option value="">Select university</option>
                                    <option value="University of Nairobi">University of Nairobi</option>
                                    <option value="Kenyatta University">Kenyatta University</option>
                                    <option value="Egerton University">Egerton University</option>
                                    <option value="JKUAT">JKUAT</option>
                                    <option value="Moi University">Moi University</option>
                                    <option value="All">All Universities</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>Course/Subject</label>
                                <input type="text" id="docSubject" class="form-control" placeholder="e.g., Botany, Computer Science">
                            </div>
                            
                            <div class="form-group">
                                <label>Year</label>
                                <select id="docYear" class="form-control">
                                    <option value="">Select year</option>
                                    <option value="1">Year 1</option>
                                    <option value="2">Year 2</option>
                                    <option value="3">Year 3</option>
                                    <option value="4">Year 4</option>
                                    <option value="5">Year 5</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>Document Type</label>
                                <select id="docType" class="form-control">
                                    <option value="pdf">PDF</option>
                                    <option value="doc">Word Document</option>
                                    <option value="ppt">Presentation</option>
                                    <option value="image">Image</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="docDescription" class="form-control" rows="3" placeholder="Document description..."></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>Upload Document *</label>
                            <div class="upload-area" id="uploadArea" onclick="document.getElementById('docFile').click()">
                                <i class="fas fa-cloud-upload-alt" style="font-size: 48px; color: var(--primary); margin-bottom: 15px;"></i>
                                <p>Click to upload or drag and drop</p>
                                <p style="font-size: 14px; color: var(--gray);">PDF, DOC, PPT, Images (Max 10MB)</p>
                            </div>
                            <input type="file" id="docFile" style="display: none;" accept=".pdf,.doc,.docx,.ppt,.pptx,.jpg,.jpeg,.png">
                        </div>
                        
                        <div style="display: flex; gap: 15px; margin-top: 20px;">
                            <button class="btn btn-success" onclick="uploadDocument()" style="flex: 1;">
                                <i class="fas fa-upload"></i> Upload Document
                            </button>
                            <button class="btn btn-secondary" onclick="clearUploadForm()">
                                <i class="fas fa-redo"></i> Clear
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Manage Documents Tab -->
                <div id="adminDocumentsTab" class="admin-tab-content">
                    <div class="search-container" style="margin-bottom: 20px;">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" id="searchAdminDocs" class="search-input" placeholder="Search documents...">
                    </div>
                    
                    <div class="table-container">
                        <table class="admin-table" id="adminDocumentsTable">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Unit Code</th>
                                    <th>University</th>
                                    <th>Subject</th>
                                    <th>Upload Date</th>
                                    <th>Views</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Documents will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div id="adminSettingsTab" class="admin-tab-content">
                    <div class="form-section">
                        <div class="form-title">
                            <div class="form-title-icon">
                                <i class="fas fa-cog"></i>
                            </div>
                            <span>Admin Settings</span>
                        </div>
                        
                        <div class="grid-2">
                            <div class="form-group">
                                <label>Change Admin Password</label>
                                <input type="password" id="newAdminPassword" class="form-control" placeholder="New password">
                            </div>
                            
                            <div class="form-group">
                                <label>Confirm New Password</label>
                                <input type="password" id="confirmAdminPassword" class="form-control" placeholder="Confirm new password">
                            </div>
                            
                            <div class="form-group">
                                <label>Subscription Price (Ksh)</label>
                                <input type="number" id="subscriptionPrice" class="form-control" value="67">
                            </div>
                            
                            <div class="form-group">
                                <label>Subscription Duration (Months)</label>
                                <input type="number" id="subscriptionDuration" class="form-control" value="5">
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 15px; margin-top: 20px;">
                            <button class="btn btn-primary" onclick="saveAdminSettings()">
                                <i class="fas fa-save"></i> Save Settings
                            </button>
                            <button class="btn btn-danger" onclick="resetSystem()">
                                <i class="fas fa-trash"></i> Reset System
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== COPYRIGHT FOOTER ==================== -->
        <div class="copyright-footer">
            <p>&copy; <strong>2025</strong> RevisionVault Pro. All rights reserved.</p>
            <p>Developed by <strong>Walter Zauko</strong></p>
            <p style="font-size: 12px; margin-top: 10px; color: var(--gray);">
                <i class="fas fa-shield-alt"></i> Secure Platform | 
                <i class="fas fa-graduation-cap"></i> Premium Materials |
                <i class="fas fa-user-check"></i> Admin Verified
            </p>
        </div>
    </div>

    <script>
        // ==================== INITIALIZATION ====================
        let currentStudent = null;
        let students = JSON.parse(localStorage.getItem('revisionvault_students')) || [];
        let payments = JSON.parse(localStorage.getItem('revisionvault_payments')) || [];
        let documents = JSON.parse(localStorage.getItem('revisionvault_documents')) || [];
        let adminPassword = 'walter.zauko23';
        let settings = JSON.parse(localStorage.getItem('revisionvault_settings')) || {
            subscriptionPrice: 67,
            subscriptionDuration: 5,
            adminPassword: 'walter.zauko23'
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 RevisionVault Pro v2.0');
            
            // Show loading for 1 second
            setTimeout(() => {
                document.getElementById('loadingOverlay').style.display = 'none';
                checkStudentSession();
                loadDocuments();
                updateAccessStatus();
                
                // Set today's date in payment form
                const today = new Date().toISOString().split('T')[0];
                if (document.getElementById('paymentDate')) {
                    document.getElementById('paymentDate').value = today;
                }
                
                showNotification('Welcome to RevisionVault Pro!', 'success');
            }, 1000);
            
            // Setup event listeners
            setupEventListeners();
        });

        // ==================== STUDENT FUNCTIONS ====================
        function registerStudent() {
            const fullName = document.getElementById('regFullName').value.trim();
            const email = document.getElementById('regEmail').value.trim();
            const phone = document.getElementById('regPhone').value.trim();
            const university = document.getElementById('regUniversity').value;
            const course = document.getElementById('regCourse').value.trim();
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regConfirmPassword').value;

            // Validation
            if (!fullName || !email || !phone || !university || !course || !password) {
                showNotification('Please fill all required fields', 'error');
                return;
            }

            if (password !== confirmPassword) {
                showNotification('Passwords do not match', 'error');
                return;
            }

            if (phone.length !== 10 || !phone.startsWith('07')) {
                showNotification('Please enter a valid 10-digit Kenyan phone number', 'error');
                return;
            }

            // Check if student already exists
            if (students.some(s => s.email === email || s.phone === phone)) {
                showNotification('Student with this email or phone already exists', 'error');
                return;
            }

            // Create student object
            const student = {
                id: 'STU_' + Date.now(),
                fullName,
                email,
                phone,
                university,
                course,
                year: document.getElementById('regYear').value || '',
                password, // In production, hash this!
                status: 'registered',
                registrationDate: new Date().toISOString(),
                subscription: {
                    active: false,
                    startDate: null,
                    endDate: null,
                    plan: null
                },
                paymentStatus: 'none',
                unlockCode: null,
                documentsAccessed: [],
                favorites: []
            };

            // Add to students array
            students.push(student);
            currentStudent = student;
            localStorage.setItem('revisionvault_students', JSON.stringify(students));
            localStorage.setItem('revisionvault_current_student', JSON.stringify(student));

            // Update UI
            updateStudentDisplay(student);
            showStep(2);
            showNotification('Registration successful! Welcome to RevisionVault Pro', 'success');
        }

        function updateStudentDisplay(student) {
            document.getElementById('accountName').textContent = student.fullName;
            document.getElementById('accountEmail').textContent = student.email;
            document.getElementById('accountPhone').textContent = student.phone;
            document.getElementById('accountUniversity').textContent = student.university;
            document.getElementById('accountCourse').textContent = student.course;
            
            // Update status
            const statusElement = document.getElementById('accountStatus');
            if (student.subscription.active) {
                statusElement.textContent = 'Active';
                statusElement.className = 'badge badge-success';
            } else if (student.paymentStatus === 'pending') {
                statusElement.textContent = 'Payment Pending';
                statusElement.className = 'badge badge-warning';
            } else {
                statusElement.textContent = 'Not Subscribed';
                statusElement.className = 'badge badge-danger';
            }
        }

        function loginStudent() {
            const phone = document.getElementById('loginPhone').value.trim();
            const password = document.getElementById('loginPassword').value.trim();

            if (!phone || !password) {
                showNotification('Please enter phone and password', 'error');
                return;
            }

            const student = students.find(s => s.phone === phone && s.password === password);
            
            if (!student) {
                showNotification('Invalid phone number or password', 'error');
                return;
            }

            currentStudent = student;
            localStorage.setItem('revisionvault_current_student', JSON.stringify(student));
            
            updateStudentDisplay(student);
            updateAccessStatus();
            
            if (student.subscription.active) {
                showStep(2);
                showNotification(`Welcome back, ${student.fullName}!`, 'success');
            } else if (student.paymentStatus === 'pending') {
                showStep(4);
                showNotification('Your payment is pending approval', 'warning');
            } else {
                showStep(2);
                showNotification(`Welcome back, ${student.fullName}!`, 'success');
            }
        }

        function logout() {
            currentStudent = null;
            localStorage.removeItem('revisionvault_current_student');
            showStep(1);
            updateAccessStatus();
            showNotification('Logged out successfully', 'info');
        }

        function checkStudentSession() {
            const savedStudent = localStorage.getItem('revisionvault_current_student');
            if (savedStudent) {
                try {
                    currentStudent = JSON.parse(savedStudent);
                    updateStudentDisplay(currentStudent);
                    updateAccessStatus();
                    
                    if (currentStudent.subscription.active) {
                        showStep(2);
                    } else if (currentStudent.paymentStatus === 'pending') {
                        showStep(4);
                        document.getElementById('pendingApproval').style.display = 'block';
                        document.getElementById('readyForUnlock').style.display = 'none';
                    } else {
                        showStep(2);
                    }
                } catch (error) {
                    console.error('Error loading student session:', error);
                }
            }
        }

        function goToPayment() {
            if (currentStudent) {
                showStep(3);
            }
        }

        function goToAccount() {
            if (currentStudent) {
                showStep(2);
            }
        }

        function submitPayment() {
            if (!currentStudent) {
                showNotification('Please register first', 'error');
                return;
            }

            const paymentCode = document.getElementById('paymentCode').value.trim().toUpperCase();
            const paymentDate = document.getElementById('paymentDate').value;

            if (!paymentCode || !paymentDate) {
                showNotification('Please fill all payment details', 'error');
                return;
            }

            // Create payment record
            const payment = {
                id: 'PAY_' + Date.now(),
                studentId: currentStudent.id,
                studentName: currentStudent.fullName,
                studentPhone: currentStudent.phone,
                studentUniversity: currentStudent.university,
                amount: parseInt(document.getElementById('paymentAmount').value),
                transactionCode: paymentCode,
                paymentDate,
                status: 'pending',
                submissionDate: new Date().toISOString(),
                adminApprovalDate: null,
                unlockCode: null
            };

            // Update student
            currentStudent.paymentStatus = 'pending';
            updateStudentInStorage(currentStudent);
            
            // Add payment
            payments.push(payment);
            localStorage.setItem('revisionvault_payments', JSON.stringify(payments));

            // Move to next step
            showStep(4);
            showNotification('Payment submitted! Admin will review and approve.', 'success');
            
            // Simulate WhatsApp notification
            simulateWhatsAppNotification(payment);
        }

        function simulateWhatsAppNotification(payment) {
            console.log(`WhatsApp notification sent for payment ${payment.transactionCode}`);
        }

        function verifyUnlockCode() {
            if (!currentStudent) return;

            const inputCode = document.getElementById('unlockCodeInput').value.trim().toUpperCase();
            
            if (!inputCode) {
                showNotification('Please enter unlock code', 'error');
                return;
            }

            // Find payment with this unlock code
            const payment = payments.find(p => 
                p.studentId === currentStudent.id && 
                p.unlockCode === inputCode && 
                p.status === 'approved'
            );

            if (payment) {
                // Update student subscription
                currentStudent.subscription = {
                    active: true,
                    startDate: new Date().toISOString(),
                    endDate: new Date(Date.now() + settings.subscriptionDuration * 30 * 24 * 60 * 60 * 1000).toISOString(),
                    plan: `${settings.subscriptionDuration}_months`
                };
                currentStudent.paymentStatus = 'approved';
                updateStudentInStorage(currentStudent);
                
                // Show success
                document.getElementById('pendingApproval').style.display = 'none';
                document.getElementById('readyForUnlock').style.display = 'none';
                document.getElementById('accessGranted').style.display = 'block';
                
                updateAccessStatus();
                showNotification('Access unlocked! All materials are now available.', 'success');
            } else {
                showNotification('Invalid unlock code. Please check and try again.', 'error');
            }
        }

        function requestNewCode() {
            showNotification('Request sent to admin. New code will be sent via WhatsApp.', 'info');
        }

        // ==================== DOCUMENT FUNCTIONS ====================
        function loadDocuments() {
            const grid = document.getElementById('documentsGrid');
            if (!grid) return;

            let filteredDocs = [...documents];
            
            // Filter by access
            if (!currentStudent || !currentStudent.subscription.active) {
                grid.innerHTML = `
                    <div class="card" style="text-align: center; padding: 40px; grid-column: 1 / -1;">
                        <div class="doc-icon">
                            <i class="fas fa-lock"></i>
                        </div>
                        <h4>Access Locked</h4>
                        <p>Subscribe to access all study materials</p>
                        <button class="btn btn-primary" onclick="switchTab('student')" style="margin-top: 20px;">
                            <i class="fas fa-crown"></i> Subscribe Now
                        </button>
                    </div>
                `;
                return;
            }

            // Apply search filter
            const searchTerm = document.getElementById('searchInput')?.value.toLowerCase() || '';
            if (searchTerm) {
                filteredDocs = filteredDocs.filter(doc => 
                    doc.title.toLowerCase().includes(searchTerm) ||
                    doc.unitCode.toLowerCase().includes(searchTerm) ||
                    doc.subject?.toLowerCase().includes(searchTerm)
                );
            }

            // Apply university filter
            const activeUniversity = document.querySelector('.university-badge.active')?.textContent;
            if (activeUniversity && activeUniversity !== 'All Universities') {
                filteredDocs = filteredDocs.filter(doc => 
                    doc.university === activeUniversity || doc.university === 'All'
                );
            }

            if (filteredDocs.length === 0) {
                grid.innerHTML = `
                    <div class="card" style="text-align: center; padding: 40px; grid-column: 1 / -1;">
                        <div class="doc-icon">
                            <i class="fas fa-search"></i>
                        </div>
                        <h4>No Documents Found</h4>
                        <p>Try changing your search criteria</p>
                    </div>
                `;
                return;
            }

            // Display documents
            grid.innerHTML = filteredDocs.map(doc => `
                <div class="document-card">
                    <div class="doc-icon">
                        <i class="${getDocumentIcon(doc.type)}"></i>
                    </div>
                    <h4>${doc.title}</h4>
                    <p style="color: var(--gray); margin: 10px 0;">
                        <strong>${doc.unitCode}</strong> • ${doc.university}
                    </p>
                    <p style="font-size: 14px; color: var(--gray);">
                        ${doc.subject || 'General'} • ${doc.year ? 'Year ' + doc.year : ''}
                    </p>
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button class="btn btn-primary btn-sm" onclick="viewDocument('${doc.id}')">
                            <i class="fas fa-eye"></i> View
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="toggleFavorite('${doc.id}')">
                            <i class="fas fa-heart"></i> Favorite
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function getDocumentIcon(type) {
            switch(type) {
                case 'pdf': return 'fas fa-file-pdf';
                case 'doc': return 'fas fa-file-word';
                case 'ppt': return 'fas fa-file-powerpoint';
                default: return 'fas fa-file-alt';
            }
        }

        function viewDocument(docId) {
            const doc = documents.find(d => d.id === docId);
            if (!doc) return;

            // Update view count
            doc.views = (doc.views || 0) + 1;
            localStorage.setItem('revisionvault_documents', JSON.stringify(documents));

            // Show in viewer
            document.getElementById('viewerTitle').textContent = doc.title;
            document.getElementById('viewerBody').innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <div class="doc-icon" style="margin: 0 auto 20px;">
                        <i class="${getDocumentIcon(doc.type)}"></i>
                    </div>
                    <h4>${doc.title}</h4>
                    <p><strong>${doc.unitCode}</strong> • ${doc.university}</p>
                    <p>${doc.description || ''}</p>
                    <div style="margin: 30px 0;">
                        <a href="${doc.url}" target="_blank" class="btn btn-primary">
                            <i class="fas fa-download"></i> Download Document
                        </a>
                    </div>
                    <p style="color: var(--gray);">This is a preview. Use the download button to get the full document.</p>
                </div>
            `;
            document.getElementById('documentViewer').style.display = 'flex';
        }

        function closeViewer() {
            document.getElementById('documentViewer').style.display = 'none';
        }

        function filterByUniversity(university) {
            // Update active badge
            document.querySelectorAll('.university-badge').forEach(badge => {
                badge.classList.remove('active');
            });
            event.target.classList.add('active');
            
            loadDocuments();
        }

        function toggleFavorite(docId) {
            if (!currentStudent) return;
            
            const index = currentStudent.favorites.indexOf(docId);
            if (index === -1) {
                currentStudent.favorites.push(docId);
                showNotification('Added to favorites', 'success');
            } else {
                currentStudent.favorites.splice(index, 1);
                showNotification('Removed from favorites', 'info');
            }
            
            updateStudentInStorage(currentStudent);
            loadFavorites();
        }

        function loadFavorites() {
            if (!currentStudent) return;
            
            const grid = document.getElementById('favoritesGrid');
            const favoriteDocs = documents.filter(doc => 
                currentStudent.favorites.includes(doc.id)
            );
            
            if (favoriteDocs.length === 0) {
                grid.innerHTML = `
                    <div class="card" style="text-align: center; padding: 40px;">
                        <div class="doc-icon">
                            <i class="fas fa-heart"></i>
                        </div>
                        <h4>No Favorites Yet</h4>
                        <p>Add documents to favorites to see them here</p>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = favoriteDocs.map(doc => `
                <div class="document-card">
                    <div class="doc-icon">
                        <i class="${getDocumentIcon(doc.type)}"></i>
                    </div>
                    <h4>${doc.title}</h4>
                    <p style="color: var(--gray); margin: 10px 0;">
                        <strong>${doc.unitCode}</strong> • ${doc.university}
                    </p>
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button class="btn btn-primary btn-sm" onclick="viewDocument('${doc.id}')">
                            <i class="fas fa-eye"></i> View
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="toggleFavorite('${doc.id}')">
                            <i class="fas fa-heart-broken"></i> Remove
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // ==================== ADMIN FUNCTIONS ====================
        function adminLogin() {
            const password = document.getElementById('adminPassword').value.trim();
            
            if (password === settings.adminPassword) {
                document.getElementById('adminLogin').style.display = 'none';
                document.getElementById('adminDashboard').style.display = 'block';
                
                // Load admin data
                loadAdminDashboard();
                loadPendingPayments();
                loadAllUsers();
                loadAdminDocuments();
                
                showNotification('Admin login successful!', 'success');
            } else {
                showNotification('Invalid admin password', 'error');
            }
        }

        function loadAdminDashboard() {
            // Update counts
            document.getElementById('totalUsers').textContent = students.length;
            document.getElementById('pendingApprovalsCount').textContent = 
                payments.filter(p => p.status === 'pending').length;
            document.getElementById('totalDocuments').textContent = documents.length;
            document.getElementById('activeSubscriptions').textContent = 
                students.filter(s => s.subscription.active).length;
            
            // Calculate revenue
            const totalRevenue = payments
                .filter(p => p.status === 'approved')
                .reduce((sum, p) => sum + p.amount, 0);
            document.getElementById('totalRevenue').textContent = `Ksh ${totalRevenue}`;
            
            // Update settings form
            document.getElementById('subscriptionPrice').value = settings.subscriptionPrice;
            document.getElementById('subscriptionDuration').value = settings.subscriptionDuration;
        }

        function loadPendingPayments() {
            const table = document.getElementById('pendingPaymentsTable').querySelector('tbody');
            const pendingPayments = payments.filter(p => p.status === 'pending');
            
            table.innerHTML = pendingPayments.map(payment => `
                <tr>
                    <td>${payment.studentName}</td>
                    <td>${payment.studentPhone}</td>
                    <td>${payment.studentUniversity}</td>
                    <td><code>${payment.transactionCode}</code></td>
                    <td>Ksh ${payment.amount}</td>
                    <td>${new Date(payment.submissionDate).toLocaleDateString()}</td>
                    <td>
                        <button onclick="approvePayment('${payment.id}')" class="btn btn-success btn-sm">
                            <i class="fas fa-check"></i> Approve
                        </button>
                        <button onclick="rejectPayment('${payment.id}')" class="btn btn-danger btn-sm">
                            <i class="fas fa-times"></i> Reject
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function approvePayment(paymentId) {
            const payment = payments.find(p => p.id === paymentId);
            if (!payment) return;

            // Generate unlock code
            const unlockCode = 'RV-' + Math.random().toString(36).substr(2, 8).toUpperCase();
            
            // Update payment
            payment.status = 'approved';
            payment.adminApprovalDate = new Date().toISOString();
            payment.unlockCode = unlockCode;
            
            // Update student
            const student = students.find(s => s.id === payment.studentId);
            if (student) {
                student.paymentStatus = 'approved';
                student.unlockCode = unlockCode;
                updateStudentInStorage(student);
            }
            
            // Save
            localStorage.setItem('revisionvault_payments', JSON.stringify(payments));
            
            // Reload
            loadPendingPayments();
            loadAllUsers();
            loadAdminDashboard();
            
            showNotification(`Payment approved! Unlock code: ${unlockCode}`, 'success');
        }

        function rejectPayment(paymentId) {
            const payment = payments.find(p => p.id === paymentId);
            if (!payment) return;

            payment.status = 'rejected';
            
            // Update student
            const student = students.find(s => s.id === payment.studentId);
            if (student) {
                student.paymentStatus = 'rejected';
                updateStudentInStorage(student);
            }
            
            localStorage.setItem('revisionvault_payments', JSON.stringify(payments));
            loadPendingPayments();
            loadAllUsers();
            
            showNotification('Payment rejected', 'warning');
        }

        function loadAllUsers() {
            const table = document.getElementById('allUsersTable').querySelector('tbody');
            
            table.innerHTML = students.map(student => `
                <tr>
                    <td>${student.fullName}</td>
                    <td>${student.email}</td>
                    <td>${student.phone}</td>
                    <td>${student.university}</td>
                    <td>
                        ${student.subscription.active ? 
                            '<span class="badge badge-success">Active</span>' : 
                          student.paymentStatus === 'pending' ? 
                            '<span class="badge badge-warning">Pending</span>' :
                          student.paymentStatus === 'approved' ? 
                            '<span class="badge badge-info">Approved</span>' :
                            '<span class="badge badge-danger">Inactive</span>'
                        }
                    </td>
                    <td>
                        <button onclick="viewStudent('${student.id}')" class="btn btn-info btn-sm">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button onclick="deleteStudent('${student.id}')" class="btn btn-danger btn-sm">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function viewStudent(studentId) {
            const student = students.find(s => s.id === studentId);
            if (!student) return;

            alert(`Student Details:\n\nName: ${student.fullName}\nEmail: ${student.email}\nPhone: ${student.phone}\nUniversity: ${student.university}\nCourse: ${student.course}\nStatus: ${student.subscription.active ? 'Active' : 'Inactive'}`);
        }

        function deleteStudent(studentId) {
            if (!confirm('Are you sure you want to delete this student? This action cannot be undone.')) return;
            
            students = students.filter(s => s.id !== studentId);
            payments = payments.filter(p => p.studentId !== studentId);
            
            localStorage.setItem('revisionvault_students', JSON.stringify(students));
            localStorage.setItem('revisionvault_payments', JSON.stringify(payments));
            
            loadAllUsers();
            loadAdminDashboard();
            showNotification('Student deleted successfully', 'success');
        }

        function uploadDocument() {
            const title = document.getElementById('docTitle').value.trim();
            const unitCode = document.getElementById('docUnitCode').value.trim().toUpperCase();
            const university = document.getElementById('docUniversity').value;
            const fileInput = document.getElementById('docFile');
            
            if (!title || !unitCode || !university || !fileInput.files[0]) {
                showNotification('Please fill all required fields and select a file', 'error');
                return;
            }

            const file = fileInput.files[0];
            
            // Create document object
            const document = {
                id: 'DOC_' + Date.now(),
                title,
                unitCode,
                university,
                subject: document.getElementById('docSubject').value.trim(),
                year: document.getElementById('docYear').value,
                type: document.getElementById('docType').value,
                description: document.getElementById('docDescription').value.trim(),
                fileName: file.name,
                fileSize: (file.size / 1024 / 1024).toFixed(2) + ' MB',
                uploadDate: new Date().toISOString(),
                views: 0,
                // In a real app, you would upload the file to a server
                // For now, we'll store a fake URL
                url: URL.createObjectURL(file)
            };

            // Add to documents
            documents.push(document);
            localStorage.setItem('revisionvault_documents', JSON.stringify(documents));
            
            // Clear form
            clearUploadForm();
            
            // Update UI
            loadAdminDocuments();
            loadAdminDashboard();
            showNotification('Document uploaded successfully!', 'success');
        }

        function clearUploadForm() {
            document.getElementById('docTitle').value = '';
            document.getElementById('docUnitCode').value = '';
            document.getElementById('docUniversity').value = '';
            document.getElementById('docSubject').value = '';
            document.getElementById('docYear').value = '';
            document.getElementById('docDescription').value = '';
            document.getElementById('docFile').value = '';
        }

        function loadAdminDocuments() {
            const table = document.getElementById('adminDocumentsTable').querySelector('tbody');
            
            table.innerHTML = documents.map(doc => `
                <tr>
                    <td>${doc.title}</td>
                    <td><strong>${doc.unitCode}</strong></td>
                    <td>${doc.university}</td>
                    <td>${doc.subject || 'General'}</td>
                    <td>${new Date(doc.uploadDate).toLocaleDateString()}</td>
                    <td>${doc.views}</td>
                    <td>
                        <button onclick="deleteDocument('${doc.id}')" class="btn btn-danger btn-sm">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function deleteDocument(docId) {
            if (!confirm('Are you sure you want to delete this document? This action cannot be undone.')) return;
            
            documents = documents.filter(d => d.id !== docId);
            localStorage.setItem('revisionvault_documents', JSON.stringify(documents));
            
            // Remove from all students' favorites
            students.forEach(student => {
                const index = student.favorites.indexOf(docId);
                if (index !== -1) {
                    student.favorites.splice(index, 1);
                }
            });
            localStorage.setItem('revisionvault_students', JSON.stringify(students));
            
            loadAdminDocuments();
            loadAdminDashboard();
            loadDocuments();
            loadFavorites();
            showNotification('Document deleted successfully', 'success');
        }

        function saveAdminSettings() {
            const newPassword = document.getElementById('newAdminPassword').value;
            const confirmPassword = document.getElementById('confirmAdminPassword').value;
            
            if (newPassword && newPassword !== confirmPassword) {
                showNotification('Passwords do not match', 'error');
                return;
            }
            
            // Update settings
            settings.subscriptionPrice = parseInt(document.getElementById('subscriptionPrice').value);
            settings.subscriptionDuration = parseInt(document.getElementById('subscriptionDuration').value);
            
            if (newPassword) {
                settings.adminPassword = newPassword;
            }
            
            localStorage.setItem('revisionvault_settings', JSON.stringify(settings));
            
            // Clear password fields
            document.getElementById('newAdminPassword').value = '';
            document.getElementById('confirmAdminPassword').value = '';
            
            showNotification('Settings saved successfully', 'success');
        }

        function resetSystem() {
            if (!confirm('⚠️ WARNING: This will reset ALL data (students, payments, documents). This action cannot be undone. Are you sure?')) return;
            
            localStorage.clear();
            students = [];
            payments = [];
            documents = [];
            currentStudent = null;
            settings = {
                subscriptionPrice: 67,
                subscriptionDuration: 5,
                adminPassword: 'walter.zauko23'
            };
            
            localStorage.setItem('revisionvault_settings', JSON.stringify(settings));
            
            // Reset UI
            location.reload();
        }

        // ==================== UTILITY FUNCTIONS ====================
        function showStep(stepNumber) {
            for (let i = 1; i <= 4; i++) {
                document.getElementById('step' + i).style.display = 'none';
            }
            document.getElementById('step' + stepNumber).style.display = 'block';
        }

        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.currentTarget.classList.add('active');
            
            // Load content if needed
            if (tabName === 'documents') {
                loadDocuments();
            } else if (tabName === 'favorites') {
                loadFavorites();
            }
        }

        function switchAdminTab(tabName) {
            // Hide all admin tabs
            document.querySelectorAll('.admin-tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Update tab buttons
            document.querySelectorAll('.admin-tab-btn').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById('admin' + tabName.charAt(0).toUpperCase() + tabName.slice(1) + 'Tab').classList.add('active');
            event.currentTarget.classList.add('active');
        }

        function updateAccessStatus() {
            const statusBar = document.getElementById('accessStatusBar');
            const statusText = document.getElementById('accessStatusText');
            const subscribeBtn = document.getElementById('subscribeBtnDocs');
            
            if (currentStudent && currentStudent.subscription.active) {
                statusBar.style.background = 'linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%)';
                statusBar.style.borderColor = 'var(--success)';
                statusText.innerHTML = '<i class="fas fa-unlock"></i> Access Granted';
                statusText.style.color = 'var(--success)';
                subscribeBtn.style.display = 'none';
                
                // Update documents tab text
                document.querySelector('[onclick="switchTab(\'documents\')"] span').innerHTML = 
                    '<i class="fas fa-file-alt"></i> Study Materials <span class="badge badge-success">Active</span>';
            } else {
                statusBar.style.background = 'linear-gradient(135deg, #fef3c7 0%, #fde68a 100%)';
                statusBar.style.borderColor = 'var(--warning)';
                statusText.innerHTML = '<i class="fas fa-lock"></i> Access Locked';
                statusText.style.color = 'var(--danger)';
                subscribeBtn.style.display = 'inline-flex';
                
                // Update documents tab text
                document.querySelector('[onclick="switchTab(\'documents\')"] span').innerHTML = 
                    '<i class="fas fa-file-alt"></i> Study Materials';
            }
        }

        function updateStudentInStorage(student) {
            const index = students.findIndex(s => s.id === student.id);
            if (index !== -1) {
                students[index] = student;
                localStorage.setItem('revisionvault_students', JSON.stringify(students));
                localStorage.setItem('revisionvault_current_student', JSON.stringify(student));
            }
        }

        function showNotification(message, type = 'info') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 
                                 type === 'error' ? 'exclamation-circle' : 
                                 type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            
            container.appendChild(notification);
            
            // Remove after 5 seconds
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => notification.remove(), 300);
            }, 5000);
        }

        function setupEventListeners() {
            // Search functionality
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', loadDocuments);
            }
            
            // File upload drag and drop
            const uploadArea = document.getElementById('uploadArea');
            if (uploadArea) {
                uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadArea.classList.add('dragover');
                });
                
                uploadArea.addEventListener('dragleave', () => {
                    uploadArea.classList.remove('dragover');
                });
                
                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.classList.remove('dragover');
                    const fileInput = document.getElementById('docFile');
                    fileInput.files = e.dataTransfer.files;
                });
            }
            
            // Search users
            const searchUsers = document.getElementById('searchUsers');
            if (searchUsers) {
                searchUsers.addEventListener('input', filterUsers);
            }
            
            // Search admin docs
            const searchAdminDocs = document.getElementById('searchAdminDocs');
            if (searchAdminDocs) {
                searchAdminDocs.addEventListener('input', filterAdminDocuments);
            }
        }

        function filterUsers() {
            const searchTerm = document.getElementById('searchUsers').value.toLowerCase();
            const rows = document.querySelectorAll('#allUsersTable tbody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        function filterAdminDocuments() {
            const searchTerm = document.getElementById('searchAdminDocs').value.toLowerCase();
            const rows = document.querySelectorAll('#adminDocumentsTable tbody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        function showAdminSecretAccess() {
            const password = prompt('Enter admin password:');
            if (password === settings.adminPassword) {
                switchTab('admin');
                document.getElementById('adminPassword').value = password;
                adminLogin();
            } else if (password) {
                alert('Invalid admin password');
            }
        }

        // Initialize with some sample documents
        if (documents.length === 0) {
            documents = [
                {
                    id: 'DOC_1',
                    title: 'Introduction to Botany',
                    unitCode: 'BOTA241',
                    university: 'University of Nairobi',
                    subject: 'Botany',
                    year: '2',
                    type: 'pdf',
                    description: 'Basic concepts and principles of botany',
                    uploadDate: new Date().toISOString(),
                    views: 45,
                    url: '#'
                },
                {
                    id: 'DOC_2',
                    title: 'Computer Networks',
                    unitCode: 'CS401',
                    university: 'JKUAT',
                    subject: 'Computer Science',
                    year: '4',
                    type: 'pdf',
                    description: 'Advanced computer networking concepts',
                    uploadDate: new Date().toISOString(),
                    views: 32,
                    url: '#'
                }
            ];
            localStorage.setItem('revisionvault_documents', JSON.stringify(documents));
        }
    </script>
</body>
</html>