<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RevisionVault Pro - University Study Materials</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1a2980;
            --secondary: #26d0ce;
            --accent: #ff4081;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --light: #f8fafc;
            --dark: #1e293b;
            --card-bg: #ffffff;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --radius: 16px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 0;
            padding-bottom: 80px;
        }

        /* Fixed Header Container */
        .header-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            padding: 15px 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
        }

        /* Logo Section */
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-shrink: 0;
        }

        .logo-icon {
            background: rgba(255, 255, 255, 0.9);
            width: 45px;
            height: 45px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 22px;
            box-shadow: var(--shadow);
        }

        .logo-text h1 {
            font-size: 22px;
            margin-bottom: 2px;
            font-weight: 800;
            letter-spacing: -0.5px;
            color: white;
        }

        .logo-text p {
            font-size: 12px;
            opacity: 0.9;
            font-weight: 400;
            color: rgba(255, 255, 255, 0.9);
        }

        /* Search Bar */
        .search-container {
            flex: 1;
            max-width: 600px;
            position: relative;
        }

        .search-box {
            width: 100%;
            padding: 14px 20px;
            padding-left: 45px;
            border: none;
            border-radius: 50px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            color: white;
            font-size: 15px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .search-box::placeholder {
            color: rgba(255, 255, 255, 0.8);
        }

        .search-box:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.25);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.2);
        }

        .search-icon {
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.9);
            font-size: 16px;
        }

        /* Search Suggestions */
        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-top: 8px;
            max-height: 300px;
            overflow-y: auto;
            display: none;
            z-index: 1001;
            border: 2px solid #e2e8f0;
        }

        .search-suggestions.active {
            display: block;
        }

        .suggestion-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 1px solid #e2e8f0;
        }

        .suggestion-item:hover {
            background: #f1f5f9;
        }

        .suggestion-code {
            font-weight: 700;
            color: var(--primary);
            font-size: 14px;
        }

        .suggestion-title {
            font-size: 12px;
            color: #64748b;
            margin-top: 4px;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Main Container */
        .main-container {
            margin-top: 100px;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
            background: white;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            min-height: calc(100vh - 180px);
        }

        /* Main Layout */
        .main-layout {
            display: grid;
            grid-template-columns: 280px 1fr 320px;
            min-height: 600px;
        }

        /* Left Sidebar */
        .sidebar-left {
            background: var(--light);
            padding: 25px 20px;
            border-right: 1px solid #e2e8f0;
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 16px;
            font-weight: 700;
        }

        .tools-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 25px;
        }

        .tool-card {
            background: var(--card-bg);
            padding: 18px 12px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tool-card:hover {
            transform: translateY(-3px);
            border-color: var(--primary);
            box-shadow: var(--shadow);
        }

        .tool-icon {
            font-size: 22px;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .tool-name {
            font-size: 12px;
            font-weight: 700;
            color: var(--dark);
        }

        .timetable {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            border: 2px solid #e2e8f0;
        }

        .week-display {
            font-size: 20px;
            font-weight: 800;
            color: var(--primary);
            text-align: center;
            margin-bottom: 5px;
        }

        .date-range {
            color: #64748b;
            text-align: center;
            margin-bottom: 15px;
            font-size: 13px;
        }

        .schedule-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            text-align: center;
        }

        .schedule-item {
            padding: 10px;
            background: #f1f5f9;
            border-radius: 8px;
        }

        .time {
            font-weight: 700;
            color: var(--primary);
            font-size: 12px;
        }

        .subject {
            font-size: 11px;
            color: #64748b;
            margin-top: 4px;
        }

        .ai-chat-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, var(--accent), #f50057);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 800;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 25px;
            transition: all 0.3s;
        }

        /* Main Content */
        .main-content {
            padding: 25px;
            background: white;
            overflow-y: auto;
            height: calc(100vh - 180px);
        }

        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .main-title {
            font-size: 24px;
            color: var(--primary);
            font-weight: 800;
        }

        .filters {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .filter-select {
            padding: 10px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            background: white;
            color: var(--dark);
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 140px;
        }

        .access-status {
            background: linear-gradient(135deg, #ffeaea, #ffc9c9);
            border: 3px solid var(--danger);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
        }

        .access-granted {
            background: linear-gradient(135deg, #d1fae5, #a7f3d0);
            border-color: var(--success);
        }

        /* Quick Unit Codes */
        .quick-units {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .unit-chip {
            background: #e0f2fe;
            color: var(--primary);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        /* Search Results */
        .search-results {
            display: none;
            margin-top: 20px;
        }

        .search-results.active {
            display: block;
        }

        /* Materials Grid */
        .materials-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 35px;
        }

        .material-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            overflow: hidden;
            border: 2px solid #e2e8f0;
            transition: all 0.3s;
        }

        .material-badge {
            position: absolute;
            top: 12px;
            left: 12px;
            background: linear-gradient(135deg, var(--accent), #f50057);
            color: white;
            padding: 6px 14px;
            border-radius: 50px;
            font-size: 10px;
            font-weight: 800;
            letter-spacing: 1px;
        }

        .material-badge.trending {
            background: linear-gradient(135deg, var(--warning), #f97316);
        }

        .material-badge.recent {
            background: linear-gradient(135deg, var(--success), #059669);
        }

        .material-image {
            height: 160px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.2);
            font-size: 60px;
            position: relative;
        }

        .material-content {
            padding: 20px;
        }

        .material-title {
            font-size: 16px;
            font-weight: 800;
            color: var(--dark);
            margin-bottom: 12px;
            line-height: 1.4;
        }

        .material-meta {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .material-code {
            background: #e0f2fe;
            padding: 5px 12px;
            border-radius: 50px;
            color: var(--primary);
            font-weight: 800;
            font-size: 12px;
        }

        .material-year {
            background: #fee2e2;
            padding: 5px 12px;
            border-radius: 50px;
            color: var(--danger);
            font-weight: 800;
            font-size: 12px;
        }

        .material-info {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #64748b;
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 12px;
        }

        .material-description {
            color: #64748b;
            font-size: 13px;
            line-height: 1.5;
            margin-bottom: 18px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .material-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            font-size: 13px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: all 0.3s;
        }

        .view-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .preview-btn {
            background: #f1f5f9;
            color: var(--dark);
            border: 2px solid #e2e8f0;
        }

        /* Right Sidebar */
        .sidebar-right {
            background: var(--light);
            padding: 25px 20px;
            border-left: 1px solid #e2e8f0;
            height: calc(100vh - 180px);
            overflow-y: auto;
        }

        .category-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 16px;
            background: var(--card-bg);
            border-radius: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            border: 2px solid #e2e8f0;
            transition: all 0.3s;
        }

        .category-name {
            font-weight: 700;
            color: var(--dark);
            font-size: 13px;
        }

        .category-count {
            background: #e0f2fe;
            padding: 3px 10px;
            border-radius: 50px;
            font-size: 11px;
            font-weight: 800;
            color: var(--primary);
        }

        .university-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .university-card {
            background: var(--card-bg);
            padding: 15px 10px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.3s;
        }

        .university-logo {
            width: 35px;
            height: 35px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 8px;
            font-weight: 800;
            font-size: 14px;
        }

        .premium-banner {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            padding: 20px;
            border-radius: var(--radius);
            text-align: center;
            margin-top: 25px;
            box-shadow: var(--shadow);
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            border-radius: 50px;
            padding: 10px 20px;
            display: flex;
            gap: 8px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            border: 2px solid #e2e8f0;
            min-width: 550px;
            justify-content: space-around;
        }

        .nav-btn {
            background: none;
            border: none;
            padding: 10px 16px;
            border-radius: 30px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 600;
            font-size: 13px;
            color: #64748b;
            transition: all 0.3s;
            min-width: 100px;
            justify-content: center;
        }

        .nav-btn.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 5px 15px rgba(26, 41, 128, 0.2);
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 15px;
            color: #64748b;
            border-top: 1px solid #e2e8f0;
            background: var(--light);
            font-size: 13px;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
        }

        .form-select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            background: white;
            font-size: 14px;
            color: #495057;
        }

        .submit-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        /* Admin Panel Styles */
        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .admin-section {
            display: none;
        }

        .admin-list {
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            width: 100%;
            max-width: 900px;
            max-height: 90vh;
            overflow: hidden;
        }

        .modal-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 20px;
            font-weight: bold;
        }

        .close-modal {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            font-size: 18px;
        }

        .modal-body {
            padding: 25px;
            max-height: 70vh;
            overflow-y: auto;
        }

        /* PDF Viewer */
        .pdf-viewer-container {
            width: 100%;
            height: 500px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        #pdfViewer {
            width: 100%;
            height: 100%;
            border: none;
        }

        .viewer-controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 12px 20px;
            border-radius: 30px;
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .page-info {
            color: white;
            font-weight: 600;
            padding: 0 10px;
        }

        /* AI Chat */
        #aiChatMessages {
            height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            display: none;
            z-index: 2001;
            max-width: 300px;
            border-left: 5px solid var(--success);
            transform: translateX(400px);
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .notification.show {
            display: block;
            transform: translateX(0);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
            .sidebar-left, .sidebar-right {
                display: none;
            }
            .main-content {
                height: auto;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 10px;
                padding: 10px;
            }
            
            .search-container {
                width: 100%;
                max-width: 100%;
            }
            
            .main-container {
                margin-top: 140px;
            }
            
            .bottom-nav {
                min-width: 90%;
                padding: 8px 15px;
                gap: 5px;
            }
            
            .nav-btn {
                min-width: auto;
                padding: 8px 12px;
                font-size: 11px;
            }
            
            .nav-btn span {
                display: none;
            }
            
            .materials-grid {
                grid-template-columns: 1fr;
            }
            
            .filters {
                flex-direction: column;
                width: 100%;
            }
            
            .filter-select {
                width: 100%;
            }
            
            .modal-content {
                max-width: 95%;
            }
        }
    </style>
</head>
<body>
    <!-- Fixed Header -->
    <div class="header-container">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <div class="logo-text">
                    <h1>RevisionVault Pro</h1>
                    <p>University Study Materials Platform</p>
                </div>
            </div>
            
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-box" placeholder="Search by Unit Code e.g AGRO222" id="searchInput">
                <div class="search-suggestions" id="searchSuggestions"></div>
            </div>
            
            <div class="header-actions">
                <div class="price-tag">
                    <i class="fas fa-crown"></i>
                    <span>Ksh 67 for 5 Months</span>
                </div>
                <div class="contact-number">
                    <i class="fas fa-phone-alt"></i>
                    <span>0765 098 865</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <div class="main-layout">
            <!-- Left Sidebar -->
            <aside class="sidebar-left">
                <div class="section-title">
                    <i class="fas fa-tools"></i>
                    <span>POWERFUL Study Tools</span>
                </div>
                <div class="tools-grid">
                    <div class="tool-card" onclick="showNotification('StudyList', 'StudyList feature coming soon!')">
                        <div class="tool-icon"><i class="fas fa-list"></i></div>
                        <div class="tool-name">STUDYLIST</div>
                    </div>
                    <div class="tool-card" onclick="showNotification('Reminders', 'Reminders feature coming soon!')">
                        <div class="tool-icon"><i class="fas fa-bell"></i></div>
                        <div class="tool-name">REMINDERS</div>
                    </div>
                    <div class="tool-card" onclick="showNotification('Notes', 'Notes feature coming soon!')">
                        <div class="tool-icon"><i class="fas fa-sticky-note"></i></div>
                        <div class="tool-name">NOTES</div>
                    </div>
                    <div class="tool-card" onclick="showNotification('Tests', 'Tests feature coming soon!')">
                        <div class="tool-icon"><i class="fas fa-file-alt"></i></div>
                        <div class="tool-name">TESTS</div>
                    </div>
                    <div class="tool-card" onclick="showNotification('Downloads', 'Downloads feature coming soon!')">
                        <div class="tool-icon"><i class="fas fa-download"></i></div>
                        <div class="tool-name">DOWNLOADS</div>
                    </div>
                    <div class="tool-card" onclick="showNotification('Progress', 'Progress tracking coming soon!')">
                        <div class="tool-icon"><i class="fas fa-chart-line"></i></div>
                        <div class="tool-name">PROGRESS</div>
                    </div>
                </div>

                <div class="timetable">
                    <div class="section-title">
                        <i class="fas fa-calendar-alt"></i>
                        <span>My Timetable</span>
                    </div>
                    <div class="week-display">Week 24</div>
                    <div class="date-range">Mon, June 10 - Fri, June 14</div>
                    <div class="schedule-grid">
                        <div class="schedule-item">
                            <div class="time">9:00 AM</div>
                            <div class="subject">AGRO222</div>
                        </div>
                        <div class="schedule-item">
                            <div class="time">11:00 AM</div>
                            <div class="subject">BOTA241</div>
                        </div>
                        <div class="schedule-item">
                            <div class="time">2:00 PM</div>
                            <div class="subject">ZOOL210</div>
                        </div>
                    </div>
                </div>

                <button class="ai-chat-btn" onclick="openAIChat()">
                    <i class="fas fa-robot"></i>
                    AI CHAT
                    <span>ESSAYS | RESEARCH | ASSIGNMENTS</span>
                </button>
            </aside>

            <!-- Main Content -->
            <main class="main-content">
                <!-- Home Tab -->
                <div id="home" class="tab-content active">
                    <div class="content-header">
                        <h1 class="main-title">Continue Reading</h1>
                        <div class="filters">
                            <select class="filter-select" onchange="filterMaterials()" id="universityFilter">
                                <option value="all">All Universities</option>
                            </select>
                            <select class="filter-select" onchange="filterMaterials()" id="yearFilter">
                                <option value="all">All Years</option>
                                <option value="1">Year 1</option>
                                <option value="2">Year 2</option>
                                <option value="3">Year 3</option>
                                <option value="4">Year 4</option>
                            </select>
                        </div>
                    </div>

                    <div class="quick-units" id="quickUnits"></div>

                    <div id="accessStatus" class="access-status">
                        <div class="access-text">
                            <h3><i class="fas fa-lock"></i> Access Locked</h3>
                            <p>Subscribe to unlock all study materials and features</p>
                        </div>
                        <button class="view-btn" onclick="showTab('register')" style="width: auto; padding: 10px 20px;">
                            <i class="fas fa-crown"></i> Subscribe Now
                        </button>
                    </div>

                    <div class="search-results" id="searchResults">
                        <h2 class="search-results-title" id="searchResultsTitle"></h2>
                        <div class="materials-grid" id="searchResultsGrid"></div>
                    </div>

                    <div id="continueReading">
                        <div class="materials-grid" id="continueReadingGrid"></div>

                        <div class="section-divider" style="margin: 30px 0 25px; display: flex; align-items: center; gap: 15px;">
                            <div class="divider-line" style="flex: 1; height: 2px; background: linear-gradient(90deg, transparent, #e2e8f0, transparent);"></div>
                            <h2 style="font-size: 20px; color: var(--primary); font-weight: 800; white-space: nowrap;">Trending Materials</h2>
                            <div class="divider-line" style="flex: 1; height: 2px; background: linear-gradient(90deg, transparent, #e2e8f0, transparent);"></div>
                        </div>

                        <div class="materials-grid" id="trendingGrid"></div>
                    </div>
                </div>

                <!-- Materials Tab -->
                <div id="materials" class="tab-content">
                    <div class="content-header">
                        <h1 class="main-title">All Study Materials</h1>
                        <div class="filters">
                            <select class="filter-select" onchange="filterAllMaterials()" id="allUniversityFilter">
                                <option value="all">All Universities</option>
                            </select>
                            <select class="filter-select" onchange="filterAllMaterials()" id="allSubjectFilter">
                                <option value="all">All Subjects</option>
                            </select>
                        </div>
                    </div>
                    <div class="materials-grid" id="allMaterialsGrid"></div>
                </div>

                <!-- Register Tab -->
                <div id="register" class="tab-content">
                    <div class="content-header">
                        <h1 class="main-title">Student Registration</h1>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Full Name</label>
                        <input type="text" class="form-input" id="studentName" placeholder="Enter your full name">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Phone Number (WhatsApp)</label>
                        <input type="tel" class="form-input" id="studentPhone" placeholder="07XXXXXXXX">
                        <small style="color: #6c757d; font-size: 12px;">This number will be used for WhatsApp verification</small>
                    </div>

                    <div class="form-group">
                        <label class="form-label">University</label>
                        <select class="form-select" id="studentUniversity">
                            <option value="">Select University</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Course/Program</label>
                        <input type="text" class="form-input" id="studentCourse" placeholder="e.g., BSc Agriculture">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Year of Study</label>
                        <select class="form-select" id="studentYear">
                            <option value="">Select Year</option>
                            <option value="1">Year 1</option>
                            <option value="2">Year 2</option>
                            <option value="3">Year 3</option>
                            <option value="4">Year 4</option>
                        </select>
                    </div>

                    <div class="payment-instructions" style="background: #e8f5e9; border: 3px solid #4caf50; border-radius: 15px; padding: 20px; margin: 20px 0;">
                        <h3 style="color: #4caf50; margin-bottom: 15px;">ðŸ’³ Payment Instructions</h3>
                        <p style="margin-bottom: 8px;">1. Open <strong>M-Pesa</strong> on your phone</p>
                        <p style="margin-bottom: 8px;">2. Select <strong>Send Money</strong></p>
                        <p style="margin-bottom: 8px;">3. Enter Phone Number:</p>
                        <div style="text-align: center; margin: 15px 0;">
                            <div style="font-size: 24px; font-weight: bold; color: var(--primary);">0765 098 865</div>
                        </div>
                        <p style="margin-bottom: 8px;">4. Enter Amount:</p>
                        <div style="text-align: center; margin: 15px 0;">
                            <div style="font-size: 32px; font-weight: bold; color: #4caf50;">Ksh 67</div>
                        </div>
                        <p style="margin-bottom: 8px;">5. Enter your <strong>M-Pesa PIN</strong></p>
                        <p style="margin-bottom: 8px;">6. Wait for confirmation message</p>
                    </div>

                    <div class="form-group">
                        <label class="form-label">M-Pesa Transaction Code</label>
                        <input type="text" class="form-input" id="paymentCode" placeholder="Enter transaction code (e.g., SDF45G7H)">
                    </div>

                    <div class="whatsapp-notice" style="background: #e3f2fd; border: 2px solid #2196f3; border-radius: 10px; padding: 15px; text-align: center; margin: 20px 0;">
                        <i class="fab fa-whatsapp" style="color: #25d366; font-size: 24px; margin-bottom: 10px;"></i>
                        <p><strong>WhatsApp Verification</strong></p>
                        <p style="font-size: 13px;">After submitting, your phone will send a WhatsApp message to admin automatically</p>
                    </div>

                    <button class="submit-btn" onclick="registerStudent()">
                        <i class="fas fa-paper-plane"></i> SUBMIT REGISTRATION & PAYMENT
                    </button>
                </div>

                <!-- Login Tab -->
                <div id="login" class="tab-content">
                    <div class="content-header">
                        <h1 class="main-title">Student Login</h1>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Phone Number</label>
                        <input type="tel" class="form-input" id="loginPhone" placeholder="07XXXXXXXX">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Unlock Code</label>
                        <input type="text" class="form-input" id="unlockCode" placeholder="Enter unlock code from admin">
                    </div>

                    <button class="submit-btn" onclick="loginStudent()">
                        <i class="fas fa-sign-in-alt"></i> LOGIN
                    </button>

                    <div style="text-align: center; margin-top: 20px;">
                        <button class="action-btn" onclick="showTab('register')" style="width: auto; padding: 12px 25px;">
                            <i class="fas fa-user-plus"></i> Not registered? Click here
                        </button>
                    </div>

                    <div id="loginMessage" style="margin-top: 20px; padding: 15px; border-radius: 8px; display: none;"></div>
                </div>

                <!-- Admin Tab -->
                <div id="admin" class="tab-content">
                    <div class="content-header">
                        <h1 class="main-title">Admin Control Panel</h1>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Admin Password</label>
                        <input type="password" class="form-input" id="adminPassword" placeholder="Enter admin password">
                    </div>

                    <button class="submit-btn" onclick="adminLogin()">
                        <i class="fas fa-sign-in-alt"></i> LOGIN AS ADMIN
                    </button>

                    <div id="adminPanel" style="display: none; margin-top: 30px;">
                        <div class="admin-tabs">
                            <button class="nav-btn" onclick="showAdminSection('pending')" style="flex: none; padding: 12px 20px;">Pending Approvals</button>
                            <button class="nav-btn" onclick="showAdminSection('students')" style="flex: none; padding: 12px 20px;">All Students</button>
                            <button class="nav-btn" onclick="showAdminSection('materials')" style="flex: none; padding: 12px 20px;">Manage Materials</button>
                        </div>

                        <div id="pendingSection" class="admin-section" style="display: none;">
                            <h3 style="color: var(--primary); margin-bottom: 15px;">ðŸ“‹ Pending Subscriptions</h3>
                            <div class="admin-list" id="pendingList"></div>
                        </div>

                        <div id="studentsSection" class="admin-section" style="display: none;">
                            <h3 style="color: var(--primary); margin-bottom: 15px;">ðŸ‘¥ All Registered Students</h3>
                            <div class="admin-list" id="studentList"></div>
                        </div>

                        <div id="materialsSection" class="admin-section" style="display: none;">
                            <h3 style="color: var(--primary); margin-bottom: 15px;">ðŸ“š Manage Study Materials</h3>
                            <div style="margin-bottom: 20px;">
                                <button class="submit-btn" onclick="addNewMaterial()" style="width: auto; padding: 12px 25px;">
                                    <i class="fas fa-plus"></i> Add New Material
                                </button>
                            </div>
                            <div class="admin-list" id="adminMaterialsList"></div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Right Sidebar -->
            <aside class="sidebar-right">
                <div class="sidebar-section">
                    <h2 class="section-title">
                        <i class="fas fa-folder"></i>
                        Categories
                    </h2>
                    <ul class="category-list" id="categoryList"></ul>
                </div>

                <div class="sidebar-section">
                    <h2 class="section-title">
                        <i class="fas fa-university"></i>
                        Universities
                    </h2>
                    <div class="university-grid" id="universityGrid"></div>
                </div>

                <div class="premium-banner">
                    <div class="premium-title">
                        <i class="fas fa-crown"></i>
                        PREMIUM ACCESS
                    </div>
                    <p style="font-size: 13px;">Unlock all study materials for 5 months</p>
                    <div class="premium-price">Ksh 67</div>
                    <p style="font-size: 12px; opacity: 0.9;">One payment, full access to all resources</p>
                    <button class="premium-btn" onclick="showTab('register')">
                        <i class="fas fa-bolt"></i> SUBSCRIBE NOW
                    </button>
                </div>

                <div style="margin-top: 30px; text-align: center; color: #64748b; font-size: 13px; line-height: 1.6;">
                    <p><i class="fas fa-shield-alt"></i> Secure Payment</p>
                    <p><i class="fas fa-headset"></i> 24/7 Support</p>
                    <p><i class="fas fa-check-circle"></i> Money Back Guarantee</p>
                </div>
            </aside>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>&copy; 2025 RevisionVault Pro â€¢ Developed by Walter Zauko</p>
            <p style="margin-top: 3px;">Contact: 0765 098 865 â€¢ All rights reserved</p>
        </footer>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <button class="nav-btn active" onclick="showTab('home')">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </button>
        <button class="nav-btn" onclick="showTab('materials')">
            <i class="fas fa-book"></i>
            <span>Materials</span>
        </button>
        <button class="nav-btn" onclick="showTab('register')">
            <i class="fas fa-user-plus"></i>
            <span>Register</span>
        </button>
        <button class="nav-btn" onclick="showTab('login')">
            <i class="fas fa-key"></i>
            <span>Login</span>
        </button>
        <button class="nav-btn" onclick="showTab('admin')">
            <i class="fas fa-shield-alt"></i>
            <span>Admin</span>
        </button>
    </div>

    <!-- PDF Viewer Modal -->
    <div class="modal" id="pdfModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="pdfModalTitle">Document Viewer</h2>
                <button class="close-modal" onclick="closeModal('pdfModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="pdf-viewer-container">
                    <iframe id="pdfViewer" src="about:blank"></iframe>
                    <div class="viewer-controls">
                        <button class="control-btn" onclick="prevPage()" id="prevBtn">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button class="control-btn" onclick="zoomOut()">
                            <i class="fas fa-search-minus"></i>
                        </button>
                        <div class="page-info">
                            Page <span id="currentPage">1</span> of <span id="totalPages">1</span>
                        </div>
                        <button class="control-btn" onclick="zoomIn()">
                            <i class="fas fa-search-plus"></i>
                        </button>
                        <button class="control-btn" onclick="nextPage()" id="nextBtn">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Chat Modal -->
    <div class="modal" id="aiChatModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title"><i class="fas fa-robot"></i> AI Study Assistant</h2>
                <button class="close-modal" onclick="closeModal('aiChatModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                    <p>AI Chat helps with essays, research, assignments, and study questions. Ask anything!</p>
                </div>
                
                <div id="aiChatMessages" style="height: 300px; overflow-y: auto; margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                    <div style="background: #f1f5f9; padding: 10px; border-radius: 10px; margin-bottom: 10px;">
                        <strong><i class="fas fa-robot"></i> AI Assistant:</strong> Hello! I'm your AI study assistant. How can I help you today?
                    </div>
                </div>
                
                <div class="form-group">
                    <input type="text" class="form-input" id="aiQuestion" placeholder="Ask me anything about your studies...">
                </div>
                
                <button class="submit-btn" onclick="askAI()">
                    <i class="fas fa-paper-plane"></i> Ask AI Assistant
                </button>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <div style="display: flex; justify-content: space-between; align-items: start;">
            <div>
                <strong id="notificationTitle"></strong>
                <p id="notificationMessage" style="margin-top: 5px;"></p>
            </div>
            <button onclick="hideNotification()" style="background: none; border: none; color: #6c757d; cursor: pointer;">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>

    <script>
        // ==================== APP DATA ====================
        const DOCUMENTS_DATA = [
            {
                "Title": "Plant Breeding notes",
                "Unit Code": "AGRO222",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Agronomy",
                "Year": "2",
                "Description": "lecture notes on plant Breeding",
                "URL": "https://drive.google.com/uc?id=17CG_rb_ecvnkLfjTzNC31u55pBR_RW70",
                "Trending": true,
                "Recent": true
            },
            {
                "Title": "Scope of production Economics",
                "Unit Code": "AGEC241",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Agricultural Economics",
                "Year": "2",
                "Description": "lecture notes on production Economics",
                "URL": "https://drive.google.com/uc?id=1uSBqGCfeWPr-upLjKOu-cCkwQUVW7GOU",
                "Trending": true
            },
            {
                "Title": "Production Economics",
                "Unit Code": "AGEC241",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Agricultural Economics",
                "Year": "2",
                "Description": "lecture notes on production Economics",
                "URL": "https://drive.google.com/uc?id=1LZ5P_t9qRlxZq2AyAI8JoG-bZAdS6G_c"
            },
            {
                "Title": "ICT Application in Agricultural Education and Extension",
                "Unit Code": "AGED113",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Agricultural Education and Extension",
                "Year": "2",
                "Description": "Examination paper on ICT Application in Agricultural Education and Extension",
                "URL": "https://drive.google.com/uc?id=1MxYZpCMFoxTLI6ZR0w9rBBAWeZ1h_bg_",
                "Recent": true
            },
            {
                "Title": "plant Breeding",
                "Unit Code": "AGRO222",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Agronomy",
                "Year": "2",
                "Description": "lecture notes on plant Breeding",
                "URL": "https://drive.google.com/uc?id=1wFm3cb1YRR9yD9f5noK4tg0HeD0K0jtg"
            },
            {
                "Title": "taxonomy of higher plants",
                "Unit Code": "BOTA241",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Botany",
                "Year": "2",
                "Description": "lecture notes on Taxonomy of higher plants",
                "URL": "https://drive.google.com/uc?id=102toSTJ9WewkGSiBKx3IxWlbPoeKrGCU"
            },
            {
                "Title": "plant physiology",
                "Unit Code": "BOTA271",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Botany",
                "Year": "2",
                "Description": "lecture notes on plant physiology",
                "URL": "https://drive.google.com/uc?id=1vSG6ErlBddO-dXBVu8Ice1ut297SiI5d"
            },
            {
                "Title": "Breeding practices",
                "Unit Code": "AGRO222",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Agronomy",
                "Year": "2",
                "Description": "lecture notes on breeding practices",
                "URL": "https://drive.google.com/uc?id=1nZfdRK6TTVLvR05-E70WPLBN51_m6G7C",
                "Recent": true
            },
            {
                "Title": "Cell biology",
                "Unit Code": "ZOOL232",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "zoology",
                "Year": "2",
                "Description": "lecture notes on cell biology",
                "URL": "https://drive.google.com/uc?id=1LlFPeHK2DjZBhYh8C0LP9DZMX-etSZd7"
            },
            {
                "Title": "course outline",
                "Unit Code": "AGEC241",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Agricultural Economics",
                "Year": "2",
                "Description": "lecture notes on production Economics",
                "URL": "https://drive.google.com/uc?id=15D0aQg6hUX3v1pKwxnQ0Al0vRVIVCfsO"
            },
            {
                "Title": "Epistemology and Education",
                "Unit Code": "EDFO112",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Education Foundation",
                "Year": "2",
                "Description": "lecture notes on Epistemology and Education",
                "URL": "https://drive.google.com/uc?id=1Z9vZTucmGM_Vcp-cTvHfWwOxzNNLgPkj"
            },
            {
                "Title": "Environmental Science",
                "Unit Code": "ENSC104",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Environmental Science",
                "Year": "2",
                "Description": "lecture notes on Environmental Education",
                "URL": "https://drive.google.com/uc?id=1Rd_mPqrUik3mh9LX6GQEgD5XOjDfw1gB"
            },
            {
                "Title": "Environmental Education",
                "Unit Code": "ENSC104",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Environmental Science",
                "Year": "2",
                "Description": "lecture notes on Environmental Education",
                "URL": "https://drive.google.com/uc?id=1px1TN0icV_IlUjRm9DpgVyyPHmSfqBNz"
            },
            {
                "Title": "introduction to entrepreneurship",
                "Unit Code": "AGBM102",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Agro business management",
                "Year": "2",
                "Description": "lecture notes on introduction to Enterpreneurship",
                "URL": "https://drive.google.com/uc?id=18KKbBRI1zzReDAAKaQ3lgNmYUHKfc57B"
            },
            {
                "Title": "Ecology",
                "Unit Code": "ZOOL210",
                "University": "Egerton University",
                "Type": "pdf",
                "Subject": "Zoology",
                "Year": "2",
                "Description": "lecture notes on ecology",
                "URL": "https://drive.google.com/uc?id=146nlk4PihaeonVHslq3GClWqwu5xsbeX",
                "Trending": true
            },
            {
                "Title": "SENV311",
                "Unit Code": "SENV311",
                "University": "University of Eldoret",
                "Type": "pdf",
                "Subject": "Environmental Science",
                "Year": "2",
                "Description": "groupwork assignment",
                "URL": "https://drive.google.com/uc?id=1yPUYlgNepiDrG8RFIraiO5vA3iLLlS6D",
                "Recent": true
            },
            {
                "Title": "Integral Calculus",
                "Unit Code": "MATH212",
                "University": "University of Nairobi",
                "Type": "pdf",
                "Subject": "Mathematics",
                "Year": "2",
                "Description": "2024 Main exam paper on integral calculus",
                "URL": "https://drive.google.com/file/d/sample1/view",
                "Trending": true
            },
            {
                "Title": "Analytical Geometry",
                "Unit Code": "MATH132",
                "University": "University of Nairobi",
                "Type": "pdf",
                "Subject": "Mathematics",
                "Year": "1",
                "Description": "Complete notes on analytical geometry",
                "URL": "https://drive.google.com/file/d/sample2/view"
            }
        ];

        // 20+ Kenyan Universities
        const UNIVERSITIES = [
            "University of Nairobi",
            "Kenyatta University",
            "Moi University",
            "Egerton University",
            "Jomo Kenyatta University of Agriculture and Technology",
            "Maseno University",
            "Masinde Muliro University of Science and Technology",
            "Dedan Kimathi University of Technology",
            "Technical University of Kenya",
            "Technical University of Mombasa",
            "Murang'a University of Technology",
            "Meru University of Science and Technology",
            "Kirinyaga University",
            "Laikipia University",
            "University of Eldoret",
            "Chuka University",
            "Karatina University",
            "Rongo University",
            "Kisii University",
            "South Eastern Kenya University",
            "Pwani University",
            "Co-operative University of Kenya",
            "Kabarak University",
            "Strathmore University",
            "Mount Kenya University",
            "Africa Nazarene University",
            "Catholic University of Eastern Africa",
            "Daystar University",
            "United States International University Africa",
            "Zetech University"
        ];

        // ==================== APP STATE ====================
        let appState = {
            currentUser: JSON.parse(localStorage.getItem('currentUser')) || null,
            users: JSON.parse(localStorage.getItem('users')) || [],
            documents: JSON.parse(localStorage.getItem('documents')) || DOCUMENTS_DATA,
            adminPassword: localStorage.getItem('adminPassword') || 'admin123',
            adminWhatsApp: localStorage.getItem('adminWhatsApp') || '254765098865',
            subscriptionPrice: localStorage.getItem('subscriptionPrice') || '67',
            currentPDF: null,
            currentPage: 1,
            totalPages: 1,
            zoom: 1,
            searchTimeout: null,
            allUnitCodes: []
        };

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            loadAppData();
            initializeUniversities();
            initializeCategories();
            initializeUnitCodes();
            renderHomeContent();
            updateAccessStatus();
            
            // Setup search
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', function(e) {
                clearTimeout(appState.searchTimeout);
                
                // Show suggestions as user types
                if (e.target.value.length > 1) {
                    showSearchSuggestions(e.target.value);
                } else {
                    hideSearchSuggestions();
                }
                
                // Debounce search for better performance
                appState.searchTimeout = setTimeout(() => {
                    searchByUnitCode(e.target.value);
                }, 300);
            });
            
            // Close suggestions when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.search-container')) {
                    hideSearchSuggestions();
                }
            });
            
            // Setup bottom nav button clicks
            document.querySelectorAll('.bottom-nav .nav-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.bottom-nav .nav-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            // Initialize sample data
            initializeSampleData();
        });

        function loadAppData() {
            if (localStorage.getItem('users')) {
                appState.users = JSON.parse(localStorage.getItem('users'));
            }
            if (localStorage.getItem('documents')) {
                appState.documents = JSON.parse(localStorage.getItem('documents'));
            }
            appState.adminPassword = localStorage.getItem('adminPassword') || 'admin123';
            appState.adminWhatsApp = localStorage.getItem('adminWhatsApp') || '254765098865';
            appState.subscriptionPrice = localStorage.getItem('subscriptionPrice') || '67';
        }

        function saveAppData() {
            localStorage.setItem('users', JSON.stringify(appState.users));
            localStorage.setItem('documents', JSON.stringify(appState.documents));
            localStorage.setItem('currentUser', JSON.stringify(appState.currentUser));
            localStorage.setItem('adminPassword', appState.adminPassword);
            localStorage.setItem('adminWhatsApp', appState.adminWhatsApp);
            localStorage.setItem('subscriptionPrice', appState.subscriptionPrice);
        }

        function initializeUniversities() {
            const universitySelects = [
                document.getElementById('universityFilter'),
                document.getElementById('allUniversityFilter'),
                document.getElementById('studentUniversity')
            ];
            
            universitySelects.forEach(select => {
                if (select) {
                    select.innerHTML = '<option value="all">All Universities</option>' +
                        UNIVERSITIES.map(uni => `<option value="${uni}">${uni}</option>`).join('');
                }
            });
            
            // Update university grid
            const grid = document.getElementById('universityGrid');
            if (grid) {
                grid.innerHTML = UNIVERSITIES.slice(0, 8).map(uni => `
                    <div class="university-card" onclick="filterByUniversity('${uni}')">
                        <div class="university-logo">${uni.substring(0, 2).toUpperCase()}</div>
                        <div class="university-name">${uni.length > 20 ? uni.substring(0, 18) + '...' : uni}</div>
                    </div>
                `).join('');
            }
        }

        function initializeCategories() {
            const categories = {};
            appState.documents.forEach(doc => {
                if (doc.Subject) {
                    categories[doc.Subject] = (categories[doc.Subject] || 0) + 1;
                }
            });
            
            // Update category list
            const categoryList = document.getElementById('categoryList');
            if (categoryList) {
                const sortedCategories = Object.entries(categories)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 8);
                
                categoryList.innerHTML = sortedCategories.map(([category, count]) => `
                    <li class="category-item" onclick="filterByCategory('${category}')">
                        <span class="category-name">${category}</span>
                        <span class="category-count">${count}</span>
                    </li>
                `).join('');
            }
            
            // Update subject filter
            const subjectFilter = document.getElementById('allSubjectFilter');
            if (subjectFilter) {
                subjectFilter.innerHTML = '<option value="all">All Subjects</option>' +
                    Object.keys(categories).map(subject => 
                        `<option value="${subject}">${subject}</option>`
                    ).join('');
            }
        }

        function initializeUnitCodes() {
            // Extract all unique unit codes for quick search
            const unitCodes = [...new Set(appState.documents.map(doc => doc["Unit Code"]))];
            appState.allUnitCodes = unitCodes;
            
            // Update quick units display
            const quickUnits = document.getElementById('quickUnits');
            if (quickUnits) {
                const popularUnits = unitCodes.slice(0, 8);
                quickUnits.innerHTML = popularUnits.map(code => `
                    <div class="unit-chip" onclick="quickSearch('${code}')">
                        ${code}
                    </div>
                `).join('');
            }
        }

        // ==================== SEARCH FUNCTIONS ====================
        function searchByUnitCode(query) {
            if (!query.trim()) {
                // Clear search results and show normal content
                document.getElementById('searchResults').classList.remove('active');
                document.getElementById('continueReading').style.display = 'block';
                return;
            }
            
            query = query.trim().toUpperCase();
            
            // Case-insensitive search
            const results = appState.documents.filter(doc => {
                const unitCode = doc["Unit Code"] || "";
                return unitCode.toUpperCase().includes(query);
            });
            
            if (results.length > 0) {
                // Show search results
                document.getElementById('continueReading').style.display = 'none';
                document.getElementById('searchResults').classList.add('active');
                document.getElementById('searchResultsTitle').textContent = `Search Results for "${query}" (${results.length} found)`;
                
                const grid = document.getElementById('searchResultsGrid');
                grid.innerHTML = results.map(doc => createMaterialCard(doc)).join('');
                
                // Auto-scroll to search results
                document.getElementById('searchResults').scrollIntoView({ behavior: 'smooth' });
            } else {
                // No results
                document.getElementById('continueReading').style.display = 'block';
                document.getElementById('searchResults').classList.remove('active');
                showNotification('No Results', `No materials found for "${query}"`, 'warning');
            }
            
            // Hide suggestions after search
            hideSearchSuggestions();
        }

        function showSearchSuggestions(query) {
            if (!query || query.length < 2) {
                hideSearchSuggestions();
                return;
            }
            
            query = query.trim().toUpperCase();
            const suggestions = appState.allUnitCodes.filter(code => 
                code.toUpperCase().includes(query)
            ).slice(0, 5);
            
            if (suggestions.length === 0) {
                hideSearchSuggestions();
                return;
            }
            
            const suggestionsContainer = document.getElementById('searchSuggestions');
            suggestionsContainer.innerHTML = suggestions.map(code => {
                // Find document for this unit code to get title
                const doc = appState.documents.find(d => d["Unit Code"] === code);
                return `
                    <div class="suggestion-item" onclick="selectSuggestion('${code}')">
                        <div class="suggestion-code">${code}</div>
                        ${doc ? `<div class="suggestion-title">${doc.Title}</div>` : ''}
                    </div>
                `;
            }).join('');
            
            suggestionsContainer.classList.add('active');
        }

        function hideSearchSuggestions() {
            document.getElementById('searchSuggestions').classList.remove('active');
        }

        function selectSuggestion(unitCode) {
            document.getElementById('searchInput').value = unitCode;
            searchByUnitCode(unitCode);
            hideSearchSuggestions();
        }

        function quickSearch(unitCode) {
            document.getElementById('searchInput').value = unitCode;
            searchByUnitCode(unitCode);
        }

        // ==================== UI FUNCTIONS ====================
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            
            // Show selected tab
            document.getElementById(tabName).style.display = 'block';
            
            // Update bottom nav active state
            document.querySelectorAll('.bottom-nav .nav-btn').forEach(btn => btn.classList.remove('active'));
            
            // Find and activate the corresponding button
            const buttons = {
                'home': 0,
                'materials': 1,
                'register': 2,
                'login': 3,
                'admin': 4
            };
            
            if (buttons[tabName] !== undefined) {
                document.querySelectorAll('.bottom-nav .nav-btn')[buttons[tabName]].classList.add('active');
            }
            
            // Clear search when switching tabs (except home)
            if (tabName !== 'home') {
                document.getElementById('searchInput').value = '';
                document.getElementById('searchResults').classList.remove('active');
                document.getElementById('continueReading').style.display = 'block';
                hideSearchSuggestions();
            }
            
            // Load content for the tab
            switch(tabName) {
                case 'home':
                    renderHomeContent();
                    break;
                case 'materials':
                    renderAllMaterials();
                    break;
                case 'admin':
                    document.getElementById('adminPassword').value = '';
                    break;
            }
        }

        function renderHomeContent() {
            renderContinueReading();
            renderTrendingMaterials();
        }

        function renderContinueReading() {
            const grid = document.getElementById('continueReadingGrid');
            const recentMaterials = appState.documents.filter(doc => doc.Recent).slice(0, 6);
            
            grid.innerHTML = recentMaterials.map(doc => createMaterialCard(doc)).join('');
        }

        function renderAllMaterials() {
            const grid = document.getElementById('allMaterialsGrid');
            grid.innerHTML = appState.documents.map(doc => createMaterialCard(doc)).join('');
        }

        function renderTrendingMaterials() {
            const grid = document.getElementById('trendingGrid');
            const trendingMaterials = appState.documents.filter(doc => doc.Trending).slice(0, 4);
            
            grid.innerHTML = trendingMaterials.map(doc => createMaterialCard(doc)).join('');
        }

        function createMaterialCard(doc) {
            const hasAccess = appState.currentUser && appState.currentUser.subscription && 
                             appState.currentUser.subscription.active;
            
            const badges = [];
            if (doc.Trending) badges.push('<div class="material-badge trending">TRENDING</div>');
            if (doc.Recent) badges.push('<div class="material-badge recent">RECENT</div>');
            
            return `
                <div class="material-card">
                    ${badges.join('')}
                    
                    <div class="material-image">
                        <i class="fas fa-file-pdf"></i>
                    </div>
                    
                    <div class="material-content">
                        <h3 class="material-title">${doc.Title}</h3>
                        
                        <div class="material-meta">
                            <span class="material-code">${doc["Unit Code"]}</span>
                            <span class="material-year">Year ${doc.Year}</span>
                        </div>
                        
                        <div class="material-info">
                            <i class="fas fa-university"></i>
                            <span>${doc.University}</span>
                        </div>
                        
                        <p class="material-description">${doc.Description}</p>
                        
                        <div class="material-actions">
                            ${hasAccess ? 
                                `<button class="action-btn view-btn" onclick="openDocumentViewer('${doc.URL}', '${doc.Title}')">
                                    <i class="fas fa-eye"></i> View Document
                                </button>` :
                                `<button class="action-btn view-btn" onclick="showTab('register')">
                                    <i class="fas fa-lock"></i> Subscribe to View
                                </button>`
                            }
                            <button class="action-btn preview-btn" onclick="previewLink('${doc.URL}')">
                                <i class="fas fa-external-link-alt"></i> Preview
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function filterMaterials() {
            const university = document.getElementById('universityFilter').value;
            const year = document.getElementById('yearFilter').value;
            
            let filtered = appState.documents;
            
            if (university !== 'all') {
                filtered = filtered.filter(doc => doc.University === university);
            }
            
            if (year !== 'all') {
                filtered = filtered.filter(doc => doc.Year.toString() === year);
            }
            
            const grid = document.getElementById('continueReadingGrid');
            grid.innerHTML = filtered.slice(0, 6).map(doc => createMaterialCard(doc)).join('');
        }

        function filterAllMaterials() {
            const university = document.getElementById('allUniversityFilter').value;
            const subject = document.getElementById('allSubjectFilter').value;
            
            let filtered = appState.documents;
            
            if (university !== 'all') {
                filtered = filtered.filter(doc => doc.University === university);
            }
            
            if (subject !== 'all') {
                filtered = filtered.filter(doc => doc.Subject === subject);
            }
            
            const grid = document.getElementById('allMaterialsGrid');
            grid.innerHTML = filtered.map(doc => createMaterialCard(doc)).join('');
        }

        function filterByCategory(category) {
            const filtered = appState.documents.filter(doc => doc.Subject === category);
            showTab('materials');
            
            setTimeout(() => {
                document.getElementById('allSubjectFilter').value = category;
                const grid = document.getElementById('allMaterialsGrid');
                grid.innerHTML = filtered.map(doc => createMaterialCard(doc)).join('');
                showNotification('Filter Applied', `Showing ${filtered.length} materials in ${category}`);
            }, 100);
        }

        function filterByUniversity(university) {
            const filtered = appState.documents.filter(doc => doc.University === university);
            showTab('materials');
            
            setTimeout(() => {
                document.getElementById('allUniversityFilter').value = university;
                const grid = document.getElementById('allMaterialsGrid');
                grid.innerHTML = filtered.map(doc => createMaterialCard(doc)).join('');
                showNotification('Filter Applied', `Showing ${filtered.length} materials from ${university}`);
            }, 100);
        }

        // ==================== SUBSCRIPTION FUNCTIONS ====================
        function registerStudent() {
            const name = document.getElementById('studentName').value.trim();
            const phone = document.getElementById('studentPhone').value.trim();
            const university = document.getElementById('studentUniversity').value;
            const course = document.getElementById('studentCourse').value.trim();
            const year = document.getElementById('studentYear').value;
            const paymentCode = document.getElementById('paymentCode').value.trim().toUpperCase();
            
            // Validation
            if (!name || !phone || !university || !course || !year || !paymentCode) {
                showNotification('Error', 'Please fill all fields', 'error');
                return;
            }
            
            if (!phone.match(/^0[17]\d{8}$/)) {
                showNotification('Error', 'Please enter a valid Kenyan phone number', 'error');
                return;
            }
            
            // Generate unlock code
            const unlockCode = generateUnlockCode();
            
            // Create student object
            const student = {
                id: Date.now(),
                name: name,
                phone: phone,
                university: university,
                course: course,
                year: year,
                registrationDate: new Date().toISOString(),
                subscription: {
                    active: false,
                    paymentCode: paymentCode,
                    unlockCode: unlockCode,
                    status: 'pending',
                    startDate: null,
                    endDate: null
                }
            };
            
            // Add to users array
            appState.users.push(student);
            saveAppData();
            
            // Send WhatsApp notification
            sendWhatsAppNotification(student);
            
            // Show success message
            showNotification('Success', 'Registration submitted! Check WhatsApp for verification instructions.', 'success');
            
            // Clear form
            document.getElementById('studentName').value = '';
            document.getElementById('studentPhone').value = '';
            document.getElementById('studentUniversity').value = '';
            document.getElementById('studentCourse').value = '';
            document.getElementById('studentYear').value = '';
            document.getElementById('paymentCode').value = '';
            
            // Show login tab
            setTimeout(() => showTab('login'), 2000);
        }

        function sendWhatsAppNotification(student) {
            const message = `ðŸ“š NEW SUBSCRIPTION REQUEST - RevisionVault Pro
            
ðŸ‘¤ Student: ${student.name}
ðŸ“± Phone: ${student.phone}
ðŸŽ“ University: ${student.university}
ðŸ“š Course: ${student.course}
ðŸ“… Year: ${student.year}
ðŸ’° Payment Code: ${student.subscription.paymentCode}
ðŸ”‘ Unlock Code: ${student.subscription.unlockCode}

Status: â³ PENDING APPROVAL

Please approve or reject this subscription.`;

            const whatsappUrl = `https://wa.me/${appState.adminWhatsApp}?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }

        function generateUnlockCode() {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
            let code = 'RV';
            for (let i = 0; i < 6; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        function loginStudent() {
            const phone = document.getElementById('loginPhone').value.trim();
            const unlockCode = document.getElementById('unlockCode').value.trim().toUpperCase();
            
            const student = appState.users.find(s => s.phone === phone);
            
            if (!student) {
                showLoginMessage('Student not found. Please register first.', 'error');
                return;
            }
            
            if (student.subscription.unlockCode !== unlockCode) {
                showLoginMessage('Invalid unlock code. Please check and try again.', 'error');
                return;
            }
            
            if (!student.subscription.active) {
                showLoginMessage('Your subscription is not active yet. Please wait for admin approval.', 'warning');
                return;
            }
            
            // Check if subscription has expired
            if (student.subscription.endDate && new Date(student.subscription.endDate) < new Date()) {
                student.subscription.active = false;
                saveAppData();
                showLoginMessage('Your subscription has expired. Please renew.', 'warning');
                return;
            }
            
            // Login successful
            appState.currentUser = student;
            saveAppData();
            
            showLoginMessage('âœ… Login successful! Full access granted for 5 months.', 'success');
            updateAccessStatus();
            
            // Redirect to home after 2 seconds
            setTimeout(() => {
                showTab('home');
                renderHomeContent();
            }, 2000);
        }

        function showLoginMessage(message, type) {
            const div = document.getElementById('loginMessage');
            div.textContent = message;
            div.style.display = 'block';
            div.style.background = type === 'error' ? '#f8d7da' : 
                                 type === 'warning' ? '#fff3cd' : '#d1fae5';
            div.style.border = type === 'error' ? '2px solid #dc3545' : 
                               type === 'warning' ? '2px solid #ffc107' : '2px solid #10b981';
            div.style.color = type === 'error' ? '#721c24' : 
                            type === 'warning' ? '#856404' : '#0f5132';
        }

        function updateAccessStatus() {
            const accessDiv = document.getElementById('accessStatus');
            if (!accessDiv) return;
            
            if (appState.currentUser && appState.currentUser.subscription.active) {
                accessDiv.className = 'access-status access-granted';
                accessDiv.innerHTML = `
                    <div class="access-text">
                        <h3><i class="fas fa-check-circle"></i> Access Granted</h3>
                        <p>Welcome, ${appState.currentUser.name}!</p>
                    </div>
                    <button class="view-btn" onclick="logout()" style="width: auto; padding: 10px 20px;">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                `;
            } else {
                accessDiv.className = 'access-status';
                accessDiv.innerHTML = `
                    <div class="access-text">
                        <h3><i class="fas fa-lock"></i> Access Locked</h3>
                        <p>Subscribe to unlock all study materials and features</p>
                    </div>
                    <button class="view-btn" onclick="showTab('register')" style="width: auto; padding: 10px 20px;">
                        <i class="fas fa-crown"></i> Subscribe Now
                    </button>
                `;
            }
        }

        function logout() {
            appState.currentUser = null;
            saveAppData();
            updateAccessStatus();
            showTab('home');
            showNotification('Logged Out', 'You have been logged out successfully.', 'info');
        }

        // ==================== ADMIN FUNCTIONS ====================
        function adminLogin() {
            const password = document.getElementById('adminPassword').value;
            
            if (password === appState.adminPassword) {
                document.getElementById('adminPanel').style.display = 'block';
                loadPendingApprovals();
                showNotification('Admin Access', 'Login successful!', 'success');
            } else {
                showNotification('Access Denied', 'Invalid admin password', 'error');
            }
        }

        function showAdminSection(section) {
            // Hide all sections
            document.querySelectorAll('.admin-section').forEach(sec => {
                sec.style.display = 'none';
            });
            
            // Show selected section
            document.getElementById(section + 'Section').style.display = 'block';
            
            // Load data for the section
            switch(section) {
                case 'pending':
                    loadPendingApprovals();
                    break;
                case 'students':
                    loadAllStudents();
                    break;
                case 'materials':
                    loadAdminMaterials();
                    break;
            }
        }

        function loadPendingApprovals() {
            const pendingList = document.getElementById('pendingList');
            const pending = appState.users.filter(u => u.subscription.status === 'pending');
            
            if (pending.length === 0) {
                pendingList.innerHTML = '<div style="text-align: center; padding: 40px; color: #6c757d;"><p>No pending approvals</p></div>';
                return;
            }
            
            pendingList.innerHTML = pending.map(student => `
                <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 10px; border: 2px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <strong>${student.name}</strong><br>
                        <small>${student.phone} â€¢ ${student.university}</small><br>
                        <small>Course: ${student.course} â€¢ Year: ${student.year}</small><br>
                        <small>Payment Code: ${student.subscription.paymentCode}</small>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="approveStudent(${student.id})" style="background: #10b981; color: white; border: none; width: 35px; height: 35px; border-radius: 50%; cursor: pointer;">
                            <i class="fas fa-check"></i>
                        </button>
                        <button onclick="deleteStudent(${student.id})" style="background: #ef4444; color: white; border: none; width: 35px; height: 35px; border-radius: 50%; cursor: pointer;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function loadAllStudents() {
            const studentList = document.getElementById('studentList');
            
            if (appState.users.length === 0) {
                studentList.innerHTML = '<div style="text-align: center; padding: 40px; color: #6c757d;"><p>No students registered</p></div>';
                return;
            }
            
            studentList.innerHTML = appState.users.map(student => `
                <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 10px; border: 2px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <strong>${student.name}</strong>
                        <span style="margin-left: 10px; font-size: 12px; background: ${student.subscription.active ? '#10b981' : '#ef4444'}; color: white; padding: 3px 10px; border-radius: 12px;">
                            ${student.subscription.active ? 'ACTIVE' : 'INACTIVE'}
                        </span><br>
                        <small>${student.phone} â€¢ ${student.university}</small><br>
                        <small>Course: ${student.course} â€¢ Year: ${student.year}</small><br>
                        <small>Unlock Code: ${student.subscription.unlockCode}</small>
                    </div>
                    <div>
                        <button onclick="deleteStudent(${student.id})" style="background: #ef4444; color: white; border: none; width: 35px; height: 35px; border-radius: 50%; cursor: pointer;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function loadAdminMaterials() {
            const materialsList = document.getElementById('adminMaterialsList');
            
            materialsList.innerHTML = appState.documents.map((doc, index) => `
                <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 10px; border: 2px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <strong>${doc.Title}</strong><br>
                        <small>${doc["Unit Code"]} â€¢ ${doc.University} â€¢ Year ${doc.Year}</small><br>
                        <small>Subject: ${doc.Subject}</small>
                    </div>
                    <div>
                        <button onclick="deleteMaterial(${index})" style="background: #ef4444; color: white; border: none; width: 35px; height: 35px; border-radius: 50%; cursor: pointer;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function approveStudent(studentId) {
            const student = appState.users.find(u => u.id === studentId);
            if (!student) return;
            
            student.subscription.active = true;
            student.subscription.status = 'approved';
            student.subscription.startDate = new Date().toISOString();
            student.subscription.endDate = new Date(Date.now() + 5 * 30 * 24 * 60 * 60 * 1000).toISOString();
            
            // Send approval message
            const approvalMessage = `ðŸŽ‰ SUBSCRIPTION APPROVED! - RevisionVault Pro
            
Dear ${student.name},

Your subscription has been approved!
ðŸ”‘ Unlock Code: ${student.subscription.unlockCode}

You can now login and access all study materials.

Thank you for subscribing!
Contact: 0765 098 865`;

            const whatsappUrl = `https://wa.me/254${student.phone.substring(1)}?text=${encodeURIComponent(approvalMessage)}`;
            
            if (confirm(`Approve subscription for ${student.name}?`)) {
                window.open(whatsappUrl, '_blank');
                saveAppData();
                loadPendingApprovals();
                loadAllStudents();
                showNotification('Approved', `Subscription approved for ${student.name}`, 'success');
            }
        }

        function deleteStudent(studentId) {
            if (confirm('Are you sure you want to delete this student?')) {
                appState.users = appState.users.filter(u => u.id !== studentId);
                saveAppData();
                loadPendingApprovals();
                loadAllStudents();
                showNotification('Deleted', 'Student deleted successfully', 'success');
            }
        }

        function deleteMaterial(index) {
            if (confirm('Are you sure you want to delete this material?')) {
                appState.documents.splice(index, 1);
                saveAppData();
                loadAdminMaterials();
                renderHomeContent();
                initializeCategories();
                showNotification('Deleted', 'Material deleted successfully', 'success');
            }
        }

        function addNewMaterial() {
            const title = prompt('Enter material title:');
            if (!title) return;
            
            const unitCode = prompt('Enter unit code:');
            if (!unitCode) return;
            
            const university = prompt('Enter university:');
            if (!university) return;
            
            const subject = prompt('Enter subject:');
            if (!subject) return;
            
            const year = prompt('Enter year (1-5):');
            if (!year) return;
            
            const description = prompt('Enter description:');
            if (!description) return;
            
            const url = prompt('Enter Google Drive URL:');
            if (!url) return;
            
            const newMaterial = {
                Title: title,
                "Unit Code": unitCode,
                University: university,
                Type: "pdf",
                Subject: subject,
                Year: year,
                Description: description,
                URL: url
            };
            
            appState.documents.push(newMaterial);
            saveAppData();
            loadAdminMaterials();
            renderHomeContent();
            initializeCategories();
            showNotification('Added', 'New material added successfully', 'success');
        }

        // ==================== PDF VIEWER FUNCTIONS ====================
        function openDocumentViewer(url, title) {
            if (!appState.currentUser || !appState.currentUser.subscription.active) {
                showTab('register');
                showNotification('Access Denied', 'Please subscribe to view documents', 'warning');
                return;
            }
            
            document.getElementById('pdfModalTitle').textContent = title;
            document.getElementById('pdfViewer').src = url;
            openModal('pdfModal');
        }

        function previewLink(url) {
            window.open(url, '_blank');
        }

        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // ==================== AI CHAT FUNCTIONS ====================
        function openAIChat() {
            if (!appState.currentUser || !appState.currentUser.subscription.active) {
                showTab('register');
                showNotification('Access Denied', 'Please subscribe to use AI Chat', 'warning');
                return;
            }
            
            openModal('aiChatModal');
        }

        function askAI() {
            const question = document.getElementById('aiQuestion').value.trim();
            if (!question) return;
            
            const chatMessages = document.getElementById('aiChatMessages');
            
            // Add user message
            chatMessages.innerHTML += `
                <div style="background: #e3f2fd; padding: 10px; border-radius: 10px; margin-bottom: 10px; text-align: right;">
                    <strong>You:</strong> ${question}
                </div>
            `;
            
            // Simulate AI response
            setTimeout(() => {
                const responses = [
                    `I understand you're asking about "${question}". Based on our study materials, I recommend checking the relevant PDFs for detailed information.`,
                    `For "${question}", you should focus on the key concepts in our study materials. The practice questions will help reinforce your understanding.`,
                    `That's a great question about "${question}". Our database shows several resources that can help you understand this topic better.`,
                    `Regarding "${question}", I suggest reviewing the lecture notes and practicing with the sample questions in our materials.`
                ];
                
                const response = responses[Math.floor(Math.random() * responses.length)];
                
                chatMessages.innerHTML += `
                    <div style="background: #f1f5f9; padding: 10px; border-radius: 10px; margin-bottom: 10px;">
                        <strong><i class="fas fa-robot"></i> AI Assistant:</strong> ${response}
                    </div>
                `;
                
                // Scroll to bottom
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 1000);
            
            // Clear input
            document.getElementById('aiQuestion').value = '';
        }

        // ==================== NOTIFICATION SYSTEM ====================
        function showNotification(title, message, type = 'info') {
            const notification = document.getElementById('notification');
            const titleElem = document.getElementById('notificationTitle');
            const messageElem = document.getElementById('notificationMessage');
            
            titleElem.textContent = title;
            messageElem.textContent = message;
            
            // Set color based on type
            notification.style.borderLeftColor = 
                type === 'error' ? '#ef4444' :
                type === 'success' ? '#10b981' :
                type === 'warning' ? '#f59e0b' : '#3b82f6';
            
            notification.classList.add('show');
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }

        function hideNotification() {
            document.getElementById('notification').classList.remove('show');
        }

        // Initialize sample data
        function initializeSampleData() {
            if (appState.users.length === 0) {
                // Add a sample approved user
                appState.users.push({
                    id: 1,
                    name: "John Doe",
                    phone: "0712345678",
                    university: "Egerton University",
                    course: "BSc Agriculture",
                    year: "2",
                    registrationDate: new Date().toISOString(),
                    subscription: {
                        active: true,
                        paymentCode: "ABC123XYZ",
                        unlockCode: "RVP7X9Y2",
                        status: 'approved',
                        startDate: new Date().toISOString(),
                        endDate: new Date(Date.now() + 5 * 30 * 24 * 60 * 60 * 1000).toISOString()
                    }
                });
                
                saveAppData();
            }
        }

        // ==================== ADVANCED FEATURES ====================
        
        // Download Tracking
        function trackDownload(materialId) {
            if (appState.currentUser) {
                // Track downloads in localStorage
                let downloads = JSON.parse(localStorage.getItem('downloads')) || {};
                if (!downloads[appState.currentUser.id]) {
                    downloads[appState.currentUser.id] = [];
                }
                downloads[appState.currentUser.id].push({
                    materialId: materialId,
                    date: new Date().toISOString()
                });
                localStorage.setItem('downloads', JSON.stringify(downloads));
            }
        }

        // Favorites System
        function toggleFavorite(materialId) {
            if (!appState.currentUser) {
                showNotification('Login Required', 'Please login to add favorites', 'warning');
                return;
            }
            
            let favorites = JSON.parse(localStorage.getItem('favorites')) || {};
            if (!favorites[appState.currentUser.id]) {
                favorites[appState.currentUser.id] = [];
            }
            
            const index = favorites[appState.currentUser.id].indexOf(materialId);
            if (index === -1) {
                favorites[appState.currentUser.id].push(materialId);
                showNotification('Added to Favorites', 'Material added to favorites', 'success');
            } else {
                favorites[appState.currentUser.id].splice(index, 1);
                showNotification('Removed from Favorites', 'Material removed from favorites', 'info');
            }
            
            localStorage.setItem('favorites', JSON.stringify(favorites));
        }

        // Study Progress Tracking
        function updateStudyProgress(materialId, progress) {
            if (appState.currentUser) {
                let studyProgress = JSON.parse(localStorage.getItem('studyProgress')) || {};
                if (!studyProgress[appState.currentUser.id]) {
                    studyProgress[appState.currentUser.id] = {};
                }
                studyProgress[appState.currentUser.id][materialId] = progress;
                localStorage.setItem('studyProgress', JSON.stringify(studyProgress));
            }
        }

        // Dark Mode Toggle
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
        }

        // Check for dark mode preference
        if (localStorage.getItem('darkMode') === 'true') {
            document.body.classList.add('dark-mode');
        }

        // Offline Detection
        window.addEventListener('online', function() {
            showNotification('Back Online', 'Your connection has been restored.', 'success');
        });

        window.addEventListener('offline', function() {
            showNotification('Offline Mode', 'You are currently offline. Some features may be limited.', 'warning');
        });
    </script>
</body>
</html>